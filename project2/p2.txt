–ß—É–¥–æ–≤–µ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è üëç
–í–∏ –º–∏—Å–ª–∏—Ç–µ –¥—É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî —Ç–µ–ø–µ—Ä, –∫–æ–ª–∏ –≤–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤—ñ–¥ `USER_NFC` –¥–æ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–æ—ó `USER_TAG`, –∑–∞–ø–∏—Ç –¥–ª—è –ø–æ—à—É–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–µ–∂ —Ç—Ä–µ–±–∞ –∑—Ä–æ–±–∏—Ç–∏ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–º —ñ –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–∏–º (—â–æ–± –ø—Ä–∞—Ü—é–≤–∞–≤ —ñ –∑ NFC, —ñ –∑ RFID, —ñ –Ω–∞–¥–∞–ª—ñ –∑ —ñ–Ω—à–∏–º–∏ —Ç–∏–ø–∞–º–∏).

–ù–∏–∂—á–µ ‚Äî –ø–æ–∫—Ä–æ–∫–æ–≤–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è —ñ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π SQL-–∑–∞–ø–∏—Ç.

---

## üîπ 1. –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

–£ –Ω–∞—Å —Ç–µ–ø–µ—Ä —î —Ç–∞–±–ª–∏—Ü—ñ:

```sql
USER_TAG(USER_ID, TAG_TYPE_ID, TAG_CODE)
TAG_TYPE_LU(ID, CODE)       -- –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 'NFC', 'RFID'
AUTH_METHOD_LU(ID, CODE)    -- –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 'MANUAL', 'TAG'
```

–Ü —î –≤—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ç–∏–º—á–∞—Å–æ–≤–∞ —Ç–∞–±–ª–∏—Ü—è `INDATA`):

```sql
INDATA (CODE, TAG_TYPE)  -- –º–æ–∂–µ –º–∞—Ç–∏ TAG_TYPE = 'NFC' –∞–±–æ 'RFID' –∞–±–æ NULL
```

---

## üîπ 2. –ù–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ –ø–æ—à—É–∫—É

1. –Ø–∫—â–æ `TAG_TYPE` = 'NFC' –∞–±–æ 'RFID' ‚Üí —à—É–∫–∞—î–º–æ –≤ `USER_TAG` –ø–æ `TAG_TYPE_LU.CODE`.
2. –Ø–∫—â–æ `TAG_TYPE` –≤—ñ–¥—Å—É—Ç–Ω—ñ–π ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ `CODE` ‚Äî —Ü–µ —á–∏—Å–ª–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è (—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞).
3. –Ø–∫—â–æ —î –∫—ñ–ª—å–∫–∞ –∑–±—ñ–≥—ñ–≤, –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç: **NFC > RFID > MANUAL**.

---

## üîπ 3. –û–Ω–æ–≤–ª–µ–Ω–∏–π –∑–∞–ø–∏—Ç

```sql
SELECT user_id, method
FROM (
  -- 1. NFC
  SELECT ut.user_id, 'NFC' AS method, 1 AS ord
    FROM user_tag ut
    JOIN tag_type_lu tt ON ut.tag_type_id = tt.id
    JOIN indata d ON tt.code = 'NFC' AND ut.tag_code = d.code

  UNION ALL

  -- 2. RFID
  SELECT ut.user_id, 'RFID' AS method, 2 AS ord
    FROM user_tag ut
    JOIN tag_type_lu tt ON ut.tag_type_id = tt.id
    JOIN indata d ON tt.code = 'RFID' AND ut.tag_code = d.code

  UNION ALL

  -- 3. MANUAL (—è–∫—â–æ –∫–æ–¥ ‚Äî —Ü–µ —á–∏—Å–ª–æ)
  SELECT u.user_id, 'MANUAL' AS method, 3 AS ord
    FROM users u
    JOIN indata d
      ON REGEXP_LIKE(d.code, '^\d+$')
     AND u.user_id = TO_NUMBER(d.code)
)
ORDER BY ord
FETCH FIRST 1 ROW ONLY;
```

---

## üîπ 4. –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

| –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç | –ú–µ—Ç–æ–¥  | –£–º–æ–≤–∞ –ø–æ—à—É–∫—É                                     |
| --------- | ------ | ------------------------------------------------ |
| 1         | NFC    | –ó–±—ñ–≥ —É `USER_TAG` –¥–ª—è `TAG_TYPE='NFC'`           |
| 2         | RFID   | –ó–±—ñ–≥ —É `USER_TAG` –¥–ª—è `TAG_TYPE='RFID'`          |
| 3         | MANUAL | –Ø–∫—â–æ –≤–≤–µ–¥–µ–Ω–æ —á–∏—Å–ª–æ–≤–∏–π –∫–æ–¥, —â–æ –¥–æ—Ä—ñ–≤–Ω—é—î `USER_ID` |

> –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ NFC- —ñ RFID-–º—ñ—Ç–∫–∏ –º–∞—é—Ç—å –æ–¥–Ω–∞–∫–æ–≤–∏–π –∫–æ–¥, Oracle —Ç–æ—á–Ω–æ —Ä–æ–∑—Ä—ñ–∑–Ω–∏—Ç—å —ó—Ö –∑–∞ `TAG_TYPE_ID`.

---

## üîπ 5. –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω—ñ—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç (–Ω–∞ –≤–∏–ø–∞–¥–æ–∫ –¥–æ–¥–∞–≤–∞–Ω–Ω—è BLE, QR —ñ —Ç.–¥.)

–Ø–∫—â–æ —Ç–∏–ø –º—ñ—Ç–∫–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —É –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö (`indata.tag_type`), –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ñ—à–µ:

```sql
SELECT user_id, method
FROM (
  -- 1. –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π –ø–æ—à—É–∫ –ø–æ –º—ñ—Ç–∫–∞—Ö
  SELECT ut.user_id, tt.code AS method, 1 AS ord
    FROM user_tag ut
    JOIN tag_type_lu tt ON ut.tag_type_id = tt.id
    JOIN indata d
      ON ut.tag_code = d.code
     AND (d.tag_type IS NULL OR tt.code = d.tag_type)

  UNION ALL

  -- 2. MANUAL
  SELECT u.user_id, 'MANUAL' AS method, 2 AS ord
    FROM users u
    JOIN indata d
      ON REGEXP_LIKE(d.code, '^\d+$')
     AND u.user_id = TO_NUMBER(d.code)
)
ORDER BY ord
FETCH FIRST 1 ROW ONLY;
```

‚úÖ –ø—ñ–¥—Ç—Ä–∏–º—É—î –±—É–¥—å-—è–∫—ñ —Ç–∏–ø–∏ –º—ñ—Ç–æ–∫ —ñ–∑ `TAG_TYPE_LU`
‚úÖ –º–æ–∂–Ω–∞ –ª–µ–≥–∫–æ –¥–æ–¥–∞—Ç–∏ BLE –∞–±–æ QR –±–µ–∑ –∑–º—ñ–Ω–∏ SQL
‚úÖ NFC —ñ RFID –º–∞—é—Ç—å —Ä—ñ–∑–Ω—ñ `TAG_TYPE_ID`, —Ç–æ–º—É –∫–æ–ª—ñ–∑—ñ–π –Ω–µ –±—É–¥–µ

---

–•–æ—á–µ—Ç–µ, —è –ø–æ–∫–∞–∂—É –≤–∞—Ä—ñ–∞–Ω—Ç **PL/SQL-—Ñ—É–Ω–∫—Ü—ñ—ó `get_user_by_tag(p_code, p_tag_type)`**, —è–∫–∞ —Ä–µ–∞–ª—ñ–∑—É—î —Ü—é –ª–æ–≥—ñ–∫—É –π –ø–æ–≤–µ—Ä—Ç–∞—î `USER_ID` + `METHOD` —è–∫ –∑–∞–ø–∏—Å?
s