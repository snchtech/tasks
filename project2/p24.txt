–î–æ–±—Ä–µ, —Ç–æ–¥—ñ –º–∏ –≤–∂–µ –∑–Ω–∞—î–º–æ –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–µ: **—ñ–Ω–¥–µ–∫—Å —É —Ç–µ–±–µ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ** üëå
–¢–∏ –±–∞—á–∏—à —É PL/SQL Developer:

```
USER_ID,
TAG_ID,
CASE WHEN DATE_END IS NULL THEN 1 END
```

–¶–µ –æ–∑–Ω–∞—á–∞—î:

* –¥–ª—è –∞–∫—Ç–∏–≤–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ ‚Üí –∑–Ω–∞—á–µ–Ω–Ω—è = `1`,
* –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏—Ö ‚Üí **NULL**,
  —Ç–æ–±—Ç–æ –±–∞–∑–∞ *–¥–æ–∑–≤–æ–ª—è—î* –±—É–¥—å-—è–∫—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤.

–¶–µ —Å–∞–º–µ —Ç–µ, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ ‚Äî —Ç–∞–∫–∏–π —ñ–Ω–¥–µ–∫—Å **–Ω–µ –º–æ–∂–µ** –¥–∞–≤–∞—Ç–∏ ORA-00001 –ø—Ä–∏ –ø–æ—è–≤—ñ –¥—Ä—É–≥–æ—ó –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—ó –º—ñ—Ç–∫–∏.

üëâ **–ê–ª–µ —Ç–∏ –æ—Ç—Ä–∏–º—É—î—à ORA-00001**.
–ó–Ω–∞—á–∏—Ç—å, –ø—Ä–∏—á–∏–Ω–∞ –Ω–µ –≤ —Ü—å–æ–º—É —É–Ω—ñ–∫–∞–ª—å–Ω–æ–º—É —ñ–Ω–¥–µ–∫—Å—ñ.

---

# ‚úÖ –†–µ–∞–ª—å–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ ORA-00001 –≤ —Ç–≤–æ—ó–π —Å–∏—Ç—É–∞—Ü—ñ—ó

–ü—Ä–∏ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –º—ñ—Ç–∫–∏ —Ç–∏ –ù–ï –æ–Ω–æ–≤–ª—é—î—à –ª–∏—à–µ `DATE_END`.
–¢–∏ –æ–Ω–æ–≤–ª—é—î—à **—ñ user_id / tag_type_id / tag_code**, –∞–±–æ —Ç–≤—ñ–π Process/DA / –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Ä–æ–±–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–∏–π –ø—Ä–∏—Å–≤–æ—î–Ω–Ω—è —Ü–∏—Ö –∑–Ω–∞—á–µ–Ω—å ‚Üí —ñ –≤ —Ü–µ–π –º–æ–º–µ–Ω—Ç —Å–ø—Ä–∞—Ü—å–æ–≤—É—î **—ñ–Ω—à–∏–π** —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–Ω–¥–µ–∫—Å:

üìå **UX_USER_TAG_ACTIVE_CODE**
–∞–±–æ
üìå **–ø–µ—Ä–≤–∏–Ω–Ω–∏–π –∫–ª—é—á / —ñ–Ω—à–∏–π constraint**, —è–∫–∏–π —Ç–∏ —Å—Ç–≤–æ—Ä—é–≤–∞–ª–∞ —Ä–∞–Ω—ñ—à–µ.

–ë–æ —è–∫—â–æ —ñ–Ω–¥–µ–∫—Å, —è–∫–∏–π —Ç–∏ –ø–æ–∫–∞–∑–∞–ª–∞ (`user_id, tag_type_id, CASE WHEN date_end IS NULL THEN 1 END`) ‚Äî —á–∏—Å—Ç–∏–π, –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π,
—Ç–æ–¥—ñ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç –π–¥–µ –Ω–µ –≤—ñ–¥ –Ω—å–æ–≥–æ.

---

# üîç –Ø–∫ —Ü–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ (—Ç–æ—á–Ω–æ –≤–∫–∞–∑–∞—Ç–∏ –≤–∏–Ω—É–≤–∞—Ç—Ü—è)

–í–∏–∫–æ–Ω–∞–π —É SQL Developer / PL/SQL Developer:

```sql
SELECT constraint_name, constraint_type
FROM user_constraints
WHERE table_name = 'USER_TAG'
  AND status = 'ENABLED';
```

–Ü –¥–æ–¥–∞—Ç–∫–æ–≤–æ:

```sql
SELECT index_name
FROM user_indexes
WHERE table_name = 'USER_TAG';
```

–Ø –≥–∞—Ä–∞–Ω—Ç—É—é, —â–æ –ø–æ–±–∞—á–∏—à —â–µ –æ–¥–∏–Ω —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–Ω–¥–µ–∫—Å, —è–∫–∏–π –≤–∏–∫–ª–∏–∫–∞—î ORA-00001.

99% —Ü–µ –±—É–¥–µ:

### ‚ùó `UX_USER_TAG_ACTIVE_CODE`

–ê –≤—ñ–Ω –≤–∏–≥–ª—è–¥–∞—î —Ç–∞–∫:

```sql
CREATE UNIQUE INDEX ux_user_tag_active_code
  ON user_tag (
    tag_type_id,
    tag_code,
    CASE WHEN date_end IS NULL THEN 1 END
  );
```

–¢–µ–ø–µ—Ä —É—è–≤–∏, —â–æ:

* —Ç–∏ –¥–µ–∞–∫—Ç–∏–≤—É—î—à –¥—Ä—É–≥–∏–π –∑–∞–ø–∏—Å,
* DA –∞–±–æ –ø—Ä–æ—Ü–µ—Å –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏—Å–≤–æ—é—î `tag_type_id` —ñ `tag_code`,
* –≤ —Ü–µ–π –º–æ–º–µ–Ω—Ç **–æ–±–∏–¥–≤–∞ –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—é—Ç—å –æ–¥–Ω–∞–∫–æ–≤–∏–º–∏** (–¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏—Ö CASE= NULL),
* —ñ —Ü–µ–π —ñ–Ω–¥–µ–∫—Å –ø–æ—á–∏–Ω–∞—î –∑–∞–±–æ—Ä–æ–Ω—è—Ç–∏:

> –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –¥–≤–æ—Ö –æ–¥–Ω–∞–∫–æ–≤–∏—Ö `(tag_type_id, tag_code, NULL)`.

–¶–µ —ñ —î –¥–∂–µ—Ä–µ–ª–æ –ø–æ–º–∏–ª–∫–∏.

---

# üü© –Ø–∫ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏

–ü–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ —ñ–Ω–¥–µ–∫—Å **ux_user_tag_active_code**, —â–æ–± –≤—ñ–Ω –ø—Ä–∞—Ü—é–≤–∞–≤ —Ç–∞–∫ —Å–∞–º–æ, —è–∫ —ñ–Ω–¥–µ–∫—Å –ø–æ user_id ‚Äî –¥–æ–∑–≤–æ–ª—è–≤ –±–∞–≥–∞—Ç–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –∑ –æ–¥–Ω–∞–∫–æ–≤–∏–º –∫–æ–¥–æ–º.

–ü–µ—Ä–µ–≤—ñ—Ä, —è–∫ –≤—ñ–Ω —Å—Ç–≤–æ—Ä–µ–Ω–∏–π (—á–µ—Ä–µ–∑ `user_ind_expressions`).
–Ø–∫—â–æ –≤—ñ–Ω –º–∞—î ELSE –∞–±–æ NVL, –ø–µ—Ä–µ–ø–∏—à–∏ —Ç–∞–∫:

## –ü—Ä–∞–≤–∏–ª—å–Ω–æ:

```sql
DROP INDEX ux_user_tag_active_code;

CREATE UNIQUE INDEX ux_user_tag_active_code
  ON user_tag (
    tag_type_id,
    tag_code,
    CASE WHEN date_end IS NULL THEN 1 END
  );
```

–¢—É—Ç:

* –∞–∫—Ç–∏–≤–Ω–∏–π ‚Üí `(tag_type_id, tag_code, 1)` ‚Üí —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π,
* –Ω–µ–∞–∫—Ç–∏–≤–Ω—ñ ‚Üí `(tag_type_id, tag_code, NULL)` ‚Üí –¥–æ–ø—É—Å–∫–∞—î—Ç—å—Å—è –±–∞–≥–∞—Ç–æ.

---

# üü¶ –Ø–∫—â–æ —Ü–µ–π —ñ–Ω–¥–µ–∫—Å —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π, –ø—Ä–∏—á–∏–Ω–∞ —ñ–Ω—à–∞ ‚Äî —ñ —è –∑–Ω–∞–π–¥—É —ó—ó

–ü–æ—Ç—Ä—ñ–±–Ω–æ –æ—Ç—Ä–∏–º–∞—Ç–∏:

1. **DDL –≤—Å—ñ—Ö —ñ–Ω–¥–µ–∫—Å—ñ–≤ —Ç–∞–±–ª–∏—Ü—ñ:**

```sql
SELECT dbms_metadata.get_ddl('INDEX', index_name)
FROM user_indexes
WHERE table_name = 'USER_TAG';
```

2. **DDL constraint‚Äô—ñ–≤:**

```sql
SELECT dbms_metadata.get_ddl('CONSTRAINT', constraint_name)
FROM user_constraints
WHERE table_name = 'USER_TAG';
```

–°–∫–∏–Ω—å —Ü–µ ‚Äî —ñ —è —Å–∫–∞–∂—É **—è–∫–∏–π —Å–∞–º–µ —ñ–Ω–¥–µ–∫—Å –±–ª–æ–∫—É—î** —Ç–≤—ñ–π UPDATE –ø—Ä–∏ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü—ñ—ó.

---

# üìå –ü–Ü–î–°–£–ú–û–ö

* –¢–≤—ñ–π —ñ–Ω–¥–µ–∫—Å `ux_user_tag_active_user` –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π ‚Üí –Ω–µ –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ ORA-00001.
* ORA-00001 –¥–∞—î —ñ–Ω—à–∏–π —ñ–Ω–¥–µ–∫—Å ‚Üí –º–∞–π–∂–µ —Ç–æ—á–Ω–æ `ux_user_tag_active_code`.
* –¢—Ä–µ–±–∞ –π–æ–≥–æ –ø–æ–ø—Ä–∞–≤–∏—Ç–∏, —â–æ–± –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ CASE –ø–æ–≤–µ—Ä—Ç–∞–≤ NULL.

–•–æ—á–µ—à ‚Äî —Å–∫–∏–Ω—å DDL —ñ–Ω–¥–µ–∫—Å—ñ–≤, —ñ —è —Å–∫–∞–∂—É —Ç–æ—á–Ω–∏–π —Ä—è–¥–æ–∫, —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–º—ñ–Ω–∏—Ç–∏.
