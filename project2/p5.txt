–û–∫–µ–π, —Ü–µ —è–∫—Ä–∞–∑ —Ç–æ–π –≤–∏–ø–∞–¥–æ–∫, –¥–µ –≤–∞—Ä—Ç–æ ‚Äú–Ω–æ—Ä–º–∞–ª—ñ–∑—É–≤–∞—Ç–∏‚Äù –≤—Å–µ –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ üí≥

–¢–≤–æ—ó –≤–∏–º–æ–≥–∏:

* —É –ë–î **–∑–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ –¥–µ—Å—è—Ç–∫–æ–≤–∏–π –∫–æ–¥**;
* –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ –≤—Å—Ç–∞–≤–∏—Ç–∏:

  * –≤–∂–µ **–¥–µ—Å—è—Ç–∫–æ–≤–∏–π** –∫–æ–¥;
  * –∞–±–æ **HEX** (–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ Android: `04:A3:BC:1F:2D:90:80` —Ç–æ—â–æ);
* —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞:

  * –ø—Ä–∏–±–∏—Ä–∞—î —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫–∏ (`:`, `-`, –ø—Ä–æ–±—ñ–ª–∏);
  * –≤–∏–∑–Ω–∞—á–∞—î, —Ü–µ **–¥–µ—Å—è—Ç–∫–æ–≤–µ** —á–∏ **—à—ñ—Å—Ç–Ω–∞–¥—Ü—è—Ç–∫–æ–≤–µ**;
  * –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ ‚Äî **–∫–æ–Ω–≤–µ—Ä—Ç—É—î HEX ‚Üí DEC**;
  * —É —Ä–∞–∑—ñ –ø–æ–º–∏–ª–∫–∏ ‚Äî –¥–∞—î –∑—Ä–æ–∑—É–º—ñ–ª–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

---

## 1. PL/SQL-—Ñ—É–Ω–∫—Ü—ñ—è –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó (HEX ‚Üí DEC –∞–±–æ –≤–∂–µ DEC)

–ü—Ä–æ–ø–æ–Ω—É—é –∑—Ä–æ–±–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é –≤ –ø–∞–∫–µ—Ç—ñ (–∞–±–æ –æ–∫—Ä–µ–º—É):

```plsql
CREATE OR REPLACE FUNCTION normalize_tag_code (p_raw IN VARCHAR2)
  RETURN VARCHAR2
IS
  v_clean VARCHAR2(128);
  v_num   NUMBER;
BEGIN
  IF p_raw IS NULL THEN
    RETURN NULL;
  END IF;

  -- 1. –ü—Ä–∏–±–∏—Ä–∞—î–º–æ –∑–∞–π–≤—ñ —Å–∏–º–≤–æ–ª–∏: –ø—Ä–æ–±—ñ–ª–∏, –¥–≤–æ–∫—Ä–∞–ø–∫–∏, –¥–µ—Ñ—ñ—Å–∏ —Ç–æ—â–æ
  v_clean := REGEXP_REPLACE(UPPER(TRIM(p_raw)), '[^0-9A-F]', '');

  IF v_clean IS NULL THEN
    RAISE_APPLICATION_ERROR(-20001, '–ö–æ–¥ –º—ñ—Ç–∫–∏ –ø–æ—Ä–æ–∂–Ω—ñ–π –∞–±–æ –º—ñ—Å—Ç–∏—Ç—å –ª–∏—à–µ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ —Å–∏–º–≤–æ–ª–∏.');
  END IF;

  -- 2. –Ø–∫—â–æ —Ç—ñ–ª—å–∫–∏ —Ü–∏—Ñ—Ä–∏ -> –≤–≤–∞–∂–∞—î–º–æ, —â–æ —Ü–µ –≤–∂–µ –¥–µ—Å—è—Ç–∫–æ–≤–∏–π –∫–æ–¥
  IF REGEXP_LIKE(v_clean, '^[0-9]+$') THEN
    -- –ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∫–æ–≤–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥—ñ–∞–ø–∞–∑–æ–Ω, —è–∫—â–æ —Ç—Ä–µ–±–∞
    RETURN TO_CHAR(TO_NUMBER(v_clean));
  
  -- 3. –Ø–∫—â–æ —Ü–∏—Ñ—Ä–∏ + A‚ÄìF -> —Ü–µ HEX, –∫–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ –≤ DEC
  ELSIF REGEXP_LIKE(v_clean, '^[0-9A-F]+$') THEN
    v_num := TO_NUMBER(v_clean, 'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');
    RETURN TO_CHAR(v_num);
  
  -- 4. –Ø–∫—â–æ –∑–º—ñ—à–∞–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç ‚Äî –ø–æ–º–∏–ª–∫–∞
  ELSE
    RAISE_APPLICATION_ERROR(-20002, '–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–¥—É –º—ñ—Ç–∫–∏ (–¥–æ–∑–≤–æ–ª–µ–Ω—ñ —Ç—ñ–ª—å–∫–∏ —Ü–∏—Ñ—Ä–∏ –∞–±–æ HEX-—Å–∏–º–≤–æ–ª–∏ 0‚Äì9, A‚ÄìF).');
  END IF;
END normalize_tag_code;
/
```

–ü–æ—è—Å–Ω–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏:

* `REGEXP_REPLACE(..., '[^0-9A-F]', '')` ‚Äî –ø—Ä–∏–±–∏—Ä–∞—î–º–æ **–≤—Å–µ, –∫—Ä—ñ–º 0‚Äì9 —Ç–∞ A‚ÄìF**, —Ç–æ–±—Ç–æ:

  * `04:A3:BC:1F` ‚Üí `04A3BC1F`
  * `04-A3-BC-1F` ‚Üí `04A3BC1F`
* `^[0-9]+$` ‚Üí —á–∏—Å—Ç–æ –¥–µ—Å—è—Ç–∫–æ–≤—ñ —Ü–∏—Ñ—Ä–∏.
* `^[0-9A-F]+$` ‚Üí HEX (—è–∫—â–æ —î –ª—ñ—Ç–µ—Ä–∏ A‚ÄìF).
* `TO_NUMBER(v_clean, 'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX')` ‚Äî –±–µ–∑–ø–µ—á–Ω–µ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è HEX ‚Üí NUMBER (–¥–æ 32 –Ω—ñ–±–ª—ñ–≤, —Ç–æ–±—Ç–æ –¥–æ–≤–æ–ª—ñ –≤–µ–ª–∏–∫–∏–π –∫–æ–¥; –¥–ª—è NFC UID/ID –∑ –≥–æ–ª–æ–≤–æ—é –≤–∏—Å—Ç–∞—á–∞—î).

---

## 2. –Ø–∫ –æ—Ä–≥–∞–Ω—ñ–∑—É–≤–∞—Ç–∏ —Ä–æ–±–æ—Ç—É –Ω–∞ —Ñ–æ—Ä–º—ñ –≤ APEX

### –í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –Ω–∞ —Ñ–æ—Ä–º—ñ

–ù–∞ –º–æ–¥–∞–ª—å–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∑–≤‚Äô—è–∑–∫—É –ø—Ä–æ–ø–æ–Ω—É—é —Ç–∞–∫—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

1. `PYY_USER_ID` ‚Äì Popup LOV (—è–∫ —Ç–∏ –ø–ª–∞–Ω—É–≤–∞–ª–∞).
2. `PYY_TAG_CODE_INPUT` ‚Äì —Ç–µ–∫—Å—Ç–æ–≤–µ –ø–æ–ª–µ, **–∫—É–¥–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –≤—Å—Ç–∞–≤–ª—è—î –±—É–¥—å-—è–∫–∏–π —Ñ–æ—Ä–º–∞—Ç** (–¥–µ—Üimal / hex / –∑ –¥–≤–æ–∫—Ä–∞–ø–∫–∞–º–∏).
3. `PYY_TAG_CODE` ‚Äì **–ø—Ä–∏—Ö–æ–≤–∞–Ω–µ** –∞–±–æ **Display Only** –ø–æ–ª–µ, —è–∫–µ –≤–∂–µ –º—ñ—Å—Ç–∏—Ç–∏–º–µ **—á–∏—Å—Ç–∏–π –¥–µ—Å—è—Ç–∫–æ–≤–∏–π –∫–æ–¥** –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ `USER_TAG.TAG_CODE`.
4. `PYY_TAG_TYPE_ID` ‚Äì Select List —ñ–∑ `TAG_TYPE_LU`.

---

### –í–∞—Ä—ñ–∞–Ω—Ç –ê: –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è ‚Äú–Ω–∞ –ª—å–æ—Ç—É‚Äù (–ø—Ä–∏ –∑–º—ñ–Ω—ñ –ø–æ–ª—è)

UX-–≤–∞—Ä—ñ–∞–Ω—Ç –¥–ª—è –∞–¥–º—ñ–Ω–∞ –Ω–∞–π–∑—Ä—É—á–Ω—ñ—à–∏–π:
–≤—ñ–Ω —â–æ—Å—å –≤—Å—Ç–∞–≤–∏–≤ ‚Üí –æ–¥—Ä–∞–∑—É –±–∞—á–∏—Ç—å, —è–∫–∏–π –¥–µ—Å—è—Ç–∫–æ–≤–∏–π –∫–æ–¥ –≤–∏–π—à–æ–≤.

#### –ö—Ä–æ–∫–∏:

1. **Item** `PYY_TAG_CODE_INPUT`

   * Label: ‚Äú–ö–æ–¥ –º—ñ—Ç–∫–∏ (–º–æ–∂–Ω–∞ –≤—Å—Ç–∞–≤–ª—è—Ç–∏ HEX / Android-—Ñ–æ—Ä–º–∞—Ç)‚Äù

2. **Item** `PYY_TAG_CODE`

   * Type: Display Only (–∞–±–æ Text Field Read Only)
   * Label: ‚Äú–î–µ—Å—è—Ç–∫–æ–≤–∏–π –∫–æ–¥ –º—ñ—Ç–∫–∏‚Äù

3. –î–æ–¥–∞—î–º–æ **Dynamic Action**:

   * **Event:** Change
   * **Selection Type:** Item(s)
   * **Item:** `PYY_TAG_CODE_INPUT`

#### True Action 1: Execute PL/SQL Code (Set Value)

* **Action:** Set Value
* **Set Type:** PL/SQL Function Body
* **PL/SQL Function Body:**

  ```plsql
  RETURN normalize_tag_code(:PYY_TAG_CODE_INPUT);
  ```
* **Affected Items:** `PYY_TAG_CODE`
* **Items to Submit:** `PYY_TAG_CODE_INPUT`
* **Fire on Initialization:** No

–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:

* –∞–¥–º—ñ–Ω –≤—Å—Ç–∞–≤–∏–≤ `04:A3:BC:1F:2D:90:80`
* DA –≤–∏–∫–ª–∏–∫–∞—î `normalize_tag_code`
* —É `PYY_TAG_CODE` –∑‚Äô—è–≤–ª—è—î—Ç—å—Å—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `132456789012345`
* –¥–∞–ª—ñ —Å–∞–º–µ `PYY_TAG_CODE` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –≤ INSERT.

#### True Action 2 (–æ–ø—Ü—ñ–π–Ω–æ): Show Message –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ

–Ø–∫—â–æ —Ñ—É–Ω–∫—Ü—ñ—è –∫–∏–Ω–µ `RAISE_APPLICATION_ERROR`, APEX —Å–∞–º –ø–æ–∫–∞–∂–µ –ø–æ–º–∏–ª–∫—É.
–ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∫–æ–≤–æ –∑—Ä–æ–±–∏—Ç–∏ **Validation** –Ω–∞ Submit, —â–æ–± –Ω–µ –ø—Ä–æ–π—Ç–∏ –¥–∞–ª—ñ –±–µ–∑ –∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ –∫–æ–¥—É.

---

### –í–∞—Ä—ñ–∞–Ω—Ç B: –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ ‚Äú–î–æ–¥–∞—Ç–∏ –∑–≤‚Äô—è–∑–æ–∫‚Äù

–Ø–∫—â–æ —Ö–æ—á–µ—à –º—ñ–Ω—ñ–º–∞–ª—ñ–∑–º: –æ–¥–∏–Ω item `PYY_TAG_CODE_INPUT`, –∞ –≤–∂–µ **–ø—Ä–æ—Ü–µ—Å** –ø–µ—Ä–µ–¥ INSERT:

#### Process ‚Äú–ü–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ—é‚Äù

```plsql
DECLARE
  v_dec_code VARCHAR2(128);
BEGIN
  v_dec_code := normalize_tag_code(:PYY_TAG_CODE_INPUT);

  INSERT INTO user_tag (user_id, tag_type_id, tag_code, created_at)
  VALUES (:PYY_USER_ID, :PYY_TAG_TYPE_ID, v_dec_code, SYSTIMESTAMP);
END;
```

* –í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–∞ —Ç–µ, —â–æ `PYY_TAG_CODE_INPUT` –Ω–µ –ø–æ—Ä–æ–∂–Ω—î.

–ú—ñ–Ω—É—Å ‚Äî –∞–¥–º—ñ–Ω –Ω–µ –±–∞—á–∏—Ç—å, —É —â–æ —Ü–µ –∫–æ–Ω–≤–µ—Ä—Ç—É–≤–∞–ª–æ—Å—å, –∞–ª–µ –¥–ª—è –ø—Ä–æ—Å—Ç–∏—Ö –∫–µ–π—Å—ñ–≤ —Ü–µ –Ω–æ—Ä–º.

---

## 3. UX-–ø—ñ–¥–∫–∞–∑–∫–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

–©–æ–± –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É –±—É–ª–æ —Ä–µ–∞–ª—å–Ω–æ –∑—Ä—É—á–Ω–æ:

* –í –æ–ø–∏—Å—ñ –¥–æ `PYY_TAG_CODE_INPUT` –Ω–∞–ø–∏—Å–∞—Ç–∏:

  > –ú–æ–∂–Ω–∞ –≤—Å—Ç–∞–≤–ª—è—Ç–∏:
  >
  > * –∞–±–æ –≤–∂–µ –¥–µ—Å—è—Ç–∫–æ–≤–∏–π –∫–æ–¥ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `123456789`),
  > * –∞–±–æ HEX/Android —Ñ–æ—Ä–º–∞—Ç (`04:A3:BC:1F:2D:90:80` / `04A3BC1F2D9080`).
  >   –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç—å —É –¥–µ—Å—è—Ç–∫–æ–≤–∏–π —Ñ–æ—Ä–º–∞—Ç.

* –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à **–í–∞—Ä—ñ–∞–Ω—Ç –ê**:

  * –ø—ñ–¥ `PYY_TAG_CODE` –º–æ–∂–Ω–∞ –Ω–∞–ø–∏—Å–∞—Ç–∏ —Ç–µ–∫—Å—Ç:

    > –ó–±–µ—Ä–µ–∂–µ—Ç—å—Å—è —è–∫ –¥–µ—Å—è—Ç–∫–æ–≤–∏–π –∫–æ–¥: &PYY_TAG_CODE.

---

## 4. –í—Å—Ç–∞–≤–∫–∞ –≤ USER_TAG

–£ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É INSERT –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **–¥–µ—Å—è—Ç–∫–æ–≤–µ –ø–æ–ª–µ**:

```plsql
INSERT INTO user_tag (user_id, tag_type_id, tag_code, created_at)
VALUES (:PYY_USER_ID, :PYY_TAG_TYPE_ID, :PYY_TAG_CODE, SYSTIMESTAMP);
```

(–£ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ B ‚Äî –±–µ—Ä–µ—à `v_dec_code` —è–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤–∏—â–µ).

---

–Ø–∫—â–æ —Ö–æ—á–µ—à, –Ω–∞—Å—Ç—É–ø–Ω–∏–º –∫—Ä–æ–∫–æ–º –º–æ–∂—É:

* –ø—ñ–¥—ñ–≥–Ω–∞—Ç–∏ —Ü–µ–π –∫–æ–¥ –ø—ñ–¥ —Ç–≤—ñ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π `PYY`-–Ω–æ–º–µ—Ä —Å—Ç–æ—Ä—ñ–Ω–∫–∏,
* –¥–æ–¥–∞—Ç–∏ —Ç–µ–∫—Å—Ç –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó/–ø–æ–º–∏–ª–æ–∫ ‚Äú–ø–æ-–ª—é–¥—Å—å–∫–∏‚Äù (—Ç–∏–ø—É: ‚Äú–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, –±—É–¥—å –ª–∞—Å–∫–∞, —Ñ–æ—Ä–º–∞—Ç –∫–æ–¥—É –º—ñ—Ç–∫–∏. –î–æ–∑–≤–æ–ª–µ–Ω—ñ –¥–µ—Å—è—Ç–∫–æ–≤—ñ —á–∏—Å–ª–∞ –∞–±–æ HEX-—Ñ–æ—Ä–º–∞—Ç, —è–∫ —É Android-–∑—á–∏—Ç—É–≤–∞—á–∞—Ö‚Äù).
