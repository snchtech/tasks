–ö–ª–∞—Å, —Ç–æ–¥—ñ –¥–∞–≤–∞–π –æ–¥—Ä–∞–∑—É –∑—Ä–æ–±–∏–º–æ **–Ω–æ—Ä–º–∞–ª—å–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –Ω–∞ –¥—É–±–ª—ñ–∫–∞—Ç–∏** + –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—é –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ, —â–æ–± –∞–¥–º—ñ–Ω –Ω–µ –º—É—á–∏–≤—Å—è.

–Ø –∑–∞–ø—Ä–æ–ø–æ–Ω—É—é —Ç–∞–∫–∏–π –ø—ñ–¥—Ö—ñ–¥:

* **normalize_tag_code** –º–∏ –≤–∂–µ —Å—Ç–≤–æ—Ä–∏–ª–∏ ‚Äì –≤–æ–Ω–∞:

  * —á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç;
  * –∫–æ–Ω–≤–µ—Ä—Ç—É—î HEX ‚Üí DEC;
  * –∫–∏–¥–∞—î –ø–æ–º–∏–ª–∫—É, —è–∫—â–æ —Ñ–æ—Ä–º–∞—Ç –∫—Ä–∏–≤–∏–π.
* –í APEX:

  * **Validation** –Ω–∞ –∫–Ω–æ–ø—Ü—ñ ‚Äú–î–æ–¥–∞—Ç–∏ –∑–≤‚Äô—è–∑–æ–∫‚Äù:

    * –Ω–æ—Ä–º–∞–ª—ñ–∑—É—î –∫–æ–¥;
    * –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ **–Ω–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–≤‚Äô—è–∑–∫—É –∑ —Ü—ñ—î—é –º—ñ—Ç–∫–æ—é**;
    * –ø–æ–≤–µ—Ä—Ç–∞—î –ª—é–¥–∏–Ω–æ–∑—Ä–æ–∑—É–º—ñ–ª–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —è–∫—â–æ –º—ñ—Ç–∫–∞ –≤–∂–µ –∑–∞–π–Ω—è—Ç–∞;
    * —è–∫—â–æ –≤—Å–µ –æ–∫ ‚Üí –ø–∏—à–µ –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –∫–æ–¥ —É `P210_TAG_CODE`.
  * –ü—Ä–æ—Ü–µ—Å –≤—Å—Ç–∞–≤–∫–∏ –ø—Ä–æ—Å—Ç–æ –±–µ—Ä–µ `P210_TAG_CODE` —ñ –≤—Å—Ç–∞–≤–ª—è—î –≤ `USER_TAG`.

---

## 1Ô∏è‚É£ Validation: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥—É–±–ª—ñ–∫–∞—Ç–∞ + –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è

**–¢–∏–ø –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó:**

* *PL/SQL Function (returning error text)*
  **–ù–∞–∑–≤–∞:** `VAL_TAG_CODE_UNIQUE`

**–ü—Ä–∏–≤‚Äô—è–∑–∫–∞ –¥–æ –∫–Ω–æ–ø–∫–∏:** `–î–æ–¥–∞—Ç–∏ –∑–≤'—è–∑–æ–∫`

**PL/SQL —Ç—ñ–ª–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó:**

```plsql
DECLARE
  v_dec_code        VARCHAR2(128);
  v_exist_user_id   users.user_id%TYPE;
  v_exist_user_name users.user_name%TYPE;
  v_exist_dept_name users.department_name%TYPE;
BEGIN
  -- 1. –ù–æ—Ä–º–∞–ª—ñ–∑—É—î–º–æ –∫–æ–¥ (–º–æ–∂–µ –∫–∏–Ω—É—Ç–∏ –ø–æ–º–∏–ª–∫—É, —è–∫—â–æ —Ñ–æ—Ä–º–∞—Ç –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π)
  v_dec_code := normalize_tag_code(:P210_TAG_CODE_INPUT);

  -- 2. –ó–∞–ø–∏—à–µ–º–æ –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –∫–æ–¥ —É item, —â–æ–± –¥–∞–ª—ñ –Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—å
  :P210_TAG_CODE := v_dec_code;

  -- 3. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –≤–∂–µ —î –∞–∫—Ç–∏–≤–Ω–∏–π –∑–≤‚Äô—è–∑–æ–∫ –∑ —Ü—ñ—î—é –º—ñ—Ç–∫–æ—é
  BEGIN
    SELECT x.user_id,
           x.user_name,
           x.department_name
      INTO v_exist_user_id,
           v_exist_user_name,
           v_exist_dept_name
      FROM (
        SELECT ut.user_id,
               u.user_name,
               u.department_name
          FROM user_tag ut
          JOIN users u
            ON u.user_id = ut.user_id
         WHERE ut.tag_type_id = :P210_TAG_TYPE_ID
           AND ut.tag_code    = v_dec_code
           AND ut.date_end IS NULL
         ORDER BY ut.id
      ) x
     WHERE ROWNUM = 1;
  EXCEPTION
    WHEN NO_DATA_FOUND THEN
      -- –î—É–±–ª—ñ–∫–∞—Ç—ñ–≤ –Ω–µ–º–∞—î ‚Äî —É—Å–µ –æ–∫
      RETURN NULL;
  END;

  -- 4. –Ø–∫—â–æ –º–∏ —Å—é–¥–∏ –¥—ñ–π—à–ª–∏ ‚Äî –∑–Ω–∞—á–∏—Ç—å –º—ñ—Ç–∫–∞ –≤–∂–µ –¥–µ—Å—å –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∞
  IF v_exist_user_id = :P210_USER_ID THEN
    RETURN '–£ —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–∂–µ —î –∞–∫—Ç–∏–≤–Ω–∏–π –∑–≤‚Äô—è–∑–æ–∫ —ñ–∑ —Ü—ñ—î—é –º—ñ—Ç–∫–æ—é.';
  ELSE
    RETURN '–¶—è –º—ñ—Ç–∫–∞ –≤–∂–µ –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∞ –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ' ||
           v_exist_user_name || ' (–ø—ñ–¥—Ä–æ–∑–¥—ñ–ª: ' || v_exist_dept_name || ').';
  END IF;
END;
```

üîç –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:

* `normalize_tag_code(:P210_TAG_CODE_INPUT)`:

  * –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î `04:A3:BC:1F` ‚Üí `–¥–µ—Å—è—Ç–∫–æ–≤–µ —á–∏—Å–ª–æ`;
  * —è–∫—â–æ –≤–≤–µ–ª–∏ —â–æ—Å—å —Ç–∏–ø—É `GZ12`, –¥–∞—Å—Ç—å –∑—Ä–æ–∑—É–º—ñ–ª—É –ø–æ–º–∏–ª–∫—É –∑ `RAISE_APPLICATION_ERROR`.
* –Ø–∫—â–æ –º—ñ—Ç–∫–∞ **–Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞** —Å–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–Ω–∏—Ö (`date_end IS NULL`) ‚Üí `NO_DATA_FOUND` ‚Üí `RETURN NULL;` ‚Üí –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø—Ä–æ–π–¥–µ–Ω–∞.
* –Ø–∫—â–æ **–∑–Ω–∞–π–¥–µ–Ω–∞**:

  * —è–∫—â–æ —Ü–µ **—Ç–æ–π –∂–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á** ‚Üí ‚Äú–£ —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–∂–µ —î –∞–∫—Ç–∏–≤–Ω–∏–π –∑–≤‚Äô—è–∑–æ–∫‚Ä¶‚Äù
  * —è–∫—â–æ **—ñ–Ω—à–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á** ‚Üí —Ç–µ–∫—Å—Ç –∑ —ñ–º‚Äô—è–º —Ç–∞ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–æ–º.

> –í–∞–∂–ª–∏–≤–æ: —Ü—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—è **—ñ –Ω–æ—Ä–º–∞–ª—ñ–∑—É—î**, —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –¥—É–±–ª—ñ–∫–∞—Ç–∏.
> –¢–µ–ø–µ—Ä –Ω–µ —Å—Ç—Ä–∞—à–Ω–æ –Ω–∞–≤—ñ—Ç—å –±–µ–∑ Dynamic Action ‚Äî –ª–æ–≥—ñ–∫–∞ –≤—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.

---

## 2Ô∏è‚É£ –ü—Ä–æ—Ü–µ—Å –≤—Å—Ç–∞–≤–∫–∏ `PRC_CREATE_USER_TAG`

–¢–µ–ø–µ—Ä –π–æ–≥–æ –º–æ–∂–Ω–∞ —Å–ø—Ä–æ—Å—Ç–∏—Ç–∏, –±–æ:

* `P210_TAG_CODE` –≤–∂–µ –º—ñ—Å—Ç–∏—Ç—å –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —Ä—è–¥–æ–∫;
* —Ñ–æ—Ä–º–∞—Ç –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ;
* –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤ –Ω–µ–º–∞—î (–≤–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å).

**Process (After Submit, when button = ‚Äú–î–æ–¥–∞—Ç–∏ –∑–≤‚Äô—è–∑–æ–∫‚Äù):**

```plsql
BEGIN
  INSERT INTO user_tag (user_id, tag_type_id, tag_code, created_at)
  VALUES (:P210_USER_ID,
          :P210_TAG_TYPE_ID,
          :P210_TAG_CODE,
          SYSTIMESTAMP);

  apex_application.g_print_success_message :=
    '–ó–≤‚Äô—è–∑–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á ‚Äì –º—ñ—Ç–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–æ.';
END;
```

---

## 3Ô∏è‚É£ –ü—Ä–æ Dynamic Action (–Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è ‚Äú–Ω–∞ –ª—å–æ—Ç—É‚Äù) ‚Äî –æ–ø—Ü—ñ–π–Ω–æ

–¢–µ, —â–æ –º–∏ –≤–∂–µ —Ä–æ–±–∏–ª–∏:

* **Event:** Change ‚Üí `P210_TAG_CODE_INPUT`
* **Action:** Set Value ‚Üí PL/SQL Function Body:

  ```plsql
  RETURN normalize_tag_code(:P210_TAG_CODE_INPUT);
  ```
* **Affected Item:** `P210_TAG_CODE`

–¶–µ —á–∏—Å—Ç–æ –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ: –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä **–æ–¥—Ä–∞–∑—É –±–∞—á–∏—Ç—å**, —É —â–æ –∫–æ–Ω–≤–µ—Ä—Ç—É—î—Ç—å—Å—è –∫–æ–¥.
–ê –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Å–µ –æ–¥–Ω–æ –∑—Ä–æ–±–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–π –¥—É–±–ª—å –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó/–ø–µ—Ä–µ–≤—ñ—Ä–∫–∏.

---

## 4Ô∏è‚É£ –©–æ –æ—Ç—Ä–∏–º–∞—î –∞–¥–º—ñ–Ω

1. –í—Å—Ç–∞–≤–ª—è—î:

   * –∞–±–æ `123456789`,
   * –∞–±–æ `04:A3:BC:1F:2D:90:80`,
   * –∞–±–æ `04A3BC1F2D9080`.
2. APEX:

   * —á–∏—Å—Ç–∏—Ç—å/–∫–æ–Ω–≤–µ—Ä—Ç—É—î –≤ –¥–µ—Å—è—Ç–∫–æ–≤–µ;
   * —è–∫—â–æ —Ñ–æ—Ä–º–∞—Ç –∫—Ä–∏–≤–∏–π ‚Üí –∑—Ä–æ–∑—É–º—ñ–ª–∏–π error;
   * —è–∫—â–æ –º—ñ—Ç–∫–∞ –≤–∂–µ –∞–∫—Ç–∏–≤–Ω–∞ –≤ —ñ–Ω—à–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ‚Üí
     **‚Äú–¶—è –º—ñ—Ç–∫–∞ –≤–∂–µ –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∞ –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ü–≤–∞–Ω–µ–Ω–∫–æ –Ü.–Ü. (–ø—ñ–¥—Ä–æ–∑–¥—ñ–ª: –¶–µ—Ö 1).‚Äù**
   * —è–∫—â–æ —Ç–∞ –∂ –º—ñ—Ç–∫–∞ –≤–∂–µ —î –≤ —Ü—å–æ–≥–æ –∂ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ‚Üí
     **‚Äú–£ —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–∂–µ —î –∞–∫—Ç–∏–≤–Ω–∏–π –∑–≤‚Äô—è–∑–æ–∫ —ñ–∑ —Ü—ñ—î—é –º—ñ—Ç–∫–æ—é.‚Äù**
3. –Ø–∫—â–æ –≤—Å–µ –æ–∫ ‚Üí

   * –∑–∞–ø–∏—Å —É `USER_TAG`,
   * –¥—ñ–∞–ª–æ–≥ –∑–∞–∫—Ä–∏–≤–∞—î—Ç—å—Å—è,
   * –Ω–∞ –æ—Å–Ω–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ IR –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è,
   * –∑–≤–µ—Ä—Ö—É –∑–µ–ª–µ–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ‚Äú–ó–≤‚Äô—è–∑–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á ‚Äì –º—ñ—Ç–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–æ.‚Äù

---

–Ø–∫—â–æ —Ö–æ—á–µ—à, –Ω–∞—Å—Ç—É–ø–Ω–∏–º –∫—Ä–æ–∫–æ–º –º–æ–∂–µ–º–æ —Ç–∞–∫ —Å–∞–º–æ –∞–∫—É—Ä–∞—Ç–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç–∏ **‚Äú–¥–µ–∞–∫—Ç–∏–≤–∞—Ü—ñ—é‚Äù –º—ñ—Ç–∫–∏** (—Å—Ç–∞–≤–∏—Ç–∏ `DATE_END`, –Ω–µ –¥–∞—é—á–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –¥–æ–¥–∞—Ç–∏ —Ç–æ–π —Å–∞–º–∏–π –∫–æ–¥ –±–µ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑–≤‚Äô—è–∑–∫—É).
