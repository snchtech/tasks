–ö–ª–∞—Å–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è, –æ—Ç —Ç—É—Ç —è–∫—Ä–∞–∑ –≤–∞–∂–ª–∏–≤–æ **—Ä–æ–∑–≤–µ—Å—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é —ñ –ø—Ä–æ—Ü–µ—Å–∏–Ω–≥** üí°

–î–∞–≤–∞–π –ø–æ –ø—É–Ω–∫—Ç–∞—Ö:

---

## 1. –Ø–∫—â–æ –∑–∞–ø—É—Å–∫–∞—Ç–∏ `normalize_tag_code` —É –ü–†–û–¶–ï–°–Ü (After Submit)

### –Ø–∫ –±—É–¥—É—Ç—å –≤–∏–≥–ª—è–¥–∞—Ç–∏ –ø–æ–º–∏–ª–∫–∏?

–Ø–∫—â–æ –≤ –ø—Ä–æ—Ü–µ—Å—ñ —Ç–∏ —Ä–æ–±–∏—à:

```plsql
BEGIN
  v_dec := normalize_tag_code(:P5_TAG_CODE_INPUT); -- —Ç—É—Ç –º–æ–∂–µ –±—É—Ç–∏ RAISE_APPLICATION_ERROR
  ...
END;
```

—ñ `normalize_tag_code` –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ä–æ–±–∏—Ç—å `RAISE_APPLICATION_ERROR(-20001, '...')`, —Ç–æ:

* APEX –ø–æ–∫–∞–∂–µ **–∂–æ–≤—Ç–∏–π/—á–µ—Ä–≤–æ–Ω–∏–π –±–ª–æ–∫ –ø–æ–º–∏–ª–∫–∏ –∑–≤–µ—Ä—Ö—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏** —Ç–∏–ø—É
  `1 error has occurred` + —Ç–µ–∫—Å—Ç ORA-20001 (–∞–±–æ —Ç–≤—ñ–π message);
* —Ü–µ **–Ω–µ –±—É–¥–µ ‚ÄúValidation error‚Äù**, —Ç–æ–±—Ç–æ:

  * –Ω–µ –±—É–¥–µ –ø—Ä–∏–≤'—è–∑–∫–∏ –¥–æ item,
  * –Ω–µ –ø—ñ–¥—Å–≤—ñ—Ç–∏—Ç—å—Å—è –ø–æ–ª–µ,
  * –Ω–µ –±—É–¥–µ –∑—Ä–æ–∑—É–º—ñ–ª–æ, —â–æ —Å–∞–º–µ ‚Äú–≤–∞–ª—ñ–¥–Ω–µ / –Ω–µ–≤–∞–ª—ñ–¥–Ω–µ‚Äù.

–¢–æ–±—Ç–æ —Ç–∞–∫ —Ç–µ–∂ –º–æ–∂–Ω–∞ –∂–∏—Ç–∏, –∞–ª–µ —Ü–µ –≤–∂–µ –Ω–µ –∫–ª–∞—Å–∏—á–Ω–∞ ‚Äú–≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Ñ–æ—Ä–º–∏‚Äù, –∞ –ø—Ä–æ—Å—Ç–æ –ø–∞–¥—ñ–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—É –∑ –ø–æ–º–∏–ª–∫–æ—é.

üëâ –¢–æ–º—É –≤—Å–µ, —â–æ ‚Äú–ø–µ—Ä–µ–≤—ñ—Ä—è—î –¥–∞–Ω—ñ —ñ –º–æ–∂–µ –Ω–µ –ø—É—Å—Ç–∏—Ç–∏ –¥–∞–ª—ñ‚Äù, –∫—Ä–∞—â–µ –≤–∏–Ω–æ—Å–∏—Ç–∏ –≤ **Validation**, –∞ –ø—Ä–æ—Ü–µ—Å–∏ —Ä–æ–±–∏—Ç–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ ‚Äú—á–∏—Å—Ç–∏–º–∏‚Äù (INSERT/UPDATE, –ª–æ–≥).

---

## 2. –ß–∏ –ø–æ—Ç—Ä—ñ–±–µ–Ω –≤–∑–∞–≥–∞–ª—ñ `P5_TAG_CODE`, —è–∫—â–æ —Ä–æ–±–∏—Ç–∏ –≤—Å–µ –Ω–∞ –æ–¥–Ω–æ–º—É –ø–æ–ª—ñ?

–Ø–∫—â–æ —Ç–æ–±—ñ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –º–∞—Ç–∏ **–æ–∫—Ä–µ–º–µ –ø–æ–ª–µ –∑ ‚Äú–∫—Ä–∞—Å–∏–≤–∏–º‚Äù –∫–æ–¥–æ–º**, —Ç–æ –º–æ–∂–Ω–∞ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –≤–∑–∞–≥–∞–ª—ñ **–ª–∏—à–µ –∑ –ø–æ–ª–µ–º –≤–≤–æ–¥—É**, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `P5_TAG_CODE_INPUT`:

* –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–≤–æ–¥–∏—Ç—å –±—É–¥—å-—è–∫–∏–π —Ñ–æ—Ä–º–∞—Ç;
* –≤–∞–ª—ñ–¥–∞—Ü—ñ—è:

  * –Ω–æ—Ä–º–∞–ª—ñ–∑—É—î –∑–Ω–∞—á–µ–Ω–Ω—è,
  * –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î `P5_TAG_CODE_INPUT` —É–∂–µ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–º DEC-–∫–æ–¥–æ–º;
* –ø—Ä–æ—Ü–µ—Å INSERT –±–µ—Ä–µ –∑–Ω–∞—á–µ–Ω–Ω—è **–∑ —Ü—å–æ–≥–æ –∂ item‚Äô–∞**.

–¢–æ–¥—ñ `P5_TAG_CODE` —è–∫ –æ–∫—Ä–µ–º–∏–π item **–º–æ–∂–Ω–∞ –Ω–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏**.

---

## 3. –Ø–∫ —Ü–µ –≤–∏–≥–ª—è–¥–∞—î –≤ –æ–¥–Ω–æ–º—É –ø–æ–ª—ñ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç)

### 3.1. –í–∞–ª—ñ–¥–∞—Ü—ñ—è (PL/SQL function returning error text)

**Validation, –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∞ –¥–æ –∫–Ω–æ–ø–∫–∏ ‚Äú–ó–≤‚Äô—è–∑–∞—Ç–∏ –º—ñ—Ç–∫—É –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º‚Äù**:

```plsql
DECLARE
  v_dec_code VARCHAR2(128);
BEGIN
  -- 1. –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è
  v_dec_code := normalize_tag_code(:P5_TAG_CODE_INPUT);

  -- 2. –ü–µ—Ä–µ–∑–∞–ø–∏—Å—É—î–º–æ –ø–æ–ª–µ –≤–∂–µ –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–º –∑–Ω–∞—á–µ–Ω–Ω—è–º
  :P5_TAG_CODE_INPUT := v_dec_code;

  -- 3. –¢—É—Ç –∂–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –≤—Å—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏:
  --    - —á–∏ —î —É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–∫—Ç–∏–≤–Ω–∞ –º—ñ—Ç–∫–∞
  --    - —á–∏ –Ω–µ –∑–∞–π–Ω—è—Ç–∏–π —Ü–µ–π –∫–æ–¥ —ñ–Ω—à–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º
  --    (—è–∫ –º–∏ –≤–∂–µ —Ä–∞–Ω—ñ—à–µ –ø–∏—Å–∞–ª–∏)
  --
  -- –Ø–∫—â–æ —â–æ—Å—å –Ω–µ —Ç–∞–∫ ‚Üí RETURN '—Ç–µ–∫—Å—Ç –ø–æ–º–∏–ª–∫–∏...';

  RETURN NULL; -- –≤—Å–µ –û–ö
EXCEPTION
  WHEN OTHERS THEN
    -- —è–∫—â–æ normalize_tag_code –∫–∏–Ω–µ RAISE_APPLICATION_ERROR,
    -- –º–æ–∂–µ–º–æ –≤—ñ–¥–¥–∞—Ç–∏ –¥—Ä—É–∂–Ω—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    RETURN '–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–¥—É –º—ñ—Ç–∫–∏. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, –±—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥–µ–Ω—ñ –¥–∞–Ω—ñ.';
END;
```

üîπ –í–∞–∂–ª–∏–≤–æ:

* **Associated Item** (–≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó) ‚Üí –ø–æ—Å—Ç–∞–≤ `P5_TAG_CODE_INPUT`, —Ç–æ–¥—ñ:

  * –ø–æ–º–∏–ª–∫–∞ –±—É–¥–µ –ø–æ–∫–∞–∑–∞–Ω–∞ —è–∫ **–≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Å–∞–º–µ —Ü—å–æ–≥–æ –ø–æ–ª—è**;
  * –ø–æ–ª–µ –ø—ñ–¥—Å–≤—ñ—Ç–∏—Ç—å—Å—è;
  * —é–∑–µ—Ä—É —Å—Ç–∞–Ω–µ –∑—Ä–æ–∑—É–º—ñ–ª–æ, —â–æ –ø—Ä–æ–±–ª–µ–º–∞ —Å–∞–º–µ –≤ –Ω—å–æ–º—É.

---

### 3.2. –ü—Ä–æ—Ü–µ—Å INSERT

–ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó:

```plsql
BEGIN
  INSERT INTO user_tag (user_id, tag_type_id, tag_code, created_at)
  VALUES (
    :P5_USER_ID,
    :P5_TAG_TYPE_ID,
    :P5_TAG_CODE_INPUT,  -- –≤–∂–µ –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è
    SYSTIMESTAMP
  );

  apex_application.g_print_success_message :=
    '–ó–≤‚Äô—è–∑–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á ‚Äì –º—ñ—Ç–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–æ.';
END;
```

–¢—É—Ç `P5_TAG_CODE_INPUT` —É–∂–µ **—á–∏—Å—Ç–∏–π DEC-–∫–æ–¥**, –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∏–π —ñ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π.

---

## 4. –Ø–∫ –±—É–¥—É—Ç—å –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏—Å—å –ø–æ–º–∏–ª–∫–∏ –≤ —Ç–∞–∫—ñ–π —Å—Ö–µ–º—ñ?

* –Ø–∫—â–æ `normalize_tag_code` –∞–±–æ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑–Ω–∞—Ö–æ–¥—è—Ç—å –ø—Ä–æ–±–ª–µ–º—É:

  * –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–æ–≤–µ—Ä—Ç–∞—î —Ç–µ–∫—Å—Ç ‚Üí
    APEX –ø–æ–∫–∞–∑—É—î –π–æ–≥–æ –≤ **–∂–æ–≤—Ç–æ–º—É –±–ª–æ—Ü—ñ ‚Äú1 error has occurred‚Äù**,
    –ø–ª—é—Å –ø—ñ–¥—Å–≤—ñ—á—É—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π item (—è–∫—â–æ –≤–∫–∞–∑–∞–Ω–∏–π –≤ Associated Item).
* –ü—Ä–æ—Ü–µ—Å INSERT –Ω–∞–≤—ñ—Ç—å –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è ‚Äî —Ü–µ –Ω–æ—Ä–º–∞ –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ–π.
* –ù—ñ—è–∫–∏—Ö Session State Protection –ø–æ—Ä—É—à–µ–Ω—å –Ω–µ –±—É–¥–µ, —è–∫—â–æ:

  * `P5_TAG_CODE_INPUT` ‚Üí Unrestricted, Value Protected = No;
  * —Ç–∏ –Ω–µ –≥—Ä–∞—î—à—Å—è –∑ extra –∑–∞—Ö–∏—Å—Ç–æ–º.

---

## 5. –©–æ –∑ UX (–∫–æ–ª–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –≤–∏–¥–Ω–∞ –æ–¥—Ä–∞–∑—É)?

–¢—É—Ç –¥–≤–∞ —Å—Ü–µ–Ω–∞—Ä—ñ—ó:

1. **–ü—Ä–æ—Å—Ç–∏–π**:

   * –í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–∞ Submit (—è–∫ –≤–∏—â–µ);
   * –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å ‚Äú–¥–µ—Å—è—Ç–∫–æ–≤–∏–π‚Äù –∫–æ–¥ –≤–∂–µ –ø—ñ—Å–ª—è —Å–∞–±–º—ñ—Ç—É (—è–∫—â–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î–º–æ `P5_TAG_CODE_INPUT` –≤ –ø—Ä–æ—Ü–µ—Å—ñ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó, —Å—Ç—Ä–∞–π–∫);

2. **–ó—Ä—É—á–Ω–∏–π** (—è–∫ —É —Ç–µ–±–µ):

   * * Dynamic Action On Change –¥–ª—è `P5_TAG_CODE_INPUT`, —è–∫–∏–π:

     - –≤–∏–∫–ª–∏–∫–∞—î `normalize_tag_code` —á–µ—Ä–µ–∑ Set Value;
     - –∑–∞–ø–æ–≤–Ω—é—î (–∞–±–æ —Ç–µ –∂ –ø–æ–ª–µ, –∞–±–æ –æ–∫—Ä–µ–º–∏–π `P5_TAG_CODE`).

–Ü –≤ –±—É–¥—å-—è–∫–æ–º—É –≤–∏–ø–∞–¥–∫—É –≤—Å–µ ‚Äú—Å–µ—Ä–π–æ–∑–Ω–µ‚Äù (—Ñ–æ—Ä–º–∞—Ç + –¥—É–±–ª—ñ–∫–∞—Ç–∏) –∫—Ä–∞—â–µ —Ç—Ä–∏–º–∞—Ç–∏ —É –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó.

---

### –í–∏—Å–Ω–æ–≤–æ–∫

> **–¢–∞–∫, —Ç–∏ –º–æ–∂–µ—à –æ–±—ñ–π—Ç–∏—Å—è –≤–∑–∞–≥–∞–ª—ñ –±–µ–∑ `P5_TAG_CODE`.**
> –ü—Ä–∞—Ü—é–π —Ç—ñ–ª—å–∫–∏ –∑ –ø–æ–ª–µ–º –≤–≤–æ–¥—É, –Ω–æ—Ä–º–∞–ª—ñ–∑—É–π –π–æ–≥–æ –≤ **–≤–∞–ª—ñ–¥–∞—Ü—ñ—ó** —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Ç–µ —Å–∞–º–µ –ø–æ–ª–µ –≤ INSERT.

> –Ø–∫—â–æ –∑–∞–ø—É—Å–∫–∞—Ç–∏ `normalize_tag_code` –≤ **–ø—Ä–æ—Ü–µ—Å—ñ**, –ø–æ–º–∏–ª–∫–∏ –±—É–¥—É—Ç—å –≤–∏–≥–ª—è–¥–∞—Ç–∏ —è–∫ –∑–∞–≥–∞–ª—å–Ω–∞ –ø–æ–º–∏–ª–∫–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (ORA-20001‚Ä¶), –±–µ–∑ –ø—ñ–¥—Å–≤—ñ—Ç–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—è ‚Äî —Ç–æ–º—É –∫—Ä–∞—â–µ –∑–∞–ø—É—Å–∫–∞—Ç–∏ —ó—ó –≤ Validation —ñ –ø–æ–≤‚Äô—è–∑—É–≤–∞—Ç–∏ –∑ item‚Äô–æ–º.

–Ø–∫—â–æ –Ω–∞–ø–∏—à–µ—à, —è–∫ —É —Ç–µ–±–µ –∑–∞—Ä–∞–∑ –≤–∏–≥–ª—è–¥–∞—î –≤–∞–ª—ñ–¥–∞—Ü—ñ—è/–ø—Ä–æ—Ü–µ—Å (–∫—ñ–ª—å–∫–∞ —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É), –º–æ–∂—É –ø—Ä—è–º–æ –Ω–∞ —Ç–≤–æ—î–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ –ø—ñ–¥ ‚Äú–æ–¥–Ω–µ –ø–æ–ª–µ + –æ–¥–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è‚Äù.
