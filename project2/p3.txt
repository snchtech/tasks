–°—É–ø–µ—Ä üëç
–í–∏ —Å—Ñ–æ—Ä–º—É–ª—é–≤–∞–ª–∏ –∞–±—Å–æ–ª—é—Ç–Ω–æ —á—ñ—Ç–∫–µ –¢–ó –¥–ª—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è –∑–≤‚Äô—è–∑–∫—ñ–≤ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á ‚Üî –º—ñ—Ç–∫–∞** (NFC / RFID).
–î–∞–ª—ñ ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∏–π –ø–æ–∫—Ä–æ–∫–æ–≤–∏–π –≥–∞–π–¥ –¥–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤ Oracle APEX:

---

## üîπ 1. –û—Å–Ω–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞: `User Tag Management`

**–¢–∏–ø —Å—Ç–æ—Ä—ñ–Ω–∫–∏:** Standard
**Region 1:** `User Tag List` (Interactive Report)
**Source (SQL Query):**

```sql
SELECT 
    t.id,
    t.user_id,
    u.user_name,
    u.department_name,
    tt.code AS tag_type_name,
    t.tag_code,
    t.created_at
FROM user_tag t
JOIN users u ON u.user_id = t.user_id
JOIN tag_type_lu tt ON tt.id = t.tag_type_id
WHERE t.date_end IS NULL
ORDER BY t.created_at DESC;
```

---

## üîπ 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–ª–æ–Ω–æ–∫ IR

| –ö–æ–ª–æ–Ω–∫–∞         | –¢–∏–ø    | –ü—Ä–∏–º—ñ—Ç–∫–∞                    |
| --------------- | ------ | --------------------------- |
| ID              | Hidden | –ü–æ—Ç—Ä—ñ–±–Ω–∞ –¥–ª—è –¥—ñ–π            |
| USER_ID         | Hidden | –ú–æ–∂–µ –±—É—Ç–∏ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∞         |
| USER_NAME       | Text   | –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è                |
| DEPARTMENT_NAME | Text   | –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è                |
| TAG_CODE        | Text   | –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è                |
| TAG_TYPE_NAME   | Text   | –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è                |
| CREATED_AT      | Date   | –§–æ—Ä–º–∞—Ç `DD.MM.YYYY HH24:MI` |

---

## üîπ 3. –î–æ–¥–∞—Ç–∏ –∫–æ–ª–æ–Ω–∫—É –∑ —ñ–∫–æ–Ω–∫–æ—é ‚Äú–í–∏–¥–∞–ª–∏—Ç–∏ –∑–≤‚Äô—è–∑–æ–∫‚Äù

1. –£ –∑–≤—ñ—Ç—ñ –¥–æ–¥–∞–π—Ç–µ **Link Column** (—Ç–∏–ø: *Link*).
2. –£ –ø–æ–ª—ñ **Link Text** –≤—Å—Ç–∞–≤—Ç–µ:

   ```html
   <span class="fa fa-trash-o" title="–í–∏–¥–∞–ª–∏—Ç–∏" style="color:red;cursor:pointer;"></span>
   ```
3. **Target:**
   None (–º–∏ –±—É–¥–µ–º–æ –æ–±—Ä–æ–±–ª—è—Ç–∏ —á–µ—Ä–µ–∑ Dynamic Action).
4. –î–æ–¥–∞–π—Ç–µ **Static ID** –¥–ª—è IR, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `ir_user_tag`.

---

## üîπ 4. Dynamic Action –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑–≤‚Äô—è–∑–∫—É

### –ü–æ–¥—ñ—è:

* **Event:** Click
* **Selection Type:** jQuery Selector
* **jQuery Selector:** `#ir_user_tag span.fa-trash-o`

### True Action 1: Confirm

* **Action:** Confirm
* **Message:**

  ```
  –í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –¥–µ–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ —Ü–µ–π –∑–≤‚Äô—è–∑–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –º—ñ—Ç–∫–æ—é?
  ```
* **Button Label:** –¢–∞–∫
* **Cancel Label:** –ù—ñ

### True Action 2: Execute Server-side Code

* **Action:** Execute PL/SQL Code
* **PL/SQL Code:**

  ```plsql
  DECLARE
      v_id NUMBER := APEX_IG.GET_SELECTED_ROWS(:APP_REGION_ID).id;
  BEGIN
      UPDATE user_tag
         SET date_end = SYSDATE
       WHERE id = v_id;

      APEX_DEBUG.MESSAGE('User_tag deactivated, ID = ' || v_id);
  END;
  ```

  ‚ö†Ô∏è –Ø–∫—â–æ IR –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î `GET_SELECTED_ROWS`, —Ç–æ–¥—ñ –ø—Ä–æ—Å—Ç—ñ—à–µ:

  * —Å—Ç–≤–æ—Ä—ñ—Ç—å Hidden Item `PXX_ID` (–¥–µ XX ‚Äî –Ω–æ–º–µ—Ä —Å—Ç–æ—Ä—ñ–Ω–∫–∏)
  * —É JS (–ø–µ—Ä–µ–¥ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º) –æ—Ç—Ä–∏–º–∞–π—Ç–µ `id` –∑ —Ä—è–¥–∫–∞ —ñ –ø–µ—Ä–µ–¥–∞–π—Ç–µ —É `PXX_ID`.

  **PL/SQL –≤–∞—Ä—ñ–∞–Ω—Ç —ñ–∑ item:**

  ```plsql
  UPDATE user_tag
     SET date_end = SYSDATE
   WHERE id = :PXX_ID;
  ```

### True Action 3: Refresh Region

* **Affected Elements:** Region ‚Üí `User Tag List`

---

## üîπ 5. JavaScript –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ ID –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ —ñ–∫–æ–Ω–∫—É

1. –î–æ–¥–∞–π—Ç–µ **Static ID** –¥–æ IR ‚Üí `ir_user_tag`
2. –£ —Å–µ–∫—Ü—ñ—ó **Function and Global Variable Declaration** —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –≤—Å—Ç–∞–≤—Ç–µ:

```js
$(document).on("click", "#ir_user_tag span.fa-trash-o", function() {
  const id = $(this).closest("tr").find("td[headers='ID']").text().trim();
  $s("PXX_ID", id); // XX = –Ω–æ–º–µ—Ä –≤–∞—à–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
});
```

---

## üîπ 6. –ö–Ω–æ–ø–∫–∞ ¬´–î–æ–¥–∞—Ç–∏ –∑–≤‚Äô—è–∑–æ–∫¬ª

1. –°—Ç–≤–æ—Ä—ñ—Ç—å **Button** —É —Ä–µ–≥—ñ–æ–Ω—ñ `User Tag List`

   * Label: **–î–æ–¥–∞—Ç–∏ –∑–≤‚Äô—è–∑–æ–∫**
   * Action: **Redirect to Page in Dialog**
   * Target Page: Modal page `User Tag Add`
   * Dialog Attributes:

     * Modal
     * Width: 500px
   * **After dialog close:** Refresh region `User Tag List`

---

## üîπ 7. Modal Page `User Tag Add`

### Items:

| Item            | Type        | Source / LOV                                                  | Required |
| --------------- | ----------- | ------------------------------------------------------------- | -------- |
| PYY_USER_ID     | Popup LOV   | `SELECT user_name d, user_id r FROM users ORDER BY user_name` | ‚úÖ        |
| PYY_TAG_CODE    | Text Field  | ‚Äî                                                             | ‚úÖ        |
| PYY_TAG_TYPE_ID | Select List | `SELECT code d, id r FROM tag_type_lu`                        | ‚úÖ        |

---

### Button:

| Button             | Action      |
| ------------------ | ----------- |
| **–î–æ–¥–∞—Ç–∏ –∑–≤‚Äô—è–∑–æ–∫** | Submit Page |

---

### Process (–Ω–∞ Submit)

**Process Point:** After Submit
**Type:** PL/SQL Code
**Code:**

```plsql
BEGIN
  INSERT INTO user_tag (user_id, tag_type_id, tag_code, created_at)
  VALUES (:PYY_USER_ID, :PYY_TAG_TYPE_ID, :PYY_TAG_CODE, SYSTIMESTAMP);

  APEX_DEBUG.MESSAGE('User Tag Created: ' || :PYY_USER_ID || ' / ' || :PYY_TAG_CODE);
  APEX_UTIL.SET_SESSION_STATE('PYY_SUCCESS', 1);
END;
```

---

### After Processing:

* **Close Dialog**
* **Refresh region** (—á–µ—Ä–µ–∑ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É, —è–∫—â–æ –≤–∫–∞–∑–∞–Ω–æ)

---

### Dynamic Action on Dialog Close (Main Page)

* Refresh Region: `User Tag List`

---

### Optional Success Message

–ù–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ ‚Üí –¥–æ–¥–∞–π—Ç–µ Dynamic Action (Event: Dialog Closed):

```plsql
apex.message.showPageSuccess('–ó–≤‚Äô—è–∑–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á - –º—ñ—Ç–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–æ.');
```

---

## üîπ 8. –ü—ñ–¥—Å—É–º–æ–∫ UX

‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—Å—ñ—Ö –∞–∫—Ç–∏–≤–Ω–∏—Ö –∑–≤‚Äô—è–∑–∫—ñ–≤
‚úÖ –ú–æ–∂–µ –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –∑–≤‚Äô—è–∑–æ–∫ —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
‚úÖ –ú–æ–∂–µ ‚Äú–¥–µ–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏‚Äù (soft delete) ‚Äî –∑–∞–ø–∏—Å –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –≤ —ñ—Å—Ç–æ—Ä—ñ—ó, –∞–ª–µ –Ω–µ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è
‚úÖ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—Ö –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è —É —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É Apex-—Å—Ç–∏–ª—ñ

---

–•–æ—á–µ—Ç–µ, —è —Å—Ñ–æ—Ä–º—É—é –ø–æ–≤–Ω–∏–π SQL + PL/SQL + JS –∫–æ–¥ (–∑—ñ –∑–º—ñ–Ω–Ω–∏–º–∏ `PXX_` / `PYY_` –ø—ñ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –Ω–æ–º–µ—Ä–∏ —Å—Ç–æ—Ä—ñ–Ω–æ–∫), —â–æ–± –≤–∏ –º–æ–≥–ª–∏ –æ–¥—Ä–∞–∑—É –≤—Å—Ç–∞–≤–∏—Ç–∏ –π–æ–≥–æ –≤ APEX?
