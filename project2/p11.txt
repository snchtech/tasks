–¢–∞–∫, –¥–∞–≤–∞–π –∑–≤–µ–¥–µ–º–æ –≤—Å–µ –≤ **–æ–¥–Ω—É –≤–∞–ª—ñ–¥–∞—Ü—ñ—é** –π —Ä–æ–∑–∫–ª–∞–¥–µ–º–æ –ø–æ –ø–æ–ª–∏—á–∫–∞—Ö, —è–∫ —Ü–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–≤‚Äô—è–∑–∞—Ç–∏ –∑ –ø—Ä–æ—Ü–µ—Å–æ–º INSERT –≤ APEX üëá

---

## 1Ô∏è‚É£ –û–¥–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è: –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è + 2 –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

**–¢–∏–ø:**
`Validation ‚Üí PL/SQL function (returning error text)`
**–ü—Ä–∏–≤‚Äô—è–∑–∫–∞:** When Button Pressed = `–î–æ–¥–∞—Ç–∏ –∑–≤'—è–∑–æ–∫` (—Ç–≤–æ—è –∫–Ω–æ–ø–∫–∞)

```plsql
DECLARE
  v_dec_code            VARCHAR2(128);
  v_user_active_code    user_tag.tag_code%TYPE;
  v_other_user_name     users.user_name%TYPE;
BEGIN
  -- 1. –ù–æ—Ä–º–∞–ª—ñ–∑—É—î–º–æ –∫–æ–¥ (HEX/Android ‚Üí DEC, –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ñ–æ—Ä–º–∞—Ç)
  v_dec_code := normalize_tag_code(:P210_TAG_CODE_INPUT);
  :P210_TAG_CODE := v_dec_code;  -- –∑–±–µ—Ä–µ–∂–µ–º–æ –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è INSERT

  ----------------------------------------------------------------------
  -- 2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: —á–∏ –≤–∂–µ —î –≤ —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–∫—Ç–∏–≤–Ω–∞ –º—ñ—Ç–∫–∞
  ----------------------------------------------------------------------
  BEGIN
    SELECT ut.tag_code
      INTO v_user_active_code
      FROM user_tag ut
     WHERE ut.user_id     = :P210_USER_ID
       AND ut.tag_type_id = :P210_TAG_TYPE_ID
       AND ut.date_end IS NULL
       FETCH FIRST 1 ROW ONLY;
  EXCEPTION
    WHEN NO_DATA_FOUND THEN
      v_user_active_code := NULL;
  END;

  IF v_user_active_code IS NOT NULL THEN
    RETURN '–£ –¥–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–∂–µ —î –∞–∫—Ç–∏–≤–Ω–∞ –º—ñ—Ç–∫–∞ –∑ –Ω–æ–º–µ—Ä–æ–º ' ||
           v_user_active_code ||
           '. –©–æ–± –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤—É, –¥–µ–∞–∫—Ç–∏–≤—É–π—Ç–µ –ø–æ–ø–µ—Ä–µ–¥–Ω—é –º—ñ—Ç–∫—É.';
  END IF;

  ----------------------------------------------------------------------
  -- 3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: —á–∏ –Ω–µ –∑–∞–π–Ω—è—Ç–∞ —Ü—è –º—ñ—Ç–∫–∞ (–∫–æ–¥) —ñ–Ω—à–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º
  ----------------------------------------------------------------------
  BEGIN
    SELECT u.user_name
      INTO v_other_user_name
      FROM user_tag ut
      JOIN users u ON u.user_id = ut.user_id
     WHERE ut.tag_type_id = :P210_TAG_TYPE_ID
       AND ut.tag_code    = v_dec_code
       AND ut.date_end IS NULL
       FETCH FIRST 1 ROW ONLY;
  EXCEPTION
    WHEN NO_DATA_FOUND THEN
      v_other_user_name := NULL;
  END;

  IF v_other_user_name IS NOT NULL THEN
    RETURN '–¢–∞–∫–∞ –º—ñ—Ç–∫–∞ –≤–∂–µ —î –≤ –±–∞–∑—ñ –π –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∞ –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ' ||
           v_other_user_name ||
           '. –í–∏ –Ω–µ –∑–º–æ–∂–µ—Ç–µ –≤–∏–¥–∞—Ç–∏ —ó—ó —ñ–Ω—à–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É. ' ||
           '–°–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è —ñ–Ω—à–æ—é –º—ñ—Ç–∫–æ—é.';
  END IF;

  ----------------------------------------------------------------------
  -- 4. –Ø–∫—â–æ —Å—é–¥–∏ –¥—ñ–π—à–ª–∏ ‚Äì —É—Å–µ –û–ö
  ----------------------------------------------------------------------
  RETURN NULL;
END;
```

üîπ –©–æ —Ä–æ–±–∏—Ç—å —Ü—è *–æ–¥–Ω–∞* –≤–∞–ª—ñ–¥–∞—Ü—ñ—è:

1. –ù–æ—Ä–º–∞–ª—ñ–∑—É—î –≤–≤–µ–¥–µ–Ω–∏–π –∫–æ–¥ ‚Üí `P210_TAG_CODE` (–¥–µ—Å—è—Ç–∫–æ–≤–∏–π —Ñ–æ—Ä–º–∞—Ç).
2. –ü–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ **—É —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** –≤–∂–µ —î –∞–∫—Ç–∏–≤–Ω–∞ –º—ñ—Ç–∫–∞ (—Ü—å–æ–≥–æ —Ç–∏–ø—É):

   * —è–∫—â–æ —Ç–∞–∫ ‚Üí –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:
     *¬´–£ –¥–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–∂–µ —î –∞–∫—Ç–∏–≤–Ω–∞ –º—ñ—Ç–∫–∞‚Ä¶¬ª*
3. –Ø–∫—â–æ –≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ—ó –º—ñ—Ç–∫–∏:

   * –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ **—Ü—è –º—ñ—Ç–∫–∞-–Ω–æ–º–µ—Ä** —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞ –≤ —ñ–Ω—à–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:
   * —è–∫—â–æ —Ç–∞–∫ ‚Üí –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:
     *¬´–¢–∞–∫–∞ –º—ñ—Ç–∫–∞ –≤–∂–µ —î –≤ –±–∞–∑—ñ –π –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∞ –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞‚Ä¶¬ª*
4. –Ø–∫—â–æ –æ–±–∏–¥–≤—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ñ ‚Üí `RETURN NULL;` ‚Üí –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞.

---

## 2Ô∏è‚É£ –î–µ —Ä–æ–±–∏—Ç–∏ INSERT? –ü–æ—Ä—è–¥–æ–∫ –≤–∞–ª—ñ–¥–∞—Ü—ñ–π —ñ –ø—Ä–æ—Ü–µ—Å—ñ–≤

> **–ü–∏—Ç–∞–Ω–Ω—è:**
> *‚Äú—á–∏ –º–æ–∂—É –≤ –ø—Ä–æ—Ü–µ—Å–∏–Ω–≥—É, —Å–ø–æ—á–∞—Ç–∫—É –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å–∏–Ω–≥ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó when button pressing –∞ –¥–∞–ª—ñ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –ø—Ä–æ—Ü–µ—Å–∏–Ω–≥ –∑ insert?‚Äù*

–ö–æ—Ä–æ—Ç–∫–æ:
üî∏ **–ü—Ä–∞–≤–∏–ª—å–Ω–∏–π —à–ª—è—Ö –≤ APEX** ‚Äî —Ü–µ:

* –ø–∏—Å–∞—Ç–∏ **–ø–µ—Ä–µ–≤—ñ—Ä–∫—É —É Validation**
* –∞ **INSERT ‚Äî —É Process**.

APEX —Å–∞–º —Ä–æ–±–∏—Ç—å —Ç–∞–∫—É —á–µ—Ä–≥—É –ø—Ä–∏ Submit:

1. –í–∏–∫–æ–Ω—É—î **—É—Å—ñ Validations** (–∑ —É–º–æ–≤–æ—é *When Button Pressed = —Ç–≤–æ—è –∫–Ω–æ–ø–∫–∞*).
2. –Ø–∫—â–æ **—Ö–æ—á –æ–¥–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞** (validation –ø–æ–≤–µ—Ä–Ω—É–≤ —Ç–µ–∫—Å—Ç –ø–æ–º–∏–ª–∫–∏) ‚Üí
   ‚ùå **–Ω—ñ—è–∫—ñ Processes –Ω–µ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è**.
3. –Ø–∫—â–æ –≤—Å—ñ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –ø—Ä–æ–π—à–ª–∏ ‚Üí —Ç—ñ–ª—å–∫–∏ —Ç–æ–¥—ñ –∑–∞–ø—É—Å–∫–∞—é—Ç—å—Å—è **Page Processes** —É –ø–æ—Ä—è–¥–∫—É `Sequence`.

–¢–æ–±—Ç–æ —Ç–æ–±—ñ **–Ω–µ —Ç—Ä–µ–±–∞** —Ä–æ–±–∏—Ç–∏ –æ–∫—Ä–µ–º–∏–π ‚Äú–ø—Ä–æ—Ü–µ—Å–∏–Ω–≥ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó‚Äù —É Processes.
–î–æ—Å—Ç–∞—Ç–Ω—å–æ:

* **–û–¥–∏–Ω Validation** (—Ç–æ–π, —â–æ –≤–∏—â–µ).
* **–û–¥–∏–Ω Process** –∑ INSERT.

---

## 3Ô∏è‚É£ –ü—Ä–∏–∫–ª–∞–¥ Process –∑ INSERT

**Process type:** PL/SQL Code
**Point:** After Submit
**Condition:** When Button Pressed = `–î–æ–¥–∞—Ç–∏ –∑–≤'—è–∑–æ–∫`

```plsql
BEGIN
  INSERT INTO user_tag (user_id, tag_type_id, tag_code, created_at)
  VALUES (
    :P210_USER_ID,
    :P210_TAG_TYPE_ID,
    :P210_TAG_CODE,      -- –≤–∂–µ –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –∫–æ–¥ –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
    SYSTIMESTAMP
  );

  apex_application.g_print_success_message :=
    '–ó–≤‚Äô—è–∑–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á ‚Äì –º—ñ—Ç–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–æ.';
END;
```

üëâ APEX —Å–∞–º –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ —Ü–µ–π INSERT –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è **—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–æ–≤–µ—Ä–Ω—É–ª–∞ `NULL`** (—Ç–æ–±—Ç–æ –±–µ–∑ –ø–æ–º–∏–ª–æ–∫).

---

## 4Ô∏è‚É£ –ü—Ä–æ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å –Ω–∞ —Ä—ñ–≤–Ω—ñ –ë–î (–Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è)

–©–æ–± —â–µ –π –ë–î ‚Äú—Å—Ç—Ä–∞—Ö—É–≤–∞–ª–∞‚Äù –ø—Ä–∞–≤–∏–ª–∞:

```plsql
-- 1. –û–¥–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞ –º—ñ—Ç–∫–∞ –∑ –ø–µ–≤–Ω–∏–º –∫–æ–¥–æ–º (–≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è —Ç–∏–ø—É)
CREATE UNIQUE INDEX ux_user_tag_active_code
  ON user_tag (
    tag_type_id,
    tag_code,
    CASE WHEN date_end IS NULL THEN 1 END
  );

-- 2. –û–¥–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞ –º—ñ—Ç–∫–∞ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–∏–ø—É)
CREATE UNIQUE INDEX ux_user_tag_active_user
  ON user_tag (
    user_id,
    tag_type_id,
    CASE WHEN date_end IS NULL THEN 1 END
  );
```

APEX-–≤–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞—î –∑—Ä–æ–∑—É–º—ñ–ª–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è,
–∞ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏ ‚Äî ‚Äú–±—Ä–æ–Ω—è‚Äù –≤—ñ–¥ –±—É–¥—å-—è–∫–∏—Ö –æ–±—Ö—ñ–¥–Ω–∏—Ö —à–ª—è—Ö—ñ–≤.

---

–Ø–∫—â–æ —Ö–æ—á–µ—à, –¥–∞–ª—ñ –º–æ–∂–µ–º–æ:

* –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º–∏–π –∑–≤—ñ—Ç ‚Äú–ê—Ä—Ö—ñ–≤ –º—ñ—Ç–æ–∫‚Äù (—É—Å—ñ –∑ `date_end IS NOT NULL`);
* –∞–±–æ –¥–æ–¥–∞—Ç–∏ –∫–æ–ª–æ–Ω–∫—É –≤ IR, –¥–µ –±—É–¥–µ –≤–∏–¥–Ω–æ, —Ö—Ç–æ —Å—Ç–≤–æ—Ä–∏–≤/–¥–µ–∞–∫—Ç–∏–≤—É–≤–∞–≤ (—á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–µ—Ä, —è–∫–∏–π –º–∏ –≤–∂–µ –æ–±–≥–æ–≤–æ—Ä—é–≤–∞–ª–∏).
