–û–ø–∏—à—É —Å–ø–æ—á–∞—Ç–∫—É **—â–æ —Ç–∏ –≤–∂–µ –ø–æ–±—É–¥—É–≤–∞–≤**, –∞ –ø–æ—Ç—ñ–º –ø–æ–∫–∞–∂—É **—è–∫ –∞–∫—É—Ä–∞—Ç–Ω–æ –¥–æ–¥–∞—Ç–∏ –∞–≤—Ç–æ—Ä–∞** –π –æ–¥–Ω–æ—á–∞—Å–Ω–æ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ –¥—É–∂–∫–∏, —â–æ–± –ª–æ–≥—ñ–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª–∞ —Ç–æ–º—É, —â–æ —Ç–∏ —Ö–æ—á–µ—à.

---

## 1. –õ–æ–≥—ñ–∫–∞ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ (—Å–ª–æ–≤–∞–º–∏)

–ú–∞—î–º–æ —É–º–æ–≤—É (—Å–ø—Ä–æ—â–µ–Ω–æ, –±–µ–∑ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫):

```sql
al.access_level = 2
AND (
    (ac.position_id   IS NULL OR ac.position_id   = uc.position_id)
AND (ac.department_id IS NULL OR ac.department_id = uc.department_id)
AND (ac.unit_id       IS NULL OR ac.unit_id       = uc.unit_id)
AND (ac.uchastok      IS NULL OR ac.uchastok      = uc.uchastok_id)
)
AND (ac.user_id IS NULL OR ac.user_id = uc.user_id)
AND EXISTS (
    SELECT 1
    FROM TaskTracker.TASKS@TO_TASKTRACKER10 t1
    WHERE t1.ID = t.TASK_ID
      AND t1.DEPARTMENT_ID = uc.department_id
      AND (ac.unit_id    IS NULL OR (ac.unit_id    IS NOT NULL AND t1.UNIT_ID      = uc.unit_id))
      AND (ac.uchastok   IS NULL OR (ac.uchastok   IS NOT NULL AND t1.UCHASTOK_ID  = uc.uchastok_id))
)
OR EXISTS (
    SELECT 1
    FROM TaskTracker.SIGNATURERIGHTS@TO_TASKTRACKER10 sr
    WHERE sr.task_id = t.TASK_ID
      AND (
            (sr.USER_TABNO = uc.user_id)
         OR (sr.POSITION_ID = uc.position_id
             AND sr.DEPARTMENT_ID = uc.department_id
             AND (sr.UNIT_ID IS NULL OR sr.UNIT_ID = uc.unit_id)
            )
        AND (sr.UCHASTOK IS NULL OR sr.UCHASTOK = uc.uchastok_id)
      )
)
```

### –Ø–∫ —Ü–µ —á–∏—Ç–∞—î—Ç—å—Å—è –ª–æ–≥—ñ—á–Ω–æ (–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—ñ–≤ AND / OR)

–ß–µ—Ä–µ–∑ —Ç–µ, —â–æ `OR` –≤–Ω–∏–∑—É **–Ω–µ –≤–∑—è—Ç–æ –≤ –¥—É–∂–∫–∏**, Oracle —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç—É—î —Ü–µ —Ç–∞–∫:

```sql
(
  al.access_level = 2
  AND —É–º–æ–≤–∏ –ø–æ ac/uc
  AND EXISTS (–ø–æ TASKS)
)
OR
EXISTS (–ø–æ SIGNATURERIGHTS)
```

–¢–æ–±—Ç–æ –∑–∞—Ä–∞–∑:

1. **–ü–µ—Ä—à–∞ –≥—ñ–ª–∫–∞**:

   * —Ä—ñ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø—É `al.access_level = 2`
   * –∑–±—ñ–≥ –ø–æ `position / department / unit / uchastok / user` –∑ —Ç–∞–±–ª–∏—Ü—ñ `ac` –∑ –ø–æ—Ç–æ—á–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º `uc`
   * —ñ—Å–Ω—É—î –∑–∞–ø–∏—Å —É `TASKS`, —è–∫–∏–π –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î `t.TASK_ID` —ñ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É/—É—á–∞—Å—Ç–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

2. **–î—Ä—É–≥–∞ –≥—ñ–ª–∫–∞** (—á–µ—Ä–µ–∑ `OR`) ‚Äì **–≤–∑–∞–≥–∞–ª—ñ –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ `access_level`**:

   * —ñ—Å–Ω—É—î –∑–∞–ø–∏—Å —É `SIGNATURERIGHTS` –¥–ª—è —Ü—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è
   * –∞–±–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —è–≤–Ω–æ –≤–∫–∞–∑–∞–Ω–∏–π —è–∫ –ø—ñ–¥–ø–∏—Å–∞–Ω—Ç (`sr.USER_TABNO = uc.user_id`),
   * –∞–±–æ —É –Ω—å–æ–≥–æ –∑–±—ñ–≥–∞—î—Ç—å—Å—è `POSITION + DEPARTMENT (+ UNIT, + UCHASTOK)` –∑ –ø—Ä–∞–≤–∞–º–∏ –ø—ñ–¥–ø–∏—Å—É.

üî¥ –¢–æ–±—Ç–æ –∑–∞—Ä–∞–∑ **–±—É–¥—å-—è–∫–∏–π**, —Ö—Ç–æ —î –≤ `SIGNATURERIGHTS`, –ø–æ–ø–∞–¥–∞—î —É view, **–Ω–∞–≤—ñ—Ç—å —è–∫—â–æ `access_level` ‚â† 2** ‚Äì —Ü–µ, —Å–∫–æ—Ä—ñ—à –∑–∞ –≤—Å–µ, –Ω–µ —Ç–µ, —â–æ —Ç–∏ —Ö–æ—á–µ—à.

---

## 2. –©–æ —Ç–∏ —Ö–æ—á–µ—à –∑–∞ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–æ—é

–¢–∏ —Å–∞–º —Å—Ñ–æ—Ä–º—É–ª—é–≤–∞–≤:

1. **–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ –∑–∞–ø–∏—Å–∏ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É (–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —É—á–∞—Å—Ç–∫—É, —è–∫—â–æ —î)** –ø—Ä–∏ —É–º–æ–≤—ñ `access_level = 2`.
2. * **–ó–∞–ø–∏—Å–∏, –¥–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —î –≤ —Å–ø–∏—Å–∫—É –ø—ñ–¥–ø–∏—Å—É–≤–∞—á—ñ–≤** (`SIGNATURERIGHTS`) ‚Äì —Ç–∞–∫–æ–∂ —É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –¥–æ—Å—Ç—É–ø—É 2.
3. * **–ó–∞–ø–∏—Å–∏, –¥–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —î –∞–≤—Ç–æ—Ä–æ–º** (`t.CREATOR_ID = uc.user_id`), —Ç–µ–∂ –ø—Ä–∏ `access_level = 2`.

–¢–æ–±—Ç–æ –±–∞–∑–æ–≤–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –º–∞–ª–∞ –± –±—É—Ç–∏ —Ç–∞–∫–∞:

```sql
al.access_level = 2
AND (
      —É–º–æ–≤–∞ –ø–æ ACL (ac + uc + tasks)
   OR —É–º–æ–≤–∞ –ø–æ SIGNATURERIGHTS
   OR —É–º–æ–≤–∞ "—è –∞–≤—Ç–æ—Ä"
)
```

---

## 3. –ü–µ—Ä–µ–ø–∏—Å–∞–Ω–∞ —É–º–æ–≤–∞ –∑ –¥–æ–¥–∞–Ω–∏–º –∞–≤—Ç–æ—Ä–æ–º

–Ø –∑–∞—Ä–∞–∑ –¥–∞–º —Ç–æ–±—ñ SQL-—Ñ—Ä–∞–≥–º–µ–Ω—Ç —É–∂–µ –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ, –∑ –¥—É–∂–∫–∞–º–∏ –π –Ω–æ–≤–æ—é —É–º–æ–≤–æ—é `t.CREATOR_ID = uc.user_id`:

```sql
al.access_level = 2
AND (
       -- 1) –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ ACL (–ø–æ–∑–∏—Ü—ñ—è/–ø—ñ–¥—Ä–æ–∑–¥—ñ–ª/unit/—É—á–∞—Å—Ç–æ–∫/–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á + —Ñ–∞–∫—Ç, —â–æ –∑–∞–¥–∞—á–∞ –∑ —Ü—å–æ–≥–æ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É/—É—á–∞—Å—Ç–∫—É)
       (
            (ac.position_id   IS NULL OR ac.position_id   = uc.position_id)
        AND (ac.department_id IS NULL OR ac.department_id = uc.department_id)
        AND (ac.unit_id       IS NULL OR ac.unit_id       = uc.unit_id)
        AND (ac.uchastok      IS NULL OR ac.uchastok      = uc.uchastok_id)
        AND (ac.user_id       IS NULL OR ac.user_id       = uc.user_id)
        AND EXISTS (
                SELECT 1
                FROM TaskTracker.TASKS@TO_TASKTRACKER10 t1
                WHERE t1.ID             = t.TASK_ID
                  AND t1.DEPARTMENT_ID  = uc.department_id
                  AND (ac.unit_id    IS NULL OR (ac.unit_id    IS NOT NULL AND t1.UNIT_ID      = uc.unit_id))
                  AND (ac.uchastok   IS NULL OR (ac.uchastok   IS NOT NULL AND t1.UCHASTOK_ID  = uc.uchastok_id))
            )
       )

    OR -- 2) –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –ø—Ä–∞–≤–∞ –ø—ñ–¥–ø–∏—Å—É –ø–æ —Ü—ñ–π –∑–∞–¥–∞—á—ñ

       EXISTS (
           SELECT 1
           FROM TaskTracker.SIGNATURERIGHTS@TO_TASKTRACKER10 sr
           WHERE sr.task_id = t.TASK_ID
             AND (
                     sr.USER_TABNO = uc.user_id
                  OR (
                        sr.POSITION_ID   = uc.position_id
                    AND sr.DEPARTMENT_ID = uc.department_id
                    AND (sr.UNIT_ID IS NULL OR sr.UNIT_ID = uc.unit_id)
                    AND (sr.UCHASTOK IS NULL OR sr.UCHASTOK = uc.uchastok_id)
                  )
                 )
       )

    OR -- 3) –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —î –∞–≤—Ç–æ—Ä–æ–º –∑–∞–¥–∞—á—ñ

       t.CREATOR_ID = uc.user_id
)
```

### –©–æ —Ç—É—Ç –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:

* `al.access_level = 2` ‚Äî –±–∞–∑–æ–≤–∞ —É–º–æ–≤–∞: –ø—Ä–∞—Ü—é—î–º–æ —Ç—ñ–ª—å–∫–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –¥–æ—Å—Ç—É–ø—É 2.
* –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π –±–ª–æ–∫ —É –¥—É–∂–∫–∞—Ö `(...)` –∫–∞–∂–µ: **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å –∑–∞–¥–∞—á—É, —è–∫—â–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —Ö–æ—á –æ–¥–Ω–∞ –∑ —Ç—Ä—å–æ—Ö —É–º–æ–≤**:

  1. ‚úÖ **–í—ñ–Ω –≤—Ö–æ–¥–∏—Ç—å —É ACL (ac)** –∑–∞ –ø—Ä–∏–Ω—Ü–∏–ø–æ–º:

     * –∞–±–æ `position/department/unit/uchastok` –Ω–µ –∑–∞–¥–∞–Ω—ñ –≤ ACL, –∞–±–æ –∑–±—ñ–≥–∞—é—Ç—å—Å—è –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º;
     * –∞–±–æ `user_id` –Ω–µ –∑–∞–¥–∞–Ω–∏–π, –∞–±–æ –∑–±—ñ–≥–∞—î—Ç—å—Å—è;
     * —ñ —î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –∑–∞–ø–∏—Å –≤ `TASKS` –∑ —Ç–∏–º —Å–∞–º–∏–º –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–æ–º/—É—á–∞—Å—Ç–∫–æ–º.
  2. ‚úÖ **–í—ñ–Ω —î –ø—ñ–¥–ø–∏—Å–∞–Ω—Ç–æ–º (SIGNATURERIGHTS)**:

     * —è–≤–Ω–æ —è–∫ `USER_TABNO`,
     * –∞–±–æ –∑–∞ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—î—é –ø–æ—Å–∞–¥–∞ + –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª + unit + uchastok.
  3. ‚úÖ **–í—ñ–Ω –∞–≤—Ç–æ—Ä –∑–∞–¥–∞—á—ñ** ‚Äì –ø—Ä–æ—Å—Ç–æ `t.CREATOR_ID = uc.user_id`.

---

## 4. –ö–æ—Ä–æ—Ç–∫–æ: —á–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ü–µ —Ç–≤–æ—î–º—É –æ–ø–∏—Å—É?

–¢–∞–∫:

* ¬´–≤—Å—ñ –∑–∞–ø–∏—Å–∏ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É –∑ –≤—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —É—á–∞—Å—Ç–∫—É —è–∫—â–æ —î¬ª ‚Üí –ø–µ—Ä—à–∏–π –±–ª–æ–∫ –∑ `ac + tasks + uc`.
* ¬´+ –∑–∞–ø–∏—Å–∏ –¥–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —î –≤ —Å–ø–∏—Å–∫—É –ø—ñ–¥–ø–∏—Å—É–≤–∞—á—ñ–≤¬ª ‚Üí –¥—Ä—É–≥–∏–π `EXISTS` –ø–æ `SIGNATURERIGHTS`.
* ¬´+ –≤—Å—ñ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ —Ä—ñ–≤–Ω—ñ –¥–æ—Å—Ç—É–ø—É 2, –¥–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —î –∞–≤—Ç–æ—Ä–æ–º¬ª ‚Üí —Ç—Ä–µ—Ç—è —É–º–æ–≤–∞ `t.CREATOR_ID = uc.user_id`.

–Ø–∫—â–æ —Å–∫–∏–Ω–µ—à –ø–æ–≤–Ω–∏–π `FROM`/`JOIN` —à–º–∞—Ç–æ–∫ `v_full_tasks`, –º–æ–∂—É —â–µ —Ä–∞–∑ –ø—Ä–æ–≥–ª—è–Ω—É—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —â–æ–± 100% —É–∑–≥–æ–¥–∏—Ç–∏ –ø–æ alias‚Äô–∞—Ö —ñ —É–Ω–∏–∫–Ω—É—Ç–∏ –¥—Ä—ñ–±–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫ —Ç–∏–ø—É `= =` —á–∏ `unit id`.
