–¢–∞–∫, –¥–∞–≤–∞–π —Ç–µ–ø–µ—Ä –ø—ñ–¥—Ç—è–≥–Ω–µ–º–æ **—Ñ—É–Ω–∫—Ü—ñ—é** –¥–æ —Ç—ñ—î—ó –∂ –ª–æ–≥—ñ–∫–∏, —â–æ –π –¥–ª—è `start_consist`:

> **–¢—Ä–µ–±–∞ —Ä–∞—Ö—É–≤–∞—Ç–∏**:
>
> * –≤—Å—ñ –Ω–∞—Ä—è–¥–∏, —è–∫—ñ
>   üîπ **–ø–æ–ø–∞–¥–∞—é—Ç—å –≤ –ø–æ—Ç–æ—á–Ω—É –∑–º—ñ–Ω—É –ø–æ ORDERSTART**
>   üîπ —ñ –º–∞—é—Ç—å —Å—Ç–∞—Ç—É—Å **–¥–æ–∑–≤–æ–ª–µ–Ω–∞** (`ORDER_STATUS_ID = 3`)
>
> **–ê –¢–ê–ö–û–ñ**
>
> * –≤—Å—ñ –Ω–∞—Ä—è–¥–∏, —è–∫—ñ
>   üîπ **–º–∞—é—Ç—å ORDERSTART —Ä–∞–Ω—ñ—à–µ –ø–æ—á–∞—Ç–∫—É –ø–æ—Ç–æ—á–Ω–æ—ó –∑–º—ñ–Ω–∏**
>   üîπ —ñ —Ç–µ–∂ –º–∞—é—Ç—å —Å—Ç–∞—Ç—É—Å **–¥–æ–∑–≤–æ–ª–µ–Ω–∞** (`ORDER_STATUS_ID = 3`).

–¢–æ–±—Ç–æ:
**—Å—Ç–∞—Ç—É—Å —Ç—ñ–ª—å–∫–∏ 3**,
–∞ –ø–æ —á–∞—Å—É ‚Äî `ORDERSTART` **–∞–±–æ –≤ –º–µ–∂–∞—Ö –∑–º—ñ–Ω–∏**, –∞–±–æ **—Ä–∞–Ω—ñ—à–µ —ó—ó –ø–æ—á–∞—Ç–∫—É** (–ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ, –∞–ª–µ —â–µ –Ω–µ –≤—ñ–¥–∫—Ä–∏—Ç—ñ/–Ω–µ –∑–∞–∫—Ä–∏—Ç—ñ).

---

### –ü–µ—Ä–µ–±—É–¥–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è `COUNT_ZORO_START_ON_SHIFT`

–Ø —â–µ —Ç—Ä–æ—Ö–∏ –ø–æ—á–∏—Å—Ç–∏–≤ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, —â–æ–± –≤–æ–Ω–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –∫–æ–º–ø—ñ–ª–∏–ª–æ—Å—å:

```sql
FUNCTION COUNT_ZORO_START_ON_SHIFT (
    LC_DEP_ID  IN NUMBER DEFAULT NULL,
    LC_UNIT_ID IN NUMBER DEFAULT NULL
) RETURN NUMBER
IS
    v_count        NUMBER;
    v_shift_start  DATE;
    v_shift_end    DATE;
    v_shift_number NUMBER;
BEGIN
    -- –í–∏–∑–Ω–∞—á–∞—î–º–æ –ø–æ—Ç–æ—á–Ω—É –∑–º—ñ–Ω—É —Ç–∞ —ó—ó –º–µ–∂—ñ
    IF (TO_CHAR(SYSDATE, 'HH24:MI') BETWEEN '23:00' AND '23:59')
       OR (TO_CHAR(SYSDATE, 'HH24:MI') BETWEEN '00:00' AND '06:59')
    THEN
        v_shift_number := 1;
        v_shift_start  := TRUNC(SYSDATE - 1) + INTERVAL '0 23:00:00' DAY TO SECOND;
        v_shift_end    := TRUNC(SYSDATE)     + INTERVAL '0 07:00:00' DAY TO SECOND;

    ELSIF TO_CHAR(SYSDATE, 'HH24:MI') BETWEEN '07:00' AND '14:59' THEN
        v_shift_number := 2;
        v_shift_start  := TRUNC(SYSDATE) + INTERVAL '0 07:00:00' DAY TO SECOND;
        v_shift_end    := TRUNC(SYSDATE) + INTERVAL '0 15:00:00' DAY TO SECOND;

    ELSIF TO_CHAR(SYSDATE, 'HH24:MI') BETWEEN '15:00' AND '22:59' THEN
        v_shift_number := 3;
        v_shift_start  := TRUNC(SYSDATE) + INTERVAL '0 15:00:00' DAY TO SECOND;
        v_shift_end    := TRUNC(SYSDATE) + INTERVAL '0 23:00:00' DAY TO SECOND;
    ELSE
        -- –ù–∞ –≤—Å—è–∫–∏–π –≤–∏–ø–∞–¥–æ–∫, —è–∫—â–æ —Ä–∞–ø—Ç–æ–º –Ω–µ –ø–æ–ø–∞–¥–∞—î–º–æ –Ω—ñ –≤ –æ–¥–∏–Ω —ñ–Ω—Ç–µ—Ä–≤–∞–ª
        RETURN 0;
    END IF;

    IF LC_DEP_ID IS NOT NULL THEN
        SELECT COUNT(tw.ORDER_ID)
          INTO v_count
          FROM ASICS.ASICS_ZORO_INFO_V2_VIEW tw
         WHERE
               -- 1) —Å—Ç–∞—Ç—É—Å —Ç—ñ–ª—å–∫–∏ "–î–æ–∑–≤–æ–ª–µ–Ω–∞"
               tw.ORDER_STATUS_ID = 3
           AND (
                   -- 2–∞) –∞–±–æ –ø–æ—á–∞—Ç–æ–∫ –≤ –º–µ–∂–∞—Ö –ø–æ—Ç–æ—á–Ω–æ—ó –∑–º—ñ–Ω–∏
                   (tw.ORDERSTART BETWEEN v_shift_start AND v_shift_end)
                   -- 2–±) –∞–±–æ –ø–æ—á–∞—Ç–æ–∫ –±—É–≤ —Ä–∞–Ω—ñ—à–µ –ø–æ—á–∞—Ç–∫—É —Ü—ñ—î—ó –∑–º—ñ–Ω–∏
                OR (tw.ORDERSTART < v_shift_start)
               )
           AND (tw.UNIT    = LC_UNIT_ID OR LC_UNIT_ID IS NULL)
           AND (tw.CRDEPID = LC_DEP_ID  OR LC_DEP_ID  IS NULL)
           AND tw.PermDepID IN (2, LC_DEP_ID);
    ELSE
        SELECT COUNT(tw.ORDER_ID)
          INTO v_count
          FROM ASICS.ASICS_ZORO_INFO_V2_VIEW tw
         WHERE
               tw.ORDER_STATUS_ID = 3
           AND (
                   (tw.ORDERSTART BETWEEN v_shift_start AND v_shift_end)
                OR (tw.ORDERSTART < v_shift_start)
               )
           AND (tw.UNIT    = LC_UNIT_ID OR LC_UNIT_ID IS NULL)
           AND (tw.CRDEPID = LC_DEP_ID  OR LC_DEP_ID  IS NULL)
           AND tw.PermDepID = 2;
    END IF;

    RETURN v_count;
END COUNT_ZORO_START_ON_SHIFT;
```

---

### –©–æ —Ç—É—Ç –≤–∞–∂–ª–∏–≤–æ

1. **–°—Ç–∞—Ç—É—Å**

   ```sql
   tw.ORDER_STATUS_ID = 3
   ```

   ‚Äî –±–µ—Ä–µ–º–æ **—Ç—ñ–ª—å–∫–∏ "–¥–æ–∑–≤–æ–ª–µ–Ω—ñ"**, —è–∫ —Ç–∏ –π —Ö–æ—Ç—ñ–≤.

2. **–õ–æ–≥—ñ–∫–∞ —á–∞—Å—É**

   ```sql
   AND (
         (tw.ORDERSTART BETWEEN v_shift_start AND v_shift_end)
      OR (tw.ORDERSTART < v_shift_start)
       )
   ```

   * —è–∫—â–æ –Ω–∞—Ä—è–¥ **–ø–ª–∞–Ω–æ–≤–æ —Å—Ç–∞—Ä—Ç—É—î –≤ –ø–æ—Ç–æ—á–Ω—É –∑–º—ñ–Ω—É** ‚Üí —Ä–∞—Ö—É—î–º–æ;
   * —è–∫—â–æ –º–∞–≤ —Å—Ç–∞—Ä—Ç—É–≤–∞—Ç–∏ **—Ä–∞–Ω—ñ—à–µ –ø–æ—á–∞—Ç–∫—É –∑–º—ñ–Ω–∏**, –∞–ª–µ —â–µ –¥–æ–∑–≤–æ–ª–µ–Ω–∏–π ‚Üí —Ç–µ–∂ —Ä–∞—Ö—É—î–º–æ (–≤—ñ–Ω –∑–∞–≤–∏—Å —ñ –π–æ–≥–æ —Ç—Ä–µ–±–∞ –≤—ñ–¥–∫—Ä–∏—Ç–∏).

3. **–§—ñ–ª—å—Ç—Ä–∏ –ø–æ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É / unit** –ª–∏—à–∞—é—Ç—å—Å—è —Ç–∞–∫–∏–º–∏ –∂, —è–∫ –±—É–ª–∏.

---

–Ø–∫—â–æ —Ö–æ—á–µ—à, –º–æ–∂—É —â–µ **—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ —Ü—é –ª–æ–≥—ñ–∫—É 1-–≤-1 –∑ —Ç–∏–º, —â–æ –≤ `start_consist` —É VIEW** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —á–µ—Ä–µ–∑ –æ–∫—Ä–µ–º—É —Ñ—É–Ω–∫—Ü—ñ—é `IS_ON_CURRENT_SHIFT(p_date)`), —â–æ–± —ñ view, —ñ —Ñ—É–Ω–∫—Ü—ñ—è –Ω–µ –∂–∏–ª–∏ —Å–≤–æ—ó–º –∂–∏—Ç—Ç—è–º, –∞ –¥–∏–≤–∏–ª–∏—Å—å –Ω–∞ –æ–¥–Ω—É –π —Ç—É —Å–∞–º—É –±—ñ–∑–Ω–µ—Å-—É–º–æ–≤—É.
