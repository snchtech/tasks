–ó—Ä–æ–∑—É–º—ñ–≤ ‚Äî **–º—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–∏**, –∑–∞–ª–∏—à–∞—é—á–∏ –≤—Å—é –ª–æ–≥—ñ–∫—É —è–∫ —î.
–¢–æ–±—Ç–æ –º–∏ –ø—Ä–æ—Å—Ç–æ **–¥–æ–¥–∞—î–º–æ –ø—ñ–¥—Ç—Ä–∏–º–∫—É –ø—Ä–µ—Ñ—ñ–∫—Å–∞ `EP_`**, –Ω–µ —á—ñ–ø–∞—é—á–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ—É–Ω–∫—Ü—ñ—ó.

–û—Å—å —Ç–∞–∫ –±—É–¥–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ñ –±–µ–∑–ø–µ—á–Ω–æ:

---

# ‚úÖ **–û–ù–û–í–õ–ï–ù–ê –§–£–ù–ö–¶–Ü–Ø (–º—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–∏ –≤ —Å—Ç–∞—Ä–∏–π –∫–æ–¥)**

```sql
function GET_USER_ROLE_BY_CUSTOM_IDNTIFY (
    LC_APP_ID     IN NUMBER,
    LC_USER_LOGIN IN VARCHAR2,
    LC_IDNT_TYPE  IN VARCHAR2
)
return NUMBER
IS
    l_curr_user_role_id NUMBER;
    l_user_roles_list   VARCHAR2(4000);
BEGIN

    select LISTAGG(ROLE_STATIC_ID, ',') 
           within group (order by ROLE_STATIC_ID)
      into l_user_roles_list
      from APEX_APPL_ACL_USER_ROLES t
     where t.APPLICATION_ID = LC_APP_ID
       and t.USER_NAME      = LC_USER_LOGIN
       and t.ROLE_STATIC_ID LIKE LC_IDNT_TYPE || '_%' 
       and ROWNUM = 1;

    -- ===== –°–¢–ê–†–ê –õ–û–ì–Ü–ö–ê + –î–û–î–ê–ù–û EP =====
    IF SUBSTR(l_user_roles_list, 1, 1) = 'P' THEN
        l_curr_user_role_id := TO_NUMBER(SUBSTR(l_user_roles_list, 3));

    ELSIF SUBSTR(l_user_roles_list, 1, 1) = 'D' THEN
        l_curr_user_role_id := TO_NUMBER(SUBSTR(l_user_roles_list, 3));

    ELSIF SUBSTR(l_user_roles_list, 1, 1) = 'U' THEN
        l_curr_user_role_id := TO_NUMBER(SUBSTR(l_user_roles_list, 3));

    -- üî• –î–û–î–ê–ù–û –ü–Ü–î–¢–†–ò–ú–ö–£ EP_xxx
    ELSIF SUBSTR(l_user_roles_list, 1, 2) = 'EP' THEN
        -- –¥–ª—è EP_5777 –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—Ä–∞—Ç–∏ —á–∏—Å–ª–æ –ø—ñ—Å–ª—è —Ç—Ä—å–æ—Ö —Å–∏–º–≤–æ–ª—ñ–≤ (E P _)
        l_curr_user_role_id := TO_NUMBER(SUBSTR(l_user_roles_list, 4));

    ELSE
        NULL;
    END IF;

    return l_curr_user_role_id;

END GET_USER_ROLE_BY_CUSTOM_IDNTIFY;
```

---

## üü¶ **–ü–æ—è—Å–Ω–µ–Ω–Ω—è –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω**

–¢–∏ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–º—ñ–Ω—é—î—à —É –ø—Ä–∏–Ω—Ü–∏–ø—ñ —Ä–æ–±–æ—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—ó ‚Äî –ª–∏—à–µ –¥–æ–¥–∞—î—à –æ–¥–∏–Ω –Ω–æ–≤–∏–π –±–ª–æ–∫:

```sql
ELSIF SUBSTR(l_user_roles_list, 1, 2) = 'EP' THEN
    l_curr_user_role_id := TO_NUMBER(SUBSTR(l_user_roles_list, 4));
```

–ß–æ–º—É `SUBSTR(..., 4)`?

| –†–æ–ª—å                                                                  | –ü–æ–∑–∏—Ü—ñ—è —á–∏—Å–ª–∞ |
| --------------------------------------------------------------------- | ------------- |
| `P_10` ‚Üí `'P' '_' 10` ‚Üí —á–∏—Å–ª–æ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ **3-–≥–æ —Å–∏–º–≤–æ–ª—É**          |               |
| `EP_5777` ‚Üí `'E' 'P' '_' 5777` ‚Üí —á–∏—Å–ª–æ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ **4-–≥–æ —Å–∏–º–≤–æ–ª—É** |               |

–¢–æ–º—É —Ç–∞–∫–µ —Ä—ñ—à–µ–Ω–Ω—è —ñ–¥–µ–∞–ª—å–Ω–æ –≤–ø–∏—Å—É—î—Ç—å—Å—è —É —Å—Ç–∞—Ä—É –ª–æ–≥—ñ–∫—É.

---

## üü© **–Ø–∫ —Ä–æ–±–∏—Ç–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Ä—ñ–∑–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä–æ–ª—ñ**

–£ –ø—Ä–æ—Ü–µ—Å—ñ **Before Header** –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —ñ–Ω—à–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É:

```plsql
DECLARE
    l_role NUMBER;
BEGIN
    l_role := GET_USER_ROLE_BY_CUSTOM_IDNTIFY(118, :APP_USER, 'EP');

    IF l_role = 23445 THEN
        apex_util.redirect_url(apex_page.get_url(
            p_application => :APP_ID,
            p_page        => 3
        ));

    ELSIF l_role = 5777 THEN
        apex_util.redirect_url(apex_page.get_url(
            p_application => :APP_ID,
            p_page        => 4
        ));
    END IF;
END;
```

–Ø–∫—â–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ –¥–æ–¥–∞—Ç–∫—É 118 ‚Äî –∑–º—ñ–Ω—é—î—à `p_application`.

---

–Ø–∫—â–æ —Ö–æ—á–µ—à ‚Äî –º–æ–∂—É –∑—Ä–æ–±–∏—Ç–∏ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω—É –ª–æ–≥—ñ–∫—É, —è–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å —É—Å—ñ—Ö EP_xxxx –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É xxxx (—è–∫—â–æ —Ç—Ä–µ–±–∞).
