–¢–∞–∫, –±–∞–∂–∞–Ω–æ **–ø—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ —ñ —á–∞—Å—Ç–∏–Ω—É —É view**, —â–æ–± –≤–æ–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª–∞ —Ç—ñ–π —Å–∞–º—ñ–π –ª–æ–≥—ñ—Ü—ñ, —â–æ –π —Ñ—É–Ω–∫—Ü—ñ—ó:

* **–¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –Ω–∞ –∑–º—ñ–Ω—ñ** ‚Üí —Å—Ç–∞—Ç—É—Å **`–î–æ–∑–≤–æ–ª–µ–Ω–∞` (3)**
* **–¥–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è –Ω–∞ –∑–º—ñ–Ω—ñ** ‚Üí —Å—Ç–∞—Ç—É—Å **`–í—ñ–¥–∫—Ä–∏—Ç–∞` (4)**

–Ü–Ω–∞–∫—à–µ —É —Ç–µ–±–µ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏ (`COUNT_ZORO_*`) –±—É–¥—É—Ç—å —Ä–∞—Ö—É–≤–∞—Ç–∏ –æ–¥–Ω–µ, –∞ –ø—ñ–¥—Å–≤—ñ—Ç–∫–∞ –≤ `view` –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ —ñ–Ω—à–µ.

---

### –û–Ω–æ–≤–ª–µ–Ω–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç `end_consist` —É view

–ë—É–ª–æ (–ª–æ–≥—ñ–∫–∞ –±–µ–∑ —Å—Ç–∞—Ç—É—Å—É –∞–±–æ –∑ `<> 0`):

```sql
CASE
    WHEN TO_NUMBER(TO_CHAR(SYSDATE,'HH24')) BETWEEN 7 AND 14
         AND TO_CHAR(tw.ORDEREND, 'HH24:MI') BETWEEN '07:00' AND '14:59'
         AND TRUNC(tw.ORDEREND) = TRUNC(SYSDATE)
    THEN 'endshift'
    ...
    ELSE NULL
END AS end_consist,
```

–ê–±–æ —É –≤–∞—Ä—ñ–∞–Ω—Ç—ñ, —è–∫–∏–π —è –ø—Ä–æ–ø–æ–Ω—É–≤–∞–≤ —Ä–∞–Ω—ñ—à–µ, –±—É–ª–æ —â–æ—Å—å —Ç–∏–ø—É:

```sql
CASE
    WHEN tw.ORDER_STATUS_ID <> 0
         AND (
               (TRUNC(tw.ORDEREND) = TRUNC(SYSDATE) ... –ø–æ –∑–º—ñ–Ω—ñ ...)
            OR TRUNC(tw.ORDEREND) < TRUNC(SYSDATE)
             )
    THEN 'endshift'
    ELSE NULL
END AS end_consist,
```

–¢–µ–ø–µ—Ä –∫—Ä–∞—â–µ –∑—Ä–æ–±–∏—Ç–∏ —Ç–∞–∫ (–æ—Ä—ñ—î–Ω—Ç—É—î–º–æ—Å—å –Ω–∞ **—Å—Ç–∞—Ç—É—Å ¬´–í—ñ–¥–∫—Ä–∏—Ç–∞¬ª (4)**):

```sql
CASE
    WHEN tw.ORDER_STATUS_ID = 4   -- —Ç—ñ–ª—å–∫–∏ –≤—ñ–¥–∫—Ä–∏—Ç—ñ, —è–∫—ñ —â–µ —Ç—Ä–µ–±–∞ –∑–∞–∫—Ä–∏—Ç–∏
         AND (
               -- 1) –ø–ª–∞–Ω–æ–≤–µ –∑–∞–∫—Ä–∏—Ç—Ç—è —Å—å–æ–≥–æ–¥–Ω—ñ —ñ –ø–æ–ø–∞–¥–∞—î –≤ –ø–æ—Ç–æ—á–Ω—É –∑–º—ñ–Ω—É
               (
                   TRUNC(tw.ORDEREND) = TRUNC(SYSDATE)
                   AND (
                       (  TO_NUMBER(TO_CHAR(SYSDATE,'HH24')) BETWEEN 7 AND 14
                          AND TO_CHAR(tw.ORDEREND,'HH24:MI') BETWEEN '07:00' AND '14:59'
                       )
                       OR
                       (  TO_NUMBER(TO_CHAR(SYSDATE,'HH24')) BETWEEN 15 AND 22
                          AND TO_CHAR(tw.ORDEREND,'HH24:MI') BETWEEN '15:00' AND '22:59'
                       )
                       OR
                       ( (TO_NUMBER(TO_CHAR(SYSDATE,'HH24')) BETWEEN 23 AND 23
                           OR TO_NUMBER(TO_CHAR(SYSDATE,'HH24')) BETWEEN 0 AND 6
                          )
                          AND ( TO_CHAR(tw.ORDEREND,'HH24:MI') BETWEEN '23:00' AND '23:59'
                                OR TO_CHAR(tw.ORDEREND,'HH24:MI') BETWEEN '00:00' AND '06:59'
                              )
                       )
                   )
               )
               -- 2) –∞–±–æ –º–∞–ª–∏ –∑–∞–∫—ñ–Ω—á–∏—Ç–∏—Å—è —Ä–∞–Ω—ñ—à–µ, –Ω—ñ–∂ —Å—å–æ–≥–æ–¥–Ω—ñ (–ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ, –∞–ª–µ —â–µ –≤—ñ–¥–∫—Ä–∏—Ç—ñ)
               OR TRUNC(tw.ORDEREND) < TRUNC(SYSDATE)
         )
    THEN 'endshift'
    ELSE NULL
END AS end_consist,
```

üîπ –¶—è –ª–æ–≥—ñ–∫–∞ —Ç–µ–ø–µ—Ä —É–∑–≥–æ–¥–∂–µ–Ω–∞ –∑:

* –∑–∞–ø–∏—Ç–æ–º –¥–ª—è –≤–∏–±—ñ—Ä–∫–∏ —Ç–∏—Ö, —â–æ —Ç—Ä–µ–±–∞ –∑–∞–∫—Ä–∏—Ç–∏:

  ```sql
  SELECT SOURCE_ID
  FROM TW.ASICS_ZORO_INFO_VIEW tw
  WHERE tw.ORDER_STATUS_ID = 4
    AND (tw.ORDEREND BETWEEN :SHIFT_START AND :SHIFT_END
         OR tw.ORDEREND < :SHIFT_START);
  ```
* —Ñ—É–Ω–∫—Ü—ñ—î—é `COUNT_ZORO_END_ON_SHIFT`, –¥–µ –º–∏ —Ç–µ–∂ –ø–µ—Ä–µ–π—à–ª–∏ –Ω–∞ `ORDER_STATUS_ID = 4`.

---

–Ø–∫—â–æ —Ö–æ—á–µ—à, –º–æ–∂—É –¥–ª—è –ø–æ–≤–Ω–æ—ó —Å–∏–º–µ—Ç—Ä—ñ—ó –≤–∏–ø–∏—Å–∞—Ç–∏ –ø–æ—Ä—É—á –æ–±–∏–¥–≤–∞ –±–ª–æ–∫–∏ ‚Äî `start_consist` (–¥–ª—è ¬´–¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö¬ª) —ñ `end_consist` (–¥–ª—è ¬´–≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö¬ª) —É —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É, –≤–∏—Ä—ñ–≤–Ω—è–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ, —â–æ–± —Ç–∏ –ø—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–≤–∏–≤ —É `view` —ñ –Ω–µ –ª–æ–≤–∏–≤ –¥—Ä—ñ–±–Ω—ñ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω—ñ –ø–æ–º–∏–ª–∫–∏.
