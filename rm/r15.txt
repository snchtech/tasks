–û–∫–µ–π, –¥–∞–≤–∞–π –∑—Ä–æ–±–∏–º–æ —Ü–µ –∞–∫—É—Ä–∞—Ç–Ω–æ –≤ –¥–≤–∞ –∫—Ä–æ–∫–∏:

1. **–Ø–∫ –¥–æ–¥–∞—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫—É `EP_23445`, `EP_5777` —É —Ñ—É–Ω–∫—Ü—ñ—é**
2. **–Ø–∫ –∑—Ä–æ–±–∏—Ç–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Ä—ñ–∑–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä–æ–ª—ñ**

---

## 1. –ü–µ—Ä–µ–ø–∏—Å—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é –ø—ñ–¥ –±—É–¥—å-—è–∫–∏–π –ø—Ä–µ—Ñ—ñ–∫—Å (`P_‚Ä¶`, `D_‚Ä¶`, `U_‚Ä¶`, `EP_‚Ä¶`)

–ó–∞—Ä–∞–∑ —Ç–∏ ¬´–∂–æ—Ä—Å—Ç–∫–æ¬ª –¥–∏–≤–∏—à—Å—è –Ω–∞ –ø–µ—Ä—à–∏–π —Å–∏–º–≤–æ–ª (`P`, `D`, `U`) —ñ –±–µ—Ä–µ—à —á–∏—Å–ª–æ –∑ 3-–≥–æ —Å–∏–º–≤–æ–ª—É. –î–ª—è `EP_23445` —Ü–µ –Ω–µ –ø—Ä–∞—Ü—é—î, –±–æ —Ç–∞–º –ø—Ä–µ—Ñ—ñ–∫—Å –¥–æ–≤—à–∏–π.

–ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–µ —ñ –Ω–∞–π–Ω–∞–¥—ñ–π–Ω—ñ—à–µ: **–∑–∞–≤–∂–¥–∏ –±—Ä–∞—Ç–∏ –≤—Å–µ, —â–æ –ø—ñ—Å–ª—è —Å–∏–º–≤–æ–ª—É `_`**, –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –ø—Ä–µ—Ñ—ñ–∫—Å–∞. –¢–æ–¥—ñ —Ñ—É–Ω–∫—Ü—ñ—è –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —ñ –¥–ª—è:

* `P_10`
* `D_200`
* `U_12345`
* `EP_23445`
* —ñ –±—É–¥—å-—è–∫–∏—Ö —ñ–Ω—à–∏—Ö `PREFIX_123`.

–Ø –± –∑–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞–≤ —Ç–∞–∫–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç (—ñ –∑–∞–æ–¥–Ω–æ –ø—Ä–∏–±—Ä–∞–≤ –∑–∞–π–≤–∏–π `LISTAGG`):

```sql
CREATE OR REPLACE FUNCTION GET_USER_ROLE_BY_CUSTOM_IDNTIFY (
    p_app_id      IN NUMBER,
    p_user_login  IN VARCHAR2,
    p_idnt_type   IN VARCHAR2
) RETURN NUMBER
IS
    l_role_static_id     APEX_APPL_ACL_USER_ROLES.ROLE_STATIC_ID%TYPE;
    l_curr_user_role_id  NUMBER;
BEGIN
    SELECT role_static_id
      INTO l_role_static_id
      FROM apex_appl_acl_user_roles t
     WHERE t.application_id = p_app_id
       AND t.user_name      = p_user_login
       AND t.role_static_id LIKE p_idnt_type || '\_%' ESCAPE '\'
       AND ROWNUM = 1;  -- —è–∫—â–æ —Ç—Ä–µ–±–∞ –æ–¥–Ω—É —Ä–æ–ª—å –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º

    -- –±–µ—Ä–µ–º–æ –≤—Å–µ –ø—ñ—Å–ª—è —Å–∏–º–≤–æ–ª—É "_"
    l_curr_user_role_id :=
        TO_NUMBER(
            SUBSTR(
                l_role_static_id,
                INSTR(l_role_static_id, '_') + 1
            )
        );

    RETURN l_curr_user_role_id;

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN NULL;
END GET_USER_ROLE_BY_CUSTOM_IDNTIFY;
```

üëâ –©–æ —Ü–µ –¥–∞—î:

* –Ø–∫—â–æ –≤ —Ç–µ–±–µ `ROLE_STATIC_ID = 'P_10'`  ‚Üí –ø–æ–≤–µ—Ä–Ω–µ `10`.
* –Ø–∫—â–æ `ROLE_STATIC_ID = 'EP_23445'` ‚Üí –ø–æ–≤–µ—Ä–Ω–µ `23445`.
* –ù–µ —Ç—Ä–µ–±–∞ –±—ñ–ª—å—à–µ `IF SUBSTR(...)= 'P'/'D'/'U'` ‚Äî –ø—Ä–∞—Ü—é—î –¥–ª—è –±—É–¥—å-—è–∫–æ–≥–æ –ø—Ä–µ—Ñ—ñ–∫—Å–∞.
* `p_idnt_type` —Ç–∏ –∑–º–æ–∂–µ—à –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ —è–∫ `'P'`, `'D'`, `'U'`, `'EP'` —Ç–æ—â–æ (—Ü–µ —Ç–µ, —â–æ –¥–æ –ø—ñ–¥–∫—Ä–µ—Å–ª–µ–Ω–Ω—è).

–Ø–∫—â–æ —Ö–æ—á–µ—à –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ —á—ñ–ø–∞—Ç–∏ —Å–≤–æ—é –ª–æ–≥—ñ–∫—É —ñ **–¥–æ–¥–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ `EP_`**, –º–æ–∂–Ω–∞ —ñ —Ç–∞–∫:

```sql
IF SUBSTR (l_user_roles_list,1,1) = 'P' THEN
    l_curr_user_role_id := TO_NUMBER (SUBSTR(l_user_roles_list, 3));
ELSIF SUBSTR (l_user_roles_list, 1, 1) = 'D' THEN
    l_curr_user_role_id := TO_NUMBER (SUBSTR (l_user_roles_list, 3));
ELSIF SUBSTR(l_user_roles_list, 1, 1) = 'U' THEN
    l_curr_user_role_id := TO_NUMBER (SUBSTR (l_user_roles_list, 3));
ELSIF SUBSTR(l_user_roles_list, 1, 2) = 'EP' THEN
    l_curr_user_role_id := TO_NUMBER (SUBSTR (l_user_roles_list, 4));
ELSE
    NULL;
END IF;
```

–ê–ª–µ —è –≤—Å–µ –∂ —Ä–∞–¥–∏–≤ –±–∏ –ø—ñ—Ç–∏ –Ω–∞ –≤–∞—Ä—ñ–∞–Ω—Ç ¬´–ø–æ `_`¬ª, –≤—ñ–Ω —á–∏—Å—Ç—ñ—à–∏–π —ñ –º–∞—Å—à—Ç–∞–±–Ω—ñ—à–∏–π.

---

## 2. –Ø–∫ –∑—Ä–æ–±–∏—Ç–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Ä—ñ–∑–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä–æ–ª—ñ

–ú–∞—î–º–æ —ñ–Ω—à–∏–π –¥–æ–¥–∞—Ç–æ–∫ (–∑–∞–≥–∞–ª—å–Ω–∏–π, –∑ –≥–æ–ª–æ–≤–Ω–æ—é —Å—Ç–æ—Ä—ñ–Ω–∫–æ—é), —è–∫–∏–π –¥—ñ–ª–∏—Ç—å cookies –∑ –¥–æ–¥–∞—Ç–∫–æ–º `118`.
–ù–∞ —Ü—ñ–π –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ç–∏ —Ö–æ—á–µ—à:

* –í–∏–∑–Ω–∞—á–∏—Ç–∏ —Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —á–µ—Ä–µ–∑ —Ç–≤—ñ–π `GET_USER_ROLE_BY_CUSTOM_IDNTIFY`.
* –Ø–∫—â–æ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

  * `EP_23445` ‚Üí –∫–∏–¥–∞—Ç–∏ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É **3**;
  * `EP_5777` ‚Üí –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É **4**;
  * (–º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ —ñ–Ω—à—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –ø—ñ–∑–Ω—ñ—à–µ).

### –í–∞—Ä—ñ–∞–Ω—Ç: –ø—Ä–æ—Ü–µ—Å **Before Header** –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ

–£ –∑–∞–≥–∞–ª—å–Ω–æ–º—É –¥–æ–¥–∞—Ç–∫—É (–Ω–∞–∑–≤–µ–º–æ –π–æ–≥–æ APP_ID = 200, —É–º–æ–≤–Ω–æ) –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Å—Ç–æ—Ä—ñ–Ω–∫–∞ 1) —Å—Ç–≤–æ—Ä—é—î—à **process Before Header** –∑ —Ç–∞–∫–∏–º –∫–æ–¥–æ–º:

```plsql
DECLARE
    l_role_id NUMBER;
BEGIN
    -- –û—Ç—Ä–∏–º—É—î–º–æ —Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –¥–æ–¥–∞—Ç–∫–∞ 118, –ø—Ä–µ—Ñ—ñ–∫—Å EP_
    l_role_id := GET_USER_ROLE_BY_CUSTOM_IDNTIFY(
                    p_app_id     => 118,          -- –∑–≤—ñ–¥–∫–∏ –±–µ—Ä–µ–º–æ —Ä–æ–ª—ñ
                    p_user_login => :APP_USER,    -- –∞–±–æ —ñ–Ω—à–∏–π –ª–æ–≥—ñ–Ω, —è–∫—â–æ —Å–≤–æ—ó –ø—Ä–∞–≤–∏–ª–∞
                    p_idnt_type  => 'EP'          -- —à—É–∫–∞—î–º–æ ROLE_STATIC_ID, —â–æ –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –∑ EP_
                 );

    -- –¢–µ–ø–µ—Ä —Ä–æ—É—Ç–∏–º–æ –∑–∞ ID
    IF l_role_id = 23445 THEN
        -- —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É 3 –ø–æ—Ç–æ—á–Ω–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É
        apex_util.redirect_url(
            apex_page.get_url(
                p_application => :APP_ID,
                p_page        => 3
            )
        );

    ELSIF l_role_id = 5777 THEN
        -- —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É 4 –ø–æ—Ç–æ—á–Ω–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É
        apex_util.redirect_url(
            apex_page.get_url(
                p_application => :APP_ID,
                p_page        => 4
            )
        );

    ELSE
        -- –Ø–∫—â–æ —Ä–æ–ª—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞/—ñ–Ω—à—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ ‚Äî –∑–∞–ª–∏—à–∞—î–º–æ –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π
        NULL;
    END IF;
END;
```

### –Ø–∫—â–æ —Ç—Ä–µ–±–∞ –∫–∏–¥–∞—Ç–∏ –≤ —ñ–Ω—à–∏–π –¥–æ–¥–∞—Ç–æ–∫

–Ø–∫—â–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ 3 —ñ 4 ‚Äî —É **–¥–æ–¥–∞—Ç–∫—É 118**, —Ç–æ–¥—ñ –ø—Ä–æ—Å—Ç–æ –º—ñ–Ω—è—î—à `p_application`:

```plsql
IF l_role_id = 23445 THEN
    apex_util.redirect_url(
        apex_page.get_url(
            p_application => 118,
            p_page        => 3
        )
    );
ELSIF l_role_id = 5777 THEN
    apex_util.redirect_url(
        apex_page.get_url(
            p_application => 118,
            p_page        => 4
        )
    );
END IF;
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Branch –∑–∞–º—ñ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—É

–ú–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –π —á–µ—Ä–µ–∑ **Branch** (–≥—ñ–ª–∫—É) –∑ —É–º–æ–≤–æ—é —Ç–∏–ø—É:

* **Condition Type**: PL/SQL Function Body (returning Boolean)
* –í —Ç—ñ–ª—ñ:

```plsql
DECLARE
    l_role_id NUMBER;
BEGIN
    l_role_id := GET_USER_ROLE_BY_CUSTOM_IDNTIFY(118, :APP_USER, 'EP');
    RETURN l_role_id = 23445; -- –¥–ª—è –≥—ñ–ª–∫–∏ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É 3
END;
```

–ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ —â–µ –æ–¥–Ω—É –≥—ñ–ª–∫—É –¥–ª—è `5777`. –ê–ª–µ –∑ –ø—Ä–æ—Ü–µ—Å–æ–º `Before Header` —É—Å–µ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ—à–µ –π –ø—Ä–æ–∑–æ—Ä—ñ—à–µ.

---

–Ø–∫—â–æ —Ö–æ—á–µ—à, —É –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –∫—Ä–æ—Ü—ñ –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏:

* —Ä–æ–∑–≤–µ—Å—Ç–∏ –ª–æ–≥—ñ–∫—É, —è–∫—â–æ –≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ **–º–æ–∂–µ –±—É—Ç–∏ –¥–µ–∫—ñ–ª—å–∫–∞ —Ä–æ–ª–µ–π**,
* –∞–±–æ –∑—Ä–æ–±–∏—Ç–∏ ¬´–ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç —Ä–æ–ª–µ–π¬ª (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, EP_‚Ä¶ –≤–∞–∂–ª–∏–≤—ñ—à–µ –∑–∞ P_‚Ä¶, —Ç–æ—â–æ).
