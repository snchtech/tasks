–°—É–ø–µ—Ä, —Ç–æ–¥—ñ –¥–æ—Ä–æ–±–ª—é `end_consist` –∑–∞ —Ç—ñ—î—é –∂ –ª–æ–≥—ñ–∫–æ—é, —â–æ –π `start_consist`, –∞–ª–µ –¥–ª—è **–∑–∞–∫—Ä–∏—Ç—Ç—è** üëá

–¢—Ä–µ–±–∞ –ø–æ–∑–Ω–∞—á–∞—Ç–∏ `endshift` –¥–ª—è –Ω–∞—Ä—è–¥—ñ–≤, —è–∫—ñ:

1. **–ü–æ–ø–∞–¥–∞—é—Ç—å –ø–æ –ø–ª–∞–Ω–æ–≤–æ–º—É —á–∞—Å—É –∑–∞–∫—Ä–∏—Ç—Ç—è –≤ –ø–æ—Ç–æ—á–Ω—É –∑–º—ñ–Ω—É**
   **—ñ —â–µ –Ω–µ –∑–∞–∫—Ä–∏—Ç—ñ** (`ORDER_STATUS_ID <> 0`),

**–ê–ë–û**

2. **–ú–∞–ª–∏ –±—É—Ç–∏ –∑–∞–∫—Ä–∏—Ç—ñ —Ä–∞–Ω—ñ—à–µ (ORDEREND < —Å—å–æ–≥–æ–¥–Ω—ñ)**
   **—ñ –≤—Å–µ —â–µ –Ω–µ –∑–∞–∫—Ä–∏—Ç—ñ** (`ORDER_STATUS_ID <> 0`).

---

### –ù–æ–≤–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç `end_consist`

–ü—ñ–¥—Å—Ç–∞–≤ –∑–∞–º—ñ—Å—Ç—å —Ç–≤–æ–≥–æ –±–ª–æ–∫—É `CASE ... AS end_consist` —Ç–∞–∫–∏–π:

```sql
CASE
    WHEN tw.ORDER_STATUS_ID <> 0 -- –Ω–µ –∑–∞–∫—Ä–∏—Ç—ñ
         AND (
               -- 1) –ø–ª–∞–Ω–æ–≤–µ –∑–∞–∫—Ä–∏—Ç—Ç—è —Å—å–æ–≥–æ–¥–Ω—ñ —ñ –ø–æ–ø–∞–¥–∞—î –≤ –ø–æ—Ç–æ—á–Ω—É –∑–º—ñ–Ω—É
               (
                   TRUNC(tw.ORDEREND) = TRUNC(SYSDATE)
                   AND (
                       (  TO_NUMBER(TO_CHAR(SYSDATE,'HH24')) BETWEEN 7 AND 14
                          AND TO_CHAR(tw.ORDEREND,'HH24:MI') BETWEEN '07:00' AND '14:59'
                       )
                       OR
                       (  TO_NUMBER(TO_CHAR(SYSDATE,'HH24')) BETWEEN 15 AND 22
                          AND TO_CHAR(tw.ORDEREND,'HH24:MI') BETWEEN '15:00' AND '22:59'
                       )
                       OR
                       ( (TO_NUMBER(TO_CHAR(SYSDATE,'HH24')) BETWEEN 23 AND 23
                           OR TO_NUMBER(TO_CHAR(SYSDATE,'HH24')) BETWEEN 0 AND 6
                          )
                          AND ( TO_CHAR(tw.ORDEREND,'HH24:MI') BETWEEN '23:00' AND '23:59'
                                OR TO_CHAR(tw.ORDEREND,'HH24:MI') BETWEEN '00:00' AND '06:59'
                              )
                       )
                   )
               )
               -- 2) –∞–±–æ –ø–ª–∞–Ω–æ–≤–∏–π —á–∞—Å –∑–∞–∫—Ä–∏—Ç—Ç—è –≤–∂–µ –≤ –º–∏–Ω—É–ª–æ–º—É –¥–Ω—ñ
               OR TRUNC(tw.ORDEREND) < TRUNC(SYSDATE)
         )
    THEN 'endshift'
    ELSE NULL
END AS end_consist,
```

üîç –õ–æ–≥—ñ–∫–∞ –∫–æ—Ä–æ—Ç–∫–æ:

* `ORDER_STATUS_ID <> 0` ‚Üí –±–µ—Ä–µ–º–æ –ª–∏—à–µ **–Ω–µ –∑–∞–∫—Ä–∏—Ç—ñ** (–Ω–µ–≤–∞–∂–ª–∏–≤–æ, –≤–æ–Ω–∏ —â–µ "–¥–æ–∑–≤–æ–ª–µ–Ω—ñ" —á–∏ –≤–∂–µ "–≤—ñ–¥–∫—Ä–∏—Ç—ñ").
* –Ø–∫—â–æ **—Å—å–æ–≥–æ–¥–Ω—ñ** —ñ —á–∞—Å –∑–∞–∫—Ä–∏—Ç—Ç—è –ø–æ–ø–∞–¥–∞—î —É –≤—ñ–∫–Ω–æ –ø–æ—Ç–æ—á–Ω–æ—ó –∑–º—ñ–Ω–∏ ‚Üí –≤–∏–¥—ñ–ª—è—î–º–æ –¥–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è –Ω–∞ —Ü—ñ–π –∑–º—ñ–Ω—ñ.
* –Ø–∫—â–æ –Ω–∞—Ä—è–¥ –º–∞–≤ –∑–∞–∫—Ä–∏—Ç–∏—Å—è **—Ä–∞–Ω—ñ—à–µ, –Ω—ñ–∂ —Å—å–æ–≥–æ–¥–Ω—ñ** ‚Üí —Ç–µ–∂ –ø—ñ–¥—Å–≤—ñ—á—É—î–º–æ –¥–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è (–±–æ "–∑–∞–≤–∏—Å").

–Ø–∫—â–æ —Ç—Ä–µ–±–∞, –º–æ–∂–µ–º–æ –¥–∞–ª—ñ –≤–∏–Ω–µ—Å—Ç–∏ –ª–æ–≥—ñ–∫—É –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ—ó –∑–º—ñ–Ω–∏ –≤ –æ–∫—Ä–µ–º—É —Ñ—É–Ω–∫—Ü—ñ—é (—â–æ–± –Ω–µ –¥—É–±–ª—é–≤–∞—Ç–∏ —Ç—Ä–∏ –∑–¥–æ—Ä–æ–≤–µ–Ω–Ω—ñ `OR`-–±–ª–æ–∫–∏ —É `start_consist` / `end_consist`).
