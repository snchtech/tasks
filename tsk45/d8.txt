–¢–∞–∫, —Ç–∏ –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–π ‚Äì `apex_util.current_user_in_role` **–Ω–µ–º–∞—î**. –¶–µ —è –ø–µ—Ä–µ–ø–ª—É—Ç–∞–≤ –∑ —ñ–Ω—à–∏–º–∏ —É—Ç–∏–ª—ñ—Ç–∞–º–∏ APEX üôà

–î–∞–≤–∞–π –≤–∏–ø—Ä–∞–≤–∏–º–æ.

---

## 1. –ü—Ä–∞–≤–∏–ª—å–Ω–∞ `has_role` —á–µ—Ä–µ–∑ `APEX_APPL_ACL_USER_ROLES`

–Ø–∫—â–æ —Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π **Access Control** –≤ APEX (–∞ –≤ —Ç–µ–±–µ —è–∫—Ä–∞–∑ —î —Ç–∞–±–ª–∏—Ü—è `APEX_APPL_ACL_USER_ROLES`), —Ç–æ —Ñ—É–Ω–∫—Ü—ñ—é `has_role` –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ —Ç–∞–∫:

```sql
FUNCTION has_role(p_role_static_id IN VARCHAR2) RETURN BOOLEAN IS
    l_dummy NUMBER;
BEGIN
    SELECT 1
      INTO l_dummy
      FROM apex_appl_acl_user_roles r
     WHERE r.application_id = TO_NUMBER(v('APP_ID'))
       AND r.user_name      = v('APP_USER')
       AND r.role_static_id = p_role_static_id;

    RETURN TRUE;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN FALSE;
    WHEN OTHERS THEN
        RETURN FALSE;
END has_role;
```

–¢—É—Ç:

* `v('APP_ID')` ‚Äì –ø–æ—Ç–æ—á–Ω–∏–π –∞–ø–ª—ñ–∫–µ–π—à–Ω,
* `v('APP_USER')` ‚Äì –ø–æ—Ç–æ—á–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á,
* `p_role_static_id` ‚Äì `'EDITOR'`, `'CHIEF_EDITOR'` —Ç–æ—â–æ.

–Ø–∫—â–æ —Ö–æ—á–µ—à –ø—Ä–∏–≤‚Äô—è–∑—É–≤–∞—Ç–∏ —Ä–æ–ª—ñ –Ω–µ –¥–æ `APP_USER`, –∞ –¥–æ —Å–≤–æ–≥–æ `P0_CUR_USER_ID` (id –∑ —Ç–∞–±–ª–∏—Ü—ñ USERS), —Ç–æ–¥—ñ —Ç—Ä–µ–±–∞ —Ä–æ–±–∏—Ç–∏ join –∑ —Ç–≤–æ—î—é USERS-—Ç–∞–±–ª–∏—Ü–µ—é —ñ —Ç–∞–º –≤–∂–µ —Å–ø—ñ–≤—Å—Ç–∞–≤–ª—è—Ç–∏ –ª–æ–≥—ñ–Ω.

---

## 2. –í–∞—Ä—ñ–∞–Ω—Ç: –æ–±–≥–æ—Ä–Ω—É—Ç–∏ —Ç–≤–æ—é —ñ—Å–Ω—É—é—á—É —Ñ—É–Ω–∫—Ü—ñ—é `GET_USER_ROLE_BY_CUSTOM_IDNTIFY`

–¢–∏ –≤–∂–µ –º–∞—î—à —Å–≤–æ—é —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è —Ä–æ–ª–µ–π. –¢–æ–¥—ñ `has_role` –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ —è–∫ **—Ç–æ–Ω–∫–∏–π wrapper**:

```sql
FUNCTION has_role(p_role_static_id IN VARCHAR2) RETURN BOOLEAN IS
    l_role_id NUMBER;
BEGIN
    l_role_id := GET_USER_ROLE_BY_CUSTOM_IDNTIFY(
                   LC_APP_ID    => TO_NUMBER(v('APP_ID')),
                   LC_USER_LOGIN=> v('APP_USER'),
                   LC_IDNT_TYPE => p_role_static_id
                 );

    RETURN l_role_id IS NOT NULL; -- –∞–±–æ > 0, –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–æ–≥–æ, —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î —Ç–≤–æ—è —Ñ—É–Ω–∫—Ü—ñ—è
EXCEPTION
    WHEN OTHERS THEN
        RETURN FALSE;
END has_role;
```

–Ø–∫—â–æ —Ç–≤–æ—è `GET_USER_ROLE_BY_CUSTOM_IDNTIFY` –ø—Ä–∏–π–º–∞—î —à–∞–±–ª–æ–Ω —Ç–∏–ø—É `'EDITOR%'`, —Ç–æ –¥–ª—è `has_role('EDITOR')` —Ç–∏ –º–æ–∂–µ—à –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –¥–æ–¥–∞—Ç–∏ `|| '%'`, –∞–±–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞ —Ä—ñ–≤–Ω—ñ –≤–∏–∫–ª–∏–∫—É:

```sql
l_is_editor       := has_role('EDITOR%');
l_is_chief_editor := has_role('CHIEF_EDITOR%');
```

---

## 3. –í–ø–∏—Å—É—î–º–æ —Ü–µ –≤ –Ω–∞—à –ø–∞–∫–µ—Ç

–¢–µ–ø–µ—Ä —É `auth_task_pkg` –ø—Ä–æ—Å—Ç–æ –∑–∞–º—ñ–Ω—é—î—à —Å—Ç–∞—Ä—É –≤–µ—Ä—Å—ñ—é `has_role` –Ω–∞ –æ–¥–Ω—É –∑ —Ü–∏—Ö (—è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –≤–∞—Ä—ñ–∞–Ω—Ç —á–µ—Ä–µ–∑ `APEX_APPL_ACL_USER_ROLES`, —è–∫—â–æ –≤—ñ–Ω —É —Ç–µ–±–µ —ñ —Ç–∞–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è):

```sql
FUNCTION has_role(p_role_static_id IN VARCHAR2) RETURN BOOLEAN IS
    l_dummy NUMBER;
BEGIN
    SELECT 1
      INTO l_dummy
      FROM apex_appl_acl_user_roles r
     WHERE r.application_id = TO_NUMBER(v('APP_ID'))
       AND r.user_name      = v('APP_USER')
       AND r.role_static_id = p_role_static_id;

    RETURN TRUE;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN FALSE;
    WHEN OTHERS THEN
        RETURN FALSE;
END has_role;
```

–Ü –≤—Å—è —ñ–Ω—à–∞ –ª–æ–≥—ñ–∫–∞ –≤ `can_edit_task`, `can_edit_template`, `can_create_task` –ª–∏—à–∞—î—Ç—å—Å—è —Ç–∞–∫–æ—é, —è–∫ –º–∏ –æ–ø–∏—Å–∞–ª–∏ —Ä–∞–Ω—ñ—à–µ.

---

–Ø–∫—â–æ –¥–∞—Å–∏ –ø—Ä–∏–∫–ª–∞–¥ —Ç—ñ–ª–∞ —Ç–≤–æ—î—ó `GET_USER_ROLE_BY_CUSTOM_IDNTIFY`, –º–æ–∂—É –ø—Ä—è–º–æ –ø—ñ–¥ –Ω–µ—ó –ø—ñ–¥–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç `has_role`, —â–æ–± —Ç–∏ –º–∞–π–∂–µ –Ω—ñ—á–æ–≥–æ –≤ —Å—Ç–∞—Ä–æ–º—É –∫–æ–¥—ñ –Ω–µ —á—ñ–ø–∞–≤.
