–û–∫–µ–π, —è —Ä–æ–∑—É–º—ñ—é —Å–∏—Ç—É–∞—Ü—ñ—é üëç
–¢–æ–±—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ:

1. **–ó–±–µ—Ä–µ–≥—Ç–∏ —Ä–µ–∞–ª—å–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤** (1,2,3,‚Ä¶ –±–µ–∑ ¬´–¥—ñ—Ä¬ª),
2. **–ù–µ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** –ø—Ä–æ –∑–º—ñ–Ω—É –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏,
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–±—É–¥–æ–≤—É–≤–∞—Ç–∏ –ø–æ—Ä—è–¥–æ–∫** –ø—Ä–∏:

   * –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—ñ (sortable),
   * –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –Ω–æ–≤–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞,
   * –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∞.

–ù–∏–∂—á–µ –¥–∞–º –≤–∞—Ä—ñ–∞–Ω—Ç, —è–∫–∏–π —Ü–µ –≤—Å–µ –∑–∞–∫—Ä–∏–≤–∞—î + —Ç—Ä–æ—Ö–∏ –ø—ñ–¥—á–∏—â—É –∫–æ–¥.

---

## 1. –Ü–¥–µ—è —Ä—ñ—à–µ–Ω–Ω—è

### –†–æ–∑–¥—ñ–ª—è—î–º–æ –ª–æ–≥—ñ–∫—É –Ω–∞ –¥–≤–∞ —Ä—ñ–≤–Ω—ñ:

1. **–í—ñ–∑—É–∞–ª—å–Ω–∞ –Ω—É–º–µ—Ä–∞—Ü—ñ—è (—Ç—ñ–ª—å–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥)**

   * `renumberListItems()` ‚Äî –æ–Ω–æ–≤–ª—é—î `data-cl-order` —ñ —Ü–∏—Ñ—Ä–∏ –≤ —Å–ø–∏—Å–∫—É (1., 2., 3., ‚Ä¶).
   * –á—ó –º–æ–∂–Ω–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —ñ –Ω–∞ `page load`, —ñ –ø—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è/–≤–∏–¥–∞–ª–µ–Ω–Ω—è/–ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è.

2. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—Ä—è–¥–∫—É –≤ APEX (–∫–æ–ª–µ–∫—Ü—ñ—è / —Ç–∞–±–ª–∏—Ü—è)**

   * `rebuildConfirmListInColl($ul, isInitial)` ‚Äî –∑–±–∏—Ä–∞—î —Å–ø–∏—Å–æ–∫ –ø–æ—Ä—è–¥–∫—É –π –≤–∏–∫–ª–∏–∫–∞—î `fn_get_ordernumb(isInitial)`.
   * –Ø–∫—â–æ `isInitial = true` ‚Üí **–Ω–µ –ø–æ–∫–∞–∑—É—î–º–æ** `#notSaveMessage`.
   * –Ø–∫—â–æ `isInitial = false` ‚Üí —Ü–µ –≤–∂–µ –¥—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ‚Üí **–ø–æ–∫–∞–∑—É—î–º–æ** –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

---

## 2. –í–∏–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ç–∞ –¥–æ–ø–æ–≤–Ω–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è JS

> ‚ö†Ô∏è –Ø –±—É–¥—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `$` —è–∫ jQuery.
> –Ø–∫—â–æ —Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à `apex.jQuery` –ø—ñ–¥ –ø—Å–µ–≤–¥–æ–Ω—ñ–º–æ–º `S`, –∑–∞–º—ñ–Ω–∏ `$` –Ω–∞ `S`.

```js
// --- 1. –ü–µ—Ä–µ–Ω—É–º–µ—Ä–∞—Ü—ñ—è li –≤ –∫–æ–∂–Ω–æ–º—É —Å–ø–∏—Å–∫—É ---
function renumberListItems() {
  $(".confirm-list_items").each(function () {
    var i = 1;
    $(this).find("li").each(function () {
      $(this).attr("data-cl-order", i);
      $(this).find(".number").text(i + '.');
      i++;
    });
  });
}

// --- 2. –í–∏–∫–ª–∏–∫ APEX-–ø—Ä–æ—Ü–µ—Å—É, —è–∫–∏–π –æ–Ω–æ–≤–ª—é—î –ø–æ—Ä—è–¥–æ–∫ —É –∫–æ–ª–µ–∫—Ü—ñ—ó/—Ç–∞–±–ª–∏—Ü—ñ ---
function fn_get_ordernumb(isInitial) {
  apex.server.process(
    "REORDER_NUMBER_LIST",
    {
      x01: $v('P4_ORDER_LIST'),
      x02: isInitial ? 'Y' : 'N', // –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –ø—Ä–∞–ø–æ—Ä–µ—Ü—å –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ (—è–∫—â–æ —Ç—Ä–µ–±–∞)
      pageItems: "#P4_ORDER_LIST,#P4_LIST_COLL_NAME"
    },
    {
      dataType: "json",
      success: function (pResponse) {
        if (pResponse.status === 'ok') {
          // –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–æ–∫–∞–∑—É—î–º–æ –ª–∏—à–µ, —è–∫—â–æ —Ü–µ –Ω–µ –ø–æ—á–∞—Ç–∫–æ–≤–µ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è
          if (!isInitial) {
            $('#notSaveMessage').show();
          }
          apex.item('P4_CHECKBOX_SHOW').setValue(pResponse.showstatus);
        }
      }
    }
  );
}

// --- 3. –ü–µ—Ä–µ–±—É–¥–æ–≤–∞ —Å–ø–∏—Å–∫—É —É –∫–æ–ª–µ–∫—Ü—ñ—ó (–Ω–∞ –æ—Å–Ω–æ–≤—ñ li) ---
function rebuildConfirmListInColl($ul, isInitial) {
  var elCollection = $ul.attr('data-col-name');

  var l_order = $ul
    .find("li")
    .sort(function (a, b) {
      // —è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à data-sq-ord –¥–ª—è —Ñ—ñ–∫—Å–∞—Ü—ñ—ó –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ –ø–æ—Ä—è–¥–∫—É
      return $(a).attr('data-sq-ord') - $(b).attr('data-sq-ord');
    })
    .map(function () {
      return $(this).attr('data-cl-order');
    })
    .get()
    .join(',');

  apex.item("P4_ORDER_LIST").setValue(l_order);
  apex.item("P4_LIST_COLL_NAME").setValue(elCollection);

  fn_get_ordernumb(isInitial);
}

// --- 4. sortable: –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —Å–ø–∏—Å–∫—É ---
$('.confirm-list_items').sortable({
  items: "li:not(.confirm-list-li_not-active)",
  update: function (event, ui) {
    // —Ç—É—Ç –º–æ–∂–Ω–∞ –Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏—Ç–∏
  },
  stop: function (event, ui) {
    // –ó–º—ñ–Ω–∞ –ø–æ—Ä—è–¥–∫–æ–≤–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤
    renumberListItems();

    // –ü–µ—Ä–µ–±—É–¥–æ–≤–∞ —Å–ø–∏—Å–∫—É –¥–∞–Ω–∏—Ö –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó (—Ü–µ –≤–∂–µ –¥—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞)
    var $el = $(this);
    rebuildConfirmListInColl($el, false);
  }
});
```

---

## 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ / –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∞

### üîπ –ü—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ `li`

–ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, –≤ —Ç–µ–±–µ —î –∫–æ–¥, —è–∫–∏–π –¥–æ–¥–∞—î –Ω–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç —É `ul.confirm-list_items`. –ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ —Ç–∏ –≤—Å—Ç–∞–≤–∏–≤ `li` —É DOM:

```js
function addNewExecutor($ul, newLiHtml) {
  $ul.append(newLiHtml);

  // –û–Ω–æ–≤–∏—Ç–∏ –Ω—É–º–µ—Ä–∞—Ü—ñ—é
  renumberListItems();

  // –û–Ω–æ–≤–∏—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ
  rebuildConfirmListInColl($ul, false);
}
```

### üîπ –ü—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è `li`

```js
function removeExecutor($li) {
  var $ul = $li.closest(".confirm-list_items");
  $li.remove();

  renumberListItems();
  rebuildConfirmListInColl($ul, false);
}
```

---

## 4. –ü–æ—á–∞—Ç–∫–æ–≤–µ ¬´—Ç–∏—Ö–µ¬ª –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏

–©–æ–± –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏:

* –Ω—É–º–µ—Ä–∞—Ü—ñ—è **–∑–∞–≤–∂–¥–∏ –ø–æ—á–∏–Ω–∞–ª–∞—Å—å —ñ–∑ 1**,
* –ø–æ—Ä—è–¥–æ–∫ —É –∫–æ–ª–µ–∫—Ü—ñ—ó/—Ç–∞–±–ª–∏—Ü—ñ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞–≤—Å—è,
* **–∞–ª–µ –±–µ–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** –ø—Ä–æ –∑–º—ñ–Ω–∏ ‚Äî –≤–∏–∫–ª–∏–∫–∞—î–º–æ –≤—Å–µ –æ–¥–∏–Ω —Ä–∞–∑ —ñ–∑ –ø—Ä–∞–ø–æ—Ä—Ü–µ–º `isInitial = true`.

–£ **Function and Global Variable Declaration** –∞–±–æ –≤ **Dynamic Action ‚Üí Page Load ‚Üí Execute JavaScript**:

```js
$(function () {
  // 1. –ü–µ—Ä–µ–Ω—É–º–µ—Ä—É–≤–∞—Ç–∏ –¥–ª—è –∫—Ä–∞—Å–∏
  renumberListItems();

  // 2. –û–Ω–æ–≤–∏—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—é/—Ç–∞–±–ª–∏—Ü—é "—Ç–∏—Ö–æ"
  $(".confirm-list_items").each(function () {
    var $ul = $(this);
    rebuildConfirmListInColl($ul, true); // isInitial = true ‚Üí –±–µ–∑ notSaveMessage
  });
});
```

–Ø–∫—â–æ –Ω–µ —Ö–æ—á–µ—à –ª—ñ–∑—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ ‚Äî –º–æ–∂–µ—à –æ–±–º–µ–∂–∏—Ç–∏—Å—å —Ç—ñ–ª—å–∫–∏ `renumberListItems();`
–¢–æ–¥—ñ –ø–æ—Ä—è–¥–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü—ñ –∑–∞–ª–∏—à–∏—Ç—å—Å—è ¬´–¥—ñ—Ä—è–≤–∏–π¬ª, –∞–ª–µ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –≤—ñ–Ω —É–∂–µ –±—É–¥–µ –≤—ñ–¥ 1.

---

## 5. –©–æ —â–µ —è –ø–æ–ø—Ä–∞–≤–∏–≤ —É —Ç–≤–æ—î–º—É –∫–æ–¥—ñ

* `closest('u1')` ‚Üí –º–∞—î –±—É—Ç–∏ `closest('ul')` (–±—É–ª–∞ –¥—Ä—É–∫–∞—Ä—Å—å–∫–∞ –ø–æ–º–∏–ª–∫–∞).
* `apex.items.P4_ORDER_LIST.setValue(...)` ‚Üí –∫–æ—Ä–µ–∫—Ç–Ω—ñ—à–µ `apex.item("P4_ORDER_LIST").setValue(...)`.
* –§—É–Ω–∫—Ü—ñ—è `rebuildConfirmlistInColl` ‚Üí –ø—Ä–∏–≤–µ–¥–µ–Ω–∞ –¥–æ —î–¥–∏–Ω–æ–≥–æ —ñ–º–µ–Ω—ñ `rebuildConfirmListInColl`.
* –î–æ–¥–∞–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä `isInitial` –¥–ª—è **–∫–æ–Ω—Ç—Ä–æ–ª—é –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ.

---

–Ø–∫—â–æ —Å–∫–∏–Ω–µ—à —à–º–∞—Ç–æ–∫ HTML (—Å—Ç—Ä—É–∫—Ç—É—Ä—É UL/LI –∑ –∫–ª–∞—Å–∞–º–∏ —Ç–∞ data-*), —è –º–æ–∂—É —â–µ –±—ñ–ª—å—à —Ç–æ—á–Ω–æ –ø—ñ–¥ —Ü–µ –ø—ñ–¥–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∫–æ–¥, –∞–ª–µ –Ω–∞–≤—ñ—Ç—å —É —Ü—å–æ–º—É –≤–∏–≥–ª—è–¥—ñ –≤—ñ–Ω –º–∞—î –≤–∏—Ä—ñ—à–∏—Ç–∏ —Ç–≤–æ—é –ø—Ä–æ–±–ª–µ–º—É:

* **–ø–æ—Ä—è–¥–æ–∫ –∑–∞–≤–∂–¥–∏ –∑ 1**,
* **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ drag/add/delete**,
* **–Ω—ñ—è–∫–∏—Ö –¥—É—Ä–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏** üòé
