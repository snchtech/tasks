–¢–∞–∫ ‚úÖ ‚Äî —Ç–≤—ñ–π —É–∑–∞–≥–∞–ª—å–Ω—é—é—á–∏–π –∑–≤—ñ—Ç –±—É–¥–µ **–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∫–æ—Ä–µ–∫—Ç–Ω–æ** –∑ –Ω–æ–≤–æ—é –ª–æ–≥—ñ–∫–æ—é, **–Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤ —Ä—ñ–∑–Ω–∏—Ö —Ü–µ—Ö–∞—Ö (department)** —Ç–∞ **–≤—ñ–¥ —Ä—ñ–∑–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** –±—É–¥–µ –∫—ñ–ª—å–∫–∞ –∑–∞–ø–∏—Å—ñ–≤ –¥–ª—è –æ–¥–Ω—ñ—î—ó –ø–∞—Ä–∏ `company_id + unit_id`.

–ü–æ—è—Å–Ω—é—é –¥–µ—Ç–∞–ª—å–Ω–æ, —á–æ–º—É —Å–∞–º–µ –≤—Å–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ —è–∫ —Ç—Ä–µ–±–∞ üëá

---

### üîπ 1. –õ–æ–≥—ñ–∫–∞ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –≤ –∑–∞–ø–∏—Ç—ñ

–£ —Ç–µ–±–µ –≤ –∫–æ–∂–Ω—ñ–π –∑ —Ç—Ä—å–æ—Ö –æ—Å–Ω–æ–≤–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π (`base`, `totals`, `headers`) —Å—Ç–æ—ó—Ç—å –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è:

```sql
GROUP BY ct.id, c.name, c.id
```

–∞ –≤ —á–∞—Å—Ç–∏–Ω—ñ –ø—ñ–¥—Å—É–º–∫—É ‚Äî `SUM(ep.people_count)`.

‚û°Ô∏è –¶–µ –æ–∑–Ω–∞—á–∞—î:

* —è–∫—â–æ —Ä—ñ–∑–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –≤–Ω–µ—Å–ª–∏ **–∫—ñ–ª—å–∫–∞ —Ä—è–¥–∫—ñ–≤ –¥–ª—è –æ–¥–Ω—ñ—î—ó –ø–∞—Ä–∏ (company_id, unit_id)**,
  —Ç–æ —É –ø—ñ–¥—Å—É–º–∫–æ–≤–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –≤–æ–Ω–∏ **–∞–≥—Ä–µ–≥—É—é—Ç—å—Å—è** –∑–∞ `company_id` (—Ç–æ–±—Ç–æ `SUM` —Å–∫–ª–∞–¥–µ –≤—Å—ñ `people_count`);
* —É –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö (`headers`) —Ç–∏ –º–∞—î—à –æ–∫—Ä–µ–º–∏–π —à–∞—Ä, —è–∫–∏–π –≤–∏–∑–Ω–∞—á–∞—î –≥—Ä—É–ø—É —Ç–∏–ø—É –∫–æ–º–ø–∞–Ω—ñ—ó (`company_type_id`);
* —É –Ω–∏–∂–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ (`totals`) —â–µ —Ä–∞–∑ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –ø–æ `company_type_id`, —è–∫–µ —Å—É–º—É—î –≤—Å—ñ `company_id` –≤ –º–µ–∂–∞—Ö —Ç–∏–ø—É.

---

### üîπ 2. –£–º–æ–≤–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –ø–æ department / unit

–¢–≤–æ—ó —É–º–æ–≤–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –Ω–∞–ø–∏—Å–∞–Ω—ñ –¥—É–∂–µ –≥–Ω—É—á–∫–æ:

```sql
AND (
  :P10_CUR_USER_DEPARTMENT IS NOT NULL AND ep.department_id = :P10_CUR_USER_DEPARTMENT
  OR (:P10_CUR_USER_DEPARTMENT IS NULL AND ep.department_id IN (
    SELECT column_value FROM TABLE(ASICS.ARM_PKG.split_string(:P10_CHECKBOX_DEPARTMENT, ';'))
  ))
)
```

—Ç–∞ –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–æ –¥–ª—è unit:

```sql
AND (
  :P10_CUR_USER_UNIT IS NOT NULL AND ep.unit_id = :P10_CUR_USER_UNIT
  OR (:P10_CUR_USER_UNIT IS NULL AND ep.unit_id IN (
    SELECT column_value FROM TABLE(ASICS.ARM_PKG.split_string(:P10_CHECKBOX_UNIT, ';'))
  ))
)
```

‚û°Ô∏è –¶–µ –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ:

* —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–±—Ä–∞–≤ **—á–µ–∫–±–æ–∫—Å–∏** ‚Äî –¥–∞–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä—É—é—Ç—å—Å—è –ø–æ –æ–±—Ä–∞–Ω–∏—Ö –≤—ñ–¥–¥—ñ–ª–∞—Ö / —é–Ω—ñ—Ç–∞—Ö;
* —è–∫—â–æ –≤–∏–±—Ä–∞–≤ –ª–∏—à–µ **—Å–≤—ñ–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç / unit** ‚Äî –∑–≤—ñ—Ç –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î —Ç—ñ–ª—å–∫–∏ –π–æ–≥–æ;
* —è–∫—â–æ –æ–±–∏–¥–≤–∞ –ø–æ—Ä–æ–∂–Ω—ñ ‚Äî –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è –≤—Å—ñ.

–¶–µ —ñ–¥–µ–∞–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –±–∞–≥–∞—Ç–æ–∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏—Ö –∑–≤—ñ—Ç—ñ–≤ —É APEX.

---

### üîπ 3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª—ñ–∫–∞—Ç–∏

–ß–µ—Ä–µ–∑ —Ç–µ, —â–æ –≤ –∞–≥—Ä–µ–≥—É—é—á–∏—Ö —á–∞—Å—Ç–∏–Ω–∞—Ö (`totals`) –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ `SUM(ep.people_count)` —ñ `GROUP BY c.id`, –¥—É–±–ª—é–≤–∞–Ω–Ω—è —Ä—è–¥–∫—ñ–≤ **–Ω–µ –≤–∏–Ω–∏–∫–∞—î**, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –¥–≤–æ—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤–Ω–µ—Å–ª–∏ –¥–∞–Ω—ñ –¥–ª—è –æ–¥–Ω—ñ—î—ó –∫–æ–º–ø–∞–Ω—ñ—ó:

```sql
Company A ‚Äî User 1 ‚Üí 5 –ª—é–¥–µ–π  
Company A ‚Äî User 2 ‚Üí 7 –ª—é–¥–µ–π  
‚Üí –í —Å—É–º—ñ 12 –ª—é–¥–µ–π
```

---

### üîπ 4. –í–∏—Ö—ñ–¥–Ω–∏–π –≤–∏–≥–ª—è–¥ –∑–≤—ñ—Ç—É

–û—Ç–∂–µ, —É –∑–≤—ñ—Ç—ñ –≤–∏–π–¥–µ —Ç–∞–∫:

```
–¢–∏–ø –∫–æ–º–ø–∞–Ω—ñ—ó: –ë—É–¥—ñ–≤–µ–ª—å–Ω—ñ
------------------------------------------------------
Company A  | Unit 1 | 12  |  (5 + 7 –æ–±‚Äô—î–¥–Ω–∞–Ω–æ)
Company B  | Unit 2 | 8
–í—Å—å–æ–≥–æ –ø–æ —Ç–∏–ø—É: 20
```

---

### üîπ 5. –©–æ –≤–∞—Ä—Ç–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏

–Ñ–¥–∏–Ω–µ, —â–æ –≤–∞—Ä—Ç–æ –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è:

* —É `external_personal` –Ω–µ–º–∞—î –ø–æ–º–∏–ª–∫–æ–≤–∏—Ö –¥—É–±–ª—å–æ–≤–∞–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ **–∑ –æ–¥–Ω–∞–∫–æ–≤–∏–º–∏** `(user_id, company_id, unit_id, date_create)`
  ‚Üí –±–æ —Ç–æ–¥—ñ —Å—É–º–∞ –∑–±—ñ–ª—å—à–∏—Ç—å—Å—è —à—Ç—É—á–Ω–æ;
* —ñ–Ω–¥–µ–∫—Å —Ç–µ–ø–µ—Ä –º–∞—î –±—É—Ç–∏ —Å–∞–º–µ –Ω–∞ `user_id, company_id, unit_id` (—Ç–∏ —Ü–µ –≤–∂–µ –∑–º—ñ–Ω–∏–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ);
* `GROUP BY` –Ω–µ –≤–∫–ª—é—á–∞—î `user_id`, –±–æ —Ç–æ–¥—ñ –ø—ñ–¥—Å—É–º–∫–∏ –± —Ä–æ–∑–±–∏–ª–∏—Å—è –ø–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞—Ö (–∞ —Ç–∏ —Ü—å–æ–≥–æ –Ω–µ —Ö–æ—á–µ—à).

---

‚úÖ **–ü—ñ–¥—Å—É–º–æ–∫:**

* –¢–∞–∫, –∑–≤—ñ—Ç –∞–≥—Ä–µ–≥—É—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ –Ω–æ–≤—ñ–π –ª–æ–≥—ñ—Ü—ñ.
* –ö—ñ–ª—å–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ –æ–¥–Ω–æ–≥–æ —Ü–µ—Ö—É —Ç–µ–ø–µ—Ä –º–æ–∂—É—Ç—å –≤–Ω–æ—Å–∏—Ç–∏ –∑–∞–ø–∏—Å–∏ ‚Äî —ñ –≤—Å—ñ –ø—ñ–¥—Å—É–º–∫–∏ –±—É–¥—É—Ç—å —Ç–æ—á–Ω—ñ.
* `SUM` –∫–æ—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∞—Ü—é—î —ñ –∑ —á–µ–∫–±–æ–∫—Å–∞–º–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó, —ñ –∑ –º—É–ª—å—Ç–∏–∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–º –≤–≤–æ–¥–æ–º.

---

–•–æ—á–µ—à, —è –ø–æ–∫–∞–∂—É —Ç–æ–±—ñ –∫–æ—Ä–æ—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É `HAVING`-—É–º–æ–≤–∏, —â–æ–± –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –Ω–µ –≤—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è –ø—É—Å—Ç—ñ –∞–±–æ –Ω—É–ª—å–æ–≤—ñ `people_count`? (—Ü–µ –¥–æ–ø–æ–º–∞–≥–∞—î —É–Ω–∏–∫–∞—Ç–∏ —Ä—è–¥–∫—ñ–≤ —ñ–∑ `NULL`-–∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ –≤ –ø—ñ–¥—Å—É–º–∫–∞—Ö).
