–ß—É–¥–æ–≤–µ —É—Ç–æ—á–Ω–µ–Ω–Ω—è üí™
–¢–µ–ø–µ—Ä –∑–∞–≤–¥–∞–Ω–Ω—è ‚Äî **–∑–∞–ª–∏—à–∏—Ç–∏ —ñ—Å–Ω—É—é—á—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–≤—ñ—Ç—É –∑ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è–º –ø–æ —Ç–∏–ø—É –∫–æ–º–ø–∞–Ω—ñ—ó**,
–∞–ª–µ **–¥–æ–¥–∞—Ç–∏ —É –≤–∏–≤—ñ–¥ –∞–≤—Ç–æ—Ä–∞ (`creator`)** —ñ **–¥–æ–ø—É—Å—Ç–∏—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ä—è–¥–∫—ñ–≤ —É –º–µ–∂–∞—Ö –æ–¥–Ω—ñ—î—ó –≥—Ä—É–ø–∏**,
—è–∫—â–æ —Ä—ñ–∑–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑–∞–ø–æ–≤–Ω–∏–ª–∏ –¥–∞–Ω—ñ –¥–ª—è —Ç—ñ—î—ó –∂ –∫–æ–º–ø–∞–Ω—ñ—ó / –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É.

–¢–æ–±—Ç–æ:

* –≥—Ä—É–ø–∞ ‚Üí **—Ç–∏–ø –∫–æ–º–ø–∞–Ω—ñ—ó** (`company_type_name`)
* –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –≥—Ä—É–ø–∏ ‚Üí **—Ä—ñ–∑–Ω—ñ –∫–æ–º–ø–∞–Ω—ñ—ó, —é–Ω—ñ—Ç–∏, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ**
* —É –∫—ñ–Ω—Ü—ñ –≥—Ä—É–ø–∏ ‚Üí –ø—ñ–¥—Å—É–º–æ–∫ ‚Äú–í—Å—å–æ–≥–æ‚Äù –ø–æ —Ç–∏–ø—É –∫–æ–º–ø–∞–Ω—ñ—ó

---

## üîπ –û–Ω–æ–≤–ª–µ–Ω–∏–π SQL-–∑–∞–ø–∏—Ç

```sql
WITH base_data AS (
    SELECT 
        ep.id,
        ct.id          AS company_type_id,
        ct.name        AS company_type_name,
        c.id           AS company_id,
        c.name         AS company_name,
        u.id           AS unit_id,
        u.name         AS unit_name,
        ep.people_count,
        TO_CHAR(NVL(ep.date_update, ep.date_create), 'DD.MM.YYYY HH24:MI') AS date_display,
        NVL(ep.updator, ep.creator) AS creator,
        0 AS is_total,
        0 AS is_header
    FROM external_personal ep
    JOIN company c       ON c.id = ep.company_id
    JOIN company_type ct ON ct.id = c.company_type_id
    LEFT JOIN units u    ON u.id = ep.unit_id
    WHERE ep.date_end IS NULL
      AND TRUNC(ep.date_create) = TRUNC(:P_DATE_REPORT)
      AND ep.department_id = :P_DEPARTMENT_ID_FROMDB
),
totals AS (
    SELECT 
        NULL AS id,
        ct.id   AS company_type_id,
        ct.name AS company_type_name,
        NULL AS company_id,
        '–í—Å—å–æ–≥–æ' AS company_name,
        NULL AS unit_id,
        NULL AS unit_name,
        SUM(ep.people_count) AS people_count,
        NULL AS date_display,
        NULL AS creator,
        1 AS is_total,
        0 AS is_header
    FROM external_personal ep
    JOIN company c       ON c.id = ep.company_id
    JOIN company_type ct ON ct.id = c.company_type_id
    WHERE ep.date_end IS NULL
      AND TRUNC(ep.date_create) = TRUNC(:P_DATE_REPORT)
      AND ep.department_id = :P_DEPARTMENT_ID_FROMDB
    GROUP BY ct.id, ct.name
),
headers AS (
    SELECT 
        NULL AS id,
        ct.id   AS company_type_id,
        ct.name AS company_type_name,
        NULL AS company_id,
        NULL AS company_name,
        NULL AS unit_id,
        NULL AS unit_name,
        NULL AS people_count,
        NULL AS date_display,
        NULL AS creator,
        0 AS is_total,
        1 AS is_header
    FROM company_type ct
    WHERE EXISTS (
        SELECT 1
        FROM external_personal ep
        JOIN company c ON c.id = ep.company_id
        WHERE c.company_type_id = ct.id
          AND ep.date_end IS NULL
          AND TRUNC(ep.date_create) = TRUNC(:P_DATE_REPORT)
          AND ep.department_id = :P_DEPARTMENT_ID_FROMDB
    )
)
SELECT 
    company_type_id,
    company_type_name,
    company_id,
    company_name,
    unit_name,
    people_count,
    creator,
    date_display,
    is_total,
    is_header
FROM (
    SELECT * FROM headers
    UNION ALL
    SELECT * FROM base_data
    UNION ALL
    SELECT * FROM totals
)
ORDER BY company_type_id, is_header DESC, is_total, company_name, creator;
```

---

## üîπ –©–æ –∑–º—ñ–Ω–∏–ª–æ—Å—å

| –ë—É–ª–æ                               | –°—Ç–∞–ª–æ                                         |
| ---------------------------------- | --------------------------------------------- |
| –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ –ø–æ —Ç–∏–ø—É –∫–æ–º–ø–∞–Ω—ñ—ó | –ó–∞–ª–∏—à–∏–ª–æ—Å—å –ø–æ —Ç–∏–ø—É –∫–æ–º–ø–∞–Ω—ñ—ó                   |
| –û–¥–∏–Ω –∑–∞–ø–∏—Å –Ω–∞ –∫–æ–º–ø–∞–Ω—ñ—é             | –¢–µ–ø–µ—Ä –∫—ñ–ª—å–∫–∞ –∑–∞–ø–∏—Å—ñ–≤ (–ø–æ —Ä—ñ–∑–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞—Ö) |
| –ù–µ –±—É–ª–æ –∞–≤—Ç–æ—Ä–∞                     | –î–æ–¥–∞–Ω–æ `creator`                              |
| –ü—ñ–¥—Å—É–º–æ–∫ –æ–¥–∏–Ω –Ω–∞ —Ç–∏–ø               | –ü—ñ–¥—Å—É–º–æ–∫ –∑–±–µ—Ä–µ–∂–µ–Ω–æ                            |

---

## üîπ –ü—Ä–∏–∫–ª–∞–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É

```
–¢–∏–ø –∫–æ–º–ø–∞–Ω—ñ—ó: –ü—Ä–æ–º–∏—Å–ª–æ–≤—ñ
---------------------------------------------------------
Company A | Unit 1 | 10 | user_ivanov | 17.01.2026 09:10
Company A | Unit 1 | 8  | user_petrenko | 17.01.2026 09:25
Company B | Unit 2 | 5  | user_shevchuk | 17.01.2026 10:12
–í—Å—å–æ–≥–æ –ø–æ —Ç–∏–ø—É:               23

–¢–∏–ø –∫–æ–º–ø–∞–Ω—ñ—ó: –ë—É–¥—ñ–≤–µ–ª—å–Ω—ñ
---------------------------------------------------------
Company C | Unit 1 | 12 | user_kuzmenko | 17.01.2026 08:44
Company D | Unit 3 | 4  | user_bondar | 17.01.2026 09:30
–í—Å—å–æ–≥–æ –ø–æ —Ç–∏–ø—É:               16
```

---

## üîπ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ APEX Interactive Report

1. –ö–æ–ª–æ–Ω–∫–∏:

   ```
   COMPANY_TYPE_NAME
   COMPANY_NAME
   UNIT_NAME
   CREATOR
   PEOPLE_COUNT
   DATE_DISPLAY
   ```

2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π **Highlighting**:

   * `IS_HEADER = 1` ‚Üí –∂–∏—Ä–Ω–∏–π —à—Ä–∏—Ñ—Ç, —Ñ–æ–Ω #f4f4f4
   * `IS_TOTAL = 1` ‚Üí –∑–µ–ª–µ–Ω–∏–π —Ñ–æ–Ω, –∂–∏—Ä–Ω–∏–π —à—Ä–∏—Ñ—Ç
     (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ —á–µ—Ä–µ–∑ CSS: `.a-IRR-table tr td[headers="COMPANY_NAME"]:contains("–í—Å—å–æ–≥–æ") { background-color: #d4edda; font-weight: bold; }`)

---

–•–æ—á–µ—à, —è –ø–æ–∫–∞–∂—É –∫–æ—Ä–æ—Ç–∫–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç CSS —ñ —É–º–æ–≤ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è IR, —â–æ–± `headers` —Ç–∞ `totals` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥—ñ–ª—è–ª–∏—Å—å —Ä—ñ–∑–Ω–∏–º–∏ –∫–æ–ª—å–æ—Ä–∞–º–∏?
