–ß—É–¥–æ–≤–æ üëç
–û—Å—å –ø–æ–≤–Ω–∞, –∞–∫—É—Ä–∞—Ç–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è SQL-–∑–∞–ø–∏—Ç—É **—á–µ—Ä–µ–∑ `UNION ALL`**, —è–∫–∞ —Å—Ç–≤–æ—Ä—é—î –∑–≤—ñ—Ç *¬´–°—É–º–∞—Ä–Ω–æ –ø–æ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∞—Ö¬ª* –∑ —è–≤–Ω–∏–º —Ä—è–¥–∫–æ–º **¬´–í—Å—å–æ–≥–æ¬ª** –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É.
–¢–∞–∫–∏–π –ø—ñ–¥—Ö—ñ–¥ –Ω–∞–¥–∞—î —Ç–æ–±—ñ –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –≤–∏–≥–ª—è–¥–æ–º —ñ –∫–æ–ª—å–æ—Ä–æ–º —Ä—è–¥–∫—ñ–≤ —É APEX (—á–µ—Ä–µ–∑ `IS_TOTAL`).

---

## üîπ SQL-–∑–∞–ø–∏—Ç (–¥–ª—è IR –∞–±–æ Classic Report)

```sql
WITH base_data AS (
    SELECT 
        u.id            AS unit_id,
        u.name          AS unit_name,
        ct.id           AS company_type_id,
        ct.name         AS company_type_name,
        c.id            AS company_id,
        c.name          AS company_name,
        SUM(ep.people_count) AS total_people,
        0 AS is_total
    FROM 
        external_personal ep
        JOIN company c       ON c.id = ep.company_id
        JOIN company_type ct ON ct.id = c.company_type_id
        JOIN units u         ON u.id = ep.unit_id
    WHERE 
        TRUNC(ep.date_create) = TRUNC(:P_REPORT_DATE)
        AND ep.department_id IN (
            SELECT TO_NUMBER(column_value)
            FROM TABLE(apex_string.split(:P_REPORT_DEPARTMENTS, ':'))
        )
        AND ep.date_end IS NULL
    GROUP BY 
        u.id, u.name, ct.id, ct.name, c.id, c.name
),
totals AS (
    SELECT 
        u.id            AS unit_id,
        u.name          AS unit_name,
        NULL             AS company_type_id,
        NULL             AS company_type_name,
        NULL             AS company_id,
        '–í—Å—å–æ–≥–æ'         AS company_name,
        SUM(ep.people_count) AS total_people,
        1 AS is_total
    FROM 
        external_personal ep
        JOIN company c ON c.id = ep.company_id
        JOIN units u   ON u.id = ep.unit_id
    WHERE 
        TRUNC(ep.date_create) = TRUNC(:P_REPORT_DATE)
        AND ep.department_id IN (
            SELECT TO_NUMBER(column_value)
            FROM TABLE(apex_string.split(:P_REPORT_DEPARTMENTS, ':'))
        )
        AND ep.date_end IS NULL
    GROUP BY 
        u.id, u.name
)
SELECT * FROM base_data
UNION ALL
SELECT * FROM totals
ORDER BY unit_name, is_total, company_type_name, company_name;
```

---

## üîπ –©–æ —Ä–æ–±–∏—Ç—å —Ü–µ–π –∑–∞–ø–∏—Ç

* `base_data` ‚Äî –∑–≤–∏—á–∞–π–Ω—ñ —Ä—è–¥–∫–∏ (–ø–æ –∫–æ–º–ø–∞–Ω—ñ—è—Ö —É—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—ñ–≤).
* `totals` ‚Äî –ø—ñ–¥—Å—É–º–∫–æ–≤—ñ —Ä—è–¥–∫–∏ –∑ `"–í—Å—å–æ–≥–æ"` –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ `unit_name`.
* `IS_TOTAL`:

  * `0` ‚Äî –∑–≤–∏—á–∞–π–Ω–∏–π –∑–∞–ø–∏—Å,
  * `1` ‚Äî –ø—ñ–¥—Å—É–º–∫–æ–≤–∏–π —Ä—è–¥–æ–∫ (–¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —É –∑–≤—ñ—Ç—ñ).

---

## üîπ –Ø–∫ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ –≤ APEX

### 1Ô∏è‚É£ –°—Ç–≤–æ—Ä–∏ **Region ‚Üí Interactive Report (–∞–±–æ Classic Report)**

SQL Source = –∑–∞–ø–∏—Ç –≤–∏—â–µ.

### 2Ô∏è‚É£ –£ –∑–≤—ñ—Ç—ñ –≤—ñ–¥–æ–±—Ä–∞–∂–∞–π –∫–æ–ª–æ–Ω–∫–∏:

| –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å (company_name) | –ü—ñ–¥—Ä–æ–∑–¥—ñ–ª (unit_name) | –ö-—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—É (total_people) |

### 3Ô∏è‚É£ –î–æ–¥–∞–π **Highlight Rule**:

* **Condition:** `IS_TOTAL = 1`
* **Style:**

  ```css
  background-color: #d4edda !important;
  color: #155724 !important;
  font-weight: bold;
  border-top: 2px solid #b7e4c7;
  ```

---

## üîπ –†–µ–∑—É–ª—å—Ç–∞—Ç —É –∑–≤—ñ—Ç—ñ

```
–ü—ñ–¥—Ä–æ–∑–¥—ñ–ª: –ö–∏—ó–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å
----------------------------------------------
–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å        | –ü—ñ–¥—Ä–æ–∑–¥—ñ–ª       | –ö-—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—É
----------------------------------------------
–£–∫—Ä–ø–æ—à—Ç–∞          | –ö–∏—ó–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å  |  12
–£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è      | –ö–∏—ó–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å  |   8
–ù–æ–≤–∞ –ø–æ—à—Ç–∞        | –ö–∏—ó–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å  |  10
SoftServe         | –ö–∏—ó–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å  |   5
----------------------------------------------
–í—Å—å–æ–≥–æ            | –ö–∏—ó–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å  |  35  ‚úÖ –∑–µ–ª–µ–Ω–∏–π —Ä—è–¥–æ–∫

–ü—ñ–¥—Ä–æ–∑–¥—ñ–ª: –õ—å–≤—ñ–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å
----------------------------------------------
–£–∫—Ä–ø–æ—à—Ç–∞          | –õ—å–≤—ñ–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å |   9
–£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è      | –õ—å–≤—ñ–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å |   6
–ù–æ–≤–∞ –ø–æ—à—Ç–∞        | –õ—å–≤—ñ–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å |   7
SoftServe         | –õ—å–≤—ñ–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å |   4
----------------------------------------------
–í—Å—å–æ–≥–æ            | –õ—å–≤—ñ–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å |  26  ‚úÖ –∑–µ–ª–µ–Ω–∏–π —Ä—è–¥–æ–∫
```

---

## üîπ –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è (–æ–ø—Ü—ñ–π–Ω–æ)

* **–ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –≤ IR**: –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ `GROUP BY unit_name`.
* **–§—ñ–ª—å—Ç—Ä–∏**: –ø—Ä–∏ –∑–º—ñ–Ω—ñ `P_REPORT_DATE` –∞–±–æ `P_REPORT_DEPARTMENTS` ‚Üí `Dynamic Action ‚Üí Refresh Report`.
* **–í–∞–ª—ñ–¥–∞—Ü—ñ—è**: —è–∫—â–æ `P_REPORT_DEPARTMENTS` –ø–æ—Ä–æ–∂–Ω—ñ–π ‚Üí –ø–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ("–í–∏–±–µ—Ä—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–∏–Ω –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª").

---

–•–æ—á–µ—à, —è –æ–¥—Ä–∞–∑—É –ø—ñ–¥–≥–æ—Ç—É—é **—Ç—Ä–µ—Ç—ñ–π –∑–≤—ñ—Ç** ‚Äî –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—é –ø–æ —Ç–∏–ø–∞—Ö —Ä–æ–±—ñ—Ç (—â–æ–± –±–∞—á–∏—Ç–∏, —Å–∫—ñ–ª—å–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—É –∑–∞–π–Ω—è—Ç–æ –≤ –∫–æ–∂–Ω–æ–º—É —Ç–∏–ø—ñ —Ä–æ–±—ñ—Ç –ø–æ –∫–æ–º–ø–∞–Ω—ñ—è—Ö)?
