–î—É–∂–µ –¥–æ–±—Ä–µ üëå
–¢–∏ —Ö–æ—á–µ—à **–∑–±–µ—Ä–µ–≥—Ç–∏ —É—Å—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∑ —Ç–≤–æ–≥–æ –∑–∞–ø–∏—Ç—É**, –∞–ª–µ **–¥–æ–¥–∞—Ç–∏ —Ä–æ–∑–¥—ñ–ª—é–≤–∞–ª—å–Ω—ñ —Ä—è–¥–∫–∏ –∑ –Ω–∞–∑–≤–∞–º–∏ —Ç–∏–ø—ñ–≤ –∫–æ–º–ø–∞–Ω—ñ–π** ‚Äî —Ç–æ–±—Ç–æ –≤–∏–≤–µ—Å—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É –≤–∏–≥–ª—è–¥—ñ:

```
–î–µ—Ä–∂–∞–≤–Ω—ñ –∫–æ–º–ø–∞–Ω—ñ—ó
  –£–∫—Ä–ø–æ—à—Ç–∞ ‚Ä¶
  –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è ‚Ä¶
–ü—Ä–∏–≤–∞—Ç–Ω—ñ –∫–æ–º–ø–∞–Ω—ñ—ó
  SoftServe ‚Ä¶
  –ù–æ–≤–∞ –ø–æ—à—Ç–∞ ‚Ä¶
```

–Ü –ø—Ä–∏ —Ü—å–æ–º—É, —â–æ–± —É—Å—ñ –¥–∞–Ω—ñ, –≤–∫–ª—é—á–Ω–æ –∑ totals, –ª–∏—à–∏–ª–∏—Å—å.

---

## üîπ 1Ô∏è‚É£ –ó–∞–≤–¥–∞–Ω–Ω—è –≤ SQL

–ú–∏ –¥–æ–¥–∞–º–æ —Ç—Ä–µ—Ç—é —á–∞—Å—Ç–∏–Ω—É (–∫—Ä—ñ–º `base_data` —ñ `totals`) ‚Äî **`headers`**, —è–∫–∞ —Å—Ç–≤–æ—Ä–∏—Ç—å –æ–¥–∏–Ω —Ä—è–¥–æ–∫ –Ω–∞ –∫–æ–∂–µ–Ω `company_type_name`.

---

## üîπ 2Ô∏è‚É£ –ì–æ—Ç–æ–≤–∏–π SQL

```sql
WITH base_data AS (
    SELECT 
        ct.id          AS company_type_id,
        ct.name        AS company_type_name,
        c.id           AS company_id,
        c.name         AS company_name,
        NVL(wt.name, ep.work_type_text) AS work_type_name,
        u.id           AS unit_id,
        u.name         AS unit_name,
        ep.people_count,
        ep.date_create,
        ep.creator,
        0 AS is_total,
        0 AS is_header
    FROM external_personal ep
        JOIN company c       ON c.id = ep.company_id
        JOIN company_type ct ON ct.id = c.company_type_id
        LEFT JOIN work_type wt ON wt.id = ep.work_type_id
        LEFT JOIN units u      ON u.id = ep.unit_id
    WHERE ep.date_end IS NULL
),
totals AS (
    SELECT 
        ct.id AS company_type_id,
        ct.name AS company_type_name,
        NULL AS company_id,
        'Total' AS company_name,
        NULL AS work_type_name,
        NULL AS unit_id,
        NULL AS unit_name,
        SUM(pc.total_people) AS people_count,
        NULL AS date_create,
        NULL AS creator,
        1 AS is_total,
        0 AS is_header
    FROM (
        SELECT 
            c.company_type_id,
            ep.company_id,
            SUM(ep.people_count) AS total_people
        FROM external_personal ep
        JOIN company c ON c.id = ep.company_id
        WHERE ep.date_end IS NULL
        GROUP BY c.company_type_id, ep.company_id
    ) pc
    JOIN company_type ct ON ct.id = pc.company_type_id
    GROUP BY ct.id, ct.name
),
headers AS (
    SELECT 
        ct.id AS company_type_id,
        ct.name AS company_type_name,
        NULL AS company_id,
        ct.name AS company_name,     -- –±—É–¥–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏—Å—å —è–∫ –∑–∞–≥–æ–ª–æ–≤–æ–∫
        NULL AS work_type_name,
        NULL AS unit_id,
        NULL AS unit_name,
        NULL AS people_count,
        NULL AS date_create,
        NULL AS creator,
        0 AS is_total,
        1 AS is_header
    FROM company_type ct
    WHERE EXISTS (
        SELECT 1
        FROM external_personal ep
        JOIN company c ON c.id = ep.company_id
        WHERE c.company_type_id = ct.id
          AND ep.date_end IS NULL
    )
)
SELECT *
FROM (
    SELECT * FROM headers
    UNION ALL
    SELECT * FROM base_data
    UNION ALL
    SELECT * FROM totals
)
ORDER BY company_type_id, is_header DESC, is_total, company_name;
```

---

## üîπ 3Ô∏è‚É£ –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è

| –ß–∞—Å—Ç–∏–Ω–∞     | –û–ø–∏—Å                                                   |
| ----------- | ------------------------------------------------------ |
| `base_data` | —É—Å—ñ –∑–≤–∏—á–∞–π–Ω—ñ –∑–∞–ø–∏—Å–∏                                    |
| `totals`    | –ø—ñ–¥—Å—É–º–∫–æ–≤–∏–π —Ä—è–¥–æ–∫ `"Total"` –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ `company_type` |
| `headers`   | –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ `company_type`                   |
| `is_header` | —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –ø—Ä–∞–ø–æ—Ä–µ—Ü—å –¥–ª—è —Å—Ç–∏–ª—ñ–∑–∞—Ü—ñ—ó                   |

---

## üîπ 4Ô∏è‚É£ –ü—Ä–∏–∫–ª–∞–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É

```
COMPANY_TYPE_ID | COMPANY_NAME        | PEOPLE_COUNT | IS_HEADER | IS_TOTAL
-----------------|--------------------|---------------|------------
1                | –î–µ—Ä–∂–∞–≤–Ω—ñ –∫–æ–º–ø–∞–Ω—ñ—ó  |               | 1         | 0
1                | –£–∫—Ä–ø–æ—à—Ç–∞           | 12            | 0         | 0
1                | –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è       | 8             | 0         | 0
1                | Total              | 20            | 0         | 1
2                | –ü—Ä–∏–≤–∞—Ç–Ω—ñ –∫–æ–º–ø–∞–Ω—ñ—ó  |               | 1         | 0
2                | SoftServe          | 6             | 0         | 0
2                | –ù–æ–≤–∞ –ø–æ—à—Ç–∞         | 9             | 0         | 0
2                | Total              | 15            | 0         | 1
```

---

## üîπ 5Ô∏è‚É£ –í—ñ–∑—É–∞–ª—å–Ω–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –≤ APEX (Highlight Rules)

–£ **Interactive Report** ‚Üí **Highlight ‚Üí Add**:

| Condition       | Style                                                                                          |
| --------------- | ---------------------------------------------------------------------------------------------- |
| `IS_HEADER = 1` | `background-color: #e2e3f3; font-weight: bold; color: #1a237e; border-top: 2px solid #c5cae9;` |
| `IS_TOTAL = 1`  | `background-color: #d4edda; color: #155724; font-weight: bold; border-top: 2px solid #b7e4c7;` |

---

## üîπ 6Ô∏è‚É£ –ü—ñ–¥—Å—É–º–æ–∫

‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —É –∑–≤—ñ—Ç—ñ:

```
–î–µ—Ä–∂–∞–≤–Ω—ñ –∫–æ–º–ø–∞–Ω—ñ—ó
   –£–∫—Ä–ø–æ—à—Ç–∞ ............. 12
   –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è ......... 8
   Total ................ 20
–ü—Ä–∏–≤–∞—Ç–Ω—ñ –∫–æ–º–ø–∞–Ω—ñ—ó
   SoftServe ............ 6
   –ù–æ–≤–∞ –ø–æ—à—Ç–∞ ........... 9
   Total ................ 15
```

‚úÖ –ü–æ–≤–Ω—ñ—Å—Ç—é —Å—É–º—ñ—Å–Ω–æ –∑ —Ç–≤–æ—î—é –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–æ—é APEX:

* –ø—ñ–¥—Ç—Ä–∏–º—É—î `Highlight` (IS_HEADER, IS_TOTAL);
* –ª–µ–≥–∫–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—Ä–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ö `P_REPORT_DATE`, `P_REPORT_DEPARTMENTS`;
* –º–æ–∂–Ω–∞ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —è–∫ –≥—Ä—É–ø–∏ (–∞–±–æ –Ω–∞–≤—ñ—Ç—å —É Classic Report —è–∫ `breaks`).

---

–•–æ—á–µ—à, —â–æ–± —è –ø–æ–∫–∞–∑–∞–≤, —è–∫ –∑—Ä–æ–±–∏—Ç–∏, —â–æ–± —Ä—è–¥–∫–∏ –∑ `IS_HEADER = 1` –≤–∏–≥–ª—è–¥–∞–ª–∏ **—è–∫ –≥—Ä—É–ø–æ–≤—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑ –∫–æ–ª–æ–Ω–æ–∫** (–∑–ª–∏—Ç—ñ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É, —è–∫ —Å–µ–∫—Ü—ñ–π–Ω—ñ —Ä—è–¥–∫–∏ —É Classic Report)?
