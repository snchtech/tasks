–¢–∞–∫, —Ü–µ –¥—É–∂–µ —Ç–∏–ø–æ–≤–∞ —ñ ‚Äú–ø—ñ–¥—Å—Ç—É–ø–Ω–∞‚Äù —Å–∏—Ç—É–∞—Ü—ñ—è –¥–ª—è Oracle APEX üòÖ
–¢–∏ –æ–ø–∏—Å–∞–≤ –∫–ª–∞—Å–∏—á–Ω–∏–π **race condition / async refresh conflict** ‚Äî –∫–æ–ª–∏ –∫—ñ–ª—å–∫–∞ —Ä–µ–≥—ñ–æ–Ω—ñ–≤ —ñ item'—ñ–≤ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –º–∞–π–∂–µ –æ–¥–Ω–æ—á–∞—Å–Ω–æ, —ñ –≤ –ø–µ–≤–Ω–∏–π –º–æ–º–µ–Ω—Ç –æ–¥–∏–Ω –∑ item'—ñ–≤ —â–µ –Ω–µ –≤—Å—Ç–∏–≥ –æ–Ω–æ–≤–∏—Ç–∏—Å—å –∞–±–æ –æ—á–∏—Å—Ç–∏–≤—Å—è –ø–µ—Ä–µ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∑–≤—ñ—Ç—É ‚Üí —Ç–æ–º—É —É —Å–µ—Å—ñ—ó –∑‚Äô—è–≤–ª—è—é—Ç—å—Å—è `NULL` –∑–Ω–∞—á–µ–Ω–Ω—è, —ñ –∑–≤—ñ—Ç–∏ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å –ø—É—Å—Ç–æ.

---

## üéØ –ú–µ—Ç–∞

–ó–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ **—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é –º—ñ–∂ `DATE`, `DEPARTMENT`, `UNIT`**, —â–æ–±:

* –ø—Ä–∏ –±—É–¥—å-—è–∫—ñ–π –∑–º—ñ–Ω—ñ –¥–∞—Ç–∏/–¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—É/—é–Ω—ñ—Ç–∞ –≤–æ–Ω–∏ **–æ–Ω–æ–≤–ª—é–≤–∞–ª–∏—Å—å —É –ø—Ä–∞–≤–∏–ª—å–Ω—ñ–π –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ**;
* APEX **–Ω–µ –æ–Ω–æ–≤–ª—é–≤–∞–≤ –∑–≤—ñ—Ç–∏**, –ø–æ–∫–∏ –Ω–µ –æ–Ω–æ–≤–∏–ª–∏—Å—å —É—Å—ñ –∑–∞–ª–µ–∂–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏;
* –∑–Ω–∞—á–µ–Ω–Ω—è `DEPARTMENT` —ñ `UNIT` **–Ω—ñ–∫–æ–ª–∏ –Ω–µ –≥—É–±–∏–ª–∏—Å—å —É —Å–µ—Å—ñ—ó** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —á–µ—Ä–µ–∑ ‚Äú—Ä–æ–∑—Ä–∏–≤‚Äù —É –ø–µ—Ä–µ–¥–∞—á—ñ –∑–Ω–∞—á–µ–Ω—å).

---

## ‚úÖ –ü–æ–∫—Ä–æ–∫–æ–≤–µ —Ä—ñ—à–µ–Ω–Ω—è

### üîπ 1. –ó—Ä–æ–±–∏ –≤—Å—ñ —Ç—Ä–∏ items ¬´–∫–µ—Ä–æ–≤–∞–Ω–∏–º–∏ —á–µ—Ä–µ–∑ Master-Detail –ª–∞–Ω—Ü—é–∂–æ–∫¬ª

–©–æ–± –Ω–µ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —ó—Ö —Ö–∞–æ—Ç–∏—á–Ω–æ, –∞ –≤ —á—ñ—Ç–∫—ñ–π –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ:

#### üîß –ü–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å:

```
P_DATE ‚Üí –æ–Ω–æ–≤–ª—é—î ‚Üí P_CHECKBOX_DEPARTMENT ‚Üí –æ–Ω–æ–≤–ª—é—î ‚Üí P_CHECKBOX_UNIT ‚Üí –æ–Ω–æ–≤–ª—é—î ‚Üí –∑–≤—ñ—Ç–∏
```

> –¢–æ–±—Ç–æ `UNIT` –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è **–ø—ñ—Å–ª—è** —Ç–æ–≥–æ, —è–∫ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –Ω–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è,
> —ñ –∑–≤—ñ—Ç–∏ —Ä–µ—Ñ—Ä–µ—à–∞—Ç—å—Å—è **—Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è** —Ç–æ–≥–æ, —è–∫ –æ–Ω–æ–≤–∏—Ç—å—Å—è `UNIT`.

---

### üîπ 2. –ù–∞–ª–∞—à—Ç—É–π **Dynamic Actions** —É –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É

#### üß© A. Dynamic Action 1 ‚Üí *On Change of P_DATE*

**True Actions:**

1. Refresh ‚Üí Region (Departments)
2. Refresh ‚Üí Region (Units)
3. Execute PL/SQL Code ‚Üí –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ –∑–∞–ø–∏—Å—ñ–≤ (item `P_RECORD_COUNT`)
4. Refresh ‚Üí Report 1
5. Refresh ‚Üí Report 2

‚öôÔ∏è **Execution Scope:** *Wait for Result = Yes*
(—â–æ–± APEX –¥–æ—á–µ–∫–∞–≤—Å—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ —Ä–µ—Ñ—Ä–µ—à—É, –ø–µ—Ä—à –Ω—ñ–∂ –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ)

---

#### üß© B. Dynamic Action 2 ‚Üí *On Change of P_CHECKBOX_DEPARTMENT*

**True Actions:**

1. Refresh ‚Üí Region (Units)
2. Execute PL/SQL Code ‚Üí –æ–Ω–æ–≤–∏—Ç–∏ `P_RECORD_COUNT`
3. Refresh ‚Üí Report 1
4. Refresh ‚Üí Report 2

–¢–∞–∫ —Å–∞–º–æ –≤–∏—Å—Ç–∞–≤ `Wait for Result = Yes`.

---

#### üß© C. Dynamic Action 3 ‚Üí *On Change of P_CHECKBOX_UNIT*

**True Actions:**

1. Execute PL/SQL Code ‚Üí –æ–Ω–æ–≤–∏—Ç–∏ `P_RECORD_COUNT`
2. Refresh ‚Üí Report 1
3. Refresh ‚Üí Report 2

---

### üîπ 3. –í APEX –∫–æ–∂–µ–Ω —Ä–µ—Ñ—Ä–µ—à –º–∞—î –±—É—Ç–∏ ‚Äú–ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏–º‚Äù

–î–ª—è —Ü—å–æ–≥–æ —É –∫–æ–∂–Ω—ñ–π –¥—ñ—ó –ø–æ—Å—Ç–∞–≤:

* **Wait for Result = Yes**
* **Fire on Initialization = No**
* **Event Scope = Static**

‚úÖ –¶–µ –∑–º—É—à—É—î APEX *–¥–æ—á—ñ–∫—É–≤–∞—Ç–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∫–æ–∂–Ω–æ—ó –¥—ñ—ó –ø–µ—Ä–µ–¥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º –Ω–∞—Å—Ç—É–ø–Ω–æ—ó*
(–æ—Å–æ–±–ª–∏–≤–æ –≤–∞–∂–ª–∏–≤–æ, –∫–æ–ª–∏ –ø—Ä–∞—Ü—é—î—à —ñ–∑ –∫—ñ–ª—å–∫–æ–º–∞ refresh‚Äô–∞–º–∏ –ø–æ—Å–ø—ñ–ª—å).

---

### üîπ 4. –î–æ–¥–∞–π ¬´—Å—Ç—Ä–∞—Ö–æ–≤–∫—É¬ª ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å –∑–Ω–∞—á–µ–Ω—å –Ω–∞ —Ä—ñ–≤–Ω—ñ PL/SQL

–ü–µ—Ä–µ–¥ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è–º –∑–∞–ø–∏—Ç—É —É –∑–≤—ñ—Ç–∞—Ö –¥–æ–¥–∞–π —É `WHERE` —É–º–æ–≤–∏ —Ç–∞–∫–æ–≥–æ —Ç–∏–ø—É:

```sql
AND (
  :P_CHECKBOX_DEPARTMENT IS NULL
  OR ep.department_id IN (
      SELECT TO_NUMBER(column_value)
      FROM TABLE(apex_string.split(:P_CHECKBOX_DEPARTMENT, ':'))
  )
)
AND (
  :P_CHECKBOX_UNIT IS NULL
  OR ep.unit_id IN (
      SELECT TO_NUMBER(column_value)
      FROM TABLE(apex_string.split(:P_CHECKBOX_UNIT, ':'))
  )
)
```

‚Üí —Ç–æ–¥—ñ –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤ –ø–µ–≤–Ω–∏–π –º–æ–º–µ–Ω—Ç item –Ω–µ –≤—Å—Ç–∏–≥–Ω–µ –æ–Ω–æ–≤–∏—Ç–∏—Å—å, –∑–≤—ñ—Ç –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∂–µ –≤—Å—ñ –¥–∞–Ω—ñ, –∞ –Ω–µ –ø—É—Å—Ç–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

---

### üîπ 5. (–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ) –î–æ–¥–∞–π **Hidden Items**-–∫–æ–ø—ñ—ó –¥–ª—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏

–°—Ç–≤–æ—Ä–∏ –¥–≤–∞ –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ item:

* `P_LAST_DEPARTMENT`
* `P_LAST_UNIT`

–£ Dynamic Actions –Ω–∞ –∑–º—ñ–Ω—É `P_CHECKBOX_DEPARTMENT` / `P_CHECKBOX_UNIT` –¥–æ–¥–∞–π –∫—Ä–æ–∫:

```js
$s('P_LAST_DEPARTMENT', $v('P_CHECKBOX_DEPARTMENT'));
$s('P_LAST_UNIT', $v('P_CHECKBOX_UNIT'));
```

–ê —É SQL –∑–≤—ñ—Ç—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π:

```sql
NVL(:P_CHECKBOX_DEPARTMENT, :P_LAST_DEPARTMENT)
```

‚úÖ –¶–µ –∑–∞–ø–æ–±—ñ–≥–∞—î —Å–∏—Ç—É–∞—Ü—ñ—ó, –∫–æ–ª–∏ APEX —â–µ –Ω–µ –∑–±–µ—Ä—ñ–≥ –Ω–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è item —É —Å–µ—Å—ñ—ó (–∞ —Å—Ç–∞—Ä—ñ –≤–∂–µ —Å—Ç–µ—Ä), —ñ –¥–∞—î –∑–º–æ–≥—É –∑–≤—ñ—Ç–∞–º –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —Å—Ç–∞–±—ñ–ª—å–Ω–æ.

---

### üîπ 6. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó

–ü—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏:

* –í–∏–∫–æ–Ω–∞–π **Dynamic Action ‚ÄúAfter Page Load‚Äù**, —è–∫–∏–π:

  * —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î –≤—Å—ñ —á–µ–∫–±–æ–∫—Å–∏ (—á–µ—Ä–µ–∑ SQL –∞–±–æ JS);
  * –æ–Ω–æ–≤–ª—é—î `P_RECORD_COUNT`;
  * —Ä–µ—Ñ—Ä–µ—à–∏—Ç—å –∑–≤—ñ—Ç–∏ **–æ–¥–∏–Ω —Ä–∞–∑**.

–¶–µ –ø—Ä–∏–±–∏—Ä–∞—î ‚Äú–ø–æ—Ä–æ–∂–Ω—ñ–π‚Äù —Å—Ç–∞–Ω –ø—ñ—Å–ª—è –ø–µ—Ä—à–æ–≥–æ –∑–∞–ø—É—Å–∫—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏.

---

## üîπ 7. –ü—Ä–∏–∫–ª–∞–¥ –∫–æ—Ä–æ—Ç–∫–æ—ó JS-—Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –∞–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è

–ú–æ–∂–µ—à –¥–æ–¥–∞—Ç–∏ —Ü–µ –≤ ‚ÄúFunction and Global Variable Declaration‚Äù:

```js
function refreshReports() {
  apex.region("report_main").refresh();
  apex.region("report_details").refresh();
}

function updateCounterAndReports() {
  apex.server.process("GET_RECORD_COUNT", {
    pageItems: ["P_DATE", "P_CHECKBOX_DEPARTMENT", "P_CHECKBOX_UNIT"]
  }, {
    success: function(pData){
      $s("P_RECORD_COUNT", pData.count);
      refreshReports();
    }
  });
}
```

–Ü –ø—Ä–æ—Å—Ç–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `updateCounterAndReports()` —É DA –ø—Ä–∏ –∑–º—ñ–Ω—ñ –±—É–¥—å-—è–∫–æ–≥–æ —Ñ—ñ–ª—å—Ç—Ä–∞.
(–í—ñ–Ω —Å–ø–æ—á–∞—Ç–∫—É –æ–Ω–æ–≤–∏—Ç—å –ª—ñ—á–∏–ª—å–Ω–∏–∫, –ø–æ—Ç—ñ–º –∑–≤—ñ—Ç–∏ ‚Äî –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ.)

---

## üîπ üîç –†–µ–∑—é–º–µ

| –ü—Ä–æ–±–ª–µ–º–∞                      | –†—ñ—à–µ–Ω–Ω—è                                                     |
| ----------------------------- | ----------------------------------------------------------- |
| –ó–Ω–∞—á–µ–Ω–Ω—è item —ñ–Ω–æ–¥—ñ –∑–Ω–∏–∫–∞—é—Ç—å  | –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ DA –∑ ‚ÄúWait for Result‚Äù              |
| –î–∞–Ω—ñ —É –∑–≤—ñ—Ç–∞—Ö –ø—É—Å—Ç—ñ           | –î–æ–¥–∞–π `NVL()` –∞–±–æ —Ä–µ–∑–µ—Ä–≤–Ω—ñ `P_LAST_*` item                  |
| –§—ñ–ª—å—Ç—Ä–∏ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ | –í—Å—Ç–∞–Ω–æ–≤–∏ —á—ñ—Ç–∫—É –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å (Date ‚Üí Dept ‚Üí Unit ‚Üí Reports) |
| –ü–æ—á–∞—Ç–∫–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–µ –∑–∞–¥–∞–Ω—ñ  | –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–π —É—Å—ñ —á–µ–∫–±–æ–∫—Å–∏ –≤ ‚ÄúAfter Page Load‚Äù                |

---

–•–æ—á–µ—à, —â–æ–± —è –¥–æ–ø–æ–º—ñ–≥ –ø—Ä–æ–ø–∏—Å–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ **Dynamic Actions (—ñ–∑ –Ω–∞–∑–≤–∞–º–∏ –∫—Ä–æ–∫—ñ–≤ —ñ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—é)** –¥–ª—è —Ç–≤–æ—î—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏, —â–æ–± –ø—Ä–æ—Å—Ç–æ –≤—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ —Ü–µ –≤ APEX Builder –±–µ–∑ –∑–¥–æ–≥–∞–¥–æ–∫?
