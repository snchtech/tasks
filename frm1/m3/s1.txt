–î—É–∂–µ –ª–æ–≥—ñ—á–Ω–æ üí™
–¢–∏ —Ö–æ—á–µ—à –¥–æ–¥–∞—Ç–∏ —É —Å–≤—ñ–π –∑–≤—ñ—Ç ‚Äú—ñ–Ω—Ç–µ–ª–µ–∫—Ç—É–∞–ª—å–Ω—É‚Äù –ª–æ–≥—ñ–∫—É –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–≤—Ç–æ—Ä–∞ —ñ –¥–∞—Ç–∏ ‚Äî —Ç–æ–±—Ç–æ:

* —è–∫—â–æ –∑–∞–ø–∏—Å –æ–Ω–æ–≤–ª—é–≤–∞–≤—Å—è (`UPDATOR`, `DATE_UPDATE`),
  ‚Üí –ø–æ–∫–∞–∑–∞—Ç–∏ —ó—Ö;
* —è–∫—â–æ –Ω—ñ ‚Äî –ø–æ–∫–∞–∑–∞—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤—ñ (`CREATOR`, `DATE_CREATE`).

---

## üîπ –û–Ω–æ–≤–ª–µ–Ω–∏–π SQL —ñ–∑ —É–º–æ–≤–Ω–æ—é –ª–æ–≥—ñ–∫–æ—é

```sql
WITH base_data AS (
    SELECT 
        u.id              AS unit_id,
        u.name            AS unit_name,
        ct.id             AS company_type_id,
        ct.name           AS company_type_name,
        c.id              AS company_id,
        c.name            AS company_name,
        ep.people_count,
        -- ‚úÖ –Ø–∫—â–æ —î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è ‚Äî –±–µ—Ä–µ–º–æ UPDATOR / DATE_UPDATE, —ñ–Ω–∞–∫—à–µ CREATOR / DATE_CREATE
        CASE 
            WHEN ep.updator IS NOT NULL THEN ep.updator 
            ELSE ep.creator 
        END AS creator,
        CASE 
            WHEN ep.date_update IS NOT NULL THEN ep.date_update 
            ELSE ep.date_create 
        END AS date_display,
        0 AS is_total
    FROM 
        external_personal ep
        JOIN company c       ON c.id = ep.company_id
        JOIN company_type ct ON ct.id = c.company_type_id
        JOIN units u         ON u.id = ep.unit_id
    WHERE 
        TRUNC(ep.date_create) = TRUNC(:P_REPORT_DATE)
        AND ep.department_id IN (
            SELECT TO_NUMBER(column_value)
            FROM TABLE(apex_string.split(:P_REPORT_DEPARTMENTS, ':'))
        )
        AND ep.date_end IS NULL
),
totals AS (
    SELECT 
        u.id              AS unit_id,
        u.name            AS unit_name,
        NULL              AS company_type_id,
        NULL              AS company_type_name,
        NULL              AS company_id,
        '–í—Å—å–æ–≥–æ'          AS company_name,
        SUM(ep.people_count) AS people_count,
        NULL              AS creator,
        NULL              AS date_display,
        1 AS is_total
    FROM 
        external_personal ep
        JOIN company c ON c.id = ep.company_id
        JOIN units u   ON u.id = ep.unit_id
    WHERE 
        TRUNC(ep.date_create) = TRUNC(:P_REPORT_DATE)
        AND ep.department_id IN (
            SELECT TO_NUMBER(column_value)
            FROM TABLE(apex_string.split(:P_REPORT_DEPARTMENTS, ':'))
        )
        AND ep.date_end IS NULL
    GROUP BY 
        u.id, u.name
)
SELECT * 
FROM (
    SELECT * FROM base_data
    UNION ALL
    SELECT * FROM totals
)
ORDER BY unit_name, is_total, company_type_name, company_name;
```

---

## üîπ üîç –ü–æ—è—Å–Ω–µ–Ω–Ω—è

| –ö–æ–ª–æ–Ω–∫–∞        | –õ–æ–≥—ñ–∫–∞                                                                     |
| -------------- | -------------------------------------------------------------------------- |
| `creator`      | —è–∫—â–æ `EP.UPDATOR` —ñ—Å–Ω—É—î ‚Üí –ø–æ–∫–∞–∑–∞—Ç–∏ `UPDATOR`, —ñ–Ω–∞–∫—à–µ `CREATOR`             |
| `date_display` | —è–∫—â–æ `EP.DATE_UPDATE` —ñ—Å–Ω—É—î ‚Üí –ø–æ–∫–∞–∑–∞—Ç–∏ `DATE_UPDATE`, —ñ–Ω–∞–∫—à–µ `DATE_CREATE` |

---

## üîπ üßæ –†–µ–∑—É–ª—å—Ç–∞—Ç

| Unit  | Company      | People | Creator                     | Date Display         |
| ----- | ------------ | ------ | --------------------------- | -------------------- |
| –ö–∏—ó–≤  | –£–∫—Ä–ø–æ—à—Ç–∞     | 8      | ivanov_i                    | 06.10.2025 12:32     |
| –ö–∏—ó–≤  | –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è | 11     | petrenko_o                  | 06.10.2025 09:44     |
| –õ—å–≤—ñ–≤ | SoftServe    | 7      | shevchuk_v                  | 06.10.2025 08:05     |
| –õ—å–≤—ñ–≤ | –ù–æ–≤–∞ –ø–æ—à—Ç–∞   | 6      | **kuzmenko_n** *(–æ–Ω–æ–≤–ª–µ–Ω–æ)* | **06.10.2025 15:10** |
| ‚Äî     | –í—Å—å–æ–≥–æ       | 32     |                             |                      |

---

‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç —É APEX:**

* —Ç–∏ –º–æ–∂–µ—à –ø—Ä–æ—Å—Ç–æ –∑–∞–º—ñ–Ω–∏—Ç–∏ –∫–æ–ª–æ–Ω–∫—É `DATE_CREATE` –Ω–∞ `DATE_DISPLAY`
  (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, ‚Äú–î–∞—Ç–∞ / —á–∞—Å –ø–æ–¥–∞–Ω–Ω—è‚Äù)
* —ñ –∫–æ–ª–æ–Ω–∫—É `CREATOR` –∑–∞–ª–∏—à–∏—Ç–∏ —Ç—É —Å–∞–º—É, –∞–ª–µ –∑ —Ü—ñ—î—é –ª–æ–≥—ñ–∫–æ—é.

---

–•–æ—á–µ—à, —â–æ–± —è –ø–æ–∫–∞–∑–∞–≤, —è–∫ —É –∑–≤—ñ—Ç—ñ APEX –¥–ª—è `DATE_DISPLAY` –∑—Ä–æ–±–∏—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –¥–∞—Ç–∏ (`DD.MM.YYYY HH24:MI`) –±–µ–∑ –∑–º—ñ–Ω–∏ SQL?
