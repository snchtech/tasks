–î—É–∂–µ –∫–ª–∞—Å–Ω–æ, –º–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ **–ø—Ä–∞–∫—Ç–∏—á–Ω–æ—ó —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó CRUD-—Ñ—É–Ω–∫—Ü—ñ–π** –¥–ª—è —Ç–≤–æ–≥–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–≤—ñ—Ç—É –≤ Oracle APEX üëå
–†–æ–∑–±–µ—Ä—ñ–º–æ –≤—Å–µ –ø–æ –ø—É–Ω–∫—Ç–∞—Ö, –≤–∫–ª—é—á–Ω–æ –∑ **–æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º —ñ—Å—Ç–æ—Ä—ñ—ó –∑–º—ñ–Ω**, **—Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è–º**, —ñ **–≤–∏–¥–∞–ª–µ–Ω–Ω—è–º —á–µ—Ä–µ–∑ AJAX**.

---

## üîπ 1Ô∏è‚É£ –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ `EXTERNAL_PERSONAL`

–î–æ–¥–∞–π –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –∞—É–¥–∏—Ç—É –∑–º—ñ–Ω:

```sql
ALTER TABLE external_personal ADD (
    date_update DATE,
    updator     VARCHAR2(100)
);
```

üëâ

* `date_update` ‚Äî –∫–æ–ª–∏ –≤–æ—Å—Ç–∞–Ω–Ω—î –∑–º—ñ–Ω–µ–Ω–æ.
* `updator` ‚Äî —Ö—Ç–æ –∑—Ä–æ–±–∏–≤ –∑–º—ñ–Ω—É (`:APP_USER`).

> **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:**
> —è–∫—â–æ —Ç–∏ –ø–ª–∞–Ω—É—î—à –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –æ–Ω–æ–≤–ª–µ–Ω—å, –∫—Ä–∞—â–µ –æ–¥—Ä–∞–∑—É —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∞—Ä—Ö—ñ–≤–Ω—É —Ç–∞–±–ª–∏—Ü—é `EXTERNAL_PERSONAL_HISTORY`.

---

## üîπ 2Ô∏è‚É£ –Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω (–∞—É–¥–∏—Ç–Ω–∞ —Ç–∞–±–ª–∏—Ü—è)

–°—Ç–≤–æ—Ä–∏–º–æ —Ç–∞–±–ª–∏—Ü—é-–∂—É—Ä–Ω–∞–ª, —â–æ–± –Ω–µ –≤—Ç—Ä–∞—á–∞—Ç–∏ —Å—Ç–∞—Ä—ñ –¥–∞–Ω—ñ:

```sql
CREATE TABLE external_personal_history AS
SELECT 
    ep.*, 
    SYSDATE AS archive_date,
    :APP_USER AS archive_user
FROM external_personal ep
WHERE 1=0;  -- —Ç—ñ–ª—å–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```

–î–æ–¥–∞–π —Ç—Ä–∏–≥–µ—Ä, —è–∫–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–ø—ñ—é–≤–∞—Ç–∏–º–µ —Å—Ç–∞—Ä–∏–π —Ä—è–¥–æ–∫ –ø–µ—Ä–µ–¥ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º –∞–±–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º:

```sql
CREATE OR REPLACE TRIGGER trg_ep_audit
BEFORE UPDATE OR DELETE ON external_personal
FOR EACH ROW
BEGIN
    INSERT INTO external_personal_history (
        id, department_id, unit_id, work_type_id, work_type_text, 
        people_count, company_id, date_create, creator, date_end,
        date_update, updator, archive_date, archive_user
    )
    VALUES (
        :OLD.id, :OLD.department_id, :OLD.unit_id, :OLD.work_type_id, :OLD.work_type_text,
        :OLD.people_count, :OLD.company_id, :OLD.date_create, :OLD.creator, :OLD.date_end,
        :OLD.date_update, :OLD.updator, SYSDATE, NVL(V('APP_USER'), USER)
    );
END;
/
```

‚úÖ
–¢–µ–ø–µ—Ä **–∫–æ–∂–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–±–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è** –∑–∞–ª–∏—à–∞—î –∫–æ–ø—ñ—é —Å—Ç–∞—Ä–æ–≥–æ –∑–∞–ø–∏—Å—É –∑ —á–∞—Å–æ–º —ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º.

---

## üîπ 3Ô∏è‚É£ –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏ **Edit** —É Interactive Report

### –ö—Ä–æ–∫ 1.

–£ IR ‚Üí **Attributes ‚Üí Link** (–∞–±–æ –¥–æ–¥–∞–π –∫–æ–ª–æ–Ω–∫—É –∑ —ñ–∫–æ–Ω–∫–æ—é üñâ):

```sql
'<a href="f?p=&APP_ID.:20:&SESSION.::NO::P20_ID:' || id || 
'" class="t-Button t-Button--small t-Button--edit"><span class="fa fa-edit"></span></a>' AS edit_link
```

> üîπ –¢—É—Ç `20` ‚Äî ID —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —Ñ–æ—Ä–º–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è.
> –ü–µ—Ä–µ–¥–∞—î–º–æ `P20_ID = external_personal.id`.

---

## üîπ 4Ô∏è‚É£ –°—Ç–æ—Ä—ñ–Ω–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è (Page 20)

**–¢–∏–ø —Å—Ç–æ—Ä—ñ–Ω–∫–∏:** Form
**Table:** `EXTERNAL_PERSONAL`

### –ï–ª–µ–º–µ–Ω—Ç–∏:

* `P20_ID` (Hidden)
* `P20_PEOPLE_COUNT` (Number field)

### Process ‚Üí ‚ÄúUpdate External Personal‚Äù:

```plsql
UPDATE external_personal
   SET people_count = :P20_PEOPLE_COUNT,
       date_update  = SYSDATE,
       updator      = :APP_USER
 WHERE id = :P20_ID;
```

‚úÖ
–ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—É:

* Redirect ‚Üí –Ω–∞–∑–∞–¥ –¥–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑—ñ –∑–≤—ñ—Ç–æ–º (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Page 10).
* Refresh Interactive Report, —â–æ–± –≤—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ –∑–º—ñ–Ω–∏.

---

## üîπ 5Ô∏è‚É£ –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏ **Delete** –∑ AJAX Callback

### –ö—Ä–æ–∫ 1.

–£ IR –¥–æ–¥–∞–π –∫–æ–ª–æ–Ω–∫—É-–ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è:

```sql
'<a href="javascript:void(0)" 
   class="t-Button t-Button--small t-Button--danger ep-delete" 
   data-id="' || id || '">
   <span class="fa fa-trash"></span></a>' AS delete_link
```

---

### –ö—Ä–æ–∫ 2.

–£ **Page ‚Üí JavaScript ‚Üí Function and Global Variable Declaration** –≤—Å—Ç–∞–≤:

```js
function deleteExternalPersonal(recordId) {
  apex.message.confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –∑–∞–ø–∏—Å?", function(okPressed) {
    if (okPressed) {
      apex.server.process("DELETE_EP", {
        x01: recordId
      }, {
        success: function() {
          apex.region("your_report_static_id").refresh();
          apex.message.showPageSuccess("–ó–∞–ø–∏—Å —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ");
        },
        error: function(err) {
          console.error("–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è:", err);
        }
      });
    }
  });
}

$(document).on("click", ".ep-delete", function() {
  const id = $(this).data("id");
  deleteExternalPersonal(id);
});
```

> üîπ –ó–∞–º—ñ–Ω–∏ `"your_report_static_id"` –Ω–∞ **Static ID** —Ç–≤–æ–≥–æ Interactive Report region.

---

### –ö—Ä–æ–∫ 3.

–°—Ç–≤–æ—Ä–∏ **Ajax Callback process** —ñ–∑ –Ω–∞–∑–≤–æ—é `DELETE_EP`:

```plsql
BEGIN
    DELETE FROM external_personal
     WHERE id = TO_NUMBER(apex_application.g_x01);
END;
```

‚úÖ
–¶–µ–π –ø—Ä–æ—Ü–µ—Å –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `apex.server.process()` —ñ –≤–∏–¥–∞–ª—è—î –∑–∞–ø–∏—Å.

---

## üîπ 6Ô∏è‚É£ –†–µ–∑—é–º–µ (–≤—Å–µ —Ä–∞–∑–æ–º)

| –î—ñ—è            | –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è                    | –û—Å–æ–±–ª–∏–≤—ñ—Å—Ç—å                                         |
| -------------- | ----------------------------- | --------------------------------------------------- |
| ‚ûï –î–æ–¥–∞–≤–∞–Ω–Ω—è    | –ö–Ω–æ–ø–∫–∞ –Ω–∞ —Ñ–æ—Ä–º—ñ (–≤–∂–µ —î)       | –ó–∞–ø–∏—Å—É—î creator, date_create                        |
| ‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è | –ö–Ω–æ–ø–∫–∞ Edit ‚Üí Form Page       | –û–Ω–æ–≤–ª—é—î people_count, date_update, updator          |
| üóëÔ∏è –í–∏–¥–∞–ª–µ–Ω–Ω—è  | –ö–Ω–æ–ø–∫–∞ Delete ‚Üí AJAX Callback | –í–∏–∫–æ–Ω—É—î DELETE + refresh IR                         |
| üßæ –Ü—Å—Ç–æ—Ä—ñ—è     | Trigger `trg_ep_audit`        | –ó–±–µ—Ä—ñ–≥–∞—î —Å—Ç–∞—Ä—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ –∑–º—ñ–Ω–æ—é –∞–±–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º |

---

–•–æ—á–µ—à, —â–æ–± —è –ø—ñ–¥–≥–æ—Ç—É–≤–∞–≤ —à–∞–±–ª–æ–Ω —Å—Ç–æ—Ä—ñ–Ω–∫–∏ **Page 20 (Edit form)** –∑ –±–∞–∑–æ–≤–∏–º–∏ —Ä–µ–≥—ñ–æ–Ω–∞–º–∏, –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏ –π –ø—Ä–æ—Ü–µ—Å–æ–º, —â–æ–± —Ç–∏ –º—ñ–≥ –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –≤ APEX?
