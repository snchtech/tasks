–Ü–¥–µ–∞–ª—å–Ω–æ üëå
–ú–∏ –∑—Ä–æ–±–∏–º–æ —Ç–∞–∫, —â–æ–± `P_REPORT_DEPARTMENTS` –∑–∞–≤–∂–¥–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞–≤—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

* —è–∫—â–æ –π–æ–≥–æ **–ø–µ—Ä–µ–¥–∞–Ω–æ** —É URL ‚Üí –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ü–µ –∑–Ω–∞—á–µ–Ω–Ω—è;
* —è–∫—â–æ **–Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–±—Ä–∞—Ç–∏ –≤—Å—ñ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∏, —è–∫—ñ –º–∞—é—Ç—å –¥–∞–Ω—ñ –Ω–∞ –ø–æ—Ç–æ—á–Ω—É –¥–∞—Ç—É (`SYSDATE`) —É `EXTERNAL_PERSONAL`;
* —ñ –ø—Ä–∏ —Ü—å–æ–º—É –≤—Å—ñ —á–µ–∫–±–æ–∫—Å–∏ –º–∞—é—Ç—å –±—É—Ç–∏ **–≤—ñ–¥–º—ñ—á–µ–Ω—ñ**.

---

## üîπ –õ–æ–≥—ñ–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó

| –í–∏–ø–∞–¥–æ–∫                               | –î–∂–µ—Ä–µ–ª–æ –∑–Ω–∞—á–µ–Ω–Ω—è                                                  | –§–æ—Ä–º–∞—Ç –¥–ª—è —á–µ–∫–±–æ–∫—Å—ñ–≤ |
| ------------------------------------- | ----------------------------------------------------------------- | -------------------- |
| `P_REPORT_DEPARTMENTS` –ø–µ—Ä–µ–¥–∞–Ω–æ –≤ URL | –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø–µ—Ä–µ–¥–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è                                  | `1:2:3`              |
| `P_REPORT_DEPARTMENTS` –ø–æ—Ä–æ–∂–Ω—ñ–π       | –±—É–¥—É—î–º–æ —Å–ø–∏—Å–æ–∫ `department_id` –∑ `EXTERNAL_PERSONAL` –∑–∞ `SYSDATE` | `1:3:5`              |

---

## üîπ –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤ APEX

### üß© –ï—Ç–∞–ø 1. –°—Ç–≤–æ—Ä—é—î–º–æ –ø—Ä–æ—Ü–µ—Å (Before Header)

1. **Process Point:** *Before Header*
2. **Process Type:** PL/SQL Code
3. **Process Name:** `INIT_P_REPORT_DEPARTMENTS`

---

### üß† PL/SQL –∫–æ–¥:

```plsql
DECLARE
    v_departments VARCHAR2(4000);
BEGIN
    -- –Ø–∫—â–æ item –ø–µ—Ä–µ–¥–∞–Ω–æ (–Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ–π) ‚Äî –∑–∞–ª–∏—à–∞—î–º–æ –π–æ–≥–æ
    IF :P_REPORT_DEPARTMENTS IS NOT NULL THEN
        NULL; -- –Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏–º–æ, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–µ—Ä–µ–¥–∞–≤ –≤–ª–∞—Å–Ω–∏–π —Å–ø–∏—Å–æ–∫

    ELSE
        -- –Ø–∫—â–æ –ø–æ—Ä–æ–∂–Ω—ñ–π ‚Äî –≤–∏–±–∏—Ä–∞—î–º–æ –≤—Å—ñ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∏, —è–∫—ñ –º–∞—é—Ç—å –¥–∞–Ω—ñ —Å—å–æ–≥–æ–¥–Ω—ñ
        SELECT LISTAGG(DISTINCT ep.department_id, ':') 
               WITHIN GROUP (ORDER BY ep.department_id)
          INTO v_departments
          FROM external_personal ep
         WHERE TRUNC(ep.date_create) = TRUNC(SYSDATE)
           AND ep.date_end IS NULL;

        -- –Ø–∫—â–æ –∑–Ω–∞–π–¥–µ–Ω–æ ‚Äî –ø—Ä–∏–∑–Ω–∞—á–∞—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è item'—É
        IF v_departments IS NOT NULL THEN
            :P_REPORT_DEPARTMENTS := v_departments;
        END IF;
    END IF;
END;
```

---

### üß± –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–æ–±–æ—Ç–∏ –ø—Ä–æ—Ü–µ—Å—É

* –Ø–∫—â–æ —Ç–∏ –≤—ñ–¥–∫—Ä–∏—î—à —Å—Ç–æ—Ä—ñ–Ω–∫—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

  ```
  f?p=100:10:&SESSION.::NO::P_REPORT_DATE:06.10.2025
  ```

  ‚Üí `P_REPORT_DEPARTMENTS` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç—Ä–∏–º–∞—î –≤—Å—ñ ID –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ñ–≤, —è–∫—ñ –º–∞—é—Ç—å –∑–∞–ø–∏—Å–∏ –∑–∞ 6.10.2025.

* –Ø–∫—â–æ —Ç–∏ –≤—ñ–¥–∫—Ä–∏—î—à —Å—Ç–æ—Ä—ñ–Ω–∫—É –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º:

  ```
  f?p=100:10:&SESSION.::NO::P_REPORT_DEPARTMENTS:1:3:5
  ```

  ‚Üí `P_REPORT_DEPARTMENTS` –∑–∞–ª–∏—à–∏—Ç—å—Å—è —Ä—ñ–≤–Ω–∏–º `1:3:5`.

---

### üß© –ï—Ç–∞–ø 2. Checkbox Group (P_REPORT_DEPARTMENTS)

**LOV Query**:

```sql
SELECT d.name AS display_value,
       d.id   AS return_value
FROM   departments d
WHERE  d.id IN (
          SELECT DISTINCT ep.department_id
          FROM external_personal ep
          WHERE TRUNC(ep.date_create) = TRUNC(:P_REPORT_DATE)
            AND ep.date_end IS NULL
       )
ORDER BY d.name;
```

**Value Separator:** `:`
**Default:** –∑–Ω–∞—á–µ–Ω–Ω—è –≤–∂–µ –ø—ñ–¥—Å—Ç–∞–≤–ª–µ–Ω–µ —á–µ—Ä–µ–∑ –ø—Ä–æ—Ü–µ—Å `INIT_P_REPORT_DEPARTMENTS`.
**Display Extra Values:** *Yes*
**Display Null Value:** *No*

---

### üß© –ï—Ç–∞–ø 3. –í—ñ–¥–º—ñ—Ç–∫–∞ —á–µ–∫–±–æ–∫—Å—ñ–≤ –ø–æ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—é

Oracle APEX –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–º—ñ—á–∞—î –≤—Å—ñ —á–µ–∫–±–æ–∫—Å–∏, —è–∫—ñ –ø—Ä–∏—Å—É—Ç–Ω—ñ —É `:P_REPORT_DEPARTMENTS`
(–±–æ –≤—ñ–Ω –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π —Ä—è–¥–∫–æ–º `1:3:5`).

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—Ä–∏–º—É—Å–æ–≤–æ –≤–∏—Å—Ç–∞–≤–∏—Ç–∏ –≤—Å—ñ ‚Äî –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ –¥–∏–Ω–∞–º—ñ—á–Ω–æ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏:

```js
apex.jQuery("input[type=checkbox][name='P_REPORT_DEPARTMENTS']").prop('checked', true);
```

–∞–ª–µ –∑–∞–∑–≤–∏—á–∞–π —Ü–µ **–Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ**, –±–æ APEX —Å–∞–º —Ä–æ–∑–º—ñ—Ç–∏—Ç—å –≤–∏–±—Ä–∞–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è.

---

## ‚úÖ –ü—ñ–¥—Å—É–º–æ–∫

| –ï—Ç–∞–ø | –ú–µ—Ç–∞                                  | –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è                        |
| ---- | ------------------------------------- | --------------------------------- |
| 1    | –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `P_REPORT_DEPARTMENTS` | PL/SQL Before Header process      |
| 2    | LOV —Ç—ñ–ª—å–∫–∏ –∑ –∞–∫—Ç—É–∞–ª—å–Ω–∏—Ö –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ñ–≤ | SQL –Ω–∞ –æ—Å–Ω–æ–≤—ñ `EXTERNAL_PERSONAL` |
| 3    | –í—ñ–¥–º—ñ—Ç–∏—Ç–∏ —á–µ–∫–±–æ–∫—Å–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º   | –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ –∑–Ω–∞—á–µ–Ω–Ω—è item‚Äô—É |

---

–•–æ—á–µ—à, —â–æ–± —è –ø–æ–∫–∞–∑–∞–≤, —è–∫ –∑—Ä–æ–±–∏—Ç–∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–≤—ñ—Ç—ñ–≤** –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ `P_REPORT_DEPARTMENTS` –∑–∞–ø–æ–≤–Ω–∏—Ç—å—Å—è (–±–µ–∑ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏)?
