–°—É–ø–µ—Ä üëç
–¢–æ–¥—ñ –ø—ñ–¥–≥–æ—Ç—É—î–º–æ –≥–æ—Ç–æ–≤–µ **SQL View** –¥–ª—è —Ç–≤–æ–≥–æ –∑–≤—ñ—Ç—É. –¶–µ –¥–æ–∑–≤–æ–ª–∏—Ç—å –≤ APEX –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ IR –Ω–∞–ø—Ä—è–º—É –¥–æ —Ü—å–æ–≥–æ View, —ñ –≤—Å–µ –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –≥—Ä—É–ø–∞–º–∏ —Ç–∞ —Ä—è–¥–∫–æ–º **Total**.

---

## üîπ SQL View

```sql
CREATE OR REPLACE VIEW v_external_personal_report AS
WITH base_data AS (
    SELECT ct.id          AS company_type_id,
           ct.name        AS company_type_name,
           c.id           AS company_id,
           c.name         AS company_name,
           NVL(wt.name, ep.work_type_text) AS work_type_name,
           u.id           AS unit_id,
           u.name         AS unit_name,
           ep.people_count,
           ep.date_create,
           ep.creator,
           0 AS is_total
    FROM   external_personal ep
    JOIN   company c       ON c.id = ep.company_id
    JOIN   company_type ct ON ct.id = c.company_type_id
    LEFT JOIN work_type wt ON wt.id = ep.work_type_id
    LEFT JOIN units u      ON u.id = ep.unit_id
    WHERE  ep.date_end IS NULL
),
totals AS (
    SELECT ct.id          AS company_type_id,
           ct.name        AS company_type_name,
           NULL           AS company_id,
           'Total'        AS company_name,
           NULL           AS work_type_name,
           NULL           AS unit_id,
           NULL           AS unit_name,
           SUM(ep.people_count) AS people_count,
           NULL           AS date_create,
           NULL           AS creator,
           1 AS is_total
    FROM   external_personal ep
    JOIN   company c       ON c.id = ep.company_id
    JOIN   company_type ct ON ct.id = c.company_type_id
    WHERE  ep.date_end IS NULL
    GROUP BY ct.id, ct.name
)
SELECT * FROM base_data
UNION ALL
SELECT * FROM totals;
```

---

## üîπ –©–æ —Ä–æ–±–∏—Ç—å —Ü–µ–π View

* **`base_data`** ‚Üí —É—Å—ñ –∑–≤–∏—á–∞–π–Ω—ñ –∑–∞–ø–∏—Å–∏.
* **`totals`** ‚Üí –¥–æ–¥–∞—î –æ–¥–∏–Ω —Ä—è–¥–æ–∫ `Total` –¥–ª—è –∫–æ–∂–Ω–æ—ó –≥—Ä—É–ø–∏ `COMPANY_TYPE`.
* –ü–æ–ª–µ `IS_TOTAL`:

  * `0` ‚Üí –∑–≤–∏—á–∞–π–Ω–∏–π —Ä—è–¥–æ–∫;
  * `1` ‚Üí –ø—ñ–¥—Å—É–º–∫–æ–≤–∏–π —Ä—è–¥–æ–∫ (–¥–ª—è highlight —É APEX).

---

## üîπ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤ APEX

1. –°—Ç–≤–æ—Ä—é—î—à **Interactive Report** –Ω–∞ –æ—Å–Ω–æ–≤—ñ `v_external_personal_report`.
2. –£ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—è—Ö ‚Üí **Group By** ‚Üí `COMPANY_TYPE_NAME`.
3. –î–æ–¥–∞—î—à **Highlight**:

   * Condition: `IS_TOTAL = 1`
   * Background: –∑–µ–ª–µ–Ω–∏–π (`#d4edda`).
4. –•–æ–≤–∞—î—à –∫–æ–ª–æ–Ω–∫—É `IS_TOTAL` –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

---

## üîπ –ü—Ä–∏–∫–ª–∞–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É

```
COMPANY_TYPE_NAME: –î–µ—Ä–∂–∞–≤–Ω—ñ –∫–æ–º–ø–∞–Ω—ñ—ó
------------------------------------------------------------
Company name     | Work type       | Unit     | People | ...
------------------------------------------------------------
–£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è     | –ú–æ–Ω—Ç–∞–∂          | –ö–∏—ó–≤     |   12   | ...
–£–∫—Ä–ø–æ—à—Ç–∞         | –†–µ–º–æ–Ω—Ç          | –õ—å–≤—ñ–≤    |    8   | ...
Total            |                 |          |   20   |

COMPANY_TYPE_NAME: –ü—Ä–∏–≤–∞—Ç–Ω—ñ –∫–æ–º–ø–∞–Ω—ñ—ó
------------------------------------------------------------
Company name     | Work type       | Unit     | People | ...
------------------------------------------------------------
SoftServe        | IT-–ø—ñ–¥—Ç—Ä–∏–º–∫–∞    | –õ—å–≤—ñ–≤    |   15   | ...
–ù–æ–≤–∞ –ø–æ—à—Ç–∞       | –õ–æ–≥—ñ—Å—Ç–∏–∫–∞       | –ö–∏—ó–≤     |   10   | ...
Total            |                 |          |   25   |
```

---

üìå –¢–∞–∫–∏–º —á–∏–Ω–æ–º, —Ç–∏ –æ–¥—Ä–∞–∑—É –æ—Ç—Ä–∏–º—É—î—à –∑–≥—Ä—É–ø–æ–≤–∞–Ω–∏–π –∑–≤—ñ—Ç –∑ –ø—ñ–¥—Å—É–º–∫–∞–º–∏ —ñ –∑–µ–ª–µ–Ω–∏–º —Ä—è–¥–∫–æ–º **Total**.

–•–æ—á–µ—à, —è —â–µ –Ω–∞–ø–∏—à—É CSS –¥–ª—è IR, —â–æ–± —Ä—è–¥–æ–∫ `Total` –±—É–≤ –±—ñ–ª—å—à –≤–∏–¥—ñ–ª–µ–Ω–∏–π (–∂–∏—Ä–Ω–∏–π —à—Ä–∏—Ñ—Ç + –∑–µ–ª–µ–Ω–∏–π —Ñ–æ–Ω)?
