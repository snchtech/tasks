–ü—Ä–µ–∫—Ä–∞—Å–Ω–æ üëå
–¶–µ–π **—Ç—Ä–µ—Ç—ñ–π –∑–≤—ñ—Ç** ‚Äî –Ω–∞–π–¥–µ—Ç–∞–ª—å–Ω—ñ—à–∏–π: –≤—ñ–Ω –º–∞—î –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ *–≤—Å—ñ –∑–∞–ø–∏—Å–∏* –ø–æ –≤–∏–∫–æ–Ω–∞–≤—Ü—è—Ö —ñ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∞—Ö, –∞–ª–µ —Ç–∞–∫–æ–∂ –º—ñ—Å—Ç–∏—Ç–∏ —Ä—è–¥–æ–∫ **¬´–í—Å—å–æ–≥–æ¬ª** –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É (–∞–Ω–∞–ª–æ–≥—ñ—á–Ω–æ –¥–æ –¥—Ä—É–≥–æ–≥–æ –∑–≤—ñ—Ç—É).
–¢—É—Ç –¥–æ–¥–∞—é—Ç—å—Å—è –ø–æ–ª—è **–¥–∞—Ç–∞+—á–∞—Å –¥–æ–¥–∞–≤–∞–Ω–Ω—è** —ñ **–∞–≤—Ç–æ—Ä –ø–æ–¥–∞–Ω–Ω—è**.

---

## üîπ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–≤—ñ—Ç—É

### –ö–æ–ª–æ–Ω–∫–∏:

| –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å (company_name) | –ü—ñ–¥—Ä–æ–∑–¥—ñ–ª (unit_name) | –ö-—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—É (people_count) | –î–∞—Ç–∞/—á–∞—Å (date_create) | –•—Ç–æ –ø–æ–¥–∞–≤ (creator) | Unit (unit_id) |

* **–ì—Ä—É–ø—É–≤–∞–Ω–Ω—è:** –∑–∞ `unit_name`
* **–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è:** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ ‚Äî –∑–∞ `company_type_name`, –ø–æ—Ç—ñ–º `company_name`
* **–ü—ñ–¥—Å—É–º–æ–∫:** –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ `unit_name` ‚Äî —Ä—è–¥–æ–∫ ‚Äú–í—Å—å–æ–≥–æ‚Äù

---

## üîπ SQL-–∑–∞–ø–∏—Ç (—á–µ—Ä–µ–∑ `UNION ALL`)

```sql
WITH base_data AS (
    SELECT 
        u.id              AS unit_id,
        u.name            AS unit_name,
        ct.id             AS company_type_id,
        ct.name           AS company_type_name,
        c.id              AS company_id,
        c.name            AS company_name,
        ep.people_count,
        ep.date_create,
        ep.creator,
        0 AS is_total
    FROM 
        external_personal ep
        JOIN company c       ON c.id = ep.company_id
        JOIN company_type ct ON ct.id = c.company_type_id
        JOIN units u         ON u.id = ep.unit_id
    WHERE 
        TRUNC(ep.date_create) = TRUNC(:P_REPORT_DATE)
        AND ep.department_id IN (
            SELECT TO_NUMBER(column_value)
            FROM TABLE(apex_string.split(:P_REPORT_DEPARTMENTS, ':'))
        )
        AND ep.date_end IS NULL
),
totals AS (
    SELECT 
        u.id              AS unit_id,
        u.name            AS unit_name,
        NULL              AS company_type_id,
        NULL              AS company_type_name,
        NULL              AS company_id,
        '–í—Å—å–æ–≥–æ'          AS company_name,
        SUM(ep.people_count) AS people_count,
        NULL              AS date_create,
        NULL              AS creator,
        1 AS is_total
    FROM 
        external_personal ep
        JOIN company c ON c.id = ep.company_id
        JOIN units u   ON u.id = ep.unit_id
    WHERE 
        TRUNC(ep.date_create) = TRUNC(:P_REPORT_DATE)
        AND ep.department_id IN (
            SELECT TO_NUMBER(column_value)
            FROM TABLE(apex_string.split(:P_REPORT_DEPARTMENTS, ':'))
        )
        AND ep.date_end IS NULL
    GROUP BY 
        u.id, u.name
)
SELECT * FROM base_data
UNION ALL
SELECT * FROM totals
ORDER BY unit_name, is_total, company_type_name, company_name;
```

---

## üîπ –ü–æ—è—Å–Ω–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏

* **base_data** ‚Äî —É—Å—ñ –∑–≤–∏—á–∞–π–Ω—ñ –∑–∞–ø–∏—Å–∏ –∑ `external_personal`.

  * –ú–∞—î –ø–æ–≤–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é: –∫–æ–º–ø–∞–Ω—ñ—è, –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª, –¥–∞—Ç–∞, –∞–≤—Ç–æ—Ä, –∫-—Å—Ç—å.
* **totals** ‚Äî –¥–æ–¥–∞—î –æ–¥–∏–Ω —Ä—è–¥–æ–∫ ‚Äú–í—Å—å–æ–≥–æ‚Äù –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ `unit_name`, –¥–µ —Å—É–º—É—é—Ç—å—Å—è `people_count`.
* **IS_TOTAL** = `1` –¥–ª—è –ø—ñ–¥—Å—É–º–∫–æ–≤–∏—Ö —Ä—è–¥–∫—ñ–≤ (—â–æ–± –≤–∏–¥—ñ–ª–∏—Ç–∏ —ó—Ö –∫–æ–ª—å–æ—Ä–æ–º —É –∑–≤—ñ—Ç—ñ).

---

## üîπ –†–µ–∑—É–ª—å—Ç–∞—Ç —É –∑–≤—ñ—Ç—ñ (–ø—Ä–∏–∫–ª–∞–¥)

```
–ü—ñ–¥—Ä–æ–∑–¥—ñ–ª: –ö–∏—ó–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å
---------------------------------------------------------------------------
–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å       | –ü—ñ–¥—Ä–æ–∑–¥—ñ–ª       | –ö-—Å—Ç—å | –î–∞—Ç–∞/—á–∞—Å          | –•—Ç–æ –ø–æ–¥–∞–≤     | Unit
---------------------------------------------------------------------------
–£–∫—Ä–ø–æ—à—Ç–∞         | –ö–∏—ó–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å  | 12    | 06.10.2025 09:12  | ivanov_i      | 101
–£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è     | –ö–∏—ó–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å  | 8     | 06.10.2025 09:35  | petrenko_o    | 101
–ù–æ–≤–∞ –ø–æ—à—Ç–∞       | –ö–∏—ó–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å  | 10    | 06.10.2025 09:40  | ivanov_i      | 101
SoftServe        | –ö–∏—ó–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å  | 5     | 06.10.2025 09:55  | shevchuk_v    | 101
---------------------------------------------------------------------------
–í—Å—å–æ–≥–æ           | –ö–∏—ó–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å  | 35    |                   |               | 101 ‚úÖ –∑–µ–ª–µ–Ω–∏–º

–ü—ñ–¥—Ä–æ–∑–¥—ñ–ª: –õ—å–≤—ñ–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å
---------------------------------------------------------------------------
–£–∫—Ä–ø–æ—à—Ç–∞         | –õ—å–≤—ñ–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å | 9     | 06.10.2025 09:05  | kovalenko_i   | 202
–£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è     | –õ—å–≤—ñ–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å | 6     | 06.10.2025 09:12  | ivanov_i      | 202
–ù–æ–≤–∞ –ø–æ—à—Ç–∞       | –õ—å–≤—ñ–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å | 7     | 06.10.2025 09:25  | petrenko_o    | 202
SoftServe        | –õ—å–≤—ñ–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å | 4     | 06.10.2025 09:45  | shevchuk_v    | 202
---------------------------------------------------------------------------
–í—Å—å–æ–≥–æ           | –õ—å–≤—ñ–≤—Å—å–∫–∏–π –æ—Ñ—ñ—Å | 26    |                   |               | 202 ‚úÖ –∑–µ–ª–µ–Ω–∏–º
```

---

## üîπ –Ø–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —É APEX

### 1Ô∏è‚É£ –°—Ç–≤–æ—Ä—é—î—à Region ‚Üí **Interactive Report / Classic Report**

* SQL Source = –∫–æ–¥ –≤–∏—â–µ.
* –§—ñ–ª—å—Ç—Ä–∏ ‚Äî —Ç—ñ –∂:

  * `P_REPORT_DATE`
  * `P_REPORT_DEPARTMENTS`
* –£ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—è—Ö:

  * –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è = `UNIT_NAME`
  * –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è = `COMPANY_TYPE_NAME`, `COMPANY_NAME`.

---

### 2Ô∏è‚É£ –î–æ–¥–∞—î—à **Highlight Rule**

* **Condition:** `IS_TOTAL = 1`
* **Style:**

  ```css
  background-color: #d4edda !important;
  color: #155724 !important;
  font-weight: bold;
  border-top: 2px solid #b7e4c7;
  ```

---

### 3Ô∏è‚É£ Dynamic Actions

* On Change ‚Üí `P_REPORT_DATE` –∞–±–æ `P_REPORT_DEPARTMENTS`
  ‚Üí **Refresh Region [Report_3]**

---

### 4Ô∏è‚É£ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

* –ú–æ–∂–µ—à —Å—Ç–≤–æ—Ä–∏—Ç–∏ **VIEW** `V_EXTERNAL_PERSONAL_FULL` –∑–∞ —Ü–∏–º SQL, —è–∫—â–æ –ø–ª–∞–Ω—É—î—à –¥–æ–¥–∞–≤–∞—Ç–∏ —Ç–∏–ø–∏ —Ä–æ–±—ñ—Ç –∞–±–æ —Å—Ç–∞—Ç—É—Å–∏ –ø—ñ–∑–Ω—ñ—à–µ.
* –Ø–∫—â–æ –¥–∞–Ω–∏—Ö –±–∞–≥–∞—Ç–æ, –¥–æ–¥–∞–π —ñ–Ω–¥–µ–∫—Å–∏ –Ω–∞ `date_create`, `department_id`, `unit_id`.

---

–•–æ—á–µ—à, —â–æ–± —è –æ–¥—Ä–∞–∑—É —Ä–æ–∑—à–∏—Ä–∏–≤ —Ü–µ–π –∑–≤—ñ—Ç (–Ω–∞—Å—Ç—É–ø–Ω–∏–º –∫—Ä–æ–∫–æ–º) ‚Äî –¥–æ–¥–∞–≤ —É –Ω—å–æ–≥–æ —Ç–∏–ø —Ä–æ–±—ñ—Ç (`WORK_TYPE_NAME` –∞–±–æ `WORK_TYPE_TEXT`) —ñ –ø—ñ–¥—Å—É–º–∫–∏ —Ç–∞–∫–æ–∂ –ø–æ –∫–æ–∂–Ω–æ–º—É —Ç–∏–ø—É —Ä–æ–±—ñ—Ç —É—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É?
