–ß—É–¥–æ–≤–æ üëç
–î–∞–≤–∞–π —è —Å–∫–ª–∞–¥—É –¥–ª—è —Ç–µ–±–µ **–ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ü–µ–ø—Ç —Å—Ç–æ—Ä—ñ–Ω–∫–∏ APEX** (–ª—ñ–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ ‚Äî —Ñ–æ—Ä–º–∞, –ø—Ä–∞–≤–∞ ‚Äî –∑–≤—ñ—Ç –∑ –≥—Ä—É–ø–∞–º–∏ —ñ —Ç–æ—Ç–∞–ª–æ–º).

---

# üîπ 1. **–§–æ—Ä–º–∞ (–ª—ñ–≤–∞ —á–∞—Å—Ç–∏–Ω–∞, Sidebar region)**

### –ü–æ–ª—è:

1. **Company (Popup LOV –∑ –≥—Ä—É–ø–∞–º–∏)**
   SQL –¥–ª—è LOV (–∑ –≥—Ä—É–ø–∞–º–∏ –ø–æ `COMPANY_TYPE`):

   ```sql
   SELECT c.name              AS display_value,
          c.id                AS return_value,
          ct.name             AS group_label,
          ct.id               AS group_order
   FROM   company c
   JOIN   company_type ct ON ct.id = c.company_type_id
   WHERE  c.date_end IS NULL
     AND  ct.date_end IS NULL
   ORDER BY ct.id, c.name
   ```

   üëâ `group_label` = –Ω–∞–∑–≤–∞ –≥—Ä—É–ø–∏ (Company_type.name).
   üëâ –ø–æ—Ä—è–¥–æ–∫ –≥—Ä—É–ø –∫–æ–Ω—Ç—Ä–æ–ª—é—î—Ç—å—Å—è `ORDER BY ct.id`.

---

2. **Unit (Select LOV)**

   ```sql
   SELECT u.name AS display_value,
          u.id   AS return_value
   FROM   units u
   WHERE  u.date_end IS NULL
   ORDER BY u.name
   ```

---

3. **Work type (Popup LOV, —Ñ—ñ–ª—å—Ç—Ä –ø–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—É)**
   (–¥–µ `:P0_DEPARTMENT_ID` = –ø–æ—Ç–æ—á–Ω–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É item)

   ```sql
   SELECT wt.name AS display_value,
          wt.id   AS return_value
   FROM   work_type wt
   WHERE  wt.department_id = :P0_DEPARTMENT_ID
     AND  wt.date_end IS NULL
   ORDER BY wt.name
   ```

---

4. **Work type text (Textarea)**
   ‚Äî –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥—É.

   üëâ –¶—ñ –¥–≤–∞ –ø–æ–ª—è (`WORK_TYPE_ID`, `WORK_TYPE_TEXT`) –∫—Ä–∞—â–µ –≤–∏–Ω–µ—Å—Ç–∏ –≤ –æ–¥–∏–Ω —Ä–µ–≥—ñ–æ–Ω –∑ CSS-–æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è–º:

   ```css
   .work-type-block {
     background: #f4f9f4;      /* —Å–≤—ñ—Ç–ª–∏–π –∑–µ–ª–µ–Ω–æ-—Å—ñ—Ä–∏–π —Ñ–æ–Ω */
     border: 1px solid #bcd9bc;
     border-radius: 8px;
     padding: 10px;
     margin-top: 8px;
   }
   ```

---

5. **People count (Number item)**
   Validation: `>=1`.

---

6. **Button "–î–æ–¥–∞—Ç–∏"**
   –ü—Ä–æ—Ü–µ—Å PL/SQL –¥–ª—è –∑–∞–ø–∏—Å—É –≤ `EXTERNAL_PERSONAL`:

   ```plsql
   BEGIN
       INSERT INTO external_personal (
           department_id,
           unit_id,
           work_type_id,
           work_type_text,
           people_count,
           company_id,
           date_create,
           creator,
           date_end
       ) VALUES (
           :P0_DEPARTMENT_ID,
           :P1_UNIT_ID,
           :P1_WORK_TYPE_ID,
           :P1_WORK_TYPE_TEXT,
           :P1_PEOPLE_COUNT,
           :P1_COMPANY_ID,
           SYSDATE,
           :APP_USER,
           NULL
       );
   END;
   ```

   üëâ –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ ‚Äî **Dynamic Action ‚Üí Refresh** –¥–ª—è IR (–ø—Ä–∞–≤–æ—Ä—É—á).

---

# üîπ 2. **IR Report (–ø—Ä–∞–≤–∞ —á–∞—Å—Ç–∏–Ω–∞)**

### SQL –¥–ª—è IR:

```sql
SELECT ct.name        AS company_type_name,
       c.name         AS company_name,
       NVL(wt.name, ep.work_type_text) AS work_type_name,
       u.name         AS unit_name,
       ep.people_count,
       ep.date_create,
       ep.creator
FROM   external_personal ep
JOIN   company c       ON c.id = ep.company_id
JOIN   company_type ct ON ct.id = c.company_type_id
LEFT JOIN work_type wt ON wt.id = ep.work_type_id
LEFT JOIN units u      ON u.id = ep.unit_id
WHERE  ep.date_end IS NULL
ORDER BY ct.id, c.name;
```

---

### –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –≤ IR

* –£ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—è—Ö Interactive Report:

  * **Group By** = `COMPANY_TYPE_NAME`.
  * –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≥—Ä—É–ø = `COMPANY_TYPE.NAME`.

---

### –ü—ñ–¥—Å—É–º–∫–æ–≤–∏–π —Ä—è–¥–æ–∫ "Total" (–∑–µ–ª–µ–Ω–∏–π)

APEX –¥–æ–∑–≤–æ–ª—è—î **Aggregate ‚Üí SUM** –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ `PEOPLE_COUNT`.
–ê–ª–µ —â–æ–± –±—É–ª–æ **–æ–∫—Ä–µ–º–∏–º —Ä—è–¥–∫–æ–º `Total`**, –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ UNION:

```sql
SELECT ct.name        AS company_type_name,
       c.name         AS company_name,
       NVL(wt.name, ep.work_type_text) AS work_type_name,
       u.name         AS unit_name,
       ep.people_count,
       ep.date_create,
       ep.creator,
       0 AS is_total
FROM   external_personal ep
JOIN   company c       ON c.id = ep.company_id
JOIN   company_type ct ON ct.id = c.company_type_id
LEFT JOIN work_type wt ON wt.id = ep.work_type_id
LEFT JOIN units u      ON u.id = ep.unit_id
WHERE  ep.date_end IS NULL

UNION ALL

SELECT ct.name        AS company_type_name,
       'Total'        AS company_name,
       NULL           AS work_type_name,
       NULL           AS unit_name,
       SUM(ep.people_count) AS people_count,
       NULL           AS date_create,
       NULL           AS creator,
       1 AS is_total
FROM   external_personal ep
JOIN   company c       ON c.id = ep.company_id
JOIN   company_type ct ON ct.id = c.company_type_id
WHERE  ep.date_end IS NULL
GROUP BY ct.name;
```

---

### –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è "Total" –∑–µ–ª–µ–Ω–∏–º

* –£ IR –¥–æ–¥–∞—Ç–∏ **Highlight**:

  * Condition: `IS_TOTAL = 1`.
  * Background color: `#d4edda` (–∑–µ–ª–µ–Ω–∏–π).

---

# üîπ 3. –ú–∞–∫–µ—Ç —Å—Ç–æ—Ä—ñ–Ω–∫–∏

```
--------------------------------------------------------
| Sidebar (–∑–ª—ñ–≤–∞)             |  IR Report (—Å–ø—Ä–∞–≤–∞)   |
|------------------------------|-----------------------|
| Company (LOV –≥—Ä—É–ø–∞–º–∏)        |  Group: Company_type  |
| Unit (select)                |   - Company name      |
|------------------------------|   - Work type name    |
| [ WorkType select + text ]   |   - People count      |
| (—Ñ–æ–Ω —Å—ñ—Ä–∏–π)                  |   - Date create       |
|------------------------------|   - Creator           |
| People_count (number)        |                       |
| [Button –î–æ–¥–∞—Ç–∏]              |                       |
--------------------------------------------------------
```

---

–•–æ—á–µ—à, —è —Å–∫–ª–∞–¥—É –≥–æ—Ç–æ–≤–∏–π **SQL View** –¥–ª—è –∑–≤—ñ—Ç—É (–∑ –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è–º Total), —â–æ–± —Ç–æ–±—ñ –±—É–ª–æ –∑—Ä—É—á–Ω–æ –æ–¥—Ä–∞–∑—É –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ –¥–æ IR?
