–ö–ª–∞—Å–Ω–∞ –∑–∞–¥—É–º–∫–∞, —Ü–µ –¥—É–∂–µ ‚Äú—é–∑–µ—Ä-—Ñ—Ä–µ–Ω–¥–ª—ñ‚Äù —Ñ—ñ–ª—å—Ç—Ä üëå
–î–∞–≤–∞–π –∑—Ä–æ–±–∏–º–æ —Ü–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∞–∫—É—Ä–∞—Ç–Ω–æ –π –ø–æ-–∫—Ä–æ–∫–∞—Ö.

### –ó–∞–≥–∞–ª—å–Ω–∞ —ñ–¥–µ—è

* –Ñ –≥–æ–ª–æ–≤–Ω–∏–π –∑–≤—ñ—Ç –∂—É—Ä–Ω–∞–ª—É (SQL –∑ —É—Å—ñ–º–∞ –Ω–∞—à–∏–º–∏ CTE).
* –Ø–∫—â–æ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î access level = 1**, –Ω–∞–¥ –∑–≤—ñ—Ç–æ–º –ø–æ–∫–∞–∑—É—î–º–æ **Checkbox Group** –∑ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∞–º–∏.
* –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: **—É—Å—ñ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∏, —è–∫—ñ —î –≤ –∑–≤—ñ—Ç—ñ, –≤–∏–±—Ä–∞–Ω—ñ, –∫—Ä—ñ–º ID = 65**.
* –ü—Ä–∏ –∑–º—ñ–Ω—ñ —á–µ–∫–±–æ–∫—Å—ñ–≤ ‚Äì **—Ä–µ—Ñ—Ä–µ—à–∏–º–æ –∑–≤—ñ—Ç**, –≤—ñ–Ω —Ñ—ñ–ª—å—Ç—Ä—É—î—Ç—å—Å—è –ø–æ `DEPARTMENT_ID`.

---

## 1. –ü—ñ–¥–≥–æ—Ç—É—î–º–æ –¥–∞–Ω—ñ: –ø–æ—Ç—Ä—ñ–±–µ–Ω `DEPARTMENT_ID` —É –≥–æ–ª–æ–≤–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ

–£ —Ç–≤–æ—î–º—É –≤–µ–ª–∏–∫–æ–º—É –∑–∞–ø–∏—Ç—ñ –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `DEPARTMENT_NAME`. –î–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–µ–Ω **id**.
–î–æ–¥–∞–π —É `tasks_with_access` —ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –≤ `base_tasks`:

```sql
tasks_with_access AS (
  SELECT DISTINCT
    t.*,
    s.status_main_id,
    t.department_id,          -- ‚Üê —è–∫—â–æ —â–µ –Ω–µ –±—É–ª–æ
    ...
),

base_tasks AS (
  SELECT
    t.task_id,
    ...
    t.department_id,
    t.department_name,
    ...
  FROM tasks_with_access t
  LEFT JOIN viewed_agg v ON v.task_id = t.task_id
),
```

–Ü –≤ —Å–∞–º–æ–º—É —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É SELECT:

```sql
SELECT
  task_id,
  ...
  department_name,
  department_id,
  ...
FROM (
  SELECT * FROM planned_tab
  UNION ALL
  ...
)
WHERE (
  :P1_DEPT_FILTER IS NULL
  OR department_id IN (
        SELECT TO_NUMBER(column_value)
        FROM TABLE(apex_string.split(:P1_DEPT_FILTER, ':'))
     )
)
ORDER BY date_create DESC;
```

> üîπ –Ø–∫—â–æ —É —Ç–µ–±–µ —Å—Ç–∞—Ä–∞ –≤–µ—Ä—Å—ñ—è APEX –±–µ–∑ `apex_string.split`, –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ `apex_util.string_to_table`.

---

## 2. –°—Ç–≤–æ—Ä—é—î–º–æ Checkbox Group item –¥–ª—è –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—ñ–≤

### 2.1. Item

1. –ù–∞ —Ü—ñ–π –∂–µ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ (–¥–µ —Ç–≤—ñ–π –∂—É—Ä–Ω–∞–ª) —Å—Ç–≤–æ—Ä–∏ **Page Item**:

   * Name: `P1_DEPT_FILTER`
   * Type: **Checkbox Group**
   * Location: Region –Ω–∞–¥ –∑–≤—ñ—Ç–æ–º (–∞–±–æ –≤ —Ç–æ–º—É –∂ —Ä–µ–≥—ñ–æ–Ω—ñ –≤ –ø–æ–∑–∏—Ü—ñ—ó ‚ÄúAbove Report‚Äù).

2. **List of Values** ‚Üí Type: `SQL Query`
   –ü—Ä–∏–∫–ª–∞–¥ LOV (–±–µ—Ä–µ–º–æ –≤—Å—ñ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∏, —â–æ —Ä–µ–∞–ª—å–Ω–æ —î –≤ –∑–≤—ñ—Ç—ñ):

   ```sql
   SELECT DISTINCT
          b.department_name AS display_value,
          b.department_id   AS return_value
   FROM base_tasks b
   ORDER BY b.department_name
   ```

   –Ø–∫—â–æ `base_tasks` —è–∫ CTE –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞–ø—Ä—è–º—É –≤ LOV, –º–æ–∂–Ω–∞ –≤–∑—è—Ç–∏ –∑ –¥–∂–µ—Ä–µ–ª–∞ –¥–∞–Ω–∏—Ö, –Ω–∞ —è–∫–æ–º—É –±–∞–∑—É—î—Ç—å—Å—è –∑–≤—ñ—Ç (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `V_TASKS_FULL`):

   ```sql
   SELECT DISTINCT
          t.department_name AS display_value,
          t.department_id   AS return_value
   FROM V_TASKS_FULL t
   ORDER BY t.department_name
   ```

---

## 3. Default value: —É—Å—ñ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∏, –∫—Ä—ñ–º ID = 65

–©–æ–± –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –±—É–ª–∏ –≤–∏–±—Ä–∞–Ω—ñ **–≤—Å—ñ**, –∫—Ä—ñ–º `65`, —É `P1_DEPT_FILTER` —Å—Ç–∞–≤–∏–º–æ **Default** —Ç–∏–ø—É `SQL Query`:

```sql
SELECT LISTAGG(department_id, ':') WITHIN GROUP (ORDER BY department_id)
FROM (
  SELECT DISTINCT t.department_id
  FROM V_TASKS_FULL t
  WHERE t.department_id <> 65
)
```

* **Type**: SQL Query (return value must be VARCHAR2)
* –¶–µ –∑–±–µ—Ä–µ `1:2:3:10:...` ‚Äì —Ñ–æ—Ä–º–∞—Ç, —è–∫–∏–π checkbox group —Ä–æ–∑—É–º—ñ—î.

> –Ø–∫—â–æ –≤ —Ç–µ–±–µ —Å–≤—ñ–π view/—Ç–∞–±–ª–∏—Ü—è –∑ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∞–º–∏, –≤—ñ–¥ —è–∫–æ—ó –∑–∞–ª–µ–∂–∏—Ç—å –∑–≤—ñ—Ç ‚Äì –º–æ–∂–µ—à –≤–∑—è—Ç–∏ `DICT_DEPARTMENT` –∞–±–æ —ñ–Ω—à—É —Ç–∞–±–ª–∏—Ü—é, –≥–æ–ª–æ–≤–Ω–µ, —â–æ–± –∑–±—ñ–≥–∞–ª–∏—Å—è `department_id`.

---

## 4. –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ Checkbox Group —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ access level = 1

–¢—É—Ç —î –¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏, –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–æ–≥–æ, —è–∫ —Ç–∏ –∑–Ω–∞—î—à —Ä—ñ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

### –í–∞—Ä—ñ–∞–Ω—Ç –ê. –£ —Ç–µ–±–µ —î item / –∑–º—ñ–Ω–Ω–∞ –∑ access level

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, `:P0_ACCESS_LEVEL` –∞–±–æ `:PO_CUR_ACCESS_LEVEL`.
–¢–æ–¥—ñ –Ω–∞ item `P1_DEPT_FILTER` —Å—Ç–∞–≤–∏—à **Condition**:

* Type: **Value of Item in Expression 1 = Expression 2**
* Expression 1: `P0_ACCESS_LEVEL`
* Expression 2: `1`

–ê–±–æ:

* Type: **PL/SQL Expression**
* Expression: `:P0_ACCESS_LEVEL = 1`

### –í–∞—Ä—ñ–∞–Ω—Ç –ë. –ü–æ—Ä–∞—Ö—É–≤–∞—Ç–∏ access level –≤ APEX

–Ø–∫—â–æ access level –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è —Ñ—É–Ω–∫—Ü—ñ—î—é (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `task_security.get_access_level(:APP_USER)`), —Å—Ç–≤–æ—Ä—é—î—à **hidden item** `P1_ACCESS_LEVEL`:

* Source Type: `SQL Query` / `PL/SQL Expression`
* –ù–∞–ø—Ä–∏–∫–ª–∞–¥:

  ```sql
  SELECT task_security.get_access_level(:APP_USER) FROM dual
  ```

–Ü –¥–ª—è `P1_DEPT_FILTER` —Å—Ç–∞–≤–∏—à —É–º–æ–≤—É –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è: `:P1_ACCESS_LEVEL = 1`.

---

## 5. –ó–≤‚Äô—è–∑–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä –∑ –æ—Å–Ω–æ–≤–Ω–∏–º –∑–≤—ñ—Ç–æ–º

–ú–∏ –≤–∂–µ –¥–æ–¥–∞–ª–∏ —É —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π SELECT:

```sql
WHERE (
  :P1_DEPT_FILTER IS NULL
  OR department_id IN (
        SELECT TO_NUMBER(column_value)
        FROM TABLE(apex_string.split(:P1_DEPT_FILTER, ':'))
     )
)
```

–¶—å–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ, —â–æ–±:

* –ø—Ä–∏ –∑–º—ñ–Ω—ñ `P1_DEPT_FILTER` –∑–º—ñ–Ω—é–≤–∞–ª–∞—Å—å —Å–µ—Å—ñ–π–Ω–∞ –∑–º—ñ–Ω–Ω–∞,
* —ñ –ø—Ä–∏ —Ä–µ—Ñ—Ä–µ—à—ñ —Ä–µ–≥—ñ–æ–Ω—É ‚Äì –∑–≤—ñ—Ç –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞–≤—Å—è.

---

## 6. Dynamic Action –Ω–∞ –∑–º—ñ–Ω—É checkbox‚Äô—ñ–≤

–©–æ–± –Ω–µ —Ä–æ–±–∏—Ç–∏ Submit —Å—Ç–æ—Ä—ñ–Ω–∫–∏, –∞ –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç–∏ –∑–≤—ñ—Ç:

1. –°—Ç–≤–æ—Ä–∏ **Dynamic Action**:

   * Event: `Change`
   * Selection Type: `Item(s)`
   * Item(s): `P1_DEPT_FILTER`

2. True Action:

   * Action: **Refresh**
   * Affected Elements: —Ç–≤–æ—ó–π —Ä–µ–≥—ñ–æ–Ω –∑—ñ –∑–≤—ñ—Ç–æ–º (Region).

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ:

* –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∫–ª—ñ–∫–∞—î/—Ä–æ–∑–∫–ª—ñ–∫–∞—î –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∏;
* DA —Å–ø—Ä–∞—Ü—å–æ–≤—É—î ‚Üí Region Refresh;
* —Ñ—ñ–ª—å—Ç—Ä —É WHERE –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –Ω–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è `:P1_DEPT_FILTER`.

---

## –ö–æ—Ä–æ—Ç–∫–æ –ø–æ –ª–æ–≥—ñ—Ü—ñ

* **Access level = 1** ‚Üí –ø–æ–∫–∞–∑—É—î–º–æ `P1_DEPT_FILTER`.
* LOV: –≤—Å—ñ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∏, —è–∫—ñ —Ä–µ–∞–ª—å–Ω–æ —î –≤ –∂—É—Ä–Ω–∞–ª—ñ.
* Default: **–≤—Å—ñ department_id, –æ–∫—Ä—ñ–º 65**, —á–µ—Ä–µ–∑ `LISTAGG`.
* –û—Å–Ω–æ–≤–Ω–∏–π SQL-–∑–≤—ñ—Ç –º—ñ—Å—Ç–∏—Ç—å `department_id` —ñ —Ñ—ñ–ª—å—Ç—Ä `IN (‚Ä¶split(:P1_DEPT_FILTER)‚Ä¶)`.
* Dynamic Action –Ω–∞ `Change` —Ä–µ—Ñ—Ä–µ—à–∏—Ç—å –∑–≤—ñ—Ç.

–Ø–∫—â–æ —Ö–æ—á–µ—à, –Ω–∞—Å—Ç—É–ø–Ω–∏–º –∫—Ä–æ–∫–æ–º –º–æ–∂—É:

* –∞–±–æ –≤–∏–ø–∏—Å–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç —Ç–≤–æ–≥–æ *—Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ* SQL –∑ —É–∂–µ –≤—Å—Ç–∞–≤–ª–µ–Ω–∏–º `WHERE (... department_id filter ...)`;
* –∞–±–æ –¥–æ–ø–æ–º–æ–≥—Ç–∏ –ø—Ä–∏–¥—É–º–∞—Ç–∏ –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–∏–π —Ñ—ñ–ª—å—Ç—Ä –ø–æ `unit` —á–∏ `page_list_id`, —è–∫—â–æ —Ç–æ–±—ñ –∑–∞–π–¥–µ —Ü–µ–π –ø—ñ–¥—Ö—ñ–¥.
