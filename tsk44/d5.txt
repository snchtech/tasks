–û–∫–µ–π, –¥–∞–≤–∞–π —Ä–µ–∞–ª—å–Ω–æ **–∫—Ä–æ–∫ 1** –∑—Ä–æ–±–∏–º–æ –¥–æ –∫—ñ–Ω—Ü—è —ñ –≤—ñ–¥—á—É—î–º–æ –ø—Ä–æ—Ñ—ñ—Ç, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–µ–æ—Ä—ñ—é üòä

**–©–æ —Ä–æ–±–∏–º–æ –∑–∞—Ä–∞–∑ (Step 1):**

1. –í `tasks_with_access` –æ–¥–∏–Ω —Ä–∞–∑ —Ä–∞—Ö—É—î–º–æ:

   * `is_overdue` ‚Äì –ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è;
   * `is_incomplete` ‚Äì ‚Äú–Ω–µ–¥–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è‚Äù.
2. –ü–µ—Ä–µ–ø–∏—Å—É—î–º–æ:

   * —Ñ—ñ–ª—å—Ç—Ä –¥–ª—è `:P1_TAB_MODE = 'PROBLEM'`;
   * –∫–æ–ª–æ–Ω–∫—É `STATUS_LABEL_PROBLEM`;
   * –∫–æ–ª–æ–Ω–∫—É `STATUS_LABEL_PLANNED`;
   * —á–∞—Å—Ç–∏–Ω—É `STATUS_LABEL_SHIFT` ‚Äì –¥–µ –±—É–ª–∏ —Ç—ñ —Å–∞–º—ñ `EXISTS`.
3. –ü—Ä–∏ —Ü—å–æ–º—É:

   * **–ª–æ–≥—ñ–∫—É –¥–æ—Å—Ç—É–ø—É (task_access_control)** –º–∏ –ø–æ–∫–∏ –Ω–µ —á—ñ–ø–∞—î–º–æ ‚Äì –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ —ó—ó, —è–∫ —î;
   * `VIEWED_BY` —ñ `TODO`/`SHIFT`-—Ñ—ñ–ª—å—Ç—Ä–∏ –ø–æ–∫–∏ –∑–∞–ª–∏—à–∏–º–æ ‚Äî —Ü–µ –±—É–¥–µ **Step 2**.

---

## 1. –û–Ω–æ–≤–ª–µ–Ω–∏–π CTE `user_ctx` (–ø—Ä–æ—Å—Ç–æ –∞–∫—É—Ä–∞—Ç–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç)

```sql
WITH user_ctx AS (
  SELECT
    CASE WHEN :PO_SUBSTITUTION_MODE = 1 THEN :PO_NEW_USER_ID       ELSE :PO_CUR_USER_TABNO       END AS user_id,
    CASE WHEN :PO_SUBSTITUTION_MODE = 1 THEN :PO_NEW_POSITION_ID   ELSE :PO_CUR_USER_POSITION    END AS position_id,
    CASE WHEN :PO_SUBSTITUTION_MODE = 1 THEN :PO_NEW_DEPARTMENT_ID ELSE :PO_CUR_USER_DEPARTMENT  END AS department_id,
    CASE WHEN :PO_SUBSTITUTION_MODE = 1 THEN :PO_NEW_UNIT_ID       ELSE :PO_CUR_USER_UNIT        END AS unit_id,
    CASE WHEN :PO_SUBSTITUTION_MODE = 1 THEN :PO_NEW_UCHASTOK      ELSE :PO_CUR_UCHASTOK         END AS uchastok_id
  FROM dual
),
```

---

## 2. –û–Ω–æ–≤–ª–µ–Ω–∏–π `tasks_with_access` –∑ –ø—Ä–∞–ø–æ—Ä—Ü—è–º–∏ `is_overdue` —Ç–∞ `is_incomplete`

–¢—É—Ç –≥–æ–ª–æ–≤–Ω–µ: **–æ–¥–∏–Ω —Ä–∞–∑** —Ä–∞—Ö—É—î–º–æ –¥–æ—Ä–æ–≥–æ—é `EXISTS` –ø–æ `DICT_APP_CONFIRM_LIST` + `SIGNATURERIGHTS`, –∞ –¥–∞–ª—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ü—ñ –ø—Ä–∞–ø–æ—Ä—Ü—ñ –≤—Å—é–¥–∏.

```sql
tasks_with_access AS (
  SELECT DISTINCT
    t.*,
    s.status_main_id,
    -- –ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–µ (–ø–ª–∞–Ω–æ–≤–∞ –¥–∞—Ç–∞ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è –º–∏–Ω—É–ª–∞, —Ñ–∞–∫—Ç –≤—ñ–¥—Å—É—Ç–Ω—ñ–π)
    CASE
      WHEN t.planning_date_end < SYSDATE AND t.actual_date_end IS NULL THEN 1
      ELSE 0
    END AS is_overdue,
    -- –Ω–µ–¥–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è (–Ω–µ–º–∞—î –≤—Å—ñ—Ö —Å—Ç–∞–¥—ñ–π –∑ DICT_APP_CONFIRM_LIST)
    CASE
      WHEN EXISTS (
        SELECT 1
        FROM TaskTracker.DICT_APP_CONFIRM_LIST@TO_TASKTRACKER10 d
        WHERE d.page_list_id    = t.page_list_id
          AND d.parent_stage_id IS NOT NULL
          AND NOT EXISTS (
            SELECT 1
            FROM TaskTracker.SIGNATURERIGHTS@TO_TASKTRACKER10 r
            WHERE r.task_id  = t.task_id
              AND r.stages_id = d.id
          )
      )
      THEN 1
      ELSE 0
    END AS is_incomplete
  FROM V_TASKS_FULL t
  CROSS JOIN user_ctx uc
  LEFT JOIN TaskTracker.DICT_STATUS@TO_TASKTRACKER10 s
         ON s.id = t.status_id
  -- —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ JOIN signaturerights –¥–ª—è —ñ–Ω—à–∏—Ö —É–º–æ–≤ ‚Äì –∑–∞–ª–∏—à–∞—î—à
  /* LEFT JOIN TaskTracker.SIGNATURERIGHTS@TO_TASKTRACKER10 r
         ON r.task_id = t.task_id */
  WHERE
    -- –¢–£–¢ –ó–ê–õ–ò–®–ê–Ñ–® –¢–í–Ü–ô –í–ï–õ–ò–ö–ò–ô –ë–õ–û–ö EXISTS() –î–õ–Ø ACCESS_CONTROL 1:1
    EXISTS (
      SELECT 1
      FROM TaskTracker.task_access_control@TO_TASKTRACKER10 ac
      JOIN TaskTracker.task_access_level_type@TO_TASKTRACKER10 al
        ON al.id = ac.access_level_id
      WHERE
        (
          -- === —Ç–≤–æ—è –ª–æ–≥—ñ–∫–∞ access_level = 1, 2, 3 (–±–µ–∑ –∑–º—ñ–Ω) ===
          -- –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ uc.user_id, uc.position_id, uc.department_id, uc.unit_id, uc.uchastok_id
          -- —ñ t.task_id, t.department_id, t.unit_id, t.uchastok_id
          -- –ø—Ä–æ—Å—Ç–æ –∞–∫—É—Ä–∞—Ç–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å–∏ —Å—é–¥–∏ —Å–≤—ñ–π –∫–æ–¥
        )
        AND ROWNUM = 1
    )
),
```

> üî¥ –í–∞–∂–ª–∏–≤–æ: —è –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—É—é —Ç—É—Ç —Ç–≤—ñ–π access-control (–±–æ –≤—ñ–Ω —ñ —Ç–∞–∫ —Å–∫–ª–∞–¥–Ω–∏–π) ‚Äì —Ç–∏ –ø—Ä–æ—Å—Ç–æ **–∫–æ–ø—ñ—é—î—à —Å–≤—ñ–π –±–ª–æ–∫ EXISTS** –≤—Å–µ—Ä–µ–¥–∏–Ω—É —Ü—å–æ–≥–æ `EXISTS (...)` —ñ –≤–∏–ø—Ä–∞–≤–ª—è—î—à —Å–∏–Ω—Ç–∞–∫—Å–∏—Å.

---

## 3. –§—ñ–ª—å—Ç—Ä –ø–æ `:P1_TAB_MODE = 'PROBLEM'` —á–µ—Ä–µ–∑ –ø—Ä–∞–ø–æ—Ä—Ü—ñ

–ó–∞–º—ñ—Å—Ç—å:

```sql
OR (:P1_TAB_MODE = 'PROBLEM' AND s.STATUS_MAIN_ID <> 0
AND (
  (t.PLANNING_DATE_END < SYSDATE AND t.ACTUAL_DATE_END IS NULL) 
  OR EXISTS (—Ç—É—Ç –∑–¥–æ—Ä–æ–≤–µ–Ω–Ω–∏–π EXISTS ...)
)
)
```

—Ç–µ–ø–µ—Ä:

```sql
OR (
  :P1_TAB_MODE = 'PROBLEM'
  AND t.status_main_id <> 0
  AND (t.is_overdue = 1 OR t.is_incomplete = 1)
)
```

–¢–æ–±—Ç–æ:

```sql
AND (
  (:P1_TAB_MODE = 'PLANNED' AND (... —Å—Ç–∞—Ä—ñ —É–º–æ–≤–∏, –∞–ª–µ –≤–∂–µ –º–æ–∂–Ω–∞ —Ç–µ–∂ —Ç—Ä–æ—Ö–∏ —Å–ø—Ä–æ—Å—Ç–∏—Ç–∏ ...))
  OR (:P1_TAB_MODE = 'TODO'    AND (...))
  OR (:P1_TAB_MODE = 'SHIFT'   AND (...))
  OR (:P1_TAB_MODE = 'PROBLEM' AND t.status_main_id <> 0
                               AND (t.is_overdue = 1 OR t.is_incomplete = 1))
  OR (:P1_TAB_MODE = 'ARCHIVE' AND t.status_main_id = 0)
)
```

---

## 4. –ü–µ—Ä–µ–ø–∏—Å—É—î–º–æ `STATUS_LABEL_PROBLEM` –±–µ–∑ EXISTS

–ë—É–ª–æ (—Å–∫–æ—Ä–æ—á–µ–Ω–æ):

```sql
CASE
  WHEN :P1_TAB_MODE = 'PROBLEM' THEN
    CASE
      WHEN (t.PLANNING_DATE_END < SYSDATE AND t.ACTUAL_DATE_END IS NULL)
           OR EXISTS (... –Ω–µ–¥–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–µ ...)
      THEN
        CASE
          WHEN (–æ–±–∏–¥–≤—ñ —É–º–æ–≤–∏) THEN '<—ñ–∫–æ–Ω–∫–∞ overdue>' || '<—ñ–∫–æ–Ω–∫–∞ incomplete>'
          WHEN (—Ç—ñ–ª—å–∫–∏ overdue) THEN '<—ñ–∫–æ–Ω–∫–∞ overdue>'
          WHEN (—Ç—ñ–ª—å–∫–∏ incomplete) THEN '<—ñ–∫–æ–Ω–∫–∞ incomplete>'
        END
    END
  ELSE NULL
END AS STATUS_LABEL_PROBLEM
```

–°—Ç–∞—î:

```sql
CASE
  WHEN :P1_TAB_MODE = 'PROBLEM' THEN
    CASE
      WHEN t.is_overdue = 1 AND t.is_incomplete = 1 THEN
        '<span class="t-Icon fa fa-clock-o" style="color:red;" title="–ü—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è"></span>' ||
        '<span class="t-Icon fa fa-id-card-o" style="color:orange;" title="–ù–µ–¥–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è"></span>'
      WHEN t.is_overdue = 1 THEN
        '<span class="t-Icon fa fa-clock-o" style="color:red;" title="–ü—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è"></span>'
      WHEN t.is_incomplete = 1 THEN
        '<span class="t-Icon fa fa-id-card-o" style="color:orange;" title="–ù–µ–¥–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è"></span>'
      ELSE
        NULL
    END
  ELSE
    NULL
END AS STATUS_LABEL_PROBLEM,
```

–ñ–æ–¥–Ω–æ–≥–æ `EXISTS` –±—ñ–ª—å—à–µ –≤ —Ü—ñ–π –∫–æ–ª–æ–Ω—Ü—ñ üî•

---

## 5. –ü–µ—Ä–µ–ø–∏—Å—É—î–º–æ `STATUS_LABEL_PLANNED`

–¢–≤–æ—è –ª–æ–≥—ñ–∫–∞ —Ç–∞–º ‚Äî –∫–æ–º–±–æ:

* ‚Äú–Ω–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è‚Äù (status_id = 10),
* ‚Äú–≤ —Ä–æ–±–æ—Ç—ñ‚Äù (status_id in 12,13),
* ‚Äú–ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–µ‚Äù,
* ‚Äú–Ω–µ–¥–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–µ‚Äù.

–ë—É–ª–æ –∑ –ø–æ–≤—Ç–æ—Ä–æ–º EXISTS, —Å—Ç–∞–Ω–µ —Ç–∞–∫:

```sql
CASE
  WHEN :P1_TAB_MODE = 'PLANNED' THEN
    (
      CASE
        WHEN t.status_id = 10 THEN
          '<span class="t-Icon fa fa-tag" style="color:green;" title="–ù–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è"></span>'
        ELSE ''
      END ||
      CASE
        WHEN t.status_id IN (12, 13) THEN
          '<span class="t-Icon fa fa-wrench" style="color:blue;" title="–í —Ä–æ–±–æ—Ç—ñ"></span>'
        ELSE ''
      END ||
      CASE
        WHEN t.is_overdue = 1 THEN
          '<span class="t-Icon fa fa-clock-o" style="color:red;" title="–ü—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è"></span>'
        ELSE ''
      END ||
      CASE
        WHEN t.is_incomplete = 1 THEN
          '<span class="t-Icon fa fa-id-card-o" style="color:orange;" title="–ù–µ–¥–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è"></span>'
        ELSE ''
      END
    )
  ELSE
    NULL
END AS STATUS_LABEL_PLANNED,
```

---

## 6. –ü–µ—Ä–µ–ø–∏—Å—É—î–º–æ —á–∞—Å—Ç–∏–Ω—É `STATUS_LABEL_SHIFT`

–£ SHIFT —Ä–µ–∂–∏–º—ñ –≤ —Ç–µ–±–µ —Ç–µ–∂ —î:

* —ñ–∫–æ–Ω–∫–∏ ‚Äú–≤—ñ–¥–∫—Ä–∏—Ç–∏/–∑–∞–∫—Ä–∏—Ç–∏ –Ω–∞ –∑–º—ñ–Ω—ñ‚Äù ‚Üí —ó—Ö –ª–∏—à–∞—î–º–æ —è–∫ —î (–±–æ —Ü–µ –ø—Ä–æ—Å—Ç—ñ BETWEEN);
* ‚Äú–Ω–æ–≤–µ‚Äù / ‚Äú–≤ —Ä–æ–±–æ—Ç—ñ‚Äù ‚Üí –ø–æ status_id;
* ‚Äú–ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–µ‚Äù / ‚Äú–Ω–µ–¥–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–µ‚Äù ‚Üí —Ä–∞–Ω—ñ—à–µ —á–µ—Ä–µ–∑ —Ç—ñ —Å–∞–º—ñ EXISTS, —Ç–µ–ø–µ—Ä —á–µ—Ä–µ–∑ –ø—Ä–∞–ø–æ—Ä—Ü—ñ.

–°–∫–æ—Ä–æ—á–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è:

```sql
CASE
  WHEN :P1_TAB_MODE = 'SHIFT' THEN
    (
      -- –í—ñ–¥–∫—Ä–∏—Ç–∏ –Ω–∞ –∑–º—ñ–Ω—ñ
      CASE
        WHEN t.planning_date_start BETWEEN TO_DATE(:P0_SHIFT_START,'DD.MM.YYYY HH24:MI')
                                      AND TO_DATE(:P0_SHIFT_END,  'DD.MM.YYYY HH24:MI')
        THEN '<span class="t-Icon fa fa-play-circle" style="color:green;" title="–í—ñ–¥–∫—Ä–∏—Ç–∏ –Ω–∞ –∑–º—ñ–Ω—ñ"></span>'
        ELSE ''
      END ||
      -- –ó–∞–∫—Ä–∏—Ç–∏ –Ω–∞ –∑–º—ñ–Ω—ñ
      CASE
        WHEN t.planning_date_end BETWEEN TO_DATE(:P0_SHIFT_START,'DD.MM.YYYY HH24:MI')
                                    AND TO_DATE(:P0_SHIFT_END,  'DD.MM.YYYY HH24:MI')
        THEN '<span class="t-Icon fa fa-stop-circle" style="color:red;" title="–ó–∞–∫—Ä–∏—Ç–∏ –Ω–∞ –∑–º—ñ–Ω—ñ"></span>'
        ELSE ''
      END ||
      -- –ù–æ–≤–µ
      CASE
        WHEN t.status_id = 10 THEN
          '<span class="t-Icon fa fa-tag" style="color:green;" title="–ù–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è"></span>'
        ELSE ''
      END ||
      -- –í —Ä–æ–±–æ—Ç—ñ
      CASE
        WHEN t.status_id IN (12, 13) THEN
          '<span class="t-Icon fa fa-wrench" style="color:blue;" title="–í —Ä–æ–±–æ—Ç—ñ"></span>'
        ELSE ''
      END ||
      -- –ü—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–µ
      CASE
        WHEN t.is_overdue = 1 THEN
          '<span class="t-Icon fa fa-clock-o" style="color:darkred;" title="–ü—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è"></span>'
        ELSE ''
      END ||
      -- –ù–µ–¥–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–µ
      CASE
        WHEN t.is_incomplete = 1 THEN
          '<span class="t-Icon fa fa-id-card-o" style="color:orange;" title="–ù–µ–¥–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è"></span>'
        ELSE ''
      END
    )
  ELSE
    NULL
END AS STATUS_LABEL_SHIFT,
```

---

## 7. –©–æ —Ç–∏ –æ—Ç—Ä–∏–º—É—î—à –≤–∂–µ –∑–∞—Ä–∞–∑

–ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –∫—Ä–æ–∫—É:

* **–≤—Å—ñ –ø–æ–≤—Ç–æ—Ä–∏ EXISTS –ø–æ DICT_APP_CONFIRM_LIST + SIGNATURERIGHTS –∑–Ω–∏–∫–ª–∏** –∑ SELECT —ñ WHERE –¥–ª—è `PROBLEM`/—ñ–∫–æ–Ω–æ–∫;
* —É—Å—è ‚Äú–≤–∞–∂–∫–∞‚Äù –ª–æ–≥—ñ–∫–∞:

  * –æ–¥–∏–Ω —Ä–∞–∑ —Ä–∞—Ö—É—î—Ç—å—Å—è –≤ `tasks_with_access` (–ø—Ä–∞–ø–æ—Ä—Ü—ñ `is_overdue`, `is_incomplete`);
  * –¥–∞–ª—ñ –≤ –±—É–¥—å-—è–∫–∏—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö/—Ñ—ñ–ª—å—Ç—Ä–∞—Ö —Ç–∏ –ø—Ä–∞—Ü—é—î—à –∑ –ø—Ä–æ—Å—Ç–∏–º–∏ `= 1 / = 0`;
* –ø–ª–∞–Ω —Å—Ç–∞—î –ø—Ä–æ—Å—Ç—ñ—à–∏–π, –º–µ–Ω—à–µ remote-–≤–∏–∫–ª–∏–∫—ñ–≤, –º–µ–Ω—à–µ –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö –ø—Ä–æ—Ö–æ–¥—ñ–≤ –ø–æ —Ç–∏—Ö —Å–∞–º–∏—Ö —Ç–∞–±–ª–∏—Ü—è—Ö.

---

## –î–∞–ª—ñ (Step 2)

–ù–∞—Å—Ç—É–ø–Ω–∏–º –∫—Ä–æ–∫–æ–º –ª–æ–≥—ñ—á–Ω–æ:

1. **VIEWED_BY** ‚Üí –≤–∏–Ω–µ—Å—Ç–∏ –≤ CTE `viewed_agg` –∑–∞–º—ñ—Å—Ç—å –∫—É–ø–∏ SELECT‚Äô—ñ–≤ —É CASE.
2. –†–æ–∑–±–∏—Ç–∏ –≤–µ–ª–∏–∫–∏–π –±–ª–æ–∫ –ø–æ `:P1_TAB_MODE` –Ω–∞ `UNION ALL` (—â–æ–± –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É –±—É–≤ —Å–≤—ñ–π –ø–ª–∞–Ω).

–ê–ª–µ –Ω–∞ —Ü—å–æ–º—É –∫—Ä–æ—Ü—ñ –≤ —Ç–µ–±–µ –≤–∂–µ –±—É–¥–µ –≤—ñ–¥—á—É—Ç–Ω–µ —Å–ø—Ä–æ—â–µ–Ω–Ω—è –π –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è —Å–∞–º–µ –∑–∞ —Ä–∞—Ö—É–Ω–æ–∫ ‚Äú–ø—Ä–æ–±–ª–µ–º–Ω–∏—Ö‚Äù EXISTS.

–Ø–∫ –∑–∞—Ö–æ—á–µ—à ‚Äî –±–µ—Ä–µ–º–æ –Ω–∞—Å—Ç—É–ø–Ω–æ—é —Å–µ—Ä—ñ—î—é `VIEWED_BY` —ñ –∑—Ä–æ–±–∏–º–æ –æ–¥–∏–Ω –∞–∫—É—Ä–∞—Ç–Ω–∏–π CTE –ø—ñ–¥ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞–º—ñ—Å—Ç—å 4 —Ä—ñ–∑–Ω–∏—Ö –ø—ñ–¥–∑–∞–ø–∏—Ç—ñ–≤ —É SELECT.
