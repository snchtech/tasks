–¢–∞–∫, —Ç—É—Ç —Ç–∏ –¥—É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ñ–¥—á—É–≤–∞—î—à –ø—Ä–æ–±–ª–µ–º—É:
–∫–æ–ª–∏ –≤ —Ç–µ–±–µ **1 –≤–∞–∂–∫–∏–π –∑–∞–ø–∏—Ç –Ω–∞ —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á + —â–µ 2‚Äì4 –º–∞–π–∂–µ —Ç–∞–∫–∏—Ö —Å–∞–º–∏—Ö –∑–∞–ø–∏—Ç–∏ –Ω–∞ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏**, —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –º–∞–π–∂–µ –≥–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ –±—É–¥–µ –≥—Ä—É–∑–∏—Ç–∏—Å—å —É 2 —Ä–∞–∑–∏ –¥–æ–≤—à–µ.

–î–∞–≤–∞–π —Ä–æ–∑–∫–ª–∞–¥–µ–º–æ, —è–∫—ñ —î —Ä–µ–∞–ª—å–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏, —ñ —â–æ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ **–±–µ–∑ —Ç–æ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞–Ω–Ω—è –≤—Å—å–æ–≥–æ**.

---

## 1. –©–æ –º–∞—î–º–æ –∑–∞—Ä–∞–∑

* –Ñ **–æ—Å–Ω–æ–≤–Ω–∏–π –∑–≤—ñ—Ç –∂—É—Ä–Ω–∞–ª—É** (–≤–µ–ª–∏–∫–∏–π SQL –∑ `V_TASKS_FULL_2`, access control, HTML —ñ —Ç.–¥.).
* –Ñ —â–µ **–∫—ñ–ª—å–∫–∞ –æ–∫—Ä–µ–º–∏—Ö SQL** (2‚Äì4), —è–∫—ñ:

  * –º–∞–π–∂–µ –ø–æ–≤—Ç–æ—Ä—é—é—Ç—å –ª–æ–≥—ñ–∫—É –¥–æ—Å—Ç—É–ø—É / —Ñ—ñ–ª—å—Ç—Ä—ñ–≤,
  * –∞–ª–µ –∑–∞–º—ñ—Å—Ç—å —Ä—è–¥–∫—ñ–≤ –≤—ñ–¥–¥–∞—é—Ç—å `COUNT(*)` –¥–ª—è:

    * –ø–ª–∞–Ω–æ–≤—ñ,
    * –ø—Ä–æ–±–ª–µ–º–Ω—ñ,
    * –∞—Ä—Ö—ñ–≤,
    * —ñ–Ω—à—ñ –≤–∫–ª–∞–¥–∫–∏.

üëâ –°—É–∫—É–ø–Ω–æ —Ü–µ –æ–∑–Ω–∞—á–∞—î: –∫–æ–∂–µ–Ω `refresh` —Ç–∏ –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤ –ø—Ä–æ–≥–∞–Ω—è—î—à —Ç—É —Å–∞–º—É ‚Äú–º‚Äô—è—Å–æ—Ä—É–±–∫—É‚Äù.

---

## 2. –î–≤—ñ –∞–¥–µ–∫–≤–∞—Ç–Ω—ñ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó

### –í–∞—Ä—ñ–∞–Ω—Ç A. –û–∫—Ä–µ–º–∏–π **–æ–¥–∏–Ω** —à–≤–∏–¥–∫–∏–π –∑–∞–ø–∏—Ç –¥–ª—è –í–°–Ü–• –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤

–ó–∞–º—ñ—Å—Ç—å 4 –æ–∫—Ä–µ–º–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ —Ç–∏–ø—É:

```sql
SELECT COUNT(*) FROM ... WHERE planned_condition;
SELECT COUNT(*) FROM ... WHERE problem_condition;
...
```

—Ä–æ–±–∏–º–æ **–æ–¥–∏–Ω –∞–≥—Ä–µ–≥–∞—Ç–Ω–∏–π**:

```sql
WITH user_ctx AS (...),
     tasks_with_access AS (...)      -- –ë–ï–ó :P1_TAB_MODE
SELECT
  SUM(CASE WHEN <—É–º–æ–≤–∞ PLANNED> THEN 1 ELSE 0 END) AS planned_cnt,
  SUM(CASE WHEN <—É–º–æ–≤–∞ TODO>    THEN 1 ELSE 0 END) AS todo_cnt,
  SUM(CASE WHEN <—É–º–æ–≤–∞ SHIFT>   THEN 1 ELSE 0 END) AS shift_cnt,
  SUM(CASE WHEN <—É–º–æ–≤–∞ PROBLEM> THEN 1 ELSE 0 END) AS problem_cnt,
  SUM(CASE WHEN <—É–º–æ–≤–∞ ARCH>    THEN 1 ELSE 0 END) AS archive_cnt
FROM tasks_with_access;
```

–Ü –¥–ª—è APEX:

* —Å—Ç–≤–æ—Ä—é—î—à **–æ–∫—Ä–µ–º–∏–π —Ä–µ–≥—ñ–æ–Ω** —Ç–∏–ø—É `SQL Report` (–º–æ–∂–Ω–∞ –≤–∑–∞–≥–∞–ª—ñ `Region Display Selector = No`),
* —É –Ω—å–æ–º—É 1 —Ä—è–¥–æ–∫ —ñ 5 –∫–æ–ª–æ–Ω–æ–∫: `PLANNED_CNT`, `PROBLEM_CNT`, ‚Ä¶
* —Ü—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –º–æ–∂–Ω–∞:

  * –∞–±–æ –ø—Ä–∏–≤‚Äô—è–∑–∞—Ç–∏ –¥–æ page item‚Äô—ñ–≤ (`P1_CNT_PLANNED` —ñ —Ç.–¥. —á–µ—Ä–µ–∑ column link / computation),
  * –∞–±–æ –ø—Ä–æ—Å—Ç–æ –∑–∞–±—Ä–∞—Ç–∏ JS‚Äô–æ–º –∑ –ø–µ—Ä—à–æ–≥–æ —Ä—è–¥–∫–∞ —ñ –∑–∞—Å—É–Ω—É—Ç–∏ –≤ –±–µ–π–¥–∂–∏–∫–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫–∞—Ö.

**–©–æ —Ü–µ –¥–∞—î:**

* –¥–ª—è –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤ —Ç–∏ **–∑–∞–º—ñ—Å—Ç—å 4 –≤–∞–∂–∫–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ –º–∞—î—à 1**;
* —É —Ü—å–æ–º—É –∑–∞–ø–∏—Ç—ñ **–Ω–µ –±—É–¥—É—î—à HTML, CREATOR_INFO, EXECUTOR_INFO**, –∞ –ª–∏—à–µ –º—ñ–Ω—ñ–º—É–º –∫–æ–ª–æ–Ω–æ–∫;
* –∑–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —Å—Ç–∞—î –ø—Ä–∏–±–ª–∏–∑–Ω–æ:
  `—á–∞—Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–≤—ñ—Ç—É` + `—á–∞—Å –æ–¥–Ω–æ–≥–æ –∞–≥—Ä–µ–≥–∞—Ü—ñ–π–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É`, –∞ –Ω–µ `+ 4 * —á–∞—Å`.

---

### –í–∞—Ä—ñ–∞–Ω—Ç B. –û–¥–∏–Ω SQL, —è–∫–∏–π –≤—ñ–¥–¥–∞—î **—ñ —Ä—è–¥–∫–∏, —ñ –≤—Å—ñ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏**, –∞ –ø–æ—Ç—ñ–º JS –∑–∞–±–∏—Ä–∞—î —ó—Ö —ñ–∑ –ø–µ—Ä—à–æ–≥–æ —Ä—è–¥–∫–∞

–¶–µ —Ç—Ä–æ—Ö–∏ ‚Äú—Ö–∏—Ç—Ä—ñ—à–µ‚Äù, –∞–ª–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –µ–∫–æ–Ω–æ–º–Ω–æ –ø–æ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –≤–∏–∫–æ–Ω–∞–Ω—å:

1. –ú–∏ –±—É–¥—É—î–º–æ –±–∞–∑–æ–≤–∏–π –Ω–∞–±—ñ—Ä tasks (–±–µ–∑ —Ñ—ñ–ª—å—Ç—Ä–∞ `:P1_TAB_MODE`).
2. –ù–∞ –Ω—å–æ–º—É —Ä–∞—Ö—É—î–º–æ **–∞–Ω–∞–ª—ñ—Ç–∏—á–Ω—ñ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏** (window functions) –¥–ª—è –∫–æ–∂–Ω–æ—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –æ–¥—Ä–∞–∑—É.
3. –ü–æ—Ç—ñ–º –≤–∂–µ —Ñ—ñ–ª—å—Ç—Ä—É—î–º–æ —Ä—è–¥–∫–∏ –ø—ñ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –≤–∫–ª–∞–¥–∫—É (`PLANNED` / `PROBLEM` / ‚Ä¶).
4. –í–∏—Ö–æ–¥–∏—Ç—å: **–æ–¥–∏–Ω –ø—Ä–æ—Ö—ñ–¥ –ø–æ –∑–∞–¥–∞—á–∞—Ö ‚Üí —ñ —Å–ø–∏—Å–æ–∫, —ñ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏**.

–°–∫–µ–ª–µ—Ç:

```sql
WITH
user_ctx AS (...),

-- 1. –í—Å—ñ –∑–∞–¥–∞—á—ñ –∑ –¥–æ—Å—Ç—É–ø–æ–º (–±–µ–∑ :P1_TAB_MODE)
tasks_base AS (
  SELECT DISTINCT
    t.*,
    s.status_main_id,
    CASE WHEN t.planning_date_end < SYSDATE AND t.actual_date_end IS NULL THEN 1 ELSE 0 END AS is_overdue,
    CASE WHEN EXISTS ( ... –Ω–µ–¥–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–µ ... ) THEN 1 ELSE 0 END AS is_incomplete
  FROM V_TASKS_FULL_2 t
  CROSS JOIN user_ctx uc
  LEFT JOIN TaskTracker.DICT_STATUS@... s ON s.id = t.status_id
  WHERE
    -- —Ç—É—Ç —Ç–≤–æ—è –ª–æ–≥—ñ–∫–∞ access level + signaturerights + creator_id
),

-- 2. –î–æ–¥–∞—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏ –ø–æ –≤—Å—ñ–π –º–Ω–æ–∂–∏–Ω—ñ (–±–µ–∑ —Ñ—ñ–ª—å—Ç—Ä–∞ –ø–æ –≤–∫–ª–∞–¥—Ü—ñ)
tasks_with_counters AS (
  SELECT
    b.*,

    -- –°–∫—ñ–ª—å–∫–∏ –≤—Å—å–æ–≥–æ –ø–ª–∞–Ω–æ–≤–∏—Ö (PLANNED)
    SUM(
      CASE
        WHEN b.status_main_id <> 0
         AND (
              (b.status_main_id <> 0 AND b.planning_date_end > SYSDATE)
           OR (b.status_main_id <> 0 AND b.actual_date_end IS NULL)
             )
        THEN 1 ELSE 0
      END
    ) OVER () AS cnt_planned,

    -- –°–∫—ñ–ª—å–∫–∏ –≤—Å—å–æ–≥–æ –ø—Ä–æ–±–ª–µ–º–Ω–∏—Ö (PROBLEM)
    SUM(
      CASE
        WHEN b.status_main_id <> 0
         AND (b.is_overdue = 1 OR b.is_incomplete = 1)
        THEN 1 ELSE 0
      END
    ) OVER () AS cnt_problem,

    -- –ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ TODO, SHIFT, ARCHIVE‚Ä¶
    SUM(
      CASE
        WHEN <—É–º–æ–≤–∞ TODO> THEN 1 ELSE 0
      END
    ) OVER () AS cnt_todo,

    SUM(
      CASE
        WHEN <—É–º–æ–≤–∞ SHIFT> THEN 1 ELSE 0
      END
    ) OVER () AS cnt_shift,

    SUM(
      CASE
        WHEN b.status_main_id = 0 THEN 1 ELSE 0
      END
    ) OVER () AS cnt_archive

  FROM tasks_base b
),

-- 3. –§—ñ–Ω–∞–ª–æ–º –≤–∏–±–∏—Ä–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ —Ä—è–¥–∫–∏ –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ—ó –≤–∫–ª–∞–¥–∫–∏
final_tasks AS (
  SELECT *
  FROM tasks_with_counters
  WHERE
        (:P1_TAB_MODE = 'PLANNED' AND <—É–º–æ–≤–∞ PLANNED>)
     OR (:P1_TAB_MODE = 'PROBLEM' AND <—É–º–æ–≤–∞ PROBLEM>)
     OR (:P1_TAB_MODE = 'TODO'    AND <—É–º–æ–≤–∞ TODO>)
     OR (:P1_TAB_MODE = 'SHIFT'   AND <—É–º–æ–≤–∞ SHIFT>)
     OR (:P1_TAB_MODE = 'ARCHIVE' AND <—É–º–æ–≤–∞ ARCHIVE>)
)
SELECT
  task_id,
  ...,
  cnt_planned,
  cnt_problem,
  cnt_todo,
  cnt_shift,
  cnt_archive
FROM final_tasks
ORDER BY date_create DESC;
```

> –ö–ª—é—á–æ–≤–∏–π –º–æ–º–µ–Ω—Ç:
> **–∞–Ω–∞–ª—ñ—Ç–∏—á–Ω—ñ `SUM(...) OVER ()` —Ä–∞—Ö—É—î–º–æ –î–û —Ç–æ–≥–æ, —è–∫ —Ñ—ñ–ª—å—Ç—Ä—É—î–º–æ –ø–æ `:P1_TAB_MODE`**.
> –¢–æ–º—É –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏ –∑–∞–≤–∂–¥–∏ –ø–æ –≤—Å—ñ–π –º–Ω–æ–∂–∏–Ω—ñ –∑–∞–¥–∞—á, –∞ –Ω–µ –ª–∏—à–µ –ø–æ —Ç—ñ–π –≤–∫–ª–∞–¥—Ü—ñ, —â–æ –∑–∞—Ä–∞–∑ –≤—ñ–¥–∫—Ä–∏—Ç–∞.

#### –Ø–∫ –¥–∞–ª—ñ –∑–∞–±—Ä–∞—Ç–∏ —Ü–µ –≤ JS

–ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, —É –∑–≤—ñ—Ç—ñ —Ç–∏ –≤–∏–≤—ñ–≤ –∫–æ–ª–æ–Ω–∫–∏:

* `CNT_PLANNED`
* `CNT_PROBLEM`
* `CNT_TODO`
* `CNT_SHIFT`
* `CNT_ARCHIVE`

—ñ –∑—Ä–æ–±–∏–≤ —ó—Ö **–ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–º–∏ –≤ —à–∞–±–ª–æ–Ω—ñ** (–∞–±–æ –∑ CSS `display:none`).

–¢–æ–¥—ñ:

```js
// –ü—ñ—Å–ª—è refresh –≥–æ–ª–æ–≤–Ω–æ–≥–æ –∑–≤—ñ—Ç—É
apex.jQuery("#your_report_static_id").on("apexafterrefresh", function () {
  var $firstRow = apex.jQuery("#your_report_static_id tbody tr").first();
  if ($firstRow.length === 0) return;

  var planned  = $firstRow.find("td[headers='CNT_PLANNED']").text();
  var problem  = $firstRow.find("td[headers='CNT_PROBLEM']").text();
  var todo     = $firstRow.find("td[headers='CNT_TODO']").text();
  var shift    = $firstRow.find("td[headers='CNT_SHIFT']").text();
  var archive  = $firstRow.find("td[headers='CNT_ARCHIVE']").text();

  // –î–∞–ª—ñ –≤—Å—Ç–∞–≤–ª—è—î—à —ó—Ö —É –±–µ–π–¥–∂–∏–∫–∏ –≤–∫–ª–∞–¥–æ–∫, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
  apex.jQuery("#tab_planned .t-Tabs-badge").text(planned);
  apex.jQuery("#tab_problem .t-Tabs-badge").text(problem);
  // —ñ —Ç.–¥.
});
```

> –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ (`#your_report_static_id`, `#tab_planned`) –ø—ñ–¥—ñ–≥–Ω–∞—î—à –ø—ñ–¥ —Å–≤—ñ–π —à–∞–±–ª–æ–Ω.

**–§—ñ—à–∫–∞:** SQL –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è **–æ–¥–∏–Ω —Ä–∞–∑**, –∞ JS –ø—Ä–æ—Å—Ç–æ —á–∏—Ç–∞—î –≥–æ—Ç–æ–≤—ñ —á–∏—Å–ª–∞.

---

## 3. –©–æ —è –±–∏ –∑—Ä–æ–±–∏–≤ –Ω–∞ —Ç–≤–æ—î–º—É –º—ñ—Å—Ü—ñ

1. **–ú—ñ–Ω—ñ–º—É–º –∑—É—Å–∏–ª—å, –º–∞–∫—Å–∏–º—É–º –≤–∏–≥–æ–¥–∏** ‚Äì —Å–ø–æ—á–∞—Ç–∫—É –í–∞—Ä—ñ–∞–Ω—Ç A:

   * –æ–¥–∏–Ω –∞–≥—Ä–µ–≥–∞—Ç–Ω–∏–π SQL –Ω–∞ –≤—Å—ñ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏ –∑–∞–º—ñ—Å—Ç—å 4;
   * –±–µ–∑ –∑–∞–π–≤–∏—Ö HTML —ñ –≤–∞–∂–∫–∏—Ö –∫–æ–ª–æ–Ω–æ–∫;
   * –æ–∫—Ä–µ–º–∏–π –ª–µ–≥–∫–∏–π —Ä–µ–≥—ñ–æ–Ω –∞–±–æ page items.

2. –Ø–∫—â–æ —ñ –ø—ñ—Å–ª—è —Ü—å–æ–≥–æ –∑–∞—Ö–æ—á–µ—Ç—å—Å—è —â–µ –ø—Ä–∏—Å–∫–æ—Ä–∏—Ç–∏/–ø–æ—á–∏—Å—Ç–∏—Ç–∏ ‚Äì
   –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –í–∞—Ä—ñ–∞–Ω—Ç B (–∞–Ω–∞–ª—ñ—Ç–∏—á–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É SQL + JS).

3. –û–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ:

   * –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ **–≤–∏–Ω–µ—Å—Ç–∏ –≤–∞–∂–∫—É –ª–æ–≥—ñ–∫—É (CREATOR/EXECUTOR HTML, LISTAGG)** —Ç—ñ–ª—å–∫–∏ –≤ –æ—Å–Ω–æ–≤–Ω–∏–π –∑–≤—ñ—Ç,
   * —É –∑–∞–ø–∏—Ç –¥–ª—è –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤ —Ü—ñ —à—Ç—É–∫–∏ –Ω–µ –≤–∫–ª—é—á–∞—Ç–∏ ‚Äî –≤–æ–Ω–∏ —Ç–æ–±—ñ –¥–ª—è `COUNT` –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ.

---

–Ø–∫—â–æ —Ç–∏ —Å–∫–∏–Ω–µ—à –æ–¥–∏–Ω —ñ–∑ —Å–≤–æ—ó—Ö ‚Äú–ª—ñ—á–∏–ª—å–Ω–∏–∫–æ–≤–∏—Ö‚Äù SQL (—è–∫–∏–π —Ä–∞—Ö—É—î, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ç—ñ–ª—å–∫–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ñ), —è –º–æ–∂—É –ø—Ä—è–º–æ –Ω–∞ –Ω—å–æ–º—É –ø–æ–∫–∞–∑–∞—Ç–∏, —è–∫ –∑—Ä–æ–±–∏—Ç–∏ –∫–æ–Ω—Å–æ–ª—ñ–¥–æ–≤–∞–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç, —è–∫–∏–π —Ä–∞—Ö—É—î –≤—Å—ñ 4‚Äì5 —Ç–∏–ø—ñ–≤ –æ–¥—Ä–∞–∑—É –π –±—É–¥–µ –∑–Ω–∞—á–Ω–æ –ª–µ–≥—à–∏–π –∑–∞ –æ—Å–Ω–æ–≤–Ω–∏–π —Ä–µ–ø–æ—Ä—Ç.
