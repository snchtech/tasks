–¢–∞–∫, —Ü–µ —è–∫—Ä–∞–∑ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π –¥–ª—è **Pre-Header process** üëç
–õ–æ–≥—ñ–∫–∞ —Ç–∞–∫–∞:

1. –£ Pre-Header –ø—Ä–æ—Ü–µ—Å—ñ —Ç–∏ **—Ä–∞—Ö—É—î—à level access** –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
2. –ó–∞–ø–∏—Å—É—î—à –π–æ–≥–æ –≤ page item, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `P1_ACCESS_LEVEL`.
3. –î–∞–ª—ñ —ñ **SQL-–∑–≤—ñ—Ç**, —ñ **checkbox group** –≤–∂–µ –ø—Ä–∞—Ü—é—é—Ç—å, –ø–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏ `:P1_ACCESS_LEVEL`.

–†–æ–∑–∫–ª–∞–¥–µ–º–æ –ø–æ –∫—Ä–æ–∫–∞—Ö.

---

## 1. –°—Ç–≤–æ—Ä—é—î–º–æ item –¥–ª—è —Ä—ñ–≤–Ω—è –¥–æ—Å—Ç—É–ø—É

–ù–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –∂—É—Ä–Ω–∞–ª—É:

* Page Item: `P1_ACCESS_LEVEL`
* Type: *Hidden* (–∞–±–æ Display Only, —è–∫—â–æ —Ö–æ—á–µ—à –±–∞—á–∏—Ç–∏ –π–æ–≥–æ –ø—Ä–∏ –¥–µ–±–∞–∑—ñ)
* Source: –ø–æ–∫–∏ –º–æ–∂–Ω–∞ –∑–∞–ª–∏—à–∏—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–º (–±—É–¥–µ–º–æ –∑–∞–ø–æ–≤–Ω—é–≤–∞—Ç–∏ –ø—Ä–æ—Ü–µ—Å–æ–º)

---

## 2. Pre-Header process, —è–∫–∏–π –∑–∞–ø–∏—à–µ level access –≤ item

### –í–∞—Ä—ñ–∞–Ω—Ç 1. –í —Ç–µ–±–µ —î —Å–≤–æ—è —Ñ—É–Ω–∫—Ü—ñ—è (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

–Ø–∫—â–æ –≤ —Ç–µ–±–µ —î —â–æ—Å—å —Ç–∏–ø—É `task_security.get_access_level(p_user_tabno)`:

1. –°—Ç–≤–æ—Ä—é—î—à **Process**:

   * Name: `INIT_ACCESS_LEVEL`
   * Point: **Before Header**
   * Type: `PL/SQL Anonymous Block`

2. –ö–æ–¥ –ø—Ä–æ—Ü–µ—Å—É:

```plsql
BEGIN
  :P1_ACCESS_LEVEL := task_security.get_access_level(:PO_CUR_USER_TABNO);
END;
```

–∞–±–æ —è–∫—â–æ –∑–∞ APP_USER:

```plsql
BEGIN
  :P1_ACCESS_LEVEL := task_security.get_access_level(:APP_USER);
END;
```

---

### –í–∞—Ä—ñ–∞–Ω—Ç 2. –†–∞—Ö—É—î—à access level –ø—Ä—è–º–æ –≤ –ø—Ä–æ—Ü–µ—Å—ñ

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —Ç–∏ —Ö–æ—á–µ—à —Å–∫–∞–∑–∞—Ç–∏:
**—è–∫—â–æ —î –∑–∞–ø–∏—Å –≤ `task_access_control` –∑ `access_level = 1` ‚Üí –≤–≤–∞–∂–∞—î–º–æ, —â–æ –≤ –Ω—å–æ–≥–æ LVL=1**.

```plsql
DECLARE
  l_level NUMBER := 0;
BEGIN
  SELECT MAX(al.access_level)
  INTO   l_level
  FROM   TaskTracker.task_access_control@TO_TASKTRACKER10 ac
         JOIN TaskTracker.task_access_level_type@TO_TASKTRACKER10 al
           ON al.id = ac.access_level_id
  WHERE  ac.user_id = :PO_CUR_USER_TABNO;  -- –∞–±–æ —Ç–≤—ñ–π user_id

  :P1_ACCESS_LEVEL := NVL(l_level, 0);
END;
```

–ú–æ–∂–µ—à —É—Å–∫–ª–∞–¥–Ω–∏—Ç–∏ –ª–æ–≥—ñ–∫—É —Ç–∞–∫, —è–∫ —Ç–æ–±—ñ —Ç—Ä–µ–±–∞; –≥–æ–ª–æ–≤–Ω–µ ‚Äî –≤ –∫—ñ–Ω—Ü—ñ:

```plsql
:P1_ACCESS_LEVEL := ...;
```

---

## 3. –£–º–æ–≤–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è Checkbox Group –Ω–∞ –æ—Å–Ω–æ–≤—ñ `P1_ACCESS_LEVEL`

–¢–µ–ø–µ—Ä –≤ `P1_DEPT_FILTER` (Checkbox Group) —Ä–æ–±–∏—à **Server-side Condition**.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥:

### –í–∞—Ä—ñ–∞–Ω—Ç –ê. –ü—Ä–æ—Å—Ç–µ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è

* Condition Type: **Value of Item in Expression 1 = Expression 2**
* Expression 1: `P1_ACCESS_LEVEL`
* Expression 2: `1`

–ê–±–æ:

### –í–∞—Ä—ñ–∞–Ω—Ç –ë. PL/SQL expression

* Condition Type: **PL/SQL Expression**
* Expression:

```plsql
:P1_ACCESS_LEVEL = 1
```

> ‚úÖ –í–∞–∂–ª–∏–≤–æ: –ø—Ä–æ—Ü–µ—Å `INIT_ACCESS_LEVEL` –º–∞—î –±—É—Ç–∏ **Before Header**, —â–æ–± `P1_ACCESS_LEVEL` –≤–∂–µ –º–∞–≤ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º —Ä–µ–≥—ñ–æ–Ω—ñ–≤/–∞–π—Ç–µ–º—ñ–≤.

---

## 4. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ `P1_ACCESS_LEVEL` —â–µ –π —É SQL-–∑–∞–ø–∏—Ç—ñ

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —Ç–∏ —Ö–æ—á–µ—à, —â–æ–±:

* –¥–ª—è level 1 –ø—Ä–∞—Ü—é–≤–∞–≤ —Ñ—ñ–ª—å—Ç—Ä –ø–æ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∞—Ö (checkbox group),
* –¥–ª—è —ñ–Ω—à–∏—Ö —Ä—ñ–≤–Ω—ñ–≤ ‚Äî —Ñ—ñ–ª—å—Ç—Ä —ñ–≥–Ω–æ—Ä—É–≤–∞–≤—Å—è.

–¢–æ–¥—ñ —É **WHERE** —Ç–≤–æ–≥–æ –≤–µ–ª–∏–∫–æ–≥–æ –∑–∞–ø–∏—Ç—É, –≤ —á–∞—Å—Ç–∏–Ω—ñ –∑ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—î—é –ø–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞—Ö, —Ä–æ–±–∏—à —Ç–∞–∫:

```sql
WHERE
  (
    :P1_ACCESS_LEVEL <> 1
    OR :P1_DEPT_FILTER IS NULL
    OR department_id IN (
         SELECT TO_NUMBER(column_value)
         FROM TABLE(apex_string.split(:P1_DEPT_FILTER, ':'))
       )
  )
```

–¢–æ–±—Ç–æ:

* —è–∫—â–æ `P1_ACCESS_LEVEL <> 1` ‚Üí —É–º–æ–≤–∞ –∑–∞–≤–∂–¥–∏ TRUE ‚Üí —Ñ—ñ–ª—å—Ç—Ä –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è;
* —è–∫—â–æ `P1_ACCESS_LEVEL = 1` ‚Üí –≤–∫–ª—é—á–∞—î—Ç—å—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–∞ –ª–æ–≥—ñ–∫–∞ —Ñ—ñ–ª—å—Ç—Ä–∞ –ø–æ —á–µ–∫–±–æ–∫—Å–∞—Ö.

---

## 5. –ü—Ä–æ –ø–æ—Ä—è–¥–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è (—â–æ–± –≤—Å–µ —Ç–æ—á–Ω–æ –ø—Ä–∞—Ü—é–≤–∞–ª–æ)

APEX —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤ —Ç–∞–∫—ñ–π –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ:

1. **Pre-Rendering**:

   * *Before Header* processes ‚úÖ
   * Computations (Before Regions)
   * Regions, Items, SQL-–∑–≤—ñ—Ç–∏
2. Rendering HTML

–¢–æ–±—Ç–æ, –∫–æ–ª–∏ –º–∏ —Å—Ç–∞–≤–∏–º–æ –ø—Ä–æ—Ü–µ—Å `INIT_ACCESS_LEVEL` –Ω–∞ **Before Header**, –Ω–∞ –º–æ–º–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É:

* `:P1_ACCESS_LEVEL` —É–∂–µ –≤ —Å–µ—Å—ñ—ó,
* condition –Ω–∞ Checkbox Group (—ñ –Ω–∞ —Ä–µ–≥—ñ–æ–Ω, —ñ –Ω–∞ item) –≤–∂–µ –º–æ–∂–µ –π–æ–≥–æ —á–∏—Ç–∞—Ç–∏,
* SQL-–∑–∞–ø–∏—Ç —É–∂–µ –±–∞—á–∏—Ç—å —Ü–µ –∑–Ω–∞—á–µ–Ω–Ω—è.

---

–Ø–∫—â–æ —Ö–æ—á–µ—à, –º–æ–∂—É:

* –¥–∞—Ç–∏ –≥–æ—Ç–æ–≤—É –∑–≤‚Äô—è–∑–∫—É: **process + condition + —Ñ—Ä–∞–≥–º–µ–Ω—Ç WHERE** –≤ –æ–¥–Ω–æ–º—É —à–º–∞—Ç–∫—É –∫–æ–¥—É 1:1 –ø—ñ–¥ —Ç–≤–æ—é —Å—Ç–æ—Ä—ñ–Ω–∫—É (–∑ –Ω–∞–∑–≤–æ—é —Å—Ç–æ—Ä—ñ–Ω–∫–∏/–∞–π—Ç–µ–º–∞, —è–∫ –≤ —Ç–µ–±–µ –≤ APEX),
* –∞–±–æ –¥–æ–ø–æ–º–æ–≥—Ç–∏ –æ–¥—Ä–∞–∑—É –¥–æ–¥–∞—Ç–∏ –¥—Ä—É–≥–∏–π —Ñ—ñ–ª—å—Ç—Ä (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, checkbox group –ø–æ UNIT) –∑–∞ –∞–Ω–∞–ª–æ–≥—ñ—î—é.
