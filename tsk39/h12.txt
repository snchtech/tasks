–û, –¥—É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ üëå ‚Äî –ª–æ–≥ –º–∞—î —Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ –Ω–µ —Ç—ñ–ª—å–∫–∏ —Å–∞–º —Ñ–∞–∫—Ç –≤—Ö–æ–¥—É, –∞–ª–µ –π **–∫–æ–Ω—Ç–µ–∫—Å—Ç**, —É —è–∫–æ–º—É –ø—Ä–∞—Ü—é–≤–∞–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á (—Å–≤—ñ–π —á–∏ –≤ —Ä–µ–∂–∏–º—ñ –∑–∞–º—ñ—â–µ–Ω–Ω—è).

---

## üìå –ü—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `SHIFT_PERSONAL_LOGGER`

–î–æ–¥–∞—î–º–æ –Ω–æ–≤—ñ –∫–æ–ª–æ–Ω–∫–∏:

```sql
ALTER TABLE SHIFT_PERSONAL_LOGGER ADD (
    IS_SUBSTITUTION    CHAR(1) DEFAULT 'N' CHECK (IS_SUBSTITUTION IN ('Y','N')),
    CHIEF_TAB_NO       NUMBER,      -- —Ç–∞–±–µ–ª—å–Ω–∏–π –Ω–æ–º–µ—Ä –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞
    CHIEF_POSITION_ID  NUMBER       -- –ø–æ—Å–∞–¥–∞ –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞
);
```

---

## üìå –õ–æ–≥—ñ–∫–∞ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è

### üîπ 1. –ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞—Ö–æ–¥–∏—Ç—å –±–µ–∑ –∑–∞–º—ñ—â–µ–Ω–Ω—è (`P0_SUBSTITUTION = 0`)

* `IS_SUBSTITUTION = 'N'`
* `CHIEF_TAB_NO = NULL`
* `CHIEF_POSITION_ID = NULL`

### üîπ 2. –ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞—Ö–æ–¥–∏—Ç—å —É —Ä–µ–∂–∏–º—ñ –∑–∞–º—ñ—â–µ–Ω–Ω—è (`P0_SUBSTITUTION = 1`)

* `IS_SUBSTITUTION = 'Y'`
* `CHIEF_TAB_NO = :P0_CUR_USER_TABNO`   (—Ç–æ–±—Ç–æ —Ç–∞–±–µ–ª—å–Ω–∏–π –Ω–æ–º–µ—Ä –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞, —è–∫–æ–≥–æ –∑–∞–º—ñ—â–∞—é—Ç—å)
* `CHIEF_POSITION_ID = :P0_CUR_USER_POSITION`

–ê —É –∑–≤–∏—á–∞–π–Ω—ñ –ø–æ–ª—è (`TAB_NO`, `POSITION_ID`) –ø–∏—à–µ–º–æ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–∏–π —Ä–µ–∞–ª—å–Ω–æ –∑–∞–π—à–æ–≤.

---

## üìå –ü—Ä–∏–∫–ª–∞–¥ PL/SQL –ø—Ä–æ—Ü–µ—Å—É –≤—Å—Ç–∞–≤–∫–∏ (—Å–ø—Ä–æ—â–µ–Ω–∏–π)

```plsql
DECLARE
    v_shift_start DATE;
    v_shift_end   DATE;
BEGIN
    -- –û—Ç—Ä–∏–º—É—î–º–æ —ñ–Ω—Ç–µ—Ä–≤–∞–ª –∑–º—ñ–Ω–∏
    IF :P0_SHIFT_NUMBER IS NOT NULL THEN
        SELECT TRUNC(SYSDATE, 'DD') + (CAST(TO_CHAR(TIME_START, 'HH24:MI:SS') AS INTERVAL DAY TO SECOND)),
               TRUNC(SYSDATE, 'DD') + (CAST(TO_CHAR(TIME_END,   'HH24:MI:SS') AS INTERVAL DAY TO SECOND))
        INTO v_shift_start, v_shift_end
        FROM DEPARTMENT_SHIFT_NUMBER
        WHERE DEPARTMENT_ID   = :P0_DEPARTMENT_ID
          AND SHIFT_NUMBER_ID = :P0_SHIFT_NUMBER;
    ELSE
        v_shift_start := :P0_SHIFT_START;
        v_shift_end   := :P0_SHIFT_END;
    END IF;

    -- –í—Å—Ç–∞–≤–∫–∞ —É –ª–æ–≥
    INSERT INTO SHIFT_PERSONAL_LOGGER (
        TAB_NO,
        DEPARTMENT_ID,
        POSITION_ID,
        SHIFT_SYMBOL_ID,
        SHIFT_NUMBER_ID,
        SHIFT_START,
        SHIFT_END,
        SOURCE_APP,
        CREATED_BY,
        IS_SUBSTITUTION,
        CHIEF_TAB_NO,
        CHIEF_POSITION_ID
    ) VALUES (
        CASE WHEN :P0_SUBSTITUTION = 1 THEN :P0_NEW_TAB_NO ELSE :P0_CUR_USER_TABNO END,
        CASE WHEN :P0_SUBSTITUTION = 1 THEN :P0_NEW_DEPARTMENT_ID ELSE :P0_CUR_USER_DEPARTMENT END,
        CASE WHEN :P0_SUBSTITUTION = 1 THEN :P0_NEW_POSITION_ID ELSE :P0_CUR_USER_POSITION END,
        :P0_SHIFT_SYMBOL,
        :P0_SHIFT_NUMBER,
        v_shift_start,
        v_shift_end,
        :APP_ID,
        :APP_USER,
        CASE WHEN :P0_SUBSTITUTION = 1 THEN 'Y' ELSE 'N' END,
        CASE WHEN :P0_SUBSTITUTION = 1 THEN :P0_CUR_USER_TABNO END,
        CASE WHEN :P0_SUBSTITUTION = 1 THEN :P0_CUR_USER_POSITION END
    )
    RETURNING SHIFT_SYMBOL_ID, SHIFT_NUMBER_ID, SHIFT_START, SHIFT_END
    INTO :P0_SHIFT_SYMBOL, :P0_SHIFT_NUMBER, :P0_SHIFT_START, :P0_SHIFT_END;
END;
```

---

## üìå –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∑–≤—ñ—Ç—ñ

–£ –≤–∞—à–æ–º—É –∂—É—Ä–Ω–∞–ª—ñ –∑–∞–≤–¥–∞–Ω—å –º–æ–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç–∏:

* –Ø–∫—â–æ `IS_SUBSTITUTION = 'N'` ‚Üí *"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—Ä–∞—Ü—é–≤–∞–≤ –ø—ñ–¥ —Å–æ–±–æ—é"*.
* –Ø–∫—â–æ `IS_SUBSTITUTION = 'Y'` ‚Üí *"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—Ä–∞—Ü—é–≤–∞–≤ —É —Ä–µ–∂–∏–º—ñ –∑–∞–º—ñ—â–µ–Ω–Ω—è –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞ (TabNo = 12345, –ü–æ—Å–∞–¥–∞ = 2206)"*.

---

‚úÖ –¢–∞–∫–∏–º —á–∏–Ω–æ–º:

* –í–∏ –∑–∞–≤–∂–¥–∏ –∑–Ω–∞—î—Ç–µ, —Ö—Ç–æ —Ñ—ñ–∑–∏—á–Ω–æ –∑–∞–π—à–æ–≤ (`TAB_NO`, `POSITION_ID`).
* –Ü —á–∏ —Ü–µ –±—É–≤ **–π–æ–≥–æ –≤–ª–∞—Å–Ω–∏–π –∑–∞—Ö—ñ–¥**, —á–∏ **–∑–∞–º—ñ—â–µ–Ω–Ω—è –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞** (`IS_SUBSTITUTION + CHIEF_*`).

---

–•–æ—á–µ—Ç–µ, —è –ø—ñ–¥–≥–æ—Ç—É—é —â–µ **SQL-–∑–∞–ø–∏—Ç –¥–ª—è –∑–≤—ñ—Ç—É**, –¥–µ –±—É–¥–µ –∫–æ–ª–æ–Ω–∞ `"–†–µ–∂–∏–º —Ä–æ–±–æ—Ç–∏"` —ñ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º —Ç–µ–∫—Å—Ç–æ–º `"–ü—ñ–¥ —Å–æ–±–æ—é"` –∞–±–æ `"–ó–∞–º—ñ—â–µ–Ω–Ω—è –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞ (–ü–Ü–ë, –ø–æ—Å–∞–¥–∞)"`?
