–ß—É–¥–æ–≤–æ üëç
–£ –≤–∞—à–æ–º—É –≤–∏–ø–∞–¥–∫—É –Ω–∞–π–∑—Ä—É—á–Ω—ñ—à–µ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ —É **PL/SQL –ø—Ä–æ—Ü–µ—Å—ñ –≤ APEX** (–∞–±–æ —É **—Ç—Ä–∏–≥–µ—Ä—ñ** –Ω–∞ —Ç–∞–±–ª–∏—Ü—ñ, —è–∫—â–æ —Ç—Ä–µ–±–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ).
–Ø –ø–æ–∫–∞–∂—É –≤–∞—Ä—ñ–∞–Ω—Ç –ø—Ä–æ—Ü–µ—Å—É –¥–ª—è APEX, –±–æ –≤—ñ–Ω –¥–∞—î –≤–∞–º –∫–æ–Ω—Ç—Ä–æ–ª—å —ñ –ø—Ä–æ—Å—Ç—ñ—à–µ –≤—ñ–¥–ª–∞–≥–æ–¥–∂—É—î—Ç—å—Å—è.

---

## üìå –ü—Ä–∏–∫–ª–∞–¥ PL/SQL –ø—Ä–æ—Ü–µ—Å—É (–Ω–∞ APEX-—Å—Ç–æ—Ä—ñ–Ω—Ü—ñ)

```plsql
DECLARE
    v_time_start DATE := SYSDATE;
    v_time_end   DATE;
BEGIN
    -- –Ø–∫—â–æ –≤–∫–∞–∑–∞–Ω–∏–π shift_number_id ‚Üí –±–µ—Ä–µ–º–æ –≥–æ–¥–∏–Ω–∏ –∑ –¥–æ–≤—ñ–¥–Ω–∏–∫–∞
    IF :P0_SHIFT_NUMBER_ID IS NOT NULL THEN
        SELECT 
            -- TIME_START –º–æ–∂–Ω–∞ —Ç–µ–∂ –ø—ñ–¥—Ç—è–≥–Ω—É—Ç–∏ –∑ –¥–æ–≤—ñ–¥–Ω–∏–∫–∞, –∞–ª–µ —á–∞—Å—Ç—ñ—à–µ —Ü–µ SYSDATE
            TRUNC(SYSDATE, 'DD') + (CAST(TO_CHAR(TIME_START, 'HH24:MI:SS') AS INTERVAL DAY TO SECOND)),
            TRUNC(SYSDATE, 'DD') + (CAST(TO_CHAR(TIME_END, 'HH24:MI:SS') AS INTERVAL DAY TO SECOND))
        INTO v_time_start, v_time_end
        FROM DEPARTMENT_SHIFT_NUMBER
        WHERE DEPARTMENT_ID = :P0_DEPARTMENT_ID
          AND SHIFT_NUMBER_ID = :P0_SHIFT_NUMBER_ID;

    ELSE
        -- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å–∞–º –≤–≤—ñ–≤ —á–∞—Å
        v_time_start := :P0_TIME_START;
        v_time_end   := :P0_TIME_END;
    END IF;

    INSERT INTO SHIFT_PERSONAL_LOGGER (
        TAB_NO,
        DEPARTMENT_ID,
        POSITION_ID,
        SHIFT_SYMBOL_ID,
        SHIFT_NUMBER_ID,
        TIME_START,
        TIME_END,
        SOURCE_APP,
        CREATED_BY
    ) VALUES (
        :P0_TAB_NO,
        :P0_DEPARTMENT_ID,
        :P0_POSITION_ID,
        :P0_SHIFT_SYMBOL_ID,
        :P0_SHIFT_NUMBER_ID,
        v_time_start,
        v_time_end,
        :APP_ID,
        :APP_USER
    );
END;
```

---

## üìå –ü–æ—è—Å–Ω–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏

1. –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–±—Ä–∞–≤ **`SHIFT_NUMBER_ID`** ‚Üí

   * –º–∏ –ø—ñ–¥—Ç—è–≥—É—î–º–æ `TIME_START` —ñ `TIME_END` —ñ–∑ —Ç–∞–±–ª–∏—Ü—ñ `DEPARTMENT_SHIFT_NUMBER` –¥–ª—è –π–æ–≥–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—É —Ç–∞ –∑–º—ñ–Ω–∏.
   * —â–æ–± –≥–æ–¥–∏–Ω—É "–Ω–∞–∫–ª–∞—Å—Ç–∏" –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—é –¥–∞—Ç—É, –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—é `TRUNC(SYSDATE) + TO_CHAR(TIME_START,'HH24:MI:SS')`.
2. –Ø–∫—â–æ `SHIFT_NUMBER_ID` = NULL ‚Üí

   * –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —Ä—É—á–Ω—ñ `P0_TIME_START` —Ç–∞ `P0_TIME_END`.
3. –î–∞–ª—ñ —Ä–æ–±–∏—Ç—å—Å—è **INSERT** —É `SHIFT_PERSONAL_LOGGER`.

---

## üìå –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ ‚Äî –¢–†–ò–ì–ï–† –Ω–∞ —Ç–∞–±–ª–∏—Ü—ñ

–Ø–∫—â–æ —Ö–æ—á–µ—Ç–µ, —â–æ–± —Ü–µ –ø—Ä–∞—Ü—é–≤–∞–ª–æ **–∑–∞–≤–∂–¥–∏**, –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ APEX —á–∏ —ñ–Ω—à–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É:

```plsql
CREATE OR REPLACE TRIGGER trg_shift_logger_bi
BEFORE INSERT ON SHIFT_PERSONAL_LOGGER
FOR EACH ROW
DECLARE
    v_time_start DATE;
    v_time_end   DATE;
BEGIN
    IF :NEW.SHIFT_NUMBER_ID IS NOT NULL THEN
        SELECT 
            TRUNC(SYSDATE, 'DD') + (CAST(TO_CHAR(TIME_START, 'HH24:MI:SS') AS INTERVAL DAY TO SECOND)),
            TRUNC(SYSDATE, 'DD') + (CAST(TO_CHAR(TIME_END, 'HH24:MI:SS') AS INTERVAL DAY TO SECOND))
        INTO v_time_start, v_time_end
        FROM DEPARTMENT_SHIFT_NUMBER
        WHERE DEPARTMENT_ID = :NEW.DEPARTMENT_ID
          AND SHIFT_NUMBER_ID = :NEW.SHIFT_NUMBER_ID;

        :NEW.TIME_START := v_time_start;
        :NEW.TIME_END   := v_time_end;
    END IF;
END;
/
```

---

üîπ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:**

* –Ø–∫—â–æ —Ü–µ –ª–∏—à–µ –¥–ª—è APEX-—Ñ–æ—Ä–º–∏ ‚Üí —Ä–æ–±—ñ—Ç—å —á–µ—Ä–µ–∑ **Process** (–≥–Ω—É—á–∫—ñ—à–µ).
* –Ø–∫—â–æ –¥–ª—è –±–∞–≥–∞—Ç—å–æ—Ö –∑–∞—Å—Ç–æ—Å—É–Ω–∫—ñ–≤ ‚Üí —Ä–æ–±—ñ—Ç—å —á–µ—Ä–µ–∑ **—Ç—Ä–∏–≥–µ—Ä**.

---

–•–æ—á–µ—Ç–µ, —è –¥–æ–ø–æ–≤–Ω—é –ø—Ä–∏–∫–ª–∞–¥–æ–º **SQL-–∑–∞–ø–∏—Ç—É**, —è–∫ –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –ø—Ä–∏ –≤—Ö–æ–¥—ñ –≤ –¥–æ–¥–∞—Ç–æ–∫, —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–∂–µ "–Ω–∞ –∑–º—ñ–Ω—ñ" (—Ç–æ–±—Ç–æ —Ñ–æ—Ä–º–∞ –π–æ–º—É –Ω–µ –ø–æ–≤–∏–Ω–Ω–∞ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏—Å—è)?
