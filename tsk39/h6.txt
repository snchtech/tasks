–î–æ–±—Ä–µ üôå –î–∞–≤–∞–π—Ç–µ —Å–∫–ª–∞–¥—É –ø–æ–≤–Ω–∏–π **PL/SQL –ø—Ä–æ—Ü–µ—Å Insert** –¥–ª—è –≤–∞—à–æ—ó —Ñ–æ—Ä–º–∏ –≤–∏–±–æ—Ä—É –∑–º—ñ–Ω–∏.

---

## üìå –õ–æ–≥—ñ–∫–∞ –ø—Ä–æ—Ü–µ—Å—É

1. –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–±—Ä–∞–≤ **`SHIFT_NUMBER_ID`** ‚Üí

   * –±–µ—Ä–µ–º–æ `TIME_START = SYSDATE`
   * `TIME_END` –ø—ñ–¥—Ç—è–≥—É—î–º–æ –∑ –¥–æ–≤—ñ–¥–Ω–∏–∫–∞ `DEPARTMENT_SHIFT_NUMBER` (–¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—É —Ç–∞ –Ω–æ–º–µ—Ä–∞ –∑–º—ñ–Ω–∏).
2. –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á **–Ω–µ –≤–∏–±—Ä–∞–≤ `SHIFT_NUMBER_ID`**, –∞–ª–µ –≤–≤—ñ–≤ **`TIME_START` —Ç–∞ `TIME_END` –≤—Ä—É—á–Ω—É** ‚Üí

   * –∑–∞–ø–∏—Å—É—î–º–æ —Ü—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞–ø—Ä—è–º—É.
3. –î–∞–Ω—ñ –∑–∞–Ω–æ—Å—è—Ç—å—Å—è –≤ `SHIFT_PERSONAL_LOGGER`.
4. –ü—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∑–∞–ø–æ–≤–Ω—é—î–º–æ –≥–ª–æ–±–∞–ª—å–Ω—ñ item-–∏ `P0_SHIFT_SYMBOL, P0_SHIFT_NUMBER, P0_SHIFT_START, P0_SHIFT_END`.

---

## üìå –ü—Ä–∏–∫–ª–∞–¥ –ø—Ä–æ—Ü–µ—Å—É (Server-side Code, APEX)

```plsql
DECLARE
    v_time_start   DATE := SYSDATE;
    v_time_end     DATE;
BEGIN
    -- –Ø–∫—â–æ –≤–∫–∞–∑–∞–Ω–æ SHIFT_NUMBER_ID ‚Üí –±–µ—Ä–µ–º–æ –≥–æ–¥–∏–Ω–∏ –∑ –¥–æ–≤—ñ–¥–Ω–∏–∫–∞
    IF :P0_SHIFT_NUMBER IS NOT NULL THEN
        SELECT 
            TRUNC(SYSDATE, 'DD') + (CAST(TO_CHAR(TIME_START, 'HH24:MI:SS') AS INTERVAL DAY TO SECOND)),
            TRUNC(SYSDATE, 'DD') + (CAST(TO_CHAR(TIME_END,   'HH24:MI:SS') AS INTERVAL DAY TO SECOND))
        INTO v_time_start, v_time_end
        FROM DEPARTMENT_SHIFT_NUMBER
        WHERE DEPARTMENT_ID   = :P0_DEPARTMENT_ID
          AND SHIFT_NUMBER_ID = :P0_SHIFT_NUMBER;

    ELSE
        -- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–≤–æ–¥–∏—Ç—å —á–∞—Å –≤—Ä—É—á–Ω—É
        v_time_start := :P0_SHIFT_START;
        v_time_end   := :P0_SHIFT_END;
    END IF;

    -- –í—Å—Ç–∞–≤–∫–∞ —É —Ç–∞–±–ª–∏—Ü—é –ª–æ–≥—É–≤–∞–Ω–Ω—è
    INSERT INTO SHIFT_PERSONAL_LOGGER (
        TAB_NO,
        DEPARTMENT_ID,
        POSITION_ID,
        SHIFT_SYMBOL_ID,
        SHIFT_NUMBER_ID,
        TIME_START,
        TIME_END,
        SOURCE_APP,
        CREATED_BY
    ) VALUES (
        :P0_TAB_NO,
        :P0_DEPARTMENT_ID,
        :P0_POSITION_ID,
        :P0_SHIFT_SYMBOL,
        :P0_SHIFT_NUMBER,
        v_time_start,
        v_time_end,
        :APP_ID,
        :APP_USER
    )
    RETURNING SHIFT_SYMBOL_ID, SHIFT_NUMBER_ID, TIME_START, TIME_END
    INTO :P0_SHIFT_SYMBOL, :P0_SHIFT_NUMBER, :P0_SHIFT_START, :P0_SHIFT_END;

END;
```

---

## üìå –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ

* `RETURNING ‚Ä¶ INTO ‚Ä¶` –≤—ñ–¥—Ä–∞–∑—É –Ω–∞–ø–æ–≤–Ω—é—î –≥–ª–æ–±–∞–ª—å–Ω—ñ item-–∏.
* –Ø–∫—â–æ —Ç—Ä–µ–±–∞ –∂–æ—Ä—Å—Ç–∫–æ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏, —â–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–±–æ –≤–∏–±–∏—Ä–∞–≤ **–Ω–æ–º–µ—Ä –∑–º—ñ–Ω–∏**, –∞–±–æ **—á–∞—Å –≤—Ä—É—á–Ω—É**, –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É:

```plsql
IF :P0_SHIFT_NUMBER IS NULL AND (:P0_SHIFT_START IS NULL OR :P0_SHIFT_END IS NULL) THEN
    RAISE_APPLICATION_ERROR(-20001, '–í–∏–±–µ—Ä—ñ—Ç—å –Ω–æ–º–µ—Ä –∑–º—ñ–Ω–∏ –∞–±–æ –≤–∫–∞–∂—ñ—Ç—å —á–∞—Å –≤—Ä—É—á–Ω—É');
END IF;
```

---

‚úÖ –¢–µ–ø–µ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞–ø–æ–≤–Ω–∏—Ç—å —Ñ–æ—Ä–º—É ‚Üí –¥–∞–Ω—ñ –∑–±–µ—Ä–µ–∂—É—Ç—å—Å—è –≤ `SHIFT_PERSONAL_LOGGER` ‚Üí –≥–ª–æ–±–∞–ª—å–Ω—ñ item-–∏ –æ–Ω–æ–≤–ª—è—Ç—å—Å—è ‚Üí –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –≤—Ö–æ–¥—ñ —Ñ–æ—Ä–º–∞ –±—ñ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è, –ø–æ–∫–∏ –Ω–µ –ø—Ä–æ–π–¥–µ `TIME_END`.

---

–•–æ—á–µ—Ç–µ, —è —â–µ –ø—ñ–¥–≥–æ—Ç—É—é **SQL –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –Ω–∞ –≤—Ö–æ–¥—ñ** (–≤ `Before Header` –∞–±–æ `Before Page Load`), —â–æ–± –≤—ñ–¥—Ä–∞–∑—É —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–∞ –≥–æ–ª–æ–≤–Ω—É, —è–∫—â–æ —É –Ω—å–æ–≥–æ –≤–∂–µ —î –∞–∫—Ç–∏–≤–Ω–∏–π –∑–∞–ø–∏—Å —É `SHIFT_PERSONAL_LOGGER`?
