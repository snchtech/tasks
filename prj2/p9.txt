–ó—Ä–æ–∑—É–º—ñ–≤ üëç.
–£ –≤–∞—Å Oracle 10g, —ñ –≤–∏ —Ö–æ—á–µ—Ç–µ –æ—Ä–≥–∞–Ω—ñ–∑—É–≤–∞—Ç–∏ **job**, —è–∫–∏–π:

1. –†–∞—Ö—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤ –∑–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –¥–µ–Ω—å.
2. –í—Å—Ç–∞–≤–ª—è—î –∑–∞–ø–∏—Å —É `prt_prot` —ñ–∑ –∫—ñ–ª—å–∫—ñ—Å—Ç—é.
3. –ó–∞–ø–∞–º‚Äô—è—Ç–æ–≤—É—î `id` —Ü—å–æ–≥–æ –∑–∞–ø–∏—Å—É.
4. –í—Å—Ç–∞–≤–ª—è—î –¥–µ—Ç–∞–ª—ñ —É `prt_n`, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ü–µ–π `prt_prot_id`.

### –í–∞–∂–ª–∏–≤—ñ –º–æ–º–µ–Ω—Ç–∏ –¥–ª—è Oracle 10g:

* –£ 10g **—î –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ `RETURNING INTO`** (–ø–æ—á–∏–Ω–∞—é—á–∏ –∑ 8i). –¢–æ–±—Ç–æ –º–æ–∂–Ω–∞ –æ–¥—Ä–∞–∑—É –æ—Ç—Ä–∏–º–∞—Ç–∏ `id` –∑ —ñ–Ω—Å–µ—Ä—Ç–∞ –≤ `prt_prot`.
* –Ø–∫—â–æ –≤ `prt_prot.id` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **trigger + sequence**, —Ç–æ `RETURNING INTO` –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ –≤—ñ–¥–ø—Ä–∞—Ü—é—î.
* –Ø–∫—â–æ ID –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —ñ–Ω—à–∏–º —á–∏–Ω–æ–º (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑ –ø–∞–∫–µ—Ç—É), —Ç–æ–¥—ñ —Ç—Ä–µ–±–∞ —É—Ç–æ—á–Ω–∏—Ç–∏, –∞–ª–µ –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ sequence + trigger –±—É–¥–µ –æ–∫.

---

### –ü—Ä–∏–∫–ª–∞–¥ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ –ø—Ä–æ—Ü–µ–¥—É—Ä—É

```sql
CREATE OR REPLACE PROCEDURE job_transfer_data IS
    v_count        NUMBER;
    v_id           prt_prot.id%TYPE; -- id –∑ prt_prot
BEGIN
    -- 1. –†–∞—Ö—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤ –∑–∞ –≤—á–æ—Ä–∞
    SELECT COUNT(*)
    INTO v_count
    FROM USER_SESSIONS t
    LEFT JOIN request_log r 
           ON r.user_session_row_id = t.id
    LEFT JOIN pp.pp_points kp 
           ON kp.id = r.id_pp_point
    WHERE TRUNC(r.request_date) = TRUNC(SYSDATE - 1);

    -- 2. –í—Å—Ç–∞–≤–ª—è—î–º–æ —É prt_prot —ñ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ id
    INSERT INTO prt_prot (id, full_file_name, file_name, result, creator, create_date)
    VALUES (prt_prot_seq.NEXTVAL, -- —è–∫—â–æ id –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è sequence'–æ–º
            'text1',
            'text.sql',
            TO_CHAR(SYSDATE,'dd.mm.yyyy hh24:mi:ss') || ' + –î–æ–¥–∞–Ω–æ: ' || v_count,
            'PP',
            SYSDATE)
    RETURNING id INTO v_id; -- –æ—Ç—Ä–∏–º–∞—î–º–æ id –≤—Å—Ç–∞–≤–ª–µ–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É

    -- 3. –í—Å—Ç–∞–≤–ª—è—î–º–æ –≤—Å—ñ —Ä—è–¥–∫–∏ —É prt_n
    INSERT INTO prt_n (prt_prot_id, user_id, data_time, oznaka, creator, create_date, f_id)
    SELECT v_id,
           t.user_id,
           r.request_date,
           r.action_type_id,
           'PP',
           SYSDATE,
           kp.id
    FROM USER_SESSIONS t
    LEFT JOIN request_log r 
           ON r.user_session_row_id = t.id
    LEFT JOIN pp.pp_points kp 
           ON kp.id = r.id_pp_point
    WHERE TRUNC(r.request_date) = TRUNC(SYSDATE - 1);

    COMMIT;
END;
/
```

---

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è JOB

```sql
BEGIN
    DBMS_SCHEDULER.create_job (
        job_name        => 'JOB_TRANSFER_DATA',
        job_type        => 'STORED_PROCEDURE',
        job_action      => 'job_transfer_data',
        start_date      => SYSTIMESTAMP,
        repeat_interval => 'FREQ=DAILY;BYHOUR=2;BYMINUTE=0;BYSECOND=0', -- –∫–æ–∂–µ–Ω –¥–µ–Ω—å –æ 02:00
        enabled         => TRUE
    );
END;
/
```

---

‚úÖ –¢–∞–∫–∏–º —á–∏–Ω–æ–º:

* `RETURNING INTO` —É 10g –ø—Ä–∞—Ü—é—î.
* –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `prt_prot_seq.NEXTVAL` –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –≤–∏ –º–∞—î—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ sequence. –Ø–∫—â–æ `id` –≤–∏—Å—Ç–∞–≤–ª—è—î—Ç—å—Å—è —Ç—Ä–∏–≥–µ—Ä–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ ‚Äî `RETURNING id INTO v_id` —Ç–µ–∂ —Å–ø—Ä–∞—Ü—é—î.

---

–•–æ—á–µ—Ç–µ, —è –∑—Ä–æ–±–ª—é —â–µ –≤–∞—Ä—ñ–∞–Ω—Ç **–±–µ–∑ sequence**, —Ç—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ `trigger` (–∞–≤—Ç–æ—ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç ID), —â–æ–± —Ç–æ—á–Ω–æ –Ω–µ –∑–∞–ª–µ–∂–∞—Ç–∏ –≤—ñ–¥ –¥–æ—Å—Ç—É–ø—É –¥–æ `NEXTVAL`?
