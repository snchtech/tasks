–û, –≥–∞—Ä–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è üëå
–¢—É—Ç —î –¥–≤–∞ —Ä—ñ–≤–Ω—ñ, –¥–µ –º–æ–∂–Ω–∞ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ ‚Äú—ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è‚Äù:

---

### üîπ –í–∞—Ä—ñ–∞–Ω—Ç 1. –ü–æ–ª–µ-—Å—Ç–∞—Ç—É—Å —É —Ç–∞–±–ª–∏—Ü—ñ `prt_prot`

–ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–µ ‚Äî –¥–æ–¥–∞—Ç–∏ –≤ `prt_prot` —â–µ –æ–¥–Ω—É –∫–æ–ª–æ–Ω–∫—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

```sql
ALTER TABLE prt_prot ADD transfer_status VARCHAR2(20);
```

–Ü —Ç–æ–¥—ñ –ª–æ–≥—ñ–∫–∞ –±—É–¥–µ —Ç–∞–∫–∞:

1. –ü—Ä–∏ –≤—Å—Ç–∞–≤—Ü—ñ —É `prt_prot` —Å—Ç–∞–≤–∏–º–æ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `transfer_status = 'IN_PROGRESS'`.
2. –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ —ñ–Ω—Å–µ—Ä—Ç–∞ –≤ `prt_n` –æ–Ω–æ–≤–ª—é—î–º–æ `transfer_status = 'DONE'`.
3. –Ø–∫—â–æ —Å—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ ‚Äî –∑–∞–ø–∏—Å –∑–∞–ª–∏—à–∏—Ç—å—Å—è –∑ `IN_PROGRESS`, —ñ –≤–∏ –∑–º–æ–∂–µ—Ç–µ —Ü–µ –≤—ñ–¥–ª–æ–≤–∏—Ç–∏.

–£ –ø—Ä–æ—Ü–µ–¥—É—Ä—ñ —Ü–µ –±—É–¥–µ —Ç–∞–∫:

```sql
    -- –≤—Å—Ç–∞–≤–∫–∞ —É prt_prot
    INSERT INTO prt_prot (full_file_name, file_name, result, creator, create_date, transfer_status)
    VALUES ('text1',
            'text.sql',
            TO_CHAR(SYSDATE,'dd.mm.yyyy hh24:mi:ss') || ' + –î–æ–¥–∞–Ω–æ: ' || v_count,
            'PP',
            SYSDATE,
            'IN_PROGRESS')
    RETURNING id INTO v_id;

    -- –≤—Å—Ç–∞–≤–∫–∞ —É prt_n
    INSERT INTO prt_n (...)
    SELECT v_id, ...
    FROM ...;

    -- –ø—ñ—Å–ª—è —É—Å–ø—ñ—Ö—É –æ–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞—Ç—É—Å
    UPDATE prt_prot SET transfer_status = 'DONE' WHERE id = v_id;
```

---

### üîπ –í–∞—Ä—ñ–∞–Ω—Ç 2. –û–∫—Ä–µ–º–∞ —Ç–∞–±–ª–∏—Ü—è-–ª–æ–≥

–ó–∞–º—ñ—Å—Ç—å –ø–æ–ª—è –≤ `prt_prot` –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ **—Ç–µ—Ö–Ω—ñ—á–Ω—É —Ç–∞–±–ª–∏—Ü—é-–ª–æ–≥**, –∫—É–¥–∏ job –±—É–¥–µ –ø–∏—Å–∞—Ç–∏:

* —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è,
* –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—Å—Ç–∞–≤–ª–µ–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤,
* —Å—Ç–∞—Ç—É—Å (`SUCCESS` / `FAILED`),
* —Ç–µ–∫—Å—Ç –ø–æ–º–∏–ª–∫–∏ (—è–∫—â–æ —î).

–¶–µ –∑—Ä—É—á–Ω–æ, —è–∫—â–æ —É –≤–∞—Å —Ç–∞–∫–∏—Ö job –±–∞–≥–∞—Ç–æ —ñ —Ç—Ä–µ–±–∞ –±–∞—á–∏—Ç–∏ ‚Äú—ñ—Å—Ç–æ—Ä—ñ—é‚Äù.

```sql
CREATE TABLE prt_transfer_log (
    id NUMBER PRIMARY KEY,
    job_date DATE,
    prot_id NUMBER,
    row_count NUMBER,
    status VARCHAR2(20),
    error_msg VARCHAR2(4000)
);
```

–£ –∫–æ–¥—ñ:

```sql
BEGIN
    -- ... –≤—Å—Ç–∞–≤–∫–∞ —É prt_prot, prt_n ...
    INSERT INTO prt_transfer_log (id, job_date, prot_id, row_count, status)
    VALUES (prt_transfer_log_seq.NEXTVAL, SYSDATE, v_id, v_count, 'SUCCESS');
EXCEPTION
    WHEN OTHERS THEN
        INSERT INTO prt_transfer_log (id, job_date, prot_id, row_count, status, error_msg)
        VALUES (prt_transfer_log_seq.NEXTVAL, SYSDATE, v_id, v_count, 'FAILED', SQLERRM);
        RAISE; -- —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –ø–æ–º–∏–ª–∫—É —É job
END;
```

---

### üîπ –í–∞—Ä—ñ–∞–Ω—Ç 3. –ö–æ–º–±—ñ–Ω–æ–≤–∞–Ω–∏–π

–ú–æ–∂–Ω–∞ —ñ –ø–æ–ª–µ `transfer_status` —É `prt_prot`, —ñ –ª–æ–≥-—Ç–∞–±–ª–∏—Ü—é –¥–ª—è —ñ—Å—Ç–æ—Ä—ñ—ó.
–ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Ç–æ–≥–æ, —á–∏ –≤–∞–º –≤–∞–∂–ª–∏–≤–æ –º–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é —á–∏ –ª–∏—à–µ –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω.

---

üëâ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:

* –Ø–∫—â–æ job **–∑–∞–≤–∂–¥–∏ –æ–¥–∏–Ω** —ñ —Å—Ç–æ—Å—É—î—Ç—å—Å—è **—Ç—ñ–ª—å–∫–∏ —Ü—ñ—î—ó —Ç–∞–±–ª–∏—Ü—ñ** ‚Üí –≤–∏—Å—Ç–∞—á–∏—Ç—å `transfer_status` —É `prt_prot`.
* –Ø–∫—â–æ job –±—É–¥–µ –∫—ñ–ª—å–∫–∞ —ñ –≤–∏ —Ö–æ—á–µ—Ç–µ **–¥–∏–≤–∏—Ç–∏—Å—è —ñ—Å—Ç–æ—Ä—ñ—é** ‚Üí –∫—Ä–∞—â–µ —Ä–æ–±–∏—Ç–∏ `prt_transfer_log`.

---

–•–æ—á–µ—Ç–µ, —è –ø—ñ–¥–≥–æ—Ç—É—é –≥–æ—Ç–æ–≤–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä–∏ –∑ –æ–±—Ä–æ–±–∫–æ—é –ø–æ–º–∏–ª–æ–∫ —ñ –ª–æ–≥–æ–º (—â–æ–± –±—É–ª–æ –≤–∏–¥–Ω–æ SUCCESS/FAILED + —Ç–µ–∫—Å—Ç –ø–æ–º–∏–ª–∫–∏)?
