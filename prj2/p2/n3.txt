–ß—É–¥–æ–≤–æ üëç
–¢–µ–ø–µ—Ä —Ä–µ–∞–ª—ñ–∑—É—î–º–æ **–∫—Ä–æ–∫ 3** ‚Äî –∫–æ–ª–∏ –≤–∏—è–≤–ª–µ–Ω–æ –¥—É–±–ª—ñ–∫–∞—Ç–∏ –º—ñ—Ç–∫–∏, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è **–¥—ñ–∞–ª–æ–≥–æ–≤–µ –≤—ñ–∫–Ω–æ** (Modal Dialog Region) —ñ–∑ –∫–∞—Ä—Ç–∫–∞–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —É —è–∫–∏—Ö —Ü—è –º—ñ—Ç–∫–∞ –≤–∂–µ —î.
–ü—ñ—Å–ª—è –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –Ω–∞ —Å–≤—ñ–π –ü–Ü–ë (–∞–±–æ –∫–Ω–æ–ø–∫—É ‚Äú–¶–µ —è‚Äù) –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è **—Ñ—ñ–∫—Å–∞—Ü—ñ—è —É —Ç–∞–±–ª–∏—Ü—ñ –∂—É—Ä–Ω–∞–ª—É** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `NFC_CONFLICT_LOG`).

---

## üß© –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

**–ú–∞—î–º–æ —Å—Ç–æ—Ä—ñ–Ω–∫—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Å—Ç–æ—Ä. 10):**

* `P10_CODE` ‚Äî –ø–æ–ª–µ, –∫—É–¥–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–≤–æ–¥–∏—Ç—å –∞–±–æ —Å–∫–∞–Ω—É—î NFC.
* `P10_DIALOG` ‚Äî –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ (Modal Dialog Region).
* –£—Å–µ—Ä–µ–¥–∏–Ω—ñ –¥—ñ–∞–ª–æ–≥—É ‚Äî **–∑–≤—ñ—Ç —ñ–∑ –∫–Ω–æ–ø–∫–∞–º–∏ –∞–±–æ –∫–∞—Ä—Ç–∫–∞–º–∏** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —É —è–∫–∏—Ö –∑–Ω–∞–π–¥–µ–Ω–æ –∑–±—ñ–≥.
* –ü—Ä–æ—Ü–µ—Å `LOG_NFC_CONFLICT` ‚Äî –¥–ª—è –∑–∞–ø–∏—Å—É –≤–∏–±–æ—Ä—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ —Ç–∞–±–ª–∏—Ü—é –∂—É—Ä–Ω–∞–ª—É.

---

## üîπ –ö—Ä–æ–∫ 1. SQL-–∑–≤—ñ—Ç –¥–ª—è –¥—ñ–∞–ª–æ–≥—É

–°—Ç–≤–æ—Ä–∏ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ä–µ–≥—ñ–æ–Ω —Ç–∏–ø—É **Classic Report** –∞–±–æ **Cards (Reflow Report)**
(—É –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ `P10_DIALOG`):

```sql
SELECT 
    u.user_id,
    u.user_name || ' (' || u.department_name || ')' AS display_name,
    t.created_at,
    '–¶–µ —è' AS action_label
FROM user_nfc t
JOIN users u ON u.user_id = t.user_id
WHERE t.nfc_id = norm_nfc(:P10_CODE)
  AND (t.date_end IS NULL OR t.date_end > SYSDATE)
```

---

## üîπ –ö—Ä–æ–∫ 2. –î–æ–¥–∞–π –∫–Ω–æ–ø–∫—É –≤ –∫–æ–∂–Ω–æ–º—É —Ä—è–¥–∫—É (–∞–±–æ –∫–∞—Ä—Ç—Ü—ñ)

–£ –∑–≤—ñ—Ç—ñ:

* —Å—Ç–≤–æ—Ä–∏ –∫–æ–ª–æ–Ω–∫—É `action_label`
* –∑—Ä–æ–±–∏ —ó—ó **–ø–æ—Å–∏–ª–∞–Ω–Ω—è–º**, —Ç–∏–ø: *Redirect to URL*
  –∑ URL-–≤–∏—Ä–∞–∑–æ–º:

```apex
javascript:confirmNfcUser('#USER_ID#');
```

üîπ –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î ‚Äú–¶–µ —è‚Äù, –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è JS-—Ñ—É–Ω–∫—Ü—ñ—è `confirmNfcUser(user_id)`.

---

## üîπ –ö—Ä–æ–∫ 3. –î–æ–¥–∞–π JS-—Ñ—É–Ω–∫—Ü—ñ—é –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É

–£ —Ä–æ–∑–¥—ñ–ª—ñ **"Function and Global Variable Declaration"** –∞–±–æ —É "Page JavaScript":

```js
function confirmNfcUser(userId) {
  apex.server.process(
    "LOG_NFC_CONFLICT",
    {
      x01: userId
    },
    {
      dataType: "json",
      success: function(pData) {
        if (pData && pData.status === "OK") {
          apex.message.showPageSuccess("–í–∞—à –≤–∏–±—ñ—Ä –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ. –î—è–∫—É—î–º–æ!");
          apex.dialog.close("P10_DIALOG");
        } else {
          apex.message.showErrors([{ type: "error", location: "page", message: "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Ñ—ñ–∫—Å–∞—Ü—ñ—ó –≤–∏–±–æ—Ä—É." }]);
        }
      }
    }
  );
}
```

---

## üîπ –ö—Ä–æ–∫ 4. –î–æ–¥–∞–π –ø—Ä–æ—Ü–µ—Å `LOG_NFC_CONFLICT` (Ajax Callback)

–ù–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Å—Ç–≤–æ—Ä—é—î—à –ø—Ä–æ—Ü–µ—Å —Ç–∏–ø—É **Ajax Callback**,
—ñ–º‚Äô—è ‚Äî `LOG_NFC_CONFLICT`
—ñ –∫–æ–¥ PL/SQL:

```plsql
DECLARE
    v_user_id NUMBER := TO_NUMBER(apex_application.g_x01);
BEGIN
    INSERT INTO nfc_conflict_log (
        nfc_code,
        found_user_id,
        action_user_id,
        action_date,
        comment
    ) VALUES (
        norm_nfc(:P10_CODE),
        v_user_id,
        :APP_USER_ID,
        SYSTIMESTAMP,
        '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏–≤ —Å–ø—ñ–≤–ø–∞–¥—ñ–Ω–Ω—è –º—ñ—Ç–∫–∏'
    );

    APEX_JSON.OPEN_OBJECT;
    APEX_JSON.WRITE('status', 'OK');
    APEX_JSON.CLOSE_OBJECT;
EXCEPTION
    WHEN OTHERS THEN
        APEX_JSON.OPEN_OBJECT;
        APEX_JSON.WRITE('status', 'ERROR');
        APEX_JSON.WRITE('message', SQLERRM);
        APEX_JSON.CLOSE_OBJECT;
END;
```

---

## üîπ –ö—Ä–æ–∫ 5. –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –¥—ñ–∞–ª–æ–≥—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

–ö–æ–ª–∏ —Ç–∏ –≤–∏–∫–æ–Ω—É—î—à –ø–µ—Ä–≤–∏–Ω–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É NFC-–∫–æ–¥—É (–∑ —Ç–≤–æ–≥–æ –∑–∞–ø–∏—Ç—É `WITH indata ...`),
—ñ –≤–∏—è–≤–ª–µ–Ω–æ –¥—É–±–ª—ñ–∫–∞—Ç–∏ ‚Äî –∑–∞–º—ñ—Å—Ç—å –ø–æ–∫–∞–∑—É –ø–æ–º–∏–ª–∫–∏ —Ç–∏ –º–æ–∂–µ—à –∑—Ä–æ–±–∏—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω—É –¥—ñ—é:

**Dynamic Action ‚Üí Execute JavaScript Code:**

```js
apex.region("P10_DIALOG").refresh();
apex.navigation.dialog(
  "#P10_DIALOG", 
  {
    title: "–ó–Ω–∞–π–¥–µ–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —ñ–∑ —Ç–∞–∫–æ—é –∂ –º—ñ—Ç–∫–æ—é",
    height: "auto",
    width: "600"
  }
);
```

---

## üîπ –ö—Ä–æ–∫ 6. –¢–∞–±–ª–∏—Ü—è –¥–ª—è –∂—É—Ä–Ω–∞–ª—É (—è–∫—â–æ —â–µ –Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–∞)

```sql
CREATE TABLE nfc_conflict_log (
  id              NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nfc_code        VARCHAR2(64),
  found_user_id   NUMBER,
  action_user_id  NUMBER,
  action_date     TIMESTAMP DEFAULT SYSTIMESTAMP,
  comment         VARCHAR2(200)
);
```

---

## üîπ –ü—ñ–¥—Å—É–º–æ–∫ (–ª–æ–≥—ñ–∫–∞ –≤–∑–∞—î–º–æ–¥—ñ—ó)

| –ö—Ä–æ–∫ | –î—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ / —Å–∏—Å—Ç–µ–º–∞                               | –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è                               |
| ---- | ------------------------------------------------------- | --------------------------------------------- |
| 1    | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–≤–æ–¥–∏—Ç—å –∞–±–æ —Å–∫–∞–Ω—É—î –º—ñ—Ç–∫—É                     | –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª—ñ–∫–∞—Ç–∏                        |
| 2    | –Ø–∫—â–æ –¥—É–±–ª—ñ–∫–∞—Ç –∑–Ω–∞–π–¥–µ–Ω–æ                                  | –í—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –¥—ñ–∞–ª–æ–≥ —ñ–∑ –∫–∞—Ä—Ç–∫–∞–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ |
| 3    | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î ¬´–¶–µ —è¬ª                              | –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è `confirmNfcUser(user_id)`        |
| 4    | JS –≤–∏–∫–ª–∏–∫–∞—î Ajax-–ø—Ä–æ—Ü–µ—Å `LOG_NFC_CONFLICT`              | –ó–∞–ø–∏—Å —É `NFC_CONFLICT_LOG`                    |
| 5    | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ‚Äú–í–∞—à –≤–∏–±—ñ—Ä –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ‚Äù | –î—ñ–∞–ª–æ–≥ –∑–∞–∫—Ä–∏–≤–∞—î—Ç—å—Å—è                           |

---

–•–æ—á–µ—à, —â–æ–± —è –ø–æ–∫–∞–∑–∞–≤ **–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É** –∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è–º —É –≤–∏–≥–ª—è–¥—ñ **Material-–ø–æ–¥—ñ–±–Ω–∏—Ö –∫–∞—Ä—Ç–æ–∫** (—ñ–∑ —Ñ–æ—Ç–æ, —ñ–º–µ–Ω–µ–º, –∫–Ω–æ–ø–∫–æ—é "–¶–µ —è"), —â–æ–± –¥—ñ–∞–ª–æ–≥ –≤–∏–≥–ª—è–¥–∞–≤ –±—ñ–ª—å—à —Å—É—á–∞—Å–Ω–æ?
