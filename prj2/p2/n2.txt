–î—É–∂–µ —Ö–æ—Ä–æ—à–µ –π –ø—Ä–∞–∫—Ç–∏—á–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è üëè
–¢–∏ —Ö–æ—á–µ—à, —â–æ–± —Å–∏—Å—Ç–µ–º–∞ **—Ä–µ–∞–≥—É–≤–∞–ª–∞ –Ω–∞ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç NFC-–º—ñ—Ç–∫–∏ –Ω–µ —è–∫ –Ω–∞ –ø–æ–º–∏–ª–∫—É –ë–î**, –∞ **–∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ APEX-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å** ‚Äî –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º —ñ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –¥—ñ—ó.
–ü–æ—è—Å–Ω—é, —è–∫ —Ü–µ –∑—Ä–æ–±–∏—Ç–∏ **–ø–æ–µ—Ç–∞–ø–Ω–æ** üëá

---

## üîπ 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª—ñ–∫–∞—Ç–∏ –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ—é / –∑–≤‚Äô—è–∑—É–≤–∞–Ω–Ω—è–º

–ü–µ—Ä–µ–¥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º –≤—Å—Ç–∞–≤–∫–∏ (`INSERT INTO USER_NFC` –∞–±–æ —Ç–≤–æ—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø—Ä–∏–≤‚Äô—è–∑–∫–∏) —Ç—Ä–µ–±–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —Ç–∞–∫–∏–π `NFC_ID` —É–∂–µ —ñ—Å–Ω—É—î **–∑ —ñ–Ω—à–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º**.

```sql
SELECT 
    u.user_id,
    u.user_name,
    u.department_name
FROM user_nfc t
JOIN users u ON u.user_id = t.user_id
WHERE t.nfc_id = :P10_CODE
  AND (t.date_end IS NULL OR t.date_end > SYSDATE);
```

üëâ –Ø–∫—â–æ —Ü–µ–π –∑–∞–ø–∏—Ç –ø–æ–≤–µ—Ä—Ç–∞—î 1 –∞–±–æ –±—ñ–ª—å—à–µ —Ä—è–¥–∫—ñ–≤, —Ç–æ–¥—ñ:

* **–Ω–µ –≤–∏–∫–æ–Ω—É—î—à –≤—Å—Ç–∞–≤–∫—É**;
* **–≤–∏–≤–æ–¥–∏—à –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É**, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

  > "–£–≤–∞–≥–∞! –¶—è –º—ñ—Ç–∫–∞ –≤–∂–µ –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∞ –¥–æ —ñ–Ω—à–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
  > –ë—É–¥—å –ª–∞—Å–∫–∞, –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ —Ç–µ—Ö–ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –∞–±–æ –≤–∏–±–µ—Ä—ñ—Ç—å —Å–≤—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å –Ω–∏–∂—á–µ."

---

## üîπ 2. –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –ª–æ–≥—ñ–∫–∏ –≤ APEX

### üß± –ö—Ä–æ–∫ 1: –î–æ–¥–∞–π **–¥–∏–Ω–∞–º—ñ—á–Ω—É –¥—ñ—é** –ø–µ—Ä–µ–¥ –ø—Ä–æ—Ü–µ—Å–æ–º –≤—Å—Ç–∞–≤–∫–∏

* **–¢–∏–ø:** `Execute Server-side Code` (PL/SQL).
* –ö–æ–¥:

```plsql
DECLARE
    v_count NUMBER;
BEGIN
    SELECT COUNT(*) INTO v_count
    FROM user_nfc
    WHERE nfc_id = norm_nfc(:P10_CODE)
      AND (date_end IS NULL OR date_end > SYSDATE);

    IF v_count > 0 THEN
        APEX_ERROR.ADD_ERROR (
            p_message => '–¶—è –º—ñ—Ç–∫–∞ –≤–∂–µ –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∞ –¥–æ —ñ–Ω—à–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∏–∂—á–µ –∞–±–æ –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ —Ç–µ—Ö–ø—ñ–¥—Ç—Ä–∏–º–∫–∏.',
            p_display_location => APEX_ERROR.C_INLINE_IN_FIELD,
            p_page_item_name => 'P10_CODE'
        );
    END IF;
END;
```

üîπ –¶–µ **–Ω–µ –≤–ø–∞–¥–µ –Ω–∞ –ø–æ–º–∏–ª–∫—É**, –∞–ª–µ –∑—É–ø–∏–Ω–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–∏–π –ø—Ä–æ—Ü–µ—Å (—è–∫—â–æ —Ç–∏ –≤–∫–∞–∂–µ—à "Stop execution on error").
üîπ APEX –ø–æ–∫–∞–∂–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä—è–º–æ –±—ñ–ª—è –ø–æ–ª—è –≤–≤–æ–¥—É NFC-–∫–æ–¥—É.

---

## üîπ 3. –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —É —è–∫–∏—Ö —Å–ø—ñ–≤–ø–∞–≤ NFC

–°—Ç–≤–æ—Ä–∏ **–ø—ñ–¥–ª–µ–≥–ª–∏–π —Ä–µ–≥—ñ–æ–Ω (Interactive Report –∞–±–æ Classic Report)** –∑ SQL:

```sql
SELECT 
    u.user_name AS "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á",
    u.department_name AS "–ü—ñ–¥—Ä–æ–∑–¥—ñ–ª",
    t.created_at AS "–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è",
    t.user_id
FROM user_nfc t
JOIN users u ON u.user_id = t.user_id
WHERE t.nfc_id = norm_nfc(:P10_CODE)
  AND (t.date_end IS NULL OR t.date_end > SYSDATE)
```

üëâ –£ –∑–≤—ñ—Ç—ñ –∑—Ä–æ–±–∏ **–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —ñ–º‚Äô—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** (—É –∫–æ–ª–æ–Ω—Ü—ñ "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á"), —è–∫–µ:

* –≤—ñ–¥–∫—Ä–∏–≤–∞—î –¥—ñ–∞–ª–æ–≥–æ–≤–µ –≤—ñ–∫–Ω–æ –∞–±–æ –∑–∞–ø—É—Å–∫–∞—î –ø—Ä–æ—Ü–µ—Å:

  * –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º, —â–æ —Ü–µ –≤—ñ–Ω;
  * –∑–∞–ø–∏—Å —É –∂—É—Ä–Ω–∞–ª (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `NFC_CONFLICT_LOG`).

---

## üîπ 4. –§—ñ–∫—Å–∞—Ü—ñ—è —É —Ç–∞–±–ª–∏—Ü—ñ –∂—É—Ä–Ω–∞–ª—É (–ª–æ–≥—É–≤–∞–Ω–Ω—è)

–°—Ç–≤–æ—Ä–∏ —Ç–∞–±–ª–∏—Ü—é:

```sql
CREATE TABLE NFC_CONFLICT_LOG (
  ID           NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  NFC_CODE     VARCHAR2(64),
  FOUND_USER_ID NUMBER,
  ACTION_USER_ID NUMBER,
  ACTION_DATE  TIMESTAMP DEFAULT SYSTIMESTAMP,
  COMMENT      VARCHAR2(200)
);
```

–£ –ø—Ä–æ—Ü–µ—Å—ñ (–∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–Ω–µ –Ω–∞ —Å–≤—ñ–π –ü–Ü–ë):

```plsql
INSERT INTO NFC_CONFLICT_LOG (nfc_code, found_user_id, action_user_id, comment)
VALUES (:P10_CODE, :FOUND_USER_ID, :APP_USER_ID, '–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ —Å–ø—ñ–≤–ø–∞–¥—ñ–Ω–Ω—è –º—ñ—Ç–∫–∏');
```

---

## üîπ 5. –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ ‚Äî –ø–æ–∫–∞–∑–∞—Ç–∏ –¥—ñ–∞–ª–æ–≥ –∑–∞–º—ñ—Å—Ç—å –ø–æ–º–∏–ª–∫–∏

–ú–æ–∂–µ—à –∑—Ä–æ–±–∏—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω—É –¥—ñ—é:

* **–ü–æ–¥—ñ—è:** –ø—ñ—Å–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥—É–±–ª—ñ–∫–∞—Ç–∞;
* **–£–º–æ–≤–∞:** —è–∫—â–æ `v_count > 0`;
* **–î—ñ—è:** –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è **Modal Dialog Region** –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º —ñ —Ç–∞–±–ª–∏—Ü–µ—é `user_nfc`.

---

## üîπ –†–µ–∑—é–º–µ (—è–∫ —Ü–µ –ø—Ä–∞—Ü—é—î)

| –ö—Ä–æ–∫ | –î—ñ—è                                                  | –ú–µ—Ö–∞–Ω—ñ–∑–º                               |
| ---- | ---------------------------------------------------- | -------------------------------------- |
| 1    | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å–∫–∞–Ω—É—î –º—ñ—Ç–∫—É / –≤–≤–æ–¥–∏—Ç—å –∫–æ–¥                | :P10_CODE                              |
| 2    | –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è PL/SQL –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞                         | –î–∏–Ω–∞–º—ñ—á–Ω–∞ –¥—ñ—è                          |
| 3    | –Ø–∫—â–æ –¥—É–±–ª—ñ–∫–∞—Ç–∞ –Ω–µ–º–∞ ‚Äî –∑–∞–ø–∏—Å —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è              | INSERT                                 |
| 4    | –Ø–∫—â–æ –¥—É–±–ª—ñ–∫–∞—Ç–∏ —î ‚Äî –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —ñ —Å–ø–∏—Å–æ–∫ | `APEX_ERROR` + –∑–≤—ñ—Ç                    |
| 5    | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î –Ω–∞ —Å–≤—ñ–π –ü–Ü–ë                      | –ü—Ä–æ—Ü–µ—Å –≤—Å—Ç–∞–≤–∫–∏ –≤ –ª–æ–≥ –∞–±–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è |

---

–•–æ—á–µ—à, —â–æ–± —è –¥–æ–ø–æ–º—ñ–≥ —Å—Ç–≤–æ—Ä–∏—Ç–∏ **–≥–æ—Ç–æ–≤—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É APEX-–¥–∏–Ω–∞–º—ñ—á–Ω–∏—Ö –¥—ñ–π** (–∑ –ø–æ–¥—ñ—è–º–∏ —ñ –∫–æ–¥–æ–º) –¥–ª—è —Ü—ñ—î—ó –ª–æ–≥—ñ–∫–∏?
–¢–æ–¥—ñ —è –ø–æ–∫–∞–∂—É –ø—Ä—è–º–æ —É –≤–∏–≥–ª—è–¥—ñ –ø–æ–∫—Ä–æ–∫–æ–≤–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (DA, —Ä–µ–≥—ñ–æ–Ω–∏, –ø—Ä–æ—Ü–µ—Å–∏).
