–°—É–ø–µ—Ä, –¥—è–∫—É—é –∑–∞ —á—ñ—Ç–∫–µ —Ñ–æ—Ä–º—É–ª—é–≤–∞–Ω–Ω—è üëç
–†–æ–±–∏–º–æ —Å–∞–º–µ —Ç–µ, —â–æ —Ç–∏ –ø—Ä–æ—Å–∏—à: **–º—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∫–∏**, **–±–µ–∑ —Ç–æ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É**, –∞–ª–µ –∑ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ—é –ª–æ–≥—ñ–∫–æ—é**.

–Ø **–ù–ï –º—ñ–Ω—è—é —Ç–≤–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É**, –ª–∏—à–µ:

* –ø—Ä–∏–±–∏—Ä–∞—é –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ —É–º–æ–≤–∏,
* –¥–æ–¥–∞—é 2 —á—ñ—Ç–∫—ñ —Ñ–ª–∞–≥–∏,
* —Ñ—ñ–∫—Å—É—é —Å—Ç–∞—Ç—É—Å **¬´–†–æ–∑–≥–ª—è–¥–∞—î¬ª —Ç—ñ–ª—å–∫–∏ –¥–ª—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ–≥–æ –µ—Ç–∞–ø—É**,
* –±–ª–æ—á–∏–º–æ –∫–Ω–æ–ø–∫—É **¬´–í—ñ–¥ —ñ–º–µ–Ω—ñ¬ª** –ø–æ–∑–∞ –∞–∫—Ç–∏–≤–Ω–∏–º –µ—Ç–∞–ø–æ–º.

---

# üß© 1. –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ (–¥–æ–¥–∞—Ç–∏ –ù–ê–î —Ü–∏–∫–ª–æ–º –µ—Ç–∞–ø—É)

```plsql
-- –ß–∏ –≤–∂–µ –ø–æ–∫–∞–∑–∞–ª–∏ "–†–æ–∑–≥–ª—è–¥–∞—î" —É —Ü—å–æ–º—É –µ—Ç–∞–ø—ñ
l_stage_has_current BOOLEAN := FALSE;
```

---

# üß© 2. –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è first row (–ú–Ü–ù–Ü–ú–ê–õ–¨–ù–ê –∑–∞–º—ñ–Ω–∞ l_count_cb)

üî¥ **–ù–ï –≤–∏–¥–∞–ª—è—î–º–æ `l_count_cb` –ø–æ–≤–Ω—ñ—Å—Ç—é**, –∞–ª–µ:

* **–≤—ñ–Ω –±—ñ–ª—å—à–µ –Ω–µ –∫–µ—Ä—É—î —Å—Ç–∞—Ç—É—Å–∞–º–∏**
* –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫

```plsql
l_is_first_active_row BOOLEAN := FALSE;

IF p_is_active_stage AND NOT l_stage_has_current THEN
   l_is_first_active_row := TRUE;
   l_stage_has_current  := TRUE;
END IF;
```

---

# üß© 3. –ü–†–ê–í–ö–ê –¢–í–û–ì–û –ö–û–î–£ –°–¢–ê–¢–£–°–Ü–í (–º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ)

### ‚ùå –ë—É–ª–æ (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)

```plsql
if not p_is_active_stage then
   l_show_button := false;
elsif l_parallel then
   l_show_button := l_is_role;
else
   if l_is_role and l_count_cb = 0 then
      l_show_button = true;
      l_count_cb := l_count_cb + 1;
   elsif (not l_is_role) and l_count_cb = 0 then
      l_show_button := false;
      l_count_cb:= l_count_cb + 1;
      append(p_buf,
        '<span class="wait-confirm-signature-text wait-confirm-signature-text-current">
           –†–æ–∑–≥–ª—è–¥–∞—î
         </span>');
   else
      l_this_row_rendered := true;
      l_show_button := false;
   end if;
end if;
```

---

### ‚úÖ –°—Ç–∞–ª–æ (–ú–Ü–ù–Ü–ú–ê–õ–¨–ù–û –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–æ)

```plsql
-- –ß–∏ –ø–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—ñ–¥–ø–∏—Å—É
IF NOT p_is_active_stage THEN
   l_show_button := FALSE;

ELSIF l_parallel THEN
   l_show_button := l_is_role;

ELSE
   l_show_button := l_is_role AND l_is_first_active_row;
END IF;
```

---

# üß© 4. –†–µ–Ω–¥–µ—Ä –∫–Ω–æ–ø–∫–∏ / —Å—Ç–∞—Ç—É—Å—É (–ú–Ü–ù–Ü–ú–ê–õ–¨–ù–ê –ü–†–ê–í–ö–ê)

### ‚ùå –ë—É–ª–æ

```plsql
if l_show_button then
   append(p_buf,'<button ...>...</button>');
if not is_active_stage then
   append(p_buf,'–û—á—ñ–∫—É—î –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –µ—Ç–∞–ø—ñ–≤');
else
   append(p_buf,'–û—á—ñ–∫—É—î –≤—ñ–¥–º—ñ—Ç–∫–∏');
end;
end if;
```

---

### ‚úÖ –°—Ç–∞–ª–æ

```plsql
IF l_show_button THEN
   append(
      p_buf,
      '<button id="signature-btn"
               data-signature-id="'||l_signature_id||'"
               class="confirm-signature-button">'
      || h(p_substage_btn_text) ||
      '</button>'
   );
ELSE
   IF NOT p_is_active_stage THEN
      append(
         p_buf,
         '<span class="wait-confirm-signature-text">
            –û—á—ñ–∫—É—î –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –µ—Ç–∞–ø—ñ–≤
          </span>'
      );

   ELSIF NOT l_parallel
      AND l_is_first_active_row
   THEN
      append(
         p_buf,
         '<span class="wait-confirm-signature-text wait-confirm-signature-text-current">
            –†–æ–∑–≥–ª—è–¥–∞—î
          </span>'
      );

   ELSE
      append(
         p_buf,
         '<span class="wait-confirm-signature-text">
            –û—á—ñ–∫—É—î –≤—ñ–¥–º—ñ—Ç–∫–∏
          </span>'
      );
   END IF;
END IF;

append(p_buf, '</div>');
```

---

# üß© 5. –ú–Ü–ù–Ü–ú–ê–õ–¨–ù–ê –ø—Ä–∞–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ **¬´–í—ñ–¥ —ñ–º–µ–Ω—ñ¬ª**

## ‚ùå –ë—É–ª–æ

```plsql
if l_can_byname then
   append(p_buf,'<button ...>–í—ñ–¥ —ñ–º–µ–Ω—ñ</button>');
end if;
```

---

## ‚úÖ –°—Ç–∞–ª–æ (–ö–†–ò–¢–ò–ß–ù–ê –ø—Ä–∞–≤–∫–∞)

```plsql
IF p_is_active_stage
   AND l_can_byname
   AND (l_parallel OR l_is_first_active_row)
THEN
   append(
      p_buf,
      '<button type="button"
               class="byname-signature-button"
               data-signature-id="'||l_signature_id||'">
         –í—ñ–¥ —ñ–º–µ–Ω—ñ
       </button>'
   );
END IF;
```

---

# üß© 6. –ú–Ü–ù–Ü–ú–ê–õ–¨–ù–ê –ø—Ä–∞–≤–∫–∞ `CAN_SIGN_BY_OTHER_PERSONAL`

### ‚ùå –ë—É–ª–æ

```plsql
AND v_sign_kat <> 1
AND p_cur_kategoria = 1
```

---

### ‚úÖ –°—Ç–∞–ª–æ

```plsql
AND (
      (v_sign_kat <> 1 AND p_cur_kategoria = 1)
   OR apex_acl.has_user_role(
         p_application_id => :APP_ID,
         p_user_name      => :APP_USER,
         p_role_static_id => 'MAIN_SIGNER'
      )
)
```

---

# ‚úÖ –©–û –¢–ò –û–¢–†–ò–ú–£–Ñ–® –ë–ï–ó –ü–ï–†–ï–ü–ò–°–£ –í–°–¨–û–ì–û

‚úî –°—Ç–∞—Ç—É—Å **¬´–†–æ–∑–≥–ª—è–¥–∞—î¬ª** ‚Äî —Ç—ñ–ª—å–∫–∏ –¥–ª—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏—Ö
‚úî –ü–∞—Ä–∞–ª–µ–ª—å–Ω—ñ –µ—Ç–∞–ø–∏ –Ω–µ –ø–ª—É—Ç–∞—é—Ç—å UX
‚úî ¬´–í—ñ–¥ —ñ–º–µ–Ω—ñ¬ª –Ω–µ –ª—ñ–∑–µ –≤ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ñ –µ—Ç–∞–ø–∏
‚úî MAIN_SIGNER –ø—Ä–∞—Ü—é—î –±–µ–∑ –ª–∞–º–∞–Ω–Ω—è —Å—Ç–∞—Ä–æ—ó –ª–æ–≥—ñ–∫–∏
‚úî `l_count_cb` –±—ñ–ª—å—à–µ –Ω–µ —à–∫–æ–¥–∏—Ç—å —Å—Ç–∞—Ç—É—Å–∞–º

---

## üß™ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è (–Ω–µ –æ–±–æ–≤ º—è–∑–∫–æ–≤–æ, –∞–ª–µ –∫–æ—Ä–∏—Å–Ω–æ)

–ü—ñ—Å–ª—è –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è ‚Äî **–æ–¥–∏–Ω —Ç–µ—Å—Ç-–∫–µ–π—Å**:

* –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏–π ‚Üí –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏–π ‚Üí –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏–π
* —É –¥—Ä—É–≥–æ–º—É –µ—Ç–∞–ø—ñ 2 –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ
* –ø–µ—Ä–µ–≤—ñ—Ä, —â–æ **‚Äú–í—ñ–¥ —ñ–º–µ–Ω—ñ‚Äù –Ω–µ –∑ º—è–≤–ª—è—î—Ç—å—Å—è –≤ 3-–º—É**

---

–Ø–∫—â–æ —Ö–æ—á–µ—à ‚Äî –Ω–∞—Å—Ç—É–ø–Ω–∏–º –∫—Ä–æ–∫–æ–º:

* –∑—Ä–æ–±–ª—é **–¥–∏—Ñ (–±—É–ª–æ/—Å—Ç–∞–ª–æ)** –ø–æ —Ä—è–¥–∫–∞—Ö
* –∞–±–æ –¥–∞–º **—á–µ–∫–ª—ñ—Å—Ç —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è**

–ö–∞–∂–∏ üëç
