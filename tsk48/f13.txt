–¢–µ–ø–µ—Ä —è —Ä–æ–∑—É–º—ñ—é –∑–∞–¥–∞—á—É **–Ω–∞ 100%**, —ñ —Ç–∏ –º–∞—î—à —Ä–∞—Ü—ñ—é —É —Å–≤–æ—î–º—É –∑–¥–∏–≤—É–≤–∞–Ω–Ω—ñ.
–¢–æ–∂ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é **–¥—É–∂–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ**, –±–µ–∑ –∑–∞–≥–∞–ª—å–Ω–∏—Ö —Ñ—Ä–∞–∑.

–ù–∏–∂—á–µ –±—É–¥–µ:

1. **–ß—ñ—Ç–∫–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è, –©–û —Å–∞–º–µ —Ç—Ä–µ–±–∞ –≤–∏–Ω–µ—Å—Ç–∏ –≤ BASE —ñ —á–æ–º—É —Ü–µ –ø—Ä–∞—Ü—é—î**, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤—Å–µ –ø–æ DBLINK
2. **–†–µ–∞–ª—å–Ω–∞ —Å—Ö–µ–º–∞ –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞–Ω–Ω—è –¢–í–û–Ñ–á view** (–Ω–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–∞)
3. **–ì–æ—Ç–æ–≤–∏–π –∫–∞—Ä–∫–∞—Å `V_TASK_BASE` + `V_TASK_FULL`**, —è–∫–∏–π –Ω–µ –¥–∞—î ORA-02063 –ø—Ä–∏ `SUM / DISTINCT`

---

# 1Ô∏è‚É£ –ö–ª—é—á–æ–≤–∞ —ñ–¥–µ—è (–æ–¥–Ω–µ —Ä–µ—á–µ–Ω–Ω—è)

> **BASE ‚Äî —Ü–µ –Ω–µ ‚Äú–±–µ–∑ DBLINK‚Äù**
> **BASE ‚Äî —Ü–µ ‚Äú–±–µ–∑ HTML, LISTAGG, ROW_NUMBER, TEXT-CASE —É –º–æ–º–µ–Ω—Ç –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó‚Äù**

üëâ DBLINK **–¥–æ–ø—É—Å–∫–∞—î—Ç—å—Å—è**
üëâ EXISTS **–¥–æ–ø—É—Å–∫–∞—î—Ç—å—Å—è**
üëâ CASE **–¥–æ–ø—É—Å–∫–∞—î—Ç—å—Å—è**
‚ùå **–∞–ª–µ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –ß–ò–°–õ–û / DATE / FLAG**, –∞ –Ω–µ —Ç–µ–∫—Å—Ç

Oracle 21 **–ª–∞–º–∞—î—Ç—å—Å—è –Ω–µ –Ω–∞ DBLINK**,
–∞ –Ω–∞ **AGGREGATE + —Å–∫–ª–∞–¥–Ω–∏–π —Ç–µ–∫—Å—Ç–æ–≤–∏–π projection —á–µ—Ä–µ–∑ DBLINK**

---

# 2Ô∏è‚É£ –©–æ —Å–∞–º–µ –õ–ê–ú–ê–Ñ —Ç–≤—ñ–π –ø–æ—Ç–æ—á–Ω–∏–π view –ø—Ä–∏ SUM

–£ —Ç–≤–æ—î–º—É `V_TASK_FULL` –æ–¥–Ω–æ—á–∞—Å–Ω–æ —î:

| –ö–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è            | –ü—Ä–æ–±–ª–µ–º–∞ |
| ---------------------- | -------- |
| LISTAGG (HTML)         | ‚ùå        |
| ROW_NUMBER             | ‚ùå        |
| CASE –∑ —Ç–µ–∫—Å—Ç–æ–º         | ‚ùå        |
| JOIN KBS.PERSONAL      | ‚ùå        |
| AGGREGATE –ø–æ–≤–µ—Ä—Ö —Ü—å–æ–≥–æ | üí•       |

‚ùó **–ù–∞–≤—ñ—Ç—å —è–∫—â–æ —Ç–∏ –≤ SUM –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à —Ç—ñ–ª—å–∫–∏ `status_id`** ‚Äî Oracle 21 **–∞–Ω–∞–ª—ñ–∑—É—î –í–°–ï projection**

---

# 3Ô∏è‚É£ –ü—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–æ–¥—ñ–ª —Å–∞–º–µ –¥–ª—è –¢–í–û–ì–û –ö–û–î–£

–ú–∏ **–Ω–µ –ø–µ—Ä–µ–ø–∏—Å—É—î–º–æ –ª–æ–≥—ñ–∫—É**,
–º–∏ **–º—ñ–Ω—è—î–º–æ –º—ñ—Å—Ü–µ —ó—ó –≤–∏–∫–æ–Ω–∞–Ω–Ω—è**.

---

## üîπ –®–ê–† 1 ‚Äî `V_TASK_BASE` (–ê–ì–†–ï–ì–ê–ë–ï–õ–¨–ù–ò–ô)

### –¢—É—Ç –∑–∞–ª–∏—à–∞—î–º–æ:

* TASKS
* SIGNATURERIGHTS
* SIGNATUREHISTORY
* EXISTS
* CASE
* DATE
* NUMBER
* **–ü–†–ê–ü–û–†–¶–Ü**

### ‚ùå –ó–∞–±–∏—Ä–∞—î–º–æ:

* HTML
* LISTAGG
* ROW_NUMBER (–¥–ª—è UI)
* –ü–Ü–ë —É —Ç–µ–∫—Å—Ç—ñ

---

### ‚úÖ `V_TASK_BASE` (—Ä–µ–∞–ª—å–Ω–∏–π, –ø—ñ–¥ —Ç–≤–æ—é –ª–æ–≥—ñ–∫—É)

```sql
CREATE OR REPLACE VIEW V_TASK_BASE AS
SELECT
  t.id               AS task_id,
  t.page_list_id,
  t.unit_id,
  t.department_id,
  t.type_id,
  t.status_id        AS status_main_id,
  t.planning_date_start,
  t.planning_date_end,
  t.date_create,

  /* —Ñ–∞–∫—Ç–∏—á–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è */
  ae.actual_date_end,

  /* ===== –ü–†–ê–ü–û–†–¶–Ü ===== */

  /* ARCHIVE */
  CASE
    WHEN t.status_id = 0 THEN 1 ELSE 0
  END AS is_archive,

  /* PLANNED */
  CASE
    WHEN t.status_id <> 0
     AND (t.planning_date_end > SYSDATE OR ae.actual_date_end IS NULL)
    THEN 1 ELSE 0
  END AS is_planned,

  /* TODO */
  CASE
    WHEN EXISTS (
      SELECT 1
      FROM TaskTracker.SIGNATURERIGHTS@TO_TASKTRACKER10 r
      WHERE r.task_id = t.id
        AND NOT EXISTS (
          SELECT 1
          FROM TaskTracker.SIGNATUREHISTORY@TO_TASKTRACKER10 h
          WHERE h.signright_id = r.id
            AND h.new_status_id IS NOT NULL
        )
    )
    THEN 1 ELSE 0
  END AS is_todo,

  /* PROBLEM */
  CASE
    WHEN t.planning_date_end < SYSDATE
     AND ae.actual_date_end IS NULL
    THEN 1 ELSE 0
  END AS is_problem

FROM TaskTracker.TASKS@TO_TASKTRACKER10 t

LEFT JOIN (
  SELECT
    sr3.task_id,
    MAX(h.signer_date) AS actual_date_end
  FROM TaskTracker.SIGNATURERIGHTS@TO_TASKTRACKER10 sr3
  JOIN TaskTracker.SIGNATUREHISTORY@TO_TASKTRACKER10 h
    ON h.signright_id = sr3.id
  WHERE sr3.stages_id = 6
  GROUP BY sr3.task_id
) ae ON ae.task_id = t.id;
```

üîê **–¶–µ–π view –ú–û–ñ–ù–ê –∞–≥—Ä–µ–≥—É–≤–∞—Ç–∏**

```sql
SELECT
  SUM(is_archive),
  SUM(is_planned),
  SUM(is_todo),
  SUM(is_problem)
FROM V_TASK_BASE;
```

‚úîÔ∏è –±–µ–∑ ORA-02063
‚úîÔ∏è Oracle 21 –Ω–µ –ª—ñ–∑–µ –≤ HTML
‚úîÔ∏è DBLINK –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è ‚Äî –∞–ª–µ –±–µ–∑–ø–µ—á–Ω–∏–π

---

## üîπ –®–ê–† 2 ‚Äî `V_TASK_FULL` (UI / APEX)

üëâ **–¢—É—Ç —Ç–≤—ñ–π –ø–æ—Ç–æ—á–Ω–∏–π –∫–æ–¥ –º–∞–π–∂–µ 1:1**
üëâ –ü—Ä–æ—Å—Ç–æ **JOIN –¥–æ BASE**, –∞ –Ω–µ –∞–≥—Ä–µ–≥–∞—Ü—ñ—è –ø–æ–≤–µ—Ä—Ö –Ω—å–æ–≥–æ

```sql
CREATE OR REPLACE VIEW V_TASK_FULL AS
SELECT
  b.task_id,
  b.planning_date_start,
  u.name AS unit_name,

  CASE
    WHEN t.type_id = 1 THEN t.task_content
    ELSE st_html.subtasks_html
  END AS task_description_html,

  ci.creator_info_html,
  ei.executor_info_html,

  b.planning_date_end,
  b.actual_date_end,

  sc.status_name,
  sc.status_id,

  dep.short_name AS department_name,
  t.note,
  t.type_id,
  vt.viewed_by,
  b.page_list_id,
  t.task_code

FROM V_TASK_BASE b
JOIN TaskTracker.TASKS@TO_TASKTRACKER10 t
  ON t.id = b.task_id

LEFT JOIN TaskTracker.DICT_UNIT@TO_TASKTRACKER10 u
  ON u.id = b.unit_id
LEFT JOIN kbs.spr_department@TO_TASKTRACKER10 dep
  ON dep.id = b.department_id

/* ‚Üì‚Üì‚Üì –í–°–Ü —Ç–≤–æ—ó HTML CTE ‚Üì‚Üì‚Üì */
LEFT JOIN subtasks_html st_html ON st_html.task_id = b.task_id
LEFT JOIN creator_info  ci      ON ci.task_id      = b.task_id
LEFT JOIN executor_info ei      ON ei.task_id      = b.task_id
LEFT JOIN status_calc   sc      ON sc.task_id      = b.task_id
LEFT JOIN viewed_today  vt      ON vt.task_id      = b.task_id
                               AND vt.rn = 1;
```

üìå **IR –ø—Ä–∞—Ü—é—î**
üìå **HTML –ø—Ä–∞—Ü—é—î**
üìå **Dashboard –ø—Ä–∞—Ü—é—î**
üìå **SUM –ø—Ä–∞—Ü—é—î**

---

# 4Ô∏è‚É£ –í—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–æ—Ç–∫–æ (—á—ñ—Ç–∫–æ)

> ‚ùì *‚Äú–Ø –≤—Å–µ –æ–¥–Ω–æ –ª—ñ–∑—É –ø–æ dblink ‚Äî —â–æ —Ü–µ –∑–º—ñ–Ω—é—î?‚Äù*

‚úîÔ∏è –¢–∏ –ª—ñ–∑–µ—à –ø–æ DBLINK **–û–î–ò–ù –†–ê–ó**
‚ùå Oracle **–ë–Ü–õ–¨–®–ï –ù–ï –ù–ê–ú–ê–ì–ê–Ñ–¢–¨–°–Ø –ê–ì–†–ï–ì–£–í–ê–¢–ò HTML / LISTAGG / ROW_NUMBER**

---

# 5Ô∏è‚É£ –§—ñ–Ω–∞–ª—å–Ω–∏–π –≤–∏—Å–Ω–æ–≤–æ–∫

–¢–∏ **–Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏—à ‚Äú–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ‚Äù**.
–¢–∏ –ø—Ä–æ—Å—Ç–æ **–ø–µ—Ä–µ—Ä—ñ—Å –º–æ–¥–µ–ª—å Oracle 12**, –∞ Oracle 21 —Ç–µ–ø–µ—Ä **–∂–æ—Ä—Å—Ç–∫—ñ—à–∏–π —ñ —á–µ—Å–Ω—ñ—à–∏–π**.

> **BASE = –ª–æ–≥—ñ–∫–∞ + –ø—Ä–∞–ø–æ—Ä—Ü—ñ**
> **FULL = UI**

–¶–µ **—î–¥–∏–Ω–∏–π —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç**.

---

–Ø–∫—â–æ —Ö–æ—á–µ—à ‚Äî –¥–∞–ª—ñ –º–æ–∂–µ–º–æ:

* üîß –≤–∏–Ω–µ—Å—Ç–∏ **SHIFT-–ª–æ–≥—ñ–∫—É**
* üìä –∑—Ä–æ–±–∏—Ç–∏ `V_TASK_DASHBOARD`
* üß™ –ø–æ–¥–∏–≤–∏—Ç–∏—Å—å `EXPLAIN PLAN` (–¥—É–∂–µ –ø–æ–∫–∞–∑–æ–≤–æ)

–ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏ üëç
