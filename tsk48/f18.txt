–î—É–∂–µ —Ö–æ—Ä–æ—à—ñ –ø–∏—Ç–∞–Ω–Ω—è üëç
–í–æ–Ω–∏ —è–∫—Ä–∞–∑ **–ø—Ä–æ ‚Äú–º–∞–≥—ñ—é‚Äù, —è–∫–æ—ó –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –Ω–µ–º–∞**. –ü–æ—è—Å–Ω—é –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–∏–∑–µ–º–ª–µ–Ω–æ, **–∫—Ä–æ–∫-–∑–∞-–∫—Ä–æ–∫–æ–º**, –±–µ–∑ —Å—Ç—Ä–∏–±–∫—ñ–≤.

---

# 1Ô∏è‚É£ –Ø–∫ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∫–∞—Å—Ç–æ–º–Ω–∞ –ø–æ–¥—ñ—è `apex-dialog-result`

### –ö–æ—Ä–æ—Ç–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å

üëâ **—Ç–∏ —ó—ó –ù–ï —Ä–µ—î—Å—Ç—Ä—É—î—à —ñ –ù–ï –æ–ø–∏—Å—É—î—à –Ω–∞–ø–µ—Ä–µ–¥**
üëâ –≤–æ–Ω–∞ –∑‚Äô—è–≤–ª—è—î—Ç—å—Å—è **–≤ –º–æ–º–µ–Ω—Ç, –∫–æ–ª–∏ –º–∏ —ó—ó —Å–∞–º—ñ ‚Äú–≤–∏—Å—Ç—Ä—ñ–ª—é—î–º–æ‚Äù**

–£ JavaScript **–ø–æ–¥—ñ—è —ñ—Å–Ω—É—î —Ä—ñ–≤–Ω–æ –≤ —Ç–æ–π –º–æ–º–µ–Ω—Ç**, –∫–æ–ª–∏ —Ö—Ç–æ—Å—å —Ä–æ–±–∏—Ç—å:

```js
apex.event.trigger(document, 'apex-dialog-result', {...});
```

---

## üîç –î–µ—Ç–∞–ª—å–Ω–æ ‚Äî —â–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è

### –û—Å—å —Ü–µ–π –∫–æ–¥ (Global Page, DA):

```js
apex.event.trigger(document, 'apex-dialog-result', {
  result: result
});
```

—Ä–æ–±–∏—Ç—å —Ç—Ä–∏ —Ä–µ—á—ñ:

1. –ë–µ—Ä–µ **–æ–±‚Äô—î–∫—Ç `document`** (–≥–ª–æ–±–∞–ª—å–Ω–∏–π –¥–ª—è –≤—Å—ñ—î—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏)
2. –°—Ç–≤–æ—Ä—é—î **–Ω–æ–≤—É –∫–∞—Å—Ç–æ–º–Ω—É –ø–æ–¥—ñ—é** –∑ —ñ–º‚Äô—è–º
   üëâ `'apex-dialog-result'`
3. –ü–µ—Ä–µ–¥–∞—î **–¥–∞–Ω—ñ –ø–æ–¥—ñ—ó** –≤ `event.detail`

> ‚ùó –ù—ñ—è–∫–æ—ó –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –Ω–µ —ñ—Å–Ω—É—î
> –¶–µ **–Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π JS-–ø–∞—Ç–µ—Ä–Ω**

---

## üîî –Ø–∫ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ 5 ‚Äú–¥—ñ–∑–Ω–∞—î—Ç—å—Å—è‚Äù, —â–æ –ø–æ–¥—ñ—è —î

–ù–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ 5 —Ç–∏ –ø–∏—à–µ—à:

```js
document.addEventListener('apex-dialog-result', function (e) {
  console.log(e.detail.result);
});
```

–¶–µ –æ–∑–Ω–∞—á–∞—î:

> ‚Äú–ö–æ–ª–∏ **–∫–æ–ª–∏—Å—å —É –º–∞–π–±—É—Ç–Ω—å–æ–º—É** —Ö—Ç–æ—Å—å –≤–∏–∫–ª–∏—á–µ
> `apex.event.trigger(document, 'apex-dialog-result')`,
> –≤–∏–∫–æ–Ω–∞–π —Ü—é —Ñ—É–Ω–∫—Ü—ñ—é.‚Äù

üìå –¢–æ–±—Ç–æ:

* —Å—Ç–æ—Ä—ñ–Ω–∫–∞ **–Ω–µ —à—É–∫–∞—î –¥—ñ–∞–ª–æ–≥**
* –Ω–µ –∑–Ω–∞—î, —Ö—Ç–æ –π–æ–≥–æ –∑–∞–∫—Ä–∏–≤
* –Ω–µ –∑–Ω–∞—î, –¥–µ –≤—ñ–Ω –±—É–≤
* –≤–æ–Ω–∞ –ø—Ä–æ—Å—Ç–æ **—Å–ª—É—Ö–∞—î –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å–∏–≥–Ω–∞–ª**

---

## üîë –ß–æ–º—É —Å–∞–º–µ `document`, –∞ –Ω–µ iframe

–£ APEX 24:

* dialog –∂–∏–≤–µ **–Ω–∞ —Ä—ñ–≤–Ω—ñ root document**
* iframe —Å—Ç–æ—Ä—ñ–Ω–∫–∏ 5 ‚Äî —Ç–µ–∂ —á–∞—Å—Ç–∏–Ω–∞ —Ü—å–æ–≥–æ document

–¢–æ–º—É `document` = **—Å–ø—ñ–ª—å–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä**

---

## üìå –í–∏—Å–Ω–æ–≤–æ–∫ –ø–æ –ø—É–Ω–∫—Ç—É 1

‚úî –∫–∞—Å—Ç–æ–º–Ω–∞ –ø–æ–¥—ñ—è —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è **–æ–¥–Ω–∏–º —Ä—è–¥–∫–æ–º**
‚úî —Å–ª—É—Ö–∞—á –ø—Ä–æ—Å—Ç–æ ‚Äú—á–µ–∫–∞—î‚Äù
‚úî –∂–æ–¥–Ω–∏—Ö selector-—ñ–≤
‚úî –∂–æ–¥–Ω–∏—Ö iframe-—Ö–∞–∫—ñ–≤

---

# 2Ô∏è‚É£ PL/SQL –ø—Ä–æ—Ü–µ—Å —É Dialog Page ‚Äî –¥–µ —ñ —è–∫ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏

–¢–µ–ø–µ—Ä –¥—Ä—É–≥–µ, —â–µ –≤–∞–∂–ª–∏–≤—ñ—à–µ.

---

## üéØ –ú–µ—Ç–∞ –ø—Ä–æ—Ü–µ—Å—É

–ö–æ–ª–∏ —Ç–∏ –Ω–∞—Ç–∏—Å–∫–∞—î—à –∫–Ω–æ–ø–∫—É **SignBy** (page 2):

1. –ó–∞–ø–∏—Å—É—î–º–æ –¥–∞–Ω—ñ –≤ –ë–î
2. –ö–∞–∂–µ–º–æ: **"—â–æ —Å–∞–º–µ –≤—ñ–¥–±—É–ª–æ—Å—å"**
3. –ö–æ—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä–∏–≤–∞—î–º–æ dialog

---

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–µ –º—ñ—Å—Ü–µ –¥–ª—è PL/SQL

### üìç Page 2 (Dialog Page)

**Processing ‚Üí Processes ‚Üí Create**

| –ü–æ–ª–µ                  | –ó–Ω–∞—á–µ–Ω–Ω—è          |
| --------------------- | ----------------- |
| Name                  | `PR_SIGN_BY_SAVE` |
| Type                  | `PL/SQL Code`     |
| Point                 | `Processing`      |
| Server-side Condition | (–∑–∞ –ø–æ—Ç—Ä–µ–±–∏)      |
| When Button Pressed   | `SIGNBY`          |

---

## ‚úçÔ∏è –ö–æ–¥ –ø—Ä–æ—Ü–µ—Å—É (READY)

```plsql
-- 1. –¢–≤–æ—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞
insert into SIGNATUREHISTORY (...)
values (...);

-- –∞–±–æ –≤–∏–∫–ª–∏–∫ –ø–∞–∫–µ—Ç—É
-- sign_pkg.sign_by_name(...);

-- 2. –ü–µ—Ä–µ–¥–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥—ñ–∞–ª–æ–≥—É
apex_util.set_session_state(
  'P0_DIALOG_RESULT',
  'SIGN_BY_DONE'
);

-- 3. –ó–∞–∫—Ä–∏–≤–∞—î–º–æ dialog
apex_navigation.close_dialog;
```

---

## ‚ùó –í–ê–ñ–õ–ò–í–û (—Ç–∏–ø–æ–≤–∞ –ø–æ–º–∏–ª–∫–∞)

üö´ **–ù–ï —Ç—Ä–µ–±–∞**:

* –æ–∫—Ä–µ–º–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É `Close Dialog`
* Dynamic Action ‚ÄúClose Dialog‚Äù
* JS `apex.navigation.closeDialog()` –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ

üëâ **–í–°–ï –º–∞—î –±—É—Ç–∏ –≤ –æ–¥–Ω–æ–º—É PL/SQL –ø—Ä–æ—Ü–µ—Å—ñ**

---

## üîÅ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ ‚Äî JS-–∫–µ—Ä–æ–≤–∞–Ω–∏–π dialog

–Ø–∫—â–æ –∑–∞–ø–∏—Å —É –ë–î —Ä–æ–±–∏—à —á–µ—Ä–µ–∑ AJAX Callback:

```js
apex.server.process(
  'SIGN_BY_PROCESS',
  {
    x01: taskId,
    x02: signatureId
  },
  {
    success: function () {
      AppDialog.close('SIGN_BY_DONE');
    }
  }
);
```

---

## üß† –ß–æ–º—É `set_session_state` –ø—Ä–∞—Ü—é—î

–¢–æ–º—É —â–æ:

* `P0_DIALOG_RESULT` ‚Äî **Session State**
* Dialog Page —ñ Parent Page ‚Äî **–æ–¥–Ω–∞ —Å–µ—Å—ñ—è**
* Global Page –±–∞—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è

---

## üß™ –Ø–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ –≤—Å–µ –ø—Ä–∞—Ü—é—î

### –£ Console (Page 6 –∞–±–æ Journal):

```js
document.addEventListener(
  'apex-dialog-result',
  e => console.log('RESULT:', e.detail.result)
);
```

–ù–∞—Ç–∏—Å–∫–∞—î—à –∫–Ω–æ–ø–∫—É ‚Üí –º–∞—î –±—É—Ç–∏:

```
RESULT: SIGN_BY_DONE
```

---

## üß© –§—ñ–Ω–∞–ª—å–Ω–∞ –º–µ–Ω—Ç–∞–ª—å–Ω–∞ –º–æ–¥–µ–ª—å

```
[Dialog Page 2]
   |
   |  set_session_state('P0_DIALOG_RESULT')
   |  close_dialog
   v
[Global Page DA]
   |
   |  apex.event.trigger(document, 'apex-dialog-result')
   v
[Page 5 / iframe]
   |
   |  document.addEventListener(...)
   v
refresh / js / anything
```

---

## üîú –î–∞–ª—ñ –º–æ–∂–µ–º–æ

* üîß –∑—Ä–æ–±–∏—Ç–∏ **registry handler‚Äô—ñ–≤**
* üß† –ø—Ä–∏–≤‚Äô—è–∑–∞—Ç–∏ –¥–æ `page_id`
* üß™ –¥–æ–¥–∞—Ç–∏ debug-console
* üì¶ –≤–∏–Ω–µ—Å—Ç–∏ –≤—Å–µ –≤ shared JS

–Ø–∫—â–æ —Ö–æ—á–µ—à ‚Äî —Å–∫–∞–∂–∏, **–Ω–∞—Å—Ç—É–ø–Ω–∏–π –ª–æ–≥—ñ—á–Ω–∏–π –∞–ø–≥—Ä–µ–π–¥** —ñ –ø—ñ–¥–∂–µ–Ω–µ–º–æ –ø—ñ–¥ —Ç–≤—ñ–π –ø—Ä–æ—î–∫—Ç üëå
