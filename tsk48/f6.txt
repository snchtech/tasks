–î–æ–±—Ä–µ, –ª–æ–≥—ñ–∫–∞ –∑—Ä–æ–∑—É–º—ñ–ª–∞ üëç
–§–∞–∫—Ç–∏—á–Ω–æ —Ç–∏ —Ö–æ—á–µ—à **–¥–æ–≤–µ—Å—Ç–∏ ‚Äú–ó–º—ñ–Ω—É‚Äù –¥–æ —Ç–æ–≥–æ –∂ —Ä—ñ–≤–Ω—è –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—ó, —â–æ –≤–∂–µ —î –¥–ª—è –ü–Ü–ë / –ü–æ—Å–∞–¥–∏**, –∞–ª–µ –∑ –Ω—é–∞–Ω—Å–æ–º: *–ø–æ—Å–∞–¥–∞ –≤ –∑–º—ñ–Ω—ñ ‚Äî –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–∞*.

–Ø —Ä–æ–∑–ø–∏—à—É **—á—ñ—Ç–∫–æ –ø–æ —à–∞—Ä–∞—Ö**, –±–µ–∑ –≤–æ–¥–∏, –∑ –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ —Ç–µ, —â–æ –≤–∂–µ —î –≤ –ø—Ä–æ—î–∫—Ç—ñ.

---

## 1Ô∏è‚É£ –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö: `SIGNATURERIGHTS`

### ‚ûï –ù–æ–≤–µ –ø–æ–ª–µ

```sql
alter table SIGNATURERIGHTS
  add SHIFT_POSITION number;
```

> `SHIFT_POSITION`
> ‚Äì FK –Ω–∞ `POSITION.ID`
> ‚Äì **nullable**
> ‚Äì –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **—Ç—ñ–ª—å–∫–∏ –¥–ª—è WORK_TYPE = 'SHIFT'**

(—è–∫—â–æ —î check –Ω–∞ —Ç–∏–ø ‚Äî –Ω–µ —á—ñ–ø–∞—î–º–æ, –ª–æ–≥—ñ–∫—É —Ç—Ä–∏–º–∞—î–º–æ –≤ –∫–æ–¥—ñ)

---

## 2Ô∏è‚É£ –§–æ—Ä–º–∞ (–∫–∞—Ä—Ç–∫–∞ / –º–∞—Ä—à—Ä—É—Ç): –≤–∫–ª–∞–¥–∫–∞ **¬´–ù–∞ –∑–º—ñ–Ω—É¬ª**

### 2.1. –ü–æ–ª–µ –≤–∏–±–æ—Ä—É –ø–æ—Å–∞–¥–∏

* –¢–∏–ø: **Select list**
* LOV: **—Ç–æ–π —Å–∞–º–∏–π**, —â–æ –Ω–∞ –≤–∫–ª–∞–¥—Ü—ñ *¬´–ü–æ –ø–æ—Å–∞–¥—ñ¬ª*
* Required: ‚ùå **–Ω—ñ**
* Visible condition:

```plsql
:WORK_TYPE = 'SHIFT'
```

> ‚ö†Ô∏è –í–ê–ñ–õ–ò–í–û
> –ù–µ —Ä–æ–±–∏ –æ–∫—Ä–µ–º—É LOV ‚Äî **–æ–¥–Ω–∞–∫–æ–≤—ñ –¥–æ–≤—ñ–¥–Ω–∏–∫–∏ = –æ–¥–Ω–∞ –ª–æ–≥—ñ–∫–∞ –¥–æ—Å—Ç—É–ø—É**

---

### 2.2. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ `SIGNATURERIGHTS`

–£ –ø—Ä–æ—Ü–µ—Å—ñ insert/update:

```plsql
insert into signaturerights (
   task_id,
   work_type,
   shift_id,
   shift_position,
   ...
)
values (
   :P_TASK_ID,
   'SHIFT',
   :P_SHIFT_ID,
   :P_SHIFT_POSITION, -- üëà –Ω–æ–≤–µ –ø–æ–ª–µ
   ...
);
```

–Ø–∫—â–æ `P_SHIFT_POSITION` = null ‚Üí –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è null, —É—Å–µ –æ–∫.

---

## 3Ô∏è‚É£ –ö–æ–ª–µ–∫—Ü—ñ—è (–∫–∞—Ä—Ç–∫–∞ –≤—ñ–¥–º—ñ—Ç–æ–∫ + –º–∞—Ä—à—Ä—É—Ç)

–¢–∏ –≤–∂–µ —Ü–µ —Ä–æ–±–∏–≤ –¥–ª—è –ü–Ü–ë / –ü–æ—Å–∞–¥–∏ ‚Äî **—Ç—É—Ç –ø—Ä–æ—Å—Ç–æ —Ä–æ–∑—à–∏—Ä—é—î–º–æ**

### 3.1. –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤ collection

–ù–∞–ø—Ä–∏–∫–ª–∞–¥:

```plsql
apex_collection.add_member(
  p_collection_name => 'SR_COLLECTION',
  c001 => sr.id,
  c002 => sr.work_type,
  c003 => sr.shift_id,
  c004 => sr.shift_position, -- üëà –ù–û–í–ï
  ...
);
```

> ‚ùó –Ø–∫—â–æ –∫–æ–ª–µ–∫—Ü—ñ—è —Å–ø—ñ–ª—å–Ω–∞ –¥–ª—è –≤—Å—ñ—Ö —Ç–∏–ø—ñ–≤ ‚Äî **–ø–æ–∑–∏—Ü—ñ—è –º–æ–∂–µ –±—É—Ç–∏ NULL**, —Ü–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ

---

### 3.2. JOIN –¥–ª—è –Ω–∞–∑–≤–∏ –ø–æ—Å–∞–¥–∏

–ü—Ä–∏ –ø–æ–±—É–¥–æ–≤—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó –∞–±–æ —É view:

```sql
left join POSITION p_shift
  on p_shift.id = sr.shift_position
```

—ñ –≤ select:

```sql
p_shift.name as shift_position_name
```

---

## 4Ô∏è‚É£ –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –º–∞—Ä—à—Ä—É—Ç—É

### –ë—É–ª–æ:

```
–ó–º—ñ–Ω–∞ 1
```

### –°—Ç–∞–ª–æ:

```
–ó–º—ñ–Ω–∞ 1 (–ú–∞–π—Å—Ç–µ—Ä)
```

### –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è (SQL / HTML)

```sql
case
  when sr.shift_position is not null then
    '–ó–º—ñ–Ω–∞ ' || s.shift_no || ' (' || p_shift.name || ')'
  else
    '–ó–º—ñ–Ω–∞ ' || s.shift_no
end as shift_label
```

> ‚úîÔ∏è **–ñ–æ–¥–Ω–∏—Ö –æ–∫—Ä–µ–º–∏—Ö –≥—ñ–ª–æ–∫ –ª–æ–≥—ñ–∫–∏**
> ‚úîÔ∏è **–û–¥–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞ ‚Äî —á–∏—Å—Ç–æ —ñ —á–∏—Ç–∞–±–µ–ª—å–Ω–æ**

---

## 5Ô∏è‚É£ –ö–∞—Ä—Ç–∫–∞ –≤—ñ–¥–º—ñ—Ç–æ–∫ (–≤–∏–∫–æ–Ω–∞–≤–µ—Ü—å)

–ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ –º–∞—Ä—à—Ä—É—Ç—É ‚Äî **–æ–¥–Ω–∞–∫–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ —Ç–µ–∫—Å—Ç—É**, —â–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –ø–ª—É—Ç–∞–≤—Å—è.

```sql
case
  when sr.work_type = 'SHIFT'
   and sr.shift_position is not null
  then
    '–ó–º—ñ–Ω–∞ ' || s.shift_no || ' (' || p_shift.name || ')'
  when sr.work_type = 'SHIFT'
  then
    '–ó–º—ñ–Ω–∞ ' || s.shift_no
  ...
end as executor_label
```

---

## 6Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–Ω–æ–ø–∫–∏ ¬´–ü–æ—Å—Ç–∞–≤–∏—Ç–∏ –≤—ñ–¥–º—ñ—Ç–∫—É¬ª

–û—Å—å —Ç—É—Ç **–∫–ª—é—á–æ–≤–∏–π –º–æ–º–µ–Ω—Ç**, —ñ –≤—ñ–Ω –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏–π.

### –õ–æ–≥—ñ–∫–∞ –º–∞—î –±—É—Ç–∏ —Ç–∞–∫–æ—é:

#### 6.1. –ë—É–ª–æ (—É–º–æ–≤–Ω–æ)

* –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É –∑–º—ñ–Ω—ñ ‚úî
* –¥–∞—Ç–∞ –≤—Ö–æ–¥–∏—Ç—å —É shift ‚úî

#### 6.2. –¢–µ–ø–µ—Ä:

```plsql
if sr.work_type = 'SHIFT' then

  -- 1. –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–º—ñ–Ω–∏
  if not is_user_in_shift(...) then
     return false;
  end if;

  -- 2. —è–∫—â–æ –ø–æ–∑–∏—Ü—ñ—è –ù–ï –∑–∞–¥–∞–Ω–∞ ‚Äî –¥–æ—Å—Ç—É–ø —î
  if sr.shift_position is null then
     return true;
  end if;

  -- 3. —è–∫—â–æ –∑–∞–¥–∞–Ω–∞ ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø–æ—Å–∞–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
  if user.position_id = sr.shift_position then
     return true;
  else
     return false;
  end if;

end if;
```

> ‚ö†Ô∏è **–¶–µ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤–æ**
> `shift_position IS NULL` = **—É—Å—ñ –≤ –∑–º—ñ–Ω—ñ**
> `shift_position IS NOT NULL` = **—Ç—ñ–ª—å–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –ø–æ—Å–∞–¥–∞**

---

## 7Ô∏è‚É£ –£–∑–≥–æ–¥–∂–µ–Ω–Ω—è –∑ —É–∂–µ –∑—Ä–æ–±–ª–µ–Ω–æ—é –ª–æ–≥—ñ–∫–æ—é (–ü–Ü–ë / –ü–æ—Å–∞–¥–∞)

–¢–∏ –≤—Å–µ —Ä–æ–±–∏—à **–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ**:

| –¢–∏–ø          | –§—ñ–ª—å—Ç—Ä                            |
| ------------ | --------------------------------- |
| –ü–æ –ü–Ü–ë       | user_id                           |
| –ü–æ –ø–æ—Å–∞–¥—ñ    | position_id (+ department/unit)   |
| **–ü–æ –∑–º—ñ–Ω—ñ** | shift_id + **(–æ–ø—Ü.) position_id** |

–¢–æ–±—Ç–æ **SHIFT = –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**, –∞ `shift_position` ‚Äî **–¥–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ñ—ñ–ª—å—Ç—Ä**, –∞ –Ω–µ –æ–∫—Ä–µ–º–∏–π —Ç–∏–ø.

---

## 8Ô∏è‚É£ –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∞ –ø–æ—Ä–∞–¥–∞ (—â–æ–± –Ω–µ —Ä–æ–∑—Ä–æ—Å–ª–æ—Å—å)

üëâ **–ù–ï —Å—Ç–≤–æ—Ä—é–π –æ–∫—Ä–µ–º—É –ª–æ–≥—ñ–∫—É –¥–ª—è ‚Äú–ó–º—ñ–Ω–∞ + –ø–æ—Å–∞–¥–∞‚Äù**

–¢—Ä–∏–º–∞–π –ø—Ä–∞–≤–∏–ª–æ:

> *–±—É–¥—å-—è–∫–µ –ø–æ–ª–µ = –æ–±–º–µ–∂–µ–Ω–Ω—è, —è–∫—â–æ –≤–æ–Ω–æ –Ω–µ NULL*

–¶–µ:

* —Å–ø—Ä–æ—â—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
* –¥–æ–∑–≤–æ–ª–∏—Ç—å –ø—ñ–∑–Ω—ñ—à–µ –¥–æ–¥–∞—Ç–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

  * `shift_unit`
  * `shift_uchastok`

–±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞–Ω–Ω—è –≤—Å—ñ—î—ó –ª–æ–≥—ñ–∫–∏.

---

## –Ø–∫—â–æ —Ö–æ—á–µ—à ‚Äî –¥–∞–ª—ñ –º–æ–∂–µ–º–æ:

* üîß —Ä–æ–∑–∫–ª–∞—Å—Ç–∏ **check-—Ñ—É–Ω–∫—Ü—ñ—é –¥–æ—Å—Ç—É–ø—É** —É —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ (PL/SQL)
* üß© –ø—Ä–∏–≤–µ—Å—Ç–∏ **–æ–¥–Ω—É —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é** –¥–ª—è –≤—Å—ñ—Ö —Ç–∏–ø—ñ–≤ –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤
* üß† –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –≤—ñ–¥–±—ñ—Ä SIGNATURERIGHTS (—â–æ–± –Ω–µ –≥–∞–Ω—è—Ç–∏ –∑–∞–π–≤—ñ —Ä—è–¥–∫–∏)

–°–∫–∞–∂–∏, –∫—É–¥–∏ –π–¥–µ–º–æ –¥–∞–ª—ñ.
